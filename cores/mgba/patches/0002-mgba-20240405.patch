From 8ff7cbd4eb0ac98da20f117fe87ea3cd48e0ba77 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Wed, 7 Feb 2024 01:44:57 -0800
Subject: [PATCH 01/53] CMake: Remove leftover debug print

---
 src/platform/qt/CMakeLists.txt | 1 -
 1 file changed, 1 deletion(-)

diff --git a/src/platform/qt/CMakeLists.txt b/src/platform/qt/CMakeLists.txt
index 610fa362d..cb224b0a6 100644
--- a/src/platform/qt/CMakeLists.txt
+++ b/src/platform/qt/CMakeLists.txt
@@ -335,7 +335,6 @@ if(BUILD_GL OR BUILD_GLES2 OR BUILD_EPOXY)
 		install(DIRECTORY ${PROJECT_SOURCE_DIR}/res/shaders DESTINATION ${DATADIR} COMPONENT ${BINARY_NAME}-qt)
 	else()
 		file(GLOB SHADERS ${PROJECT_SOURCE_DIR}/res/shaders/*.shader)
-		message(STATUS ${SHADERS})
 		file(MAKE_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/shaders)
 		foreach(SHADER_DIR ${SHADERS})
 			get_filename_component(SHADER ${SHADER_DIR} NAME)

From 24e161cb16476cd6014e54d1043d71566f4757c0 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Wed, 7 Feb 2024 03:38:07 -0800
Subject: [PATCH 02/53] Qt: Improve OpenGLES support and cleanup ifdef maze

---
 src/platform/qt/Display.cpp   | 48 ++++++++++++-----------------------
 src/platform/qt/DisplayGL.cpp | 47 ++++++++++++++++++++++++++++++++++
 src/platform/qt/DisplayGL.h   |  1 +
 3 files changed, 64 insertions(+), 32 deletions(-)

diff --git a/src/platform/qt/Display.cpp b/src/platform/qt/Display.cpp
index 8bec92f28..2cc7df66e 100644
--- a/src/platform/qt/Display.cpp
+++ b/src/platform/qt/Display.cpp
@@ -33,49 +33,33 @@ QGBA::Display* QGBA::Display::create(QWidget* parent) {
 	switch (s_driver) {
 #if defined(BUILD_GL) || defined(BUILD_GLES2) || defined(BUILD_GLES3) || defined(USE_EPOXY)
 	case Driver::OPENGL:
-#if defined(BUILD_GLES2) || defined(BUILD_GLES3) || defined(USE_EPOXY)
-		if (QOpenGLContext::openGLModuleType() == QOpenGLContext::LibGLES) {
-			format.setVersion(2, 0);
-		} else {
-			format.setVersion(3, 3);
-		}
-		format.setProfile(QSurfaceFormat::CoreProfile);
-		if (DisplayGL::supportsFormat(format)) {
-			QSurfaceFormat::setDefaultFormat(format);
-		} else {
-#ifdef BUILD_GL
-			LOG(QT, WARN) << ("Failed to create an OpenGL Core context, trying old-style...");
-			format.setVersion(1, 4);
-			format.setOption(QSurfaceFormat::DeprecatedFunctions);
-			if (!DisplayGL::supportsFormat(format)) {
-				return nullptr;
-			}
-#else
-			return nullptr;
-#endif
+	default:
+		if (DisplayGL::highestCompatible(format)) {
+			return new DisplayGL(format, parent);
 		}
-		return new DisplayGL(format, parent);
-#endif
+		break;
 #endif
 #ifdef BUILD_GL
 	case Driver::OPENGL1:
-		format.setVersion(1, 4);
-		if (!DisplayGL::supportsFormat(format)) {
-			return nullptr;
+		if (QOpenGLContext::openGLModuleType() == QOpenGLContext::LibGL) {
+			format.setVersion(1, 4);
+		} else {
+			format.setVersion(1, 1);
+		}
+		if (DisplayGL::supportsFormat(format)) {
+			return new DisplayGL(format, parent);
 		}
-		return new DisplayGL(format, parent);
+		break;
 #endif
 
 	case Driver::QT:
-		return new DisplayQt(parent);
-
+#if !defined(BUILD_GL) && !defined(BUILD_GLES2) && !defined(BUILD_GLES3) && !defined(USE_EPOXY)
 	default:
-#if defined(BUILD_GL) || defined(BUILD_GLES2) || defined(BUILD_GLES3) || defined(USE_EPOXY)
-		return new DisplayGL(format, parent);
-#else
-		return new DisplayQt(parent);
 #endif
+		return new DisplayQt(parent);
+
 	}
+	return nullptr;
 }
 
 QGBA::Display::Display(QWidget* parent)
diff --git a/src/platform/qt/DisplayGL.cpp b/src/platform/qt/DisplayGL.cpp
index e31437cad..3a4c3ffdd 100644
--- a/src/platform/qt/DisplayGL.cpp
+++ b/src/platform/qt/DisplayGL.cpp
@@ -53,6 +53,12 @@ typedef struct _XDisplay Display;
 #define OVERHEAD_NSEC 300000
 #endif
 
+// Legacy define from X11/X.h
+#ifdef Unsorted
+#undef Unsorted
+#endif
+
+#include "LogController.h"
 #include "OpenGLBug.h"
 #include "utils.h"
 
@@ -277,6 +283,47 @@ void DisplayGL::startDrawing(std::shared_ptr<CoreController> controller) {
 	QTimer::singleShot(8, this, &DisplayGL::updateContentSize);
 }
 
+bool DisplayGL::highestCompatible(QSurfaceFormat& format) {
+#if defined(BUILD_GLES2) || defined(BUILD_GLES3) || defined(USE_EPOXY)
+	if (QOpenGLContext::openGLModuleType() == QOpenGLContext::LibGL) {
+		format.setVersion(3, 3);
+		format.setProfile(QSurfaceFormat::CoreProfile);
+		if (DisplayGL::supportsFormat(format)) {
+			return true;
+		}
+	} else {
+#if defined(BUILD_GLES3) || defined(USE_EPOXY)
+		format.setVersion(3, 1);
+		if (DisplayGL::supportsFormat(format)) {
+			return true;
+		}
+#endif
+#if defined(BUILD_GLES2) || defined(USE_EPOXY)
+		format.setVersion(2, 0);
+		if (DisplayGL::supportsFormat(format)) {
+			return true;
+		}
+#endif
+	}
+#endif
+
+#ifdef BUILD_GL
+#if defined(BUILD_GLES2) || defined(BUILD_GLES3) || defined(USE_EPOXY)
+	LOG(QT, WARN) << tr("Failed to create an OpenGL 3 context, trying old-style...");
+#endif
+	if (QOpenGLContext::openGLModuleType() == QOpenGLContext::LibGL) {
+		format.setVersion(1, 4);
+	} else {
+		format.setVersion(1, 1);			
+	}
+	format.setOption(QSurfaceFormat::DeprecatedFunctions);
+	if (DisplayGL::supportsFormat(format)) {
+			return true;
+	}
+#endif
+	return false;
+}
+
 bool DisplayGL::supportsFormat(const QSurfaceFormat& format) {
 	if (!s_supports.contains(format)) {
 		QOpenGLContext context;
diff --git a/src/platform/qt/DisplayGL.h b/src/platform/qt/DisplayGL.h
index d94a68621..71e2de597 100644
--- a/src/platform/qt/DisplayGL.h
+++ b/src/platform/qt/DisplayGL.h
@@ -96,6 +96,7 @@ public:
 	int framebufferHandle() override;
 	QSize contentSize() const override { return m_cachedContentSize; }
 
+	static bool highestCompatible(QSurfaceFormat&);
 	static bool supportsFormat(const QSurfaceFormat&);
 
 public slots:

From 38f9a7375b903f21804306201af5cd1b754c1e06 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Thu, 8 Feb 2024 17:15:18 -0800
Subject: [PATCH 03/53] Core: Move rewind state coalescing into
 mCoreRewindRestore

---
 include/mgba/core/rewind.h         |  2 +-
 src/core/rewind.c                  | 46 ++++++++++++++++--------------
 src/core/thread.c                  |  2 +-
 src/platform/qt/CoreController.cpp |  6 +---
 4 files changed, 28 insertions(+), 28 deletions(-)

diff --git a/include/mgba/core/rewind.h b/include/mgba/core/rewind.h
index 9d2595557..2f33886ca 100644
--- a/include/mgba/core/rewind.h
+++ b/include/mgba/core/rewind.h
@@ -40,7 +40,7 @@ void mCoreRewindContextDeinit(struct mCoreRewindContext*);
 
 struct mCore;
 void mCoreRewindAppend(struct mCoreRewindContext*, struct mCore*);
-bool mCoreRewindRestore(struct mCoreRewindContext*, struct mCore*);
+bool mCoreRewindRestore(struct mCoreRewindContext*, struct mCore*, unsigned count);
 
 CXX_GUARD_END
 
diff --git a/src/core/rewind.c b/src/core/rewind.c
index 21120ec21..b8ba752dd 100644
--- a/src/core/rewind.c
+++ b/src/core/rewind.c
@@ -115,7 +115,7 @@ void _rewindDiff(struct mCoreRewindContext* context) {
 	context->currentState->unmap(context->currentState, next, size);
 }
 
-bool mCoreRewindRestore(struct mCoreRewindContext* context, struct mCore* core) {
+bool mCoreRewindRestore(struct mCoreRewindContext* context, struct mCore* core, unsigned count) {
 #ifndef DISABLE_THREADING
 	if (context->onThread) {
 		MutexLock(&context->mutex);
@@ -129,30 +129,34 @@ bool mCoreRewindRestore(struct mCoreRewindContext* context, struct mCore* core)
 #endif
 		return false;
 	}
-	--context->size;
 
-	mCoreLoadStateNamed(core, context->previousState, SAVESTATE_SAVEDATA | SAVESTATE_RTC);
-	if (context->current == 0) {
-		context->current = mCoreRewindPatchesSize(&context->patchMemory);
-	}
-	--context->current;
+	for (; count && context->size; --count, --context->size) {
+		if (context->current == 0) {
+			context->current = mCoreRewindPatchesSize(&context->patchMemory);
+		}
+		--context->current;
 
-	if (context->size) {
-		struct PatchFast* patch = mCoreRewindPatchesGetPointer(&context->patchMemory, context->current);
-		size_t size2 = context->previousState->size(context->previousState);
-		size_t size = context->currentState->size(context->currentState);
-		if (size2 < size) {
-			size = size2;
+		if (context->size > 1) {
+			struct PatchFast* patch = mCoreRewindPatchesGetPointer(&context->patchMemory, context->current);
+			size_t size2 = context->previousState->size(context->previousState);
+			size_t size = context->currentState->size(context->currentState);
+			if (size2 < size) {
+				size = size2;
+			}
+			void* current = context->currentState->map(context->currentState, size, MAP_READ);
+			void* previous = context->previousState->map(context->previousState, size, MAP_WRITE);
+			patch->d.applyPatch(&patch->d, previous, size, current, size);
+			context->currentState->unmap(context->currentState, current, size);
+			context->previousState->unmap(context->previousState, previous, size);
 		}
-		void* current = context->currentState->map(context->currentState, size, MAP_READ);
-		void* previous = context->previousState->map(context->previousState, size, MAP_WRITE);
-		patch->d.applyPatch(&patch->d, previous, size, current, size);
-		context->currentState->unmap(context->currentState, current, size);
-		context->previousState->unmap(context->previousState, previous, size);
+		struct VFile* nextState = context->previousState;
+		context->previousState = context->currentState;
+		context->currentState = nextState;
 	}
-	struct VFile* nextState = context->previousState;
-	context->previousState = context->currentState;
-	context->currentState = nextState;
+
+	mCoreLoadStateNamed(core, context->currentState, SAVESTATE_SAVEDATA | SAVESTATE_RTC);
+
+
 #ifndef DISABLE_THREADING
 	if (context->onThread) {
 		MutexUnlock(&context->mutex);
diff --git a/src/core/thread.c b/src/core/thread.c
index 903d4b844..b458f5e12 100644
--- a/src/core/thread.c
+++ b/src/core/thread.c
@@ -153,7 +153,7 @@ void _frameStarted(void* context) {
 		return;
 	}
 	if (thread->core->opts.rewindEnable && thread->core->opts.rewindBufferCapacity > 0) {
-		if (!thread->impl->rewinding || !mCoreRewindRestore(&thread->impl->rewind, thread->core)) {
+		if (!thread->impl->rewinding || !mCoreRewindRestore(&thread->impl->rewind, thread->core, 1)) {
 			if (thread->impl->rewind.rewindFrameCounter == 0) {
 				mCoreRewindAppend(&thread->impl->rewind, thread->core);
 				thread->impl->rewind.rewindFrameCounter = thread->core->opts.rewindBufferInterval;
diff --git a/src/platform/qt/CoreController.cpp b/src/platform/qt/CoreController.cpp
index 2e2bd5fed..dd74cce78 100644
--- a/src/platform/qt/CoreController.cpp
+++ b/src/platform/qt/CoreController.cpp
@@ -556,11 +556,7 @@ void CoreController::rewind(int states) {
 	if (!states) {
 		states = INT_MAX;
 	}
-	for (int i = 0; i < states; ++i) {
-		if (!mCoreRewindRestore(&m_threadContext.impl->rewind, m_threadContext.core)) {
-			break;
-		}
-	}
+	mCoreRewindRestore(&m_threadContext.impl->rewind, m_threadContext.core, states);
 	interrupter.resume();
 	emit frameAvailable();
 	emit rewound();

From d40ab470b35891c364616f8530b627f1d16fe77f Mon Sep 17 00:00:00 2001
From: oltolm <oleg.tolmatcev@gmail.com>
Date: Sun, 7 Jan 2024 12:13:26 +0100
Subject: [PATCH 04/53] CMake: make compile with mingw-w64 and Qt6

---
 .gitignore                      |  4 ++++
 CMakeLists.txt                  |  4 +++-
 CMakePresets.json               | 21 +++++++++++++++++++++
 src/platform/sdl/CMakeLists.txt |  1 +
 4 files changed, 29 insertions(+), 1 deletion(-)
 create mode 100644 CMakePresets.json

diff --git a/.gitignore b/.gitignore
index 999fdd673..fedbc461f 100644
--- a/.gitignore
+++ b/.gitignore
@@ -20,6 +20,10 @@
 CMakeCache.txt
 CMakeFiles
 CMakeSettings.json
+CMakeUserPresets.json
+compile_commands.json
+/.cache
+/.vscode
 cmake_install.cmake
 hle-bios.bin
 version.c
diff --git a/CMakeLists.txt b/CMakeLists.txt
index a1e730e04..4bf160665 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -217,13 +217,15 @@ endif()
 # Platform support
 if(WIN32)
 	set(WIN32_VERSION "${LIB_VERSION_MAJOR},${LIB_VERSION_MINOR},${LIB_VERSION_PATCH}")
-	add_definitions(-D_WIN32_WINNT=0x0600)
 	set(CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS TRUE)
 	if(MSVC)
 		add_definitions(-DNOMINMAX -DWIN32_LEAN_AND_MEAN)
 		add_definitions(-D_UNICODE -DUNICODE)
 	else()
 		add_definitions(-D_GNU_SOURCE)
+		if(CMAKE_SIZEOF_VOID_P EQUAL 8)
+			add_compile_definitions(_FILE_OFFSET_BITS=64)
+		endif()
 	endif()
 	list(APPEND OS_LIB ws2_32 shlwapi)
 	list(APPEND CORE_VFS_SRC ${CMAKE_CURRENT_SOURCE_DIR}/src/util/vfs/vfs-fd.c ${CMAKE_CURRENT_SOURCE_DIR}/src/platform/windows/vfs-w32.c)
diff --git a/CMakePresets.json b/CMakePresets.json
new file mode 100644
index 000000000..584b1987d
--- /dev/null
+++ b/CMakePresets.json
@@ -0,0 +1,21 @@
+{
+    "version": 3,
+    "configurePresets": [
+        {
+            "name": "clang",
+            "generator": "Ninja",
+            "cacheVariables": {
+                "CMAKE_BUILD_TYPE": "Debug",
+                "CMAKE_EXPORT_COMPILE_COMMANDS": "ON"
+            }
+        },
+        {
+            "name": "gcc",
+            "generator": "Ninja",
+            "cacheVariables": {
+                "CMAKE_BUILD_TYPE": "Debug",
+                "CMAKE_EXPORT_COMPILE_COMMANDS": "ON"
+            }
+        }
+    ]
+}
\ No newline at end of file
diff --git a/src/platform/sdl/CMakeLists.txt b/src/platform/sdl/CMakeLists.txt
index ca1919da9..07c773fb2 100644
--- a/src/platform/sdl/CMakeLists.txt
+++ b/src/platform/sdl/CMakeLists.txt
@@ -125,6 +125,7 @@ target_link_libraries(${BINARY_NAME}-sdl ${BINARY_NAME} ${PLATFORM_LIBRARY} ${OP
 if(NOT WIN32)
 	set_target_properties(${BINARY_NAME}-sdl PROPERTIES OUTPUT_NAME ${BINARY_NAME})
 else()
+	target_compile_definitions(${BINARY_NAME}-sdl PRIVATE _WIN32_WINNT=0x0600)
 	set_target_properties(${BINARY_NAME}-sdl PROPERTIES RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}")
 endif()
 install(TARGETS ${BINARY_NAME}-sdl DESTINATION ${CMAKE_INSTALL_BINDIR} COMPONENT ${BINARY_NAME}-sdl)

From 84ded099b706d54f2e3e9270c9e069b6ee742f3a Mon Sep 17 00:00:00 2001
From: oltolm <oleg.tolmatcev@gmail.com>
Date: Sun, 7 Jan 2024 12:16:52 +0100
Subject: [PATCH 05/53] fix compilation warnings

---
 include/mgba-util/common.h                       |  4 ----
 include/mgba-util/platform/windows/threading.h   |  2 +-
 src/core/thread.c                                | 16 ++++++++--------
 src/platform/qt/AudioProcessorSDL.h              |  1 +
 src/platform/qt/ColorPicker.cpp                  |  4 +---
 src/platform/qt/ForwarderController.cpp          |  4 ++--
 src/platform/qt/ForwarderGenerator3DS.h          |  2 +-
 src/platform/qt/GBAKeyEditor.cpp                 |  1 +
 src/platform/qt/SettingsView.cpp                 |  1 +
 src/platform/qt/ShortcutController.cpp           |  8 ++++----
 src/platform/qt/input/SDLInputDriver.h           |  2 ++
 src/platform/qt/main.cpp                         | 10 ++++++----
 .../qt/scripting/ScriptingController.cpp         | 16 ++++++++--------
 src/platform/qt/scripting/ScriptingController.h  |  2 +-
 src/platform/sdl/main.c                          |  1 +
 15 files changed, 38 insertions(+), 36 deletions(-)

diff --git a/include/mgba-util/common.h b/include/mgba-util/common.h
index 9625d3d90..f502cd664 100644
--- a/include/mgba-util/common.h
+++ b/include/mgba-util/common.h
@@ -14,10 +14,6 @@
 #define CXX_GUARD_END
 #endif
 
-#ifdef __MINGW32__
-#define __USE_MINGW_ANSI_STDIO 1
-#endif
-
 CXX_GUARD_START
 
 #include <assert.h>
diff --git a/include/mgba-util/platform/windows/threading.h b/include/mgba-util/platform/windows/threading.h
index 3f5de5a77..df1e90205 100644
--- a/include/mgba-util/platform/windows/threading.h
+++ b/include/mgba-util/platform/windows/threading.h
@@ -8,7 +8,7 @@
 
 #include <mgba-util/common.h>
 
-#define _WIN32_WINNT 0x0600
+#define WIN32_LEAN_AND_MEAN
 #include <windows.h>
 #define THREAD_ENTRY DWORD WINAPI
 typedef THREAD_ENTRY ThreadEntry(LPVOID);
diff --git a/src/core/thread.c b/src/core/thread.c
index b458f5e12..63b8e0d56 100644
--- a/src/core/thread.c
+++ b/src/core/thread.c
@@ -218,17 +218,17 @@ ADD_CALLBACK(savedataUpdated)
 ADD_CALLBACK(alarm)
 
 #undef ADD_CALLBACK
-#define CALLBACK(NAME) _script_ ## NAME
+#define SCRIPT(NAME) _script_ ## NAME
 
 static void _mCoreThreadAddCallbacks(struct mCoreThread* threadContext) {
 	struct mCoreCallbacks callbacks = {
-		.videoFrameEnded = CALLBACK(frame),
-		.coreCrashed = CALLBACK(crashed),
-		.sleep = CALLBACK(sleep),
-		.shutdown = CALLBACK(stop),
-		.keysRead = CALLBACK(keysRead),
-		.savedataUpdated = CALLBACK(savedataUpdated),
-		.alarm = CALLBACK(alarm),
+		.videoFrameEnded = SCRIPT(frame),
+		.coreCrashed = SCRIPT(crashed),
+		.sleep = SCRIPT(sleep),
+		.shutdown = SCRIPT(stop),
+		.keysRead = SCRIPT(keysRead),
+		.savedataUpdated = SCRIPT(savedataUpdated),
+		.alarm = SCRIPT(alarm),
 		.context = threadContext
 	};
 	threadContext->core->addCoreCallbacks(threadContext->core, &callbacks);
diff --git a/src/platform/qt/AudioProcessorSDL.h b/src/platform/qt/AudioProcessorSDL.h
index c2d5d0ee1..2f86c0e16 100644
--- a/src/platform/qt/AudioProcessorSDL.h
+++ b/src/platform/qt/AudioProcessorSDL.h
@@ -9,6 +9,7 @@
 
 #ifdef BUILD_SDL
 
+#define SDL_MAIN_HANDLED
 #include "platform/sdl/sdl-audio.h"
 
 namespace QGBA {
diff --git a/src/platform/qt/ColorPicker.cpp b/src/platform/qt/ColorPicker.cpp
index 22d995c0f..8cebab520 100644
--- a/src/platform/qt/ColorPicker.cpp
+++ b/src/platform/qt/ColorPicker.cpp
@@ -44,13 +44,11 @@ bool ColorPicker::eventFilter(QObject* obj, QEvent* event) {
 		return false;
 	}
 
-	QWidget* swatch = static_cast<QWidget*>(obj);
-
 	QColorDialog* colorPicker = new QColorDialog;
 	colorPicker->setAttribute(Qt::WA_DeleteOnClose);
 	colorPicker->setCurrentColor(m_defaultColor);
 	colorPicker->open();
-	connect(colorPicker, &QColorDialog::colorSelected, [this, swatch](const QColor& color) {
+	connect(colorPicker, &QColorDialog::colorSelected, [this](const QColor& color) {
 		setColor(color);
 		emit colorChanged(color);
 	});
diff --git a/src/platform/qt/ForwarderController.cpp b/src/platform/qt/ForwarderController.cpp
index 56e202019..0934f1c69 100644
--- a/src/platform/qt/ForwarderController.cpp
+++ b/src/platform/qt/ForwarderController.cpp
@@ -232,9 +232,9 @@ bool ForwarderController::toolInstalled(const QString& tool) {
 
 void ForwarderController::connectReply(QNetworkReply* reply, Download download, void (ForwarderController::*next)(QNetworkReply*)) {
 #if (QT_VERSION >= QT_VERSION_CHECK(5, 15, 0))
-	connect(reply, &QNetworkReply::errorOccurred, this, [this, reply]() {
+	connect(reply, &QNetworkReply::errorOccurred, this, [this]() {
 #else
-	connect(reply, qOverload<>(&QNetworkReply::error), this, [this, reply]() {
+	connect(reply, qOverload<>(&QNetworkReply::error), this, [this]() {
 #endif
 		emit buildFailed();
 	});
diff --git a/src/platform/qt/ForwarderGenerator3DS.h b/src/platform/qt/ForwarderGenerator3DS.h
index b22585063..8713be1bf 100644
--- a/src/platform/qt/ForwarderGenerator3DS.h
+++ b/src/platform/qt/ForwarderGenerator3DS.h
@@ -23,7 +23,7 @@ public:
 	System system() const override { return System::N3DS; }
 	QString extension() const override { return QLatin1String("cia"); }
 
-	virtual QStringList externalTools() const { return {"bannertool", "3dstool", "ctrtool", "makerom"}; }
+	virtual QStringList externalTools() const override { return {"bannertool", "3dstool", "ctrtool", "makerom"}; }
 
 	void rebuild(const QString& source, const QString& target) override;
 
diff --git a/src/platform/qt/GBAKeyEditor.cpp b/src/platform/qt/GBAKeyEditor.cpp
index 88963afa2..4536bda2a 100644
--- a/src/platform/qt/GBAKeyEditor.cpp
+++ b/src/platform/qt/GBAKeyEditor.cpp
@@ -18,6 +18,7 @@
 #include "KeyEditor.h"
 
 #ifdef BUILD_SDL
+#define SDL_MAIN_HANDLED
 #include "platform/sdl/sdl-events.h"
 #endif
 
diff --git a/src/platform/qt/SettingsView.cpp b/src/platform/qt/SettingsView.cpp
index 7f0fef53f..04d7d1649 100644
--- a/src/platform/qt/SettingsView.cpp
+++ b/src/platform/qt/SettingsView.cpp
@@ -26,6 +26,7 @@
 #include <mgba/internal/gba/gba.h>
 
 #ifdef BUILD_SDL
+#define SDL_MAIN_HANDLED
 #include "platform/sdl/sdl-events.h"
 #endif
 
diff --git a/src/platform/qt/ShortcutController.cpp b/src/platform/qt/ShortcutController.cpp
index d1165a9ba..db7f27e6a 100644
--- a/src/platform/qt/ShortcutController.cpp
+++ b/src/platform/qt/ShortcutController.cpp
@@ -143,7 +143,7 @@ bool ShortcutController::eventFilter(QObject* obj, QEvent* event) {
 		QKeyEvent* keyEvent = static_cast<QKeyEvent*>(event);
 #ifdef ENABLE_SCRIPTING
 		if (m_scripting) {
-			m_scripting->event(obj, event);
+			m_scripting->scriptingEvent(obj, event);
 		}
 #endif
 		if (keyEvent->isAutoRepeat()) {
@@ -165,7 +165,7 @@ bool ShortcutController::eventFilter(QObject* obj, QEvent* event) {
 	if (event->type() == GamepadButtonEvent::Down()) {
 #ifdef ENABLE_SCRIPTING
 		if (m_scripting) {
-			m_scripting->event(obj, event);
+			m_scripting->scriptingEvent(obj, event);
 		}
 #endif
 		auto item = m_buttons.find(static_cast<GamepadButtonEvent*>(event)->value());
@@ -186,7 +186,7 @@ bool ShortcutController::eventFilter(QObject* obj, QEvent* event) {
 	if (event->type() == GamepadButtonEvent::Up()) {
 #ifdef ENABLE_SCRIPTING
 		if (m_scripting) {
-			m_scripting->event(obj, event);
+			m_scripting->scriptingEvent(obj, event);
 		}
 #endif
 		auto item = m_buttons.find(static_cast<GamepadButtonEvent*>(event)->value());
@@ -224,7 +224,7 @@ bool ShortcutController::eventFilter(QObject* obj, QEvent* event) {
 #ifdef ENABLE_SCRIPTING
 	if (event->type() == GamepadHatEvent::Type()) {
 		if (m_scripting) {
-			m_scripting->event(obj, event);
+			m_scripting->scriptingEvent(obj, event);
 		}
 	}
 #endif
diff --git a/src/platform/qt/input/SDLInputDriver.h b/src/platform/qt/input/SDLInputDriver.h
index 61f1e6238..4a4916ad3 100644
--- a/src/platform/qt/input/SDLInputDriver.h
+++ b/src/platform/qt/input/SDLInputDriver.h
@@ -8,6 +8,8 @@
 #include "input/Gamepad.h"
 #include "input/InputDriver.h"
 
+#define SDL_MAIN_HANDLED
+
 #include "platform/sdl/sdl-events.h"
 
 #include <memory>
diff --git a/src/platform/qt/main.cpp b/src/platform/qt/main.cpp
index c245cff53..62967bf1a 100644
--- a/src/platform/qt/main.cpp
+++ b/src/platform/qt/main.cpp
@@ -109,8 +109,9 @@ int main(int argc, char* argv[]) {
 #endif
 
 	QTranslator qtTranslator;
-	qtTranslator.load(locale, "qt", "_", QLibraryInfo::location(QLibraryInfo::TranslationsPath));
-	application.installTranslator(&qtTranslator);
+	if (qtTranslator.load(locale, "qt", "_", QLibraryInfo::location(QLibraryInfo::TranslationsPath))) {
+		application.installTranslator(&qtTranslator);
+	}
 
 #ifdef QT_STATIC
 	QTranslator qtStaticTranslator;
@@ -119,8 +120,9 @@ int main(int argc, char* argv[]) {
 #endif
 
 	QTranslator langTranslator;
-	langTranslator.load(locale, binaryName, "-", ":/translations/");
-	application.installTranslator(&langTranslator);
+	if (langTranslator.load(locale, binaryName, "-", ":/translations/")) {
+		application.installTranslator(&langTranslator);
+	}
 
 	Window* w = application.newWindow();
 	w->loadConfig();
diff --git a/src/platform/qt/scripting/ScriptingController.cpp b/src/platform/qt/scripting/ScriptingController.cpp
index 065754bf1..06adafdf5 100644
--- a/src/platform/qt/scripting/ScriptingController.cpp
+++ b/src/platform/qt/scripting/ScriptingController.cpp
@@ -170,11 +170,11 @@ void ScriptingController::flushStorage() {
 }
 
 bool ScriptingController::eventFilter(QObject* obj, QEvent* ev) {
-	event(obj, ev);
+	scriptingEvent(obj, ev);
 	return false;
 }
 
-void ScriptingController::event(QObject* obj, QEvent* event) {
+void ScriptingController::scriptingEvent(QObject* obj, QEvent* event) {
 	if (!m_controller) {
 		return;
 	}
@@ -188,7 +188,7 @@ void ScriptingController::event(QObject* obj, QEvent* event) {
 		return;
 	case QEvent::KeyPress:
 	case QEvent::KeyRelease: {
-		struct mScriptKeyEvent ev{mSCRIPT_EV_TYPE_KEY};
+		struct mScriptKeyEvent ev{{mSCRIPT_EV_TYPE_KEY}};
 		auto keyEvent = static_cast<QKeyEvent*>(event);
 		ev.state = event->type() == QEvent::KeyRelease ? mSCRIPT_INPUT_STATE_UP :
 			static_cast<QKeyEvent*>(event)->isAutoRepeat() ? mSCRIPT_INPUT_STATE_HELD : mSCRIPT_INPUT_STATE_DOWN;
@@ -199,7 +199,7 @@ void ScriptingController::event(QObject* obj, QEvent* event) {
 	}
 	case QEvent::MouseButtonPress:
 	case QEvent::MouseButtonRelease: {
-		struct mScriptMouseButtonEvent ev{mSCRIPT_EV_TYPE_MOUSE_BUTTON};
+		struct mScriptMouseButtonEvent ev{{mSCRIPT_EV_TYPE_MOUSE_BUTTON}};
 		auto mouseEvent = static_cast<QMouseEvent*>(event);
 		ev.mouse = 0;
 		ev.state = event->type() == QEvent::MouseButtonPress ? mSCRIPT_INPUT_STATE_DOWN : mSCRIPT_INPUT_STATE_UP;
@@ -208,7 +208,7 @@ void ScriptingController::event(QObject* obj, QEvent* event) {
 		return;
 	}
 	case QEvent::MouseMove: {
-		struct mScriptMouseMoveEvent ev{mSCRIPT_EV_TYPE_MOUSE_MOVE};
+		struct mScriptMouseMoveEvent ev{{mSCRIPT_EV_TYPE_MOUSE_MOVE}};
 		auto mouseEvent = static_cast<QMouseEvent*>(event);
 		QPoint pos = mouseEvent->pos();
 		pos = static_cast<Display*>(obj)->normalizedPoint(m_controller.get(), pos);
@@ -219,7 +219,7 @@ void ScriptingController::event(QObject* obj, QEvent* event) {
 		return;
 	}
 	case QEvent::Wheel: {
-		struct mScriptMouseWheelEvent ev{mSCRIPT_EV_TYPE_MOUSE_WHEEL};
+		struct mScriptMouseWheelEvent ev{{mSCRIPT_EV_TYPE_MOUSE_WHEEL}};
 		auto wheelEvent = static_cast<QWheelEvent*>(event);
 		QPoint adelta = wheelEvent->angleDelta();
 		QPoint pdelta = wheelEvent->pixelDelta();
@@ -240,7 +240,7 @@ void ScriptingController::event(QObject* obj, QEvent* event) {
 
 	auto type = event->type();
 	if (type == GamepadButtonEvent::Down() || type == GamepadButtonEvent::Up()) {
-		struct mScriptGamepadButtonEvent ev{mSCRIPT_EV_TYPE_GAMEPAD_BUTTON};
+		struct mScriptGamepadButtonEvent ev{{mSCRIPT_EV_TYPE_GAMEPAD_BUTTON}};
 		auto gamepadEvent = static_cast<GamepadButtonEvent*>(event);
 		ev.pad = 0;
 		ev.state = event->type() == GamepadButtonEvent::Down() ? mSCRIPT_INPUT_STATE_DOWN : mSCRIPT_INPUT_STATE_UP;
@@ -248,7 +248,7 @@ void ScriptingController::event(QObject* obj, QEvent* event) {
 		mScriptContextFireEvent(&m_scriptContext, &ev.d);
 	}
 	if (type == GamepadHatEvent::Type()) {
-		struct mScriptGamepadHatEvent ev{mSCRIPT_EV_TYPE_GAMEPAD_HAT};
+		struct mScriptGamepadHatEvent ev{{mSCRIPT_EV_TYPE_GAMEPAD_HAT}};
 		updateGamepad();
 		auto gamepadEvent = static_cast<GamepadHatEvent*>(event);
 		ev.pad = 0;
diff --git a/src/platform/qt/scripting/ScriptingController.h b/src/platform/qt/scripting/ScriptingController.h
index a44e52b2e..9e5b3f6b5 100644
--- a/src/platform/qt/scripting/ScriptingController.h
+++ b/src/platform/qt/scripting/ScriptingController.h
@@ -43,7 +43,7 @@ public:
 	bool loadFile(const QString& path);
 	bool load(VFileDevice& vf, const QString& name);
 
-	void event(QObject* obj, QEvent* ev);
+	void scriptingEvent(QObject* obj, QEvent* ev);
 
 	mScriptContext* context() { return &m_scriptContext; }
 	ScriptingTextBufferModel* textBufferModel() const { return m_bufferModel; }
diff --git a/src/platform/sdl/main.c b/src/platform/sdl/main.c
index f71f1cfc5..d6a41f611 100644
--- a/src/platform/sdl/main.c
+++ b/src/platform/sdl/main.c
@@ -47,6 +47,7 @@ static void _loadState(struct mCoreThread* thread) {
 int main(int argc, char** argv) {
 #ifdef _WIN32
 	AttachConsole(ATTACH_PARENT_PROCESS);
+	freopen("CONOUT$", "w", stdout);
 #endif
 	struct mSDLRenderer renderer = {0};
 

From 7a63654859becfa4c07101925bf03b190ab8e2dd Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Mon, 4 Mar 2024 21:52:25 -0800
Subject: [PATCH 06/53] Windows: Fix compilation woes from last commit

---
 include/mgba-util/common.h                     | 18 +++++++++++++-----
 include/mgba-util/platform/windows/threading.h |  2 --
 src/platform/sdl/CMakeLists.txt                |  1 -
 3 files changed, 13 insertions(+), 8 deletions(-)

diff --git a/include/mgba-util/common.h b/include/mgba-util/common.h
index f502cd664..5ef829da8 100644
--- a/include/mgba-util/common.h
+++ b/include/mgba-util/common.h
@@ -16,6 +16,19 @@
 
 CXX_GUARD_START
 
+#ifdef _WIN32
+#define WIN32_LEAN_AND_MEAN
+// Require Windows 7 or newer
+#ifndef _WIN32_WINNT
+#define _WIN32_WINNT 0x0601
+#elif _WIN32_WINNT < 0x0601
+#undef _WIN32_WINNT
+#define _WIN32_WINNT 0x0601
+#endif
+// WinSock2 gets very angry if it's included too late
+#include <winsock2.h>
+#endif
+
 #include <assert.h>
 #include <ctype.h>
 #include <fcntl.h>
@@ -31,11 +44,6 @@ CXX_GUARD_START
 #include <string.h>
 #include <time.h>
 
-#ifdef _WIN32
-// WinSock2 gets very angry if it is included too late
-#include <winsock2.h>
-#endif
-
 #if defined(_MSC_VER) || defined(__cplusplus)
 #define restrict __restrict
 #endif
diff --git a/include/mgba-util/platform/windows/threading.h b/include/mgba-util/platform/windows/threading.h
index df1e90205..7b1589075 100644
--- a/include/mgba-util/platform/windows/threading.h
+++ b/include/mgba-util/platform/windows/threading.h
@@ -8,8 +8,6 @@
 
 #include <mgba-util/common.h>
 
-#define WIN32_LEAN_AND_MEAN
-#include <windows.h>
 #define THREAD_ENTRY DWORD WINAPI
 typedef THREAD_ENTRY ThreadEntry(LPVOID);
 #define THREAD_EXIT(RES) return RES
diff --git a/src/platform/sdl/CMakeLists.txt b/src/platform/sdl/CMakeLists.txt
index 07c773fb2..ca1919da9 100644
--- a/src/platform/sdl/CMakeLists.txt
+++ b/src/platform/sdl/CMakeLists.txt
@@ -125,7 +125,6 @@ target_link_libraries(${BINARY_NAME}-sdl ${BINARY_NAME} ${PLATFORM_LIBRARY} ${OP
 if(NOT WIN32)
 	set_target_properties(${BINARY_NAME}-sdl PROPERTIES OUTPUT_NAME ${BINARY_NAME})
 else()
-	target_compile_definitions(${BINARY_NAME}-sdl PRIVATE _WIN32_WINNT=0x0600)
 	set_target_properties(${BINARY_NAME}-sdl PROPERTIES RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}")
 endif()
 install(TARGETS ${BINARY_NAME}-sdl DESTINATION ${CMAKE_INSTALL_BINDIR} COMPONENT ${BINARY_NAME}-sdl)

From 800f6d9f40590f619b407a808869d21a52e547bd Mon Sep 17 00:00:00 2001
From: TuxSH <1922548+TuxSH@users.noreply.github.com>
Date: Sat, 12 Aug 2023 00:17:04 +0200
Subject: [PATCH 07/53] 3DS: Implement 3x sharp bilinear scaling and make it
 the default

- Old method was 2x. 3x looks quite a bit sharper in aspect-fit mode on
  non-O2DS as the width is an integer number of half-width pixels. Since
  resulting upscaling ratio is 3x:1.5x, this gives very good results,
  althought it might be too sharp for your liking (YMMV). Not as much of
  a difference in screen-fit mode
- Remove duplicate rendertarget as it was not necessary
---
 src/platform/3ds/main.c | 97 +++++++++++++++++++++--------------------
 1 file changed, 50 insertions(+), 47 deletions(-)

diff --git a/src/platform/3ds/main.c b/src/platform/3ds/main.c
index 470c50db7..0f7bb27b9 100644
--- a/src/platform/3ds/main.c
+++ b/src/platform/3ds/main.c
@@ -47,8 +47,9 @@ static enum FilterMode {
 	FM_NEAREST,
 	FM_LINEAR_1x,
 	FM_LINEAR_2x,
+	FM_LINEAR_3x,
 	FM_MAX
-} filterMode = FM_LINEAR_2x;
+} filterMode = FM_LINEAR_3x;
 
 static enum DarkenMode {
 	DM_NATIVE,
@@ -97,9 +98,8 @@ static int bufferId = 0;
 static bool frameLimiter = true;
 static u32 frameCounter;
 
-static C3D_RenderTarget* topScreen[2];
-static C3D_RenderTarget* bottomScreen[2];
-static int doubleBuffer = 0;
+static C3D_RenderTarget* topScreen;
+static C3D_RenderTarget* bottomScreen;
 static bool frameStarted = false;
 
 static C3D_RenderTarget* upscaleBuffer;
@@ -115,28 +115,26 @@ static bool _initGpu(void) {
 	}
 
 	if (gfxIsWide()) {
-		topScreen[0] = C3D_RenderTargetCreate(240, 800, GPU_RB_RGB8, 0);
-		topScreen[1] = C3D_RenderTargetCreate(240, 800, GPU_RB_RGB8, 0);
+		topScreen = C3D_RenderTargetCreate(240, 800, GPU_RB_RGB8, 0);
 	} else {
-		topScreen[0] = C3D_RenderTargetCreate(240, 400, GPU_RB_RGB8, 0);
-		topScreen[1] = C3D_RenderTargetCreate(240, 400, GPU_RB_RGB8, 0);
+		topScreen = C3D_RenderTargetCreate(240, 400, GPU_RB_RGB8, 0);
 	}
-	bottomScreen[0] = C3D_RenderTargetCreate(240, 320, GPU_RB_RGB8, 0);
-	bottomScreen[1] = C3D_RenderTargetCreate(240, 320, GPU_RB_RGB8, 0);
-	if (!topScreen[0] || !topScreen[1] || !bottomScreen[0] || !bottomScreen[1]) {
+	bottomScreen = C3D_RenderTargetCreate(240, 320, GPU_RB_RGB8, 0);
+	if (!topScreen || !bottomScreen) {
 		return false;
 	}
 
 	C3D_FrameBegin(0);
-	C3D_FrameDrawOn(bottomScreen[0]);
-	C3D_RenderTargetClear(bottomScreen[0], C3D_CLEAR_COLOR, 0, 0);
-	C3D_FrameDrawOn(topScreen[0]);
-	C3D_RenderTargetClear(topScreen[0], C3D_CLEAR_COLOR, 0, 0);
-	C3D_RenderTargetSetOutput(topScreen[0], GFX_TOP, GFX_LEFT, GX_TRANSFER_IN_FORMAT(GX_TRANSFER_FMT_RGB8) | GX_TRANSFER_OUT_FORMAT(GX_TRANSFER_FMT_RGB8));
-	C3D_RenderTargetSetOutput(bottomScreen[0], GFX_BOTTOM, GFX_LEFT, GX_TRANSFER_IN_FORMAT(GX_TRANSFER_FMT_RGB8) | GX_TRANSFER_OUT_FORMAT(GX_TRANSFER_FMT_RGB8));
+	C3D_FrameDrawOn(bottomScreen);
+	C3D_RenderTargetClear(bottomScreen, C3D_CLEAR_COLOR, 0, 0);
+	C3D_FrameDrawOn(topScreen);
+	C3D_RenderTargetClear(topScreen, C3D_CLEAR_COLOR, 0, 0);
+	C3D_RenderTargetSetOutput(topScreen, GFX_TOP, GFX_LEFT, GX_TRANSFER_IN_FORMAT(GX_TRANSFER_FMT_RGB8) | GX_TRANSFER_OUT_FORMAT(GX_TRANSFER_FMT_RGB8));
+	C3D_RenderTargetSetOutput(bottomScreen, GFX_BOTTOM, GFX_LEFT, GX_TRANSFER_IN_FORMAT(GX_TRANSFER_FMT_RGB8) | GX_TRANSFER_OUT_FORMAT(GX_TRANSFER_FMT_RGB8));
 	C3D_FrameEnd(0);
 
-	if (!C3D_TexInitVRAM(&upscaleBufferTex, 512, 512, GPU_RGB8)) {
+	if (!C3D_TexInitVRAM(&upscaleBufferTex, 1024, 512, GPU_RGB8)) {
+		__builtin_trap();
 		return false;
 	}
 	upscaleBuffer = C3D_RenderTargetCreateFromTex(&upscaleBufferTex, GPU_TEXFACE_2D, 0, 0);
@@ -164,10 +162,8 @@ static void _cleanup(void) {
 		screenshotBuffer = NULL;
 	}
 
-	C3D_RenderTargetDelete(topScreen[0]);
-	C3D_RenderTargetDelete(topScreen[1]);
-	C3D_RenderTargetDelete(bottomScreen[0]);
-	C3D_RenderTargetDelete(bottomScreen[1]);
+	C3D_RenderTargetDelete(topScreen);
+	C3D_RenderTargetDelete(bottomScreen);
 	C3D_RenderTargetDelete(upscaleBuffer);
 	C3D_TexDelete(&upscaleBufferTex);
 	C3D_TexDelete(&outputTexture[0]);
@@ -216,10 +212,10 @@ static void _drawStart(void) {
 	C3D_FrameBegin(0);
 	ctrStartFrame();
 
-	C3D_FrameDrawOn(bottomScreen[doubleBuffer]);
-	C3D_RenderTargetClear(bottomScreen[doubleBuffer], C3D_CLEAR_COLOR, 0, 0);
-	C3D_FrameDrawOn(topScreen[doubleBuffer]);
-	C3D_RenderTargetClear(topScreen[doubleBuffer], C3D_CLEAR_COLOR, 0, 0);
+	C3D_FrameDrawOn(bottomScreen);
+	C3D_RenderTargetClear(bottomScreen, C3D_CLEAR_COLOR, 0, 0);
+	C3D_FrameDrawOn(topScreen);
+	C3D_RenderTargetClear(topScreen, C3D_CLEAR_COLOR, 0, 0);
 }
 
 static void _drawEnd(void) {
@@ -227,12 +223,10 @@ static void _drawEnd(void) {
 		return;
 	}
 	ctrEndFrame();
-	C3D_RenderTargetSetOutput(topScreen[doubleBuffer], GFX_TOP, GFX_LEFT, GX_TRANSFER_IN_FORMAT(GX_TRANSFER_FMT_RGB8) | GX_TRANSFER_OUT_FORMAT(GX_TRANSFER_FMT_RGB8));
-	C3D_RenderTargetSetOutput(bottomScreen[doubleBuffer], GFX_BOTTOM, GFX_LEFT, GX_TRANSFER_IN_FORMAT(GX_TRANSFER_FMT_RGB8) | GX_TRANSFER_OUT_FORMAT(GX_TRANSFER_FMT_RGB8));
+	C3D_RenderTargetSetOutput(topScreen, GFX_TOP, GFX_LEFT, GX_TRANSFER_IN_FORMAT(GX_TRANSFER_FMT_RGB8) | GX_TRANSFER_OUT_FORMAT(GX_TRANSFER_FMT_RGB8));
+	C3D_RenderTargetSetOutput(bottomScreen, GFX_BOTTOM, GFX_LEFT, GX_TRANSFER_IN_FORMAT(GX_TRANSFER_FMT_RGB8) | GX_TRANSFER_OUT_FORMAT(GX_TRANSFER_FMT_RGB8));
 	C3D_FrameEnd(0);
 	frameStarted = false;
-
-	doubleBuffer ^= 1;
 }
 
 static int _batteryState(void) {
@@ -256,7 +250,7 @@ static int _batteryState(void) {
 }
 
 static void _guiPrepare(void) {
-	C3D_FrameDrawOn(bottomScreen[doubleBuffer]);
+	C3D_FrameDrawOn(bottomScreen);
 	ctrSetViewportSize(320, 240, true);
 }
 
@@ -476,21 +470,33 @@ static u32 _setupTex(int out, bool faded) {
 static void _drawTex(struct mCore* core, bool faded, bool both) {
 	unsigned screen_w, screen_h;
 	bool isWide = screenMode >= SM_PA_TOP && gfxIsWide();
+
+	if (filterMode < FM_LINEAR_1x || filterMode > FM_LINEAR_3x) {
+		// Out-of-range filtering modes are not supported
+		filterMode = FM_LINEAR_3x;
+	}
+	int mult = 1 + filterMode - FM_LINEAR_1x;
+
 	switch (screenMode) {
 	case SM_PA_BOTTOM:
-		C3D_FrameDrawOn(bottomScreen[doubleBuffer]);
+		C3D_FrameDrawOn(bottomScreen);
 		screen_w = 320;
 		screen_h = 240;
 		break;
 	case SM_PA_TOP:
-		C3D_FrameDrawOn(topScreen[doubleBuffer]);
+		C3D_FrameDrawOn(topScreen);
 		screen_w = isWide ? 800 : 400;
 		screen_h = 240;
 		break;
 	default:
 		C3D_FrameDrawOn(upscaleBuffer);
-		screen_w = 512;
-		screen_h = 512;
+		// PICA200 erratum: if viewport X coord exceeds 1023, entire polygon
+		// is not rendered. If viewport Y coord exceeds 1016, GPU hangs.
+		// This can not be mitigated by scissor testing.
+		// C3D_FrameDrawOn sets the viewport dims to the texture's dims,
+		// thus we must re-set the viewport ourselves.
+		screen_w = 256 * mult;
+		screen_h = 256 * mult;
 		break;
 	}
 	int wide = isWide ? 2 : 1;
@@ -523,17 +529,13 @@ static void _drawTex(struct mCore* core, bool faded, bool both) {
 	case SM_AF_BOTTOM:
 	case SM_SF_TOP:
 	case SM_SF_BOTTOM:
-	default:
-		if (filterMode == FM_LINEAR_1x) {
-			w = corew;
-			h = coreh;
-		} else {
-			w = corew * 2;
-			h = coreh * 2;
-		}
+	default: {
+		w = corew * mult;
+		h = coreh * mult;
 		ctrSetViewportSize(screen_w, screen_h, false);
 		break;
 	}
+	}
 
 	uint32_t color = _setupTex(activeOutputTexture, faded);
 	ctrAddRectEx(color, x, y, w, h, 0, 0, corew, coreh, 0);
@@ -549,10 +551,10 @@ static void _drawTex(struct mCore* core, bool faded, bool both) {
 	coreh = h;
 	screen_h = 240;
 	if (screenMode < SM_PA_TOP) {
-		C3D_FrameDrawOn(bottomScreen[doubleBuffer]);
+		C3D_FrameDrawOn(bottomScreen);
 		screen_w = 320;
 	} else {
-		C3D_FrameDrawOn(topScreen[doubleBuffer]);
+		C3D_FrameDrawOn(topScreen);
 		screen_w = isWide ? 800 : 400;
 	}
 	ctrSetViewportSize(screen_w, screen_h, true);
@@ -979,13 +981,14 @@ int main(int argc, char* argv[]) {
 				.title = "Filtering",
 				.data = GUI_V_S("filterMode"),
 				.submenu = 0,
-				.state = FM_LINEAR_2x,
+				.state = FM_LINEAR_3x,
 				.validStates = (const char*[]) {
 					NULL, // Disable choosing nearest neighbor; it always looks bad
 					"Bilinear (smoother)",
 					"Bilinear (pixelated)",
+					"Bilinear (ultrasharp)",
 				},
-				.nStates = 3
+				.nStates = 4
 			},
 			{
 				.title = "Screen darkening",

From b133270381e926fb22db94f9743fd3130f7f1527 Mon Sep 17 00:00:00 2001
From: TuxSH <1922548+TuxSH@users.noreply.github.com>
Date: Sun, 17 Sep 2023 18:20:47 +0200
Subject: [PATCH 08/53] Fix menu bug that allowed the selection of invalid
 states when wrap=true

---
 src/util/gui/menu.c | 17 ++++++++++-------
 1 file changed, 10 insertions(+), 7 deletions(-)

diff --git a/src/util/gui/menu.c b/src/util/gui/menu.c
index 584f2d0d5..f0c624f17 100644
--- a/src/util/gui/menu.c
+++ b/src/util/gui/menu.c
@@ -18,30 +18,33 @@ DEFINE_VECTOR(GUIMenuItemList, struct GUIMenuItem);
 DEFINE_VECTOR(GUIMenuSavedList, struct GUIMenuSavedState);
 
 void _itemNext(struct GUIMenuItem* item, bool wrap) {
-	if (item->state < item->nStates - 1) {
+	if (wrap || item->state < item->nStates - 1) {
 		unsigned oldState = item->state;
 		do {
 			++item->state;
+			if (item->state >= item->nStates) {
+				item->state -= item->nStates;
+			}
 		} while (!item->validStates[item->state] && item->state < item->nStates - 1);
 		if (!item->validStates[item->state]) {
 			item->state = oldState;
 		}
-	} else if (wrap) {
-		item->state = 0;
 	}
 }
 
 void _itemPrev(struct GUIMenuItem* item, bool wrap) {
-	if (item->state > 0) {
+	if (wrap || item->state > 0) {
 		unsigned oldState = item->state;
 		do {
-			--item->state;
+			if (item->state > 0) {
+				--item->state;
+			} else {
+				item->state = item->nStates - 1;
+			}
 		} while (!item->validStates[item->state] && item->state > 0);
 		if (!item->validStates[item->state]) {
 			item->state = oldState;
 		}
-	} else if (wrap) {
-		item->state = item->nStates - 1;
 	}
 }
 

From 15d2b3708777334489ead9d1b18944925317529a Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Mon, 11 Mar 2024 21:39:45 -0700
Subject: [PATCH 09/53] GB: Fix type coercion

---
 src/gb/gb.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/gb/gb.c b/src/gb/gb.c
index 958312524..b3bb62a80 100644
--- a/src/gb/gb.c
+++ b/src/gb/gb.c
@@ -106,7 +106,7 @@ static void GBDeinit(struct mCPUComponent* component) {
 
 bool GBLoadGBX(struct GBXMetadata* metadata, struct VFile* vf) {
 	uint8_t footer[16];
-	if (vf->seek(vf, -sizeof(footer), SEEK_END) < 0) {
+	if (vf->seek(vf, -(off_t) sizeof(footer), SEEK_END) < 0) {
 		return false;
 	}
 	if (vf->read(vf, footer, sizeof(footer)) < (ssize_t) sizeof(footer)) {
@@ -1100,7 +1100,7 @@ bool GBIsROM(struct VFile* vf) {
 	}
 
 	uint8_t footer[16];
-	vf->seek(vf, -sizeof(footer), SEEK_END);
+	vf->seek(vf, -(off_t) sizeof(footer), SEEK_END);
 	if (vf->read(vf, footer, sizeof(footer)) < (ssize_t) sizeof(footer)) {
 		return false;
 	}

From 9c7a60c367f5a9d5bcca308d8bc6d26a69c6aef0 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Tue, 12 Mar 2024 17:46:25 -0700
Subject: [PATCH 10/53] SDL: Use SDL_GameControllerRumble instead of
 SDL_JoystickRumble if available

---
 src/platform/sdl/sdl-events.c | 21 +++++++++++++++++----
 1 file changed, 17 insertions(+), 4 deletions(-)

diff --git a/src/platform/sdl/sdl-events.c b/src/platform/sdl/sdl-events.c
index a675ff2c0..41783b3c3 100644
--- a/src/platform/sdl/sdl-events.c
+++ b/src/platform/sdl/sdl-events.c
@@ -665,13 +665,22 @@ void mSDLHandleEvent(struct mCoreThread* context, struct mSDLPlayer* sdlContext,
 #if SDL_VERSION_ATLEAST(2, 0, 0)
 static void _mSDLSetRumble(struct mRumble* rumble, int enable) {
 	struct mSDLRumble* sdlRumble = (struct mSDLRumble*) rumble;
-	if (!sdlRumble->p->joystick
+	if (!sdlRumble->p->joystick) {
+		return;
+	}
+
 #if !SDL_VERSION_ATLEAST(2, 0, 9)
-		|| !sdlRumble->p->joystick->haptic || !SDL_HapticRumbleSupported(sdlRumble->p->joystick->haptic)
+	if (!sdlRumble->p->joystick->haptic || !SDL_HapticRumbleSupported(sdlRumble->p->joystick->haptic)) {
+		return;
+	}
 #endif
-	 ) {
+
+#if SDL_VERSION_ATLEAST(2, 0, 18)
+	if (!sdlRumble->p->joystick->controller || !SDL_GameControllerHasRumble(sdlRumble->p->joystick->controller)) {
 		return;
 	}
+#endif
+
 	int8_t originalLevel = sdlRumble->level;
 	sdlRumble->level += enable;
 	if (CircleBufferSize(&sdlRumble->history) == RUMBLE_PWM) {
@@ -689,7 +698,11 @@ static void _mSDLSetRumble(struct mRumble* rumble, int enable) {
 	}
 	sdlRumble->activeLevel = activeLevel;
 #if SDL_VERSION_ATLEAST(2, 0, 9)
-	SDL_JoystickRumble(sdlRumble->p->joystick->joystick, activeLevel * 0xFFFF, activeLevel * 0xFFFF, 500);
+	if (sdlRumble->p->joystick->controller) {
+		SDL_GameControllerRumble(sdlRumble->p->joystick->controller, activeLevel * 0xFFFF, activeLevel * 0xFFFF, 500);
+	} else {
+		SDL_JoystickRumble(sdlRumble->p->joystick->joystick, activeLevel * 0xFFFF, activeLevel * 0xFFFF, 500);
+	}
 #else
 	if (sdlRumble->activeLevel > 0.5 / RUMBLE_STEPS) {
 		SDL_HapticRumbleStop(sdlRumble->p->joystick->haptic);

From 04d01bdfbc50bfa72779025682682cb08972f29f Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Sun, 17 Mar 2024 19:53:41 -0700
Subject: [PATCH 11/53] GB Audio: Fix audio envelope timing resetting too often
 (fixes #3164)

---
 CHANGES                                       |   1 +
 .../nrx2_speed_change/xbaseline_0000.png      | Bin 1388 -> 1193 bytes
 .../nrx2_speed_change/xbaseline_0000.png      | Bin 1402 -> 1201 bytes
 src/gb/audio.c                                |  27 +++++++++++-------
 4 files changed, 17 insertions(+), 11 deletions(-)

diff --git a/CHANGES b/CHANGES
index d850f2002..efb7d494e 100644
--- a/CHANGES
+++ b/CHANGES
@@ -6,6 +6,7 @@ Features:
  - New unlicensed GB mappers: NT (older types 1 and 2), Li Cheng, GGB-81
  - Debugger: Add range watchpoints
 Emulation fixes:
+ - GB Audio: Fix audio envelope timing resetting too often (fixes mgba.io/i/3164)
  - GB I/O: Fix STAT writing IRQ trigger conditions (fixes mgba.io/i/2501)
  - GB Serialize: Add missing Pocket Cam state to savestates
  - GB Video: Implement DMG-style sprite ordering
diff --git a/cinema/gb/samesuite/apu/channel_1/nrx2_speed_change/xbaseline_0000.png b/cinema/gb/samesuite/apu/channel_1/nrx2_speed_change/xbaseline_0000.png
index 0032b919f1aaef5acc9573be68705c0633b9bf45..e541e5c0ba570a3e33559ffc29e4b643a51c3c73 100644
GIT binary patch
literal 1193
zcmeAS@N?(olHy`uVBq!ia0vp^3xIe62NRHFxc>b*0|QHer;B4q#hkZu1B)Ij2)I1G
zGVen9ly#nVD`bV)QW`sX=YF>fQeM_O;kJNUk!CbU;{ETsKrC?RK-v6W&HF{`wjT?4
zR9gGGBJHw!(&@(r*}r;kL~XjUea`E*lbkxQe_i`{rmwuyjqiW!_Ag%<&GE2ocVxe2
z=5OtdU(?zRzv<q**<H0>X6gD=@k_tG|2<z{6V+wMdqsNd`6B|ge_kA~Gz+VjX`jB<
zq&fT4)-P+XSI5pj`*_B$Plvni{qenLP(Ir#|5AQuZU6PQ(z1&;kLoP1Kd)!?=T80B
z+Jr>QecN)a`yNj#ka0iLoAv$Xj8D4BU#~^%`PAQ&zWTqA&HMZNpTzvXaFb`-O<S99
zuiNHspCP++{#ri1rB+|})bBTnmpQL2>Xmlm^fa>{Pd3f2l3rn7yvU^Puyt*q{iO$=
zeXqHv`2_w9DZa?iy*+pL{rCP~3x93<R=@P=lfRKG`SPw_pOXAl_ObrFq=f&O)2x25
zo0exk>id@;IoE1S{rT(LatkxJ7T@-=UUhfVw&UHJ_l?5l@0<Patkx^v8rS<)a{CwU
zd-!)DUzmEy-_%tRjUr#mX5=|1t$Yw2bfN#^Y<9y!Rli;yPS@I1XC6g~{q?9#I}?0(
zlX2pQC%<aMYgzM+eZ2b*ZV<R~@KwvV*piKtXWipVzZv?^@bCKT2iLIAU;4bRV3yZ!
ztNrpeC)IzQf0@g6{K(W9Ru!s9=1eU8@bfI&4<1?LA70+qDh=b3*w(CD4s=lfyZ7sr
z%~xN}IOzMfEaFei-T(ERXPfJK?)5D$sd(d`vXOUV1>=k3FN~9eE`1C0%@xR;^KVZP
z;|uFA`gisAgzn3~{iW#3{#EbIf4G)Ev@N-IaK~<*hsC7@AFo^f+F11}q4d!6R}WPG
z32oVP&!(gE;YQvQ$G7VIYW(%b&}*Oac~M@ULno|e{61(rNq4Pg=I-lrwx`S$f2=xf
z$JMVu@3OpuyY9+C?U!epXGqB1Zm5Yly-0q=az3%;|0^$kJ3Y0kJZsZZQ`Ox3t8l%x
zr3Uxs#&sUhi;D7>UBhP_5tA=><j98`Y)>8o1K7c~bc2O{ZLZnw_ox3pkUTl<+LSGO
zLnoKU^-Pa=6m~tBeYNlnS5UAVeOcpoEv(AO>io%Bf%(Q3YU_?H{Ip`tBD<-ng}U8!
zOYY4s&x@#v$T{+0<rmx1f|zQ};_C~N*{;V`EYdvYeWu~+*T3ga8cF_svXXP}fBqZi
z6J9;w1p4dIhyIO69?mc7Xg>HTVS|N)4j)_h&}7~}l3@QPfcfnQP!Z(m>gTe~DWM4f
DU*lx*

literal 1388
zcmdUv?N<^86vk;4^a8lrI-w4A&6m^4Nz+I{GZQu6h}2Wl&}4<Qn%YppB=sbgvy2o<
zEJ>W{h%|J)fRRXyEmKOQQc@iFPQo!3MuI2}|BQXO&pr2kxaapgA8rK>8v|MAwhjOQ
zKw|e{lAOK4SygL3b1FbRuLb~C2gYI|QVKY;H&ul#UZ0o!afI7X4WbrB_ni-OKXwiv
zSog{nuux6Jt2W37gD6^iwg&%1n60JBJKp{CIR7tNKs6<usG+2@Ht6wROIOJWUz+0)
zp%+2jxlCOTa_plpy8@F9U+c0*#FCs}B$qZ4Ce4bq<P|Oqo%g44$&nf#gJX96IBA$U
zD^X8Tr3Wy`5z*yg6gilg;6P-s!YkQxF?z#<HL~c1HPKvx#((fR?2C#?bVts{+Yeyh
zacDa7HYQr1(WW*{KMDLnq_9zFWs4TQ-|P5E1w6H;*}m67A3;#-n7muJTaFhsO)WZ}
zP1q9q_G?xbtVFW?=gQHwMBw9;n`!+#<6g9c^JKEB*Jkl079|#!Oor_a!)b(=Mj@jt
zrcu*_df1>O-hXL|jMED8Z0j$LnG4b^sdS4Ef+3rd3q;+xBd{d$V(ICH&Wtxge|ueP
zAdsD_diOxqL+7hf+;G7)O~u@<yS9^C7Q{b^_qYT=Abk(HJ3A&yt*{C(tap@>E}wyB
zfb2EmK<d`3yHr`QY161)@253xZ+SZjd5Y7CE}nMPd*BDk@68x9&F8vYub<t>eyxaS
zZM#Z26=Ay4+06r`<&;MoDi5GjqG$2BSS6~1v{=2v6LRTeA#a&enRPn=yfvhl@D|nK
zo8*Dv%0i}M5}Q|ySwH2&L)kL;X3SIpv;0hyBW?+59A$QVBSp#)B_JTB9h=s#P|URq
zE~7Z_f|~5I%CjNM`ET^%s(b&I3lN7QOdjIKI>YqArGW{N%AVPb8!Em7%^464zPL3o
zgj{%5d*wnD&21=Ca_#PJHTvrAj3{;0<LC3&{Y5$HaoPl<revNh6SWQ;w%CUlT9exc
zcwmR`MxXt{wt6Qie&NPGIT+YNZ<{te(x7Vd^J`EA55%?;k{%lYUdfPJzkr*~4%D?m
zz1T4NyHH#GpiPj>4}aUarBZZ)OkblJQ{GtF&=sjm2CaW2MQ0Cl7UC^SKyE&JB$5PA
zpz>tlhd_S1KE7z+J~X=9IVj(UQcg<>+Nrf7;vVr$W3v|LS#p_)ZQ`q{BHCN&F*J_^
z4*GpvE7?1){^$L_T&hb~qG0eV_R!kGZWN5maD9%ldPr8KUtC)c(iie|8ZRZ?=wi(^
z7$I1LT^f+4#iyDw%3jPJ?HeUnLWry`9(0<-BmJ4TDeR8cbLN#3#BbMJ>$sV`=t}2r
zcKHaM6N2}N@+7a_4Yp7iC)u;^a=qPr=HFj2qQNSJ_D%)UPm??{o~2&4khckPmjnl6
z_4CIbecEN{m#Vt_P6kO<v9RC|p>IfC-)`fp(d1<RB(Mdkq#m{mcitnQRzq@Ls@=01
zO?>)1EkH4Hu---+XSi}S?G3TQZVo{`lh^CaO~>;2Ucf4UI`8oG4x^`n*p{CA)Q9yH
zM6i76==L8KeCc=I6OnY;Z?e(;%u~k^!9lRE+`v!>upCJL|E>GNckJxus7M#&%U?7$
L3X2i!%`E*7PTjq&

diff --git a/cinema/gb/samesuite/apu/channel_2/nrx2_speed_change/xbaseline_0000.png b/cinema/gb/samesuite/apu/channel_2/nrx2_speed_change/xbaseline_0000.png
index 2804b6f3a5f9ecfc563b1f9f493e383099380a35..5173a31fdeba2b6065b2a4d660eecb5cf72d6bd5 100644
GIT binary patch
literal 1201
zcmeAS@N?(olHy`uVBq!ia0vp^3xIe62NRHFxc>b*0|QHir;B4q#hkZuFHU--AmCb<
zwf{oBPu=9&1>3q?8yqBBUt9X;7CU!@PnZ`W`FyW^-(gpo;}7@FpK(6gIe4BYN0S$S
z`Io(qBYovL)=qt0+WEpf>9k7Wyq$X<z$D%SH9h`WbL@TPy84Ru^8M{!C4`^9KXPsM
zUY^2vp6B8&-nqVAe)k%?iLtN#PdWFoQ0uzAYyOq{uV?@I;K=_uXWc)W^I|u58Sf~$
z68G!g>)h+lg}(>=pIk1x=O^1egYw;0?=S5>vF6ssx~s7zwR2v-zQ4Kq+r_$9LHEB4
zw!QsPcy8|VpB)zGjklaV^?dC@&GUCI&R%fo@a*G{|NTFe{oY>Y(z^9u^NlUyI-VUn
z>6HX@_~Q7reBW|Qv*vhSd-&~R$d{D|PclkN#$1nyO9=nZ{LAHA(I2;hs;;_a2fzAW
zlTPz-4K`eJk>RxU^Lgi=d)Lm`xA*VywZZr1m%e@wSNn3s&R>lmpC7#Q?{(Fy2ak5o
z>1O{`zh_Nw{+IiQ`iu2+)|yF0XQn@0d-Yod*lEY#FXLUX&b+XDU%AcCUzXedyV;g*
zu&R5ZA6)4hbm{i#4Uaim9x0wbvS9vVbABghZyD*A%6eZn8g+WFeUbi3I5|#g+8oYi
z@$1WXzYr^$ofzrH)7JarmDLaJ4}W*RIPK?ERlW1nx=*LS?2lvLELSsa;_rin!FR&{
z)_qW#|6={++dO={x`w46{C*voF}+PS{m_G>UyWZs_;r@;2M@FH4%Nveb&~mp%w^Yu
z*;hYa*}U}Ym4mN%&OBIGGpF+3Z^5WPo4#<m+Pmj>T`;gc=bt|_sHbk3ouQiAx$jwC
z%X9WKd<p)tJx|<@YybAO9o5$E^}+Ue1=Dwb&}4g^aOW=D|8-Ut|39sJFLcrWBFOyv
zq3rsfrq5k}c{cmP#Ht+TQ;&nRe|7%)V(3-rZmBC3(K55t;CpkpN@P^>qndRq(<hzN
zf2=!g$6b)4D&Dbszh2pVRdU9`D+jG#o^1xYXdC0x!j+<bU4Q{<@%ViAHvRBdcb9rj
zyEen({%TLF{XN?w9+h41zjE+TS(UoY?u<-Oz@JGd+*>Iiwd}ar0vo-pi{`Ib&L{T#
z+WEA}zxUnYkDHj1+1vSf@2n-CPgiuS=9PnV%!}Q!Wu8^UoP*C(cK)9~_1>cRC&GVA
zt7acuxKQ<5t9xqftK>+b=}{NYUwQuQDsOjuoSI>U=3ft4nQL*U?$}DqIJlHqdlt|*
z$ql>f{#Zt;CC}euQupOQ<8$K~RuzsQxBp4jDg3cq=25~13ke-Qw(jPGLz8(f{=hE#
UH?f-xJwQc~r>mdKI;Vst0G@ehoB#j-

literal 1402
zcmdUv`BTyf0L9tb$lR2*3u8hmrghycz|>qt%_}nvODanikIalvL|YM9(2{1WwLFHz
z`^Yj+OhnyAGa`?~V@<@PG+{HZ(2(ORNgiu|#{Tf$n|VKd=Kb*Qp2m5b7{iP~AdrdA
z3D1D_EM8Z-(S~&g4eN(NpiOQ*o^EI9`SS&0nsV<}PoKW8?rV>P%A=ZHlyk|)%)Z})
z&1o({8}*n&;bo*dn9pA=wk@*LFs9YRd~a^eUChbe#%O86Xyc_*MsAR>d)XaXH#+Xn
z>IK@O9j+&e>eoi<WS1j|+~6CBp#)&VZsaa#r+I&>J#CfyL4N7p-=l}ft0dn~Ay&Ti
zqBAkB6Ibk{>Y2RE_}<n`SvX9cf=N*eGZ~I+JNlL_+t<nlp{36P!0nlFv?$m?VuJs|
zkFVq#hs?0Is3LjQcVRSY^n;+~cR#D{t3nXYCo!v8rtjJ0*6Xjvqm4fghUJ&cE2ZiQ
zWK5bXiT#cu*`6JbOuDulpFmxhtT?W`&|;nCCqc+Z#9l3yiLA$!Sya-DAfiIj)$|i@
z&JR^_p{5~q5P^53cuuoy0++R<L4p>QD@YbEmOxFYi}OQ~b!A|q+XLais~0L>VzGD;
z>1Ye9M)fenxQ)7==oJB*Fj2<$H=#(CPiDcxU6HV{SdUxBH}Y)gqm8;_HNa^GHA><X
z?R$-=lS1yv#d^J7%cy4jHI&B1ly!v|aQ*vYDH-?{vwfhC;*VR{P6494s@cicsZI|V
zwGY$M&H|WUZ5+BQGTxd875yTN<J&c3k?u6{DK!E3cR&;RzN$Q?Fx?+-TWpnh+lA{~
zAfgJeBlvLCP5BK|P67C_Fv5bho8v?=nr7*|_@QWRsPC9r2x{f!7r38<lj3%bxg-E&
zl?clo&V7kYH=tE0T_ET$#{0%pdO|WQx$1n8eW_q8+hH=5(v?R5gww9R2riN%WZ^8v
zDr0){0=tEgvq!=UVZ8hGsp7_|_!f~Wz_7ey-ffgcor_}p9vNBlwtlrv<+7)ZCuCNw
zULZ_d|EJfG3ZJWxBtyHy6KW&d0Dz=?0B6l&>GncBMS1yolbu#EsF`|e@KLs6%?lis
zw!=xiGHj+Hj6ua;grMviYyc#XgRvs9tDe|DUfWQPC{al`n<gN8$sdLkGEuqe=rajX
zbJ$TE+Vscn4;LA=tCMU#7ARp(iD%k`8pXNsw8Y$CtOM-NtO)m}-^itj#V%{G1Mm|Q
z{pnujIh#d#Hrk5o9E6uL`2upCqFr;qA~taN2;{hB$#ck)LdJr(RKUsE-1jEs<()T=
zpzZzW=hm&tI6iO$*sJ2KK$mlvA~BA=ruXVb1x_`4WCN?&PINOie>lZZh|Ml4c(E;`
zY{pKf&N%apNk$tlXD-Dyz_nIPwc@IIFmKCj96!@=llcMyo-R%6y`o|-xzN4pyvZkn
z<dxs1%c8dtiGAzybmDF63mIsK0y%eQB0^S?q*^Jg9@One@6Ug@4yLer-4z(I6R5C0
zI2?r03CC59pBfmAVHZymeK^j!13G8Mf_g3@mn`g*Z`RK#g1kNO)=z6&r)J45xFLO#
zKd+OH3(g(+nv||Hy<(AnD5~*13*pxx9CPj1AI_M4`h&#qCX{*=?O<!Z2e#GJ1biFJ
i@!*IbiWUFAT8n6Jew}~DQ`7$KQ+>Q}o;B{F$^QYQ$iSii

diff --git a/src/gb/audio.c b/src/gb/audio.c
index 996fce66d..cf5445e15 100644
--- a/src/gb/audio.c
+++ b/src/gb/audio.c
@@ -33,10 +33,10 @@ static void _writeDuty(struct GBAudioEnvelope* envelope, uint8_t value);
 static bool _writeEnvelope(struct GBAudioEnvelope* envelope, uint8_t value, enum GBAudioStyle style);
 
 static void _resetSweep(struct GBAudioSweep* sweep);
-static bool _resetEnvelope(struct GBAudioEnvelope* sweep);
+static bool _resetEnvelope(struct GBAudioEnvelope* sweep, enum GBAudioStyle style);
 
 static void _updateEnvelope(struct GBAudioEnvelope* envelope);
-static void _updateEnvelopeDead(struct GBAudioEnvelope* envelope);
+static void _updateEnvelopeDead(struct GBAudioEnvelope* envelope, enum GBAudioStyle style);
 static bool _updateSweep(struct GBAudioSquareChannel* sweep, bool initial);
 
 static void _updateSquareSample(struct GBAudioSquareChannel* ch);
@@ -192,7 +192,7 @@ void GBAudioWriteNR14(struct GBAudio* audio, uint8_t value) {
 		}
 	}
 	if (GBAudioRegisterControlIsRestart(value << 8)) {
-		audio->playingCh1 = _resetEnvelope(&audio->ch1.envelope);
+		audio->playingCh1 = _resetEnvelope(&audio->ch1.envelope, audio->style);
 		audio->ch1.sweep.realFrequency = audio->ch1.control.frequency;
 		_resetSweep(&audio->ch1.sweep);
 		if (audio->playingCh1 && audio->ch1.sweep.shift) {
@@ -243,7 +243,7 @@ void GBAudioWriteNR24(struct GBAudio* audio, uint8_t value) {
 		}
 	}
 	if (GBAudioRegisterControlIsRestart(value << 8)) {
-		audio->playingCh2 = _resetEnvelope(&audio->ch2.envelope);
+		audio->playingCh2 = _resetEnvelope(&audio->ch2.envelope, audio->style);
 
 		if (!audio->ch2.control.length) {
 			audio->ch2.control.length = 64;
@@ -383,7 +383,7 @@ void GBAudioWriteNR44(struct GBAudio* audio, uint8_t value) {
 		}
 	}
 	if (GBAudioRegisterNoiseControlIsRestart(value)) {
-		audio->playingCh4 = _resetEnvelope(&audio->ch4.envelope);
+		audio->playingCh4 = _resetEnvelope(&audio->ch4.envelope, audio->style);
 
 		audio->ch4.lfsr = 0;
 		if (!audio->ch4.length) {
@@ -877,9 +877,10 @@ static void _sample(struct mTiming* timing, void* user, uint32_t cyclesLate) {
 	mTimingSchedule(timing, &audio->sampleEvent, audio->sampleInterval * audio->timingFactor - cyclesLate);
 }
 
-bool _resetEnvelope(struct GBAudioEnvelope* envelope) {
+bool _resetEnvelope(struct GBAudioEnvelope* envelope, enum GBAudioStyle style) {
 	envelope->currentVolume = envelope->initialVolume;
-	_updateEnvelopeDead(envelope);
+	envelope->nextStep = envelope->stepTime;
+	_updateEnvelopeDead(envelope, style);
 	return envelope->initialVolume || envelope->direction;
 }
 
@@ -932,7 +933,7 @@ bool _writeEnvelope(struct GBAudioEnvelope* envelope, uint8_t value, enum GBAudi
 		}
 		envelope->currentVolume &= 0xF;
 	}
-	_updateEnvelopeDead(envelope);
+	_updateEnvelopeDead(envelope, style);
 	return envelope->initialVolume || envelope->direction;
 }
 
@@ -968,16 +969,20 @@ static void _updateEnvelope(struct GBAudioEnvelope* envelope) {
 	}
 }
 
-static void _updateEnvelopeDead(struct GBAudioEnvelope* envelope) {
+static void _updateEnvelopeDead(struct GBAudioEnvelope* envelope, enum GBAudioStyle style) {
 	if (!envelope->stepTime) {
 		envelope->dead = envelope->currentVolume ? 1 : 2;
 	} else if (!envelope->direction && !envelope->currentVolume) {
 		envelope->dead = 2;
 	} else if (envelope->direction && envelope->currentVolume == 0xF) {
 		envelope->dead = 1;
-	} else {
+	} else if (envelope->dead) {
+		// TODO: Figure out if this happens on DMG/CGB or just AGB
+		// TODO: Figure out the exact circumstances that lead to reloading the step
+		if (style == GB_AUDIO_GBA) {
+			envelope->nextStep = envelope->stepTime;
+		}
 		envelope->dead = 0;
-		envelope->nextStep = envelope->stepTime;
 	}
 }
 

From 938e02634d5c8806c623e444a50a46fa9ef2d599 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Mon, 18 Mar 2024 23:17:42 -0700
Subject: [PATCH 12/53] Scripting: Export new image masking function

---
 include/mgba-util/image.h   |   1 +
 res/scripts/color-mask.lua  |  34 +++++++++++++
 res/scripts/logo-bg.png     | Bin 0 -> 1268 bytes
 res/scripts/logo-bounce.lua |  39 ++++++++++-----
 res/scripts/logo-fg.png     | Bin 0 -> 888 bytes
 res/scripts/wheel.png       | Bin 0 -> 6931 bytes
 src/script/image.c          |   8 ++++
 src/util/image.c            |  90 ++++++++++++++++++++++++++++++----
 src/util/test/image.c       |  93 ++++++++++++++++++++++++++++++++++++
 9 files changed, 246 insertions(+), 19 deletions(-)
 create mode 100644 res/scripts/color-mask.lua
 create mode 100644 res/scripts/logo-bg.png
 create mode 100644 res/scripts/logo-fg.png
 create mode 100644 res/scripts/wheel.png

diff --git a/include/mgba-util/image.h b/include/mgba-util/image.h
index 31514687d..b86b2135a 100644
--- a/include/mgba-util/image.h
+++ b/include/mgba-util/image.h
@@ -138,6 +138,7 @@ void mPainterInit(struct mPainter*, struct mImage* backing);
 void mPainterDrawRectangle(struct mPainter*, int x, int y, int width, int height);
 void mPainterDrawLine(struct mPainter*, int x1, int y1, int x2, int y2);
 void mPainterDrawCircle(struct mPainter*, int x, int y, int diameter);
+void mPainterDrawMask(struct mPainter*, const struct mImage* mask, int x, int y);
 
 uint32_t mColorConvert(uint32_t color, enum mColorFormat from, enum mColorFormat to);
 uint32_t mImageColorConvert(uint32_t color, const struct mImage* from, enum mColorFormat to);
diff --git a/res/scripts/color-mask.lua b/res/scripts/color-mask.lua
new file mode 100644
index 000000000..25a51f805
--- /dev/null
+++ b/res/scripts/color-mask.lua
@@ -0,0 +1,34 @@
+local state = {}
+state.wheel = image.load(script.dir .. "/wheel.png")
+state.overlay = canvas:newLayer(state.wheel.width, state.wheel.height)
+state.painter = image.newPainter(state.overlay.image)
+state.phase = 0
+state.speed = 0.01
+state.painter:setFill(true)
+state.painter:setStrokeWidth(0)
+
+function state.update()
+	local r = math.fmod(state.phase * 3, math.pi * 2)
+	local g = math.fmod(state.phase * 5, math.pi * 2)
+	local b = math.fmod(state.phase * 7, math.pi * 2)
+	local color = 0xFF000000
+	color = color | math.floor((math.sin(r) + 1) * 127.5) << 16
+	color = color | math.floor((math.sin(g) + 1) * 127.5) << 8
+	color = color | math.floor((math.sin(b) + 1) * 127.5)
+
+	-- Clear image
+	state.painter:setBlend(false)
+	state.painter:setFillColor(0)
+	state.painter:drawRectangle(0, 0, state.wheel.width, state.wheel.height)
+	-- Draw mask
+	state.painter:setBlend(true)
+	state.painter:setFillColor(color | 0xFF000000)
+	state.painter:drawMask(state.wheel, 0, 0)
+
+	state.overlay:update()
+	state.phase = math.fmod(state.phase + state.speed, math.pi * 2 * 3 * 5 * 7)
+end
+
+callbacks:add("frame", state.update)
+
+
diff --git a/res/scripts/logo-bg.png b/res/scripts/logo-bg.png
new file mode 100644
index 0000000000000000000000000000000000000000..908e410d972802b97a3819d83beddf167b1279ef
GIT binary patch
literal 1268
zcmV<Q1Pl9#P)<h;3K|Lk000e1NJLTq001Ze0012b1^@s6*hwyP000ELNkl<ZScScp
zPfS!-6o<bz|9HZbSC}CM7LAG#j3AA%i*^#FYHC_&icQnTgc^;}P2CVzt)yW^$3{2Z
zG-YSh7$GsPNV;iFq(n$sCI}{IqLtEGO2HYFL136)7c)bLVFr1C{Us+i_uPB#{ocvD
z_v9LqNK-yw0o#BBz;?h1{0jU7gn&U{mj6kHq(b0Z;4n~_^!EW<fRZdR^S}@Z*bva4
zY^Pop;1|GGzz8q_6aiH>*Aei51Z+QvjE8`~)(hwY+{q2LXAWMze3{P9PD)ElsjaPL
z$BrG;)YRbj`!lB+Kt<9%PV+xbgY5@?0e-UsXh?bs=*b+2Mx*%ser9H705DAx(=?f#
zoyF~TQ(axn-o1MX1OfyC0g8%>R=ejPz>mNf@EwWF=a!^8Wl>L0kBW<nH8?n^ix)5I
z)TvXduCA8D;Sh<8%jtB=vMiaVsm+@=>*UFkx^d%%!r^eXCDYZNY!@W`B&kV~TN0Uu
zr2W}exN_x+3JVJrkH?qz!{M;Hy1LZT(xSS$I_2l*F9I8eA<MFqmzSrVJ9nzJwN-cS
z+{p#`b4LGxq=VT24`hozfBw8&E|;Rw=n9FD=I7_t+uN%P7cQu=u~8)@C5ylwk4Ijw
zSGBdZ8W|bM42?^=mEl{E^o^vvbintrZQR`4EI<<z6DtBP+ch57-Me?y-rlaGM~`aj
z)~#|novN>|&lS=mDVE_IlJsT@@Nl-MBS(%1(CFx>Ex>FF27@XnC|GIA14#oJzBx$^
z4iXh&nI<PE0Txg3dQ@Co48ZvKc&;g1fEp54QtDK@fffglm0)TrQ5c>-f4*+Or%#{a
zcDorJ9evT%-N5VockNX=fN-{%(P(r@yB?)Jc5G~HHPc<d+rR)I2k<9}Q@2F1SPa;h
z3{Fi=v9Pef#KeTHFu-&GQQ%(Ys9_ku#$+%Oi7-Du&yy!l?1VW0rz6?v%p5gM6G;3&
z8v!^sH)nS(2jEBneoaO__W67OJbd_YLjdFPIN@;C-#wQE7%9Lga1dxu4zO?EK3pyr
zZEbBdH#gJQ*SBWC)FFBH?3r!AWyM)iy`;xOLqqa<y^CcFP(?+B&YnH1fq~3Bb!Amn
zRtnIG6DRD1bxVq714NQvQrEe2=TuNoummz?RaI4LX=za?6nf!KWo2aobnMtMJAk(&
z{hbRCNrt2^uU)$q^Lo8<yWLqqQ<*(;=8SIMys21hX<3cO<I2m+6QJYAkJ|z4mUM3=
zz?8jl|Ni~%hK7cm*-ST|&!?uQCUtalC=!Y2(W6I;W2aA_wgcEBse3hmDcgPZ>eU~1
z?b;Rhdc86X<Atyuk4NR@<pSh#xfBcr?Ev;k>aYWtvezzMy7c{_Lx*NIZQ8W#AmuX4
zvUL6WbvuAVl7ediOqnYb3N^L0wG9LUfw*a!vMej-ziL^QB9Vw4z)4A;8d~~rU#m(d
zCnuY3-@g4>C={yc@9#H;hliP-p2p+xP*G7qYilce_Uu{hdgCOXzvUYRn65J51K>ko
zKVYt5jb0M(^iN&}V7l^wcY*hTcSyXO4PXwK23}3}(<Kt`=Z}EjUpC-s^a|hu8iCJ&
eZXgH@1N;lJ`-l0cu}-xB0000<MNUMnLSTaAOj=L?

literal 0
HcmV?d00001

diff --git a/res/scripts/logo-bounce.lua b/res/scripts/logo-bounce.lua
index c8192638c..aae32ce40 100644
--- a/res/scripts/logo-bounce.lua
+++ b/res/scripts/logo-bounce.lua
@@ -1,44 +1,61 @@
 math.randomseed(os.time())
 local state = {}
-state.logo = image.load(script.dir .. "/logo.png")
-state.overlay = canvas:newLayer(state.logo.width, state.logo.height)
-state.overlay.image:drawImageOpaque(state.logo, 0, 0)
-state.x = math.random() * (canvas:screenWidth() - state.logo.width)
-state.y = math.random() * (canvas:screenHeight() - state.logo.height)
+state.logo_fg = image.load(script.dir .. "/logo-fg.png")
+state.logo_bg = image.load(script.dir .. "/logo-bg.png")
+state.overlay = canvas:newLayer(state.logo_fg.width, state.logo_fg.height)
+state.x = math.random() * (canvas:screenWidth() - state.logo_fg.width)
+state.y = math.random() * (canvas:screenHeight() - state.logo_fg.height)
+state.overlay:setPosition(math.floor(state.x), math.floor(state.y))
 state.direction = math.floor(math.random() * 3)
 state.speed = 0.5
 
-state.overlay:setPosition(math.floor(state.x), math.floor(state.y))
-state.overlay:update()
+function state.recolor()
+	local r = math.floor(math.random() * 255)
+	local g = math.floor(math.random() * 255)
+	local b = math.floor(math.random() * 255)
+	local color = 0xFF000000 | (r << 16) | (g << 8) | b
+	state.overlay.image:drawImageOpaque(state.logo_bg, 0, 0)
+	local painter = image.newPainter(state.overlay.image)
+	painter:setFill(true)
+	painter:setFillColor(color)
+	painter:setBlend(true)
+	painter:drawMask(state.logo_fg, 0, 0)
+	state.overlay:update()
+end
 
 function state.update()
 	if state.direction & 1 == 1 then
 		state.x = state.x + 1
-		if state.x > canvas:screenWidth() - state.logo.width then
-			state.x = (canvas:screenWidth() - state.logo.width) * 2 - state.x
+		if state.x > canvas:screenWidth() - state.logo_fg.width then
+			state.x = (canvas:screenWidth() - state.logo_fg.width) * 2 - state.x
 			state.direction = state.direction ~ 1
+			state.recolor()
 		end
 	else
 		state.x = state.x - 1
 		if state.x < 0 then
 			state.x = -state.x
 			state.direction = state.direction ~ 1
+			state.recolor()
 		end
 	end
 	if state.direction & 2 == 2 then
 		state.y = state.y + 1
-		if state.y > canvas:screenHeight() - state.logo.height then
-			state.y = (canvas:screenHeight() - state.logo.height) * 2 - state.y
+		if state.y > canvas:screenHeight() - state.logo_fg.height then
+			state.y = (canvas:screenHeight() - state.logo_fg.height) * 2 - state.y
 			state.direction = state.direction ~ 2
+			state.recolor()
 		end
 	else
 		state.y = state.y - 1
 		if state.y < 0 then
 			state.y = -state.y
 			state.direction = state.direction ~ 2
+			state.recolor()
 		end
 	end
 	state.overlay:setPosition(math.floor(state.x), math.floor(state.y))
 end
 
+state.recolor()
 callbacks:add("frame", state.update)
diff --git a/res/scripts/logo-fg.png b/res/scripts/logo-fg.png
new file mode 100644
index 0000000000000000000000000000000000000000..c401fb0112f85b8018412906cd23cc7f2abf03ae
GIT binary patch
literal 888
zcmV-;1Bd*HP)<h;3K|Lk000e1NJLTq001Ze0012b1^@s6*hwyP0009&Nkl<ZScSEh
zU5Hgx6vuz}I^$^NSMyR~I3j@}W+jUFfvIQ@I$#-yFWQ5G8PsEf1VQ4*gCh2zzDd!O
zkoxQg_~J)YV}pcIT4rf87%AF}<Ba}#*yk|Y>zp&^&OQBManId*?R9=<pS{;!r=pUf
z7GO2-4zL_}2KW)^i0m@Zn-!o8RWbnA0{el<!;BvQegeJ+E+y6h{8KjI7+^Z^I<NtF
zv%$E(^5jf+05?YpxB)nvK-Q`sxB*N6T1SLBs4fENH^A}adU&b7n5|D$5^GhLsPC(X
z)Qf6w&e%NdQm03;Gpz}DF^B(Lbp1DQHnCLAz-z!FU`g^@WTu;eD@A9pKj%rO6?w|Y
zs_Go|WA&8Uml5}|y17V95@*$Q>fV|_W9tO0wQ=ft^+E>Z2SosT)UVXp>Vhc1y$0c8
z8?FAF0l8Bhl?Qk$YIsilNc~H_ULqjsfgu1>eXB0a0_;<dsdJ-_lWJ$lfLn3^)7d<#
z&WOiV38%ptU@kD8aD2@J?ibo+#dTwt{tECe&<Si$8=HV0!a4gMAtBF9`g%$R>@Min
z1ndCL181s){03nLcSeo_<*@;9yH5XQ09D}k42McXI8W<No&FOc0A3uT^DQ8=4jZBF
z<@61Z@y4pa5#T{h`yt?^Qm~$ccmUiYlyjda?cG2dFojUArFxVCUIo_IKyD&zn6V{8
z_5xo3UjrW!c5El`C!rksGV<*Qi1XAe^@p0=w58-+*ri@kC#h}8|A*>Eb-sEjy7!JW
zQODMz?p6m9r+?M<5&>@}aUYsrq^NFB6LqXUU>jkRbP@9731C-AuRFb8Ga=vQ>3%$*
zR;PhCfK!BYvyJe<^mc=QLsjirx(ht@ifgT6D8o9UsXwo-HPn9fyxuVmmUczd?htD*
z&z2gBigbNmQ$JCs792mj4meGUmys;=Hg%8M9R>SN{Y+i1KASP_V4Z-iYUX!w5w#H3
z<VIixFe+((L^wWwBb>hz35ocXI%59;yj)}r7PS}Dt?FrqPaj2eB#qt33})$hU=`3#
zNLS<Q9RC=YLvrl>AAqq&1B-!`z^e@AzB|CU#9Dz#gxq);*hl!V2jD;ITEqaeo}m%|
O0000<MNUMnLSTXb*q=B6

literal 0
HcmV?d00001

diff --git a/res/scripts/wheel.png b/res/scripts/wheel.png
new file mode 100644
index 0000000000000000000000000000000000000000..5e7bcca12b9468ca8db02ebbad04c29ce210387d
GIT binary patch
literal 6931
zcmV+u8|>tXP)<h;3K|Lk000e1NJLTq005By0049d1^@s6g;CHF000`=Nkl<Zc-rlq
zdypK(dBA@&J+pgvdT<f~0df!zAuO=KkV0Tb2tNwj1cMAN3`Ty)mW?qFi&C6GLY#^z
zszOr6#5PK>c^ONwML97T5Exv<m<S^TCd9@P4;dtZ(F2gs3*GI^Zs(8g-J6@8?wQ%y
zJF%zhs;-@#ea!SXzyA8`ue-l?cn2hT1~3_T4G4Aifo<$Z$P@yOB;aU5rV%iefXM_*
zBw!o?9sv$D7w{$cRq%F#zYYA&;BNqbE%+~}SMODLdK;XoFX91XfIb`^*!!}Ol1@v`
zUK7>@z}rAsLsJF%=pp1t0!}1g79q!LXeJWSO@KoHiCIBp$`brO@V05Feh>Z=;Qto9
zKSI||5E`iUz!5ks8-?hd3X%L0-~yFF;LIfCbOJs|z)S)r5#SISfQjZxCWuV=P4HHO
z{|NXGf%goQcPW^BpauvWelQBr-iAmn(%Qz=58MadVk#kL5O5A5vk2&IfDvYZCVp-Z
zM5Pvh@^*m#H28Oew;a~5g=4gKl7NT9w?`q`8xYCAjli=NhcYt>nWy2I)@Y)_j2b8D
z{UC@+8DJ_!?4c%@0Dm2L_kh0?cp7@D>NBY|)3u`z4F^Q>T3{7$BG3)I$#H}%AmBVg
z4$cIQ4Vw75Y8;}H0VJE2^5Vy@gLgOhH$(qZFhRmNU=I#|KMK)MK_qX`aG+l+97@PV
z1kBextpRw#0^r17tF8s0k_DiW4Wjz%7VwsW_wUfPR;gBW6SruehsbTK02Tui^>cwP
z;Ip{ghs)Inrr@GFL2gQRbdDZJvlaj77fd<nV)64L`g$OUMIe@gycnFZs$1EEWHI}C
zY8yoI77foHz+nc0TM^uhU}n>EF~O7uPaGtxf;GY98lXwaB7U>eL3|IyQgBXC|6f9K
z3zFMMA!-?(pMYG_&^`i(3lQ9e;6eoD#xqC*$fS|n6egT3FlB{DB;1^cf98QZ7sOrQ
zEC8pZnmvK!$D<JC2Iyz{nfQQ1FFw~IxCOz{&9XN<BO5$!tH9WrvG}n`O^O6fH0b<P
za2JF4wrcK5z{^PfYZRi)0Ntmpo-*Ka1Rl2`xC+6TL9!MGkVFbpj-|OP1eKdJ3tKLO
zxD><^aF2x<fRE(9QHW9j`XvKy6PFVa{0D+_GQndrJ<_0Y^Vme>07zs3CLw$E<Bx#&
zF^Jjfy^rLVqYxPZdNe9KPD8K+k5jVAIz<a*g~{4Wa}4%SnoT4u+Q+pN%BvqA2jWK{
z&a8h&^5`f;O#nSHNS+@;a2p=Sv;<GyX3a4e*ex|>jzK+|pz$&k%mc*XAbtSu+4cXC
zJTVGU1E6Q94<UiaX$Wq{<A^~rjOMIbC{M4=X$2lPgDsS1w8b@#^*e_sr=<6B_1;DD
z%qT>1jqbvi0gn?A{96Mc&r&hHg!fsX5*eE_BUD*5kj-%RGJxb6YK{kZhk*Az@aCxZ
zYmltj$2HNwK=u)MEN(PmnPr-@QfKvO=k{1<@d;(A4W^ng==d=3ZUpZ=a2((vd1>E-
zNUm@Af_m}z79OV<p-Gad$l1)<dUClnP}XM5raF_}n`%ar0A_;sui#Hs_agQ^h~y^y
z97+g0uEgUUBN%Bw35)!*YNF_8$#<+X27t2k0J0V;tNQgm4BkJ2Uj_%srhNw@xeeIW
zknMSRTyB(`UqH@YiV5Or9xA{N;7#Cl{kk1BR#ycz3$agsX=~(5JM@p87JWcoJMtGn
zd_jr3hGg4_g2-rD$emjDHD*xbE~*?&RX?yQ1M{MzuhDFq>JgpBQ33j6uNBn%>o<Tu
z0h=Q%)LJQG2^bF?2uuME0D2<5h3IQEo2HK>)t)p1(0vuex!^nrWgNyO%YCHGCzACC
z3SETUN{tH#0ThKN2_PFtae(6R>;~2W&!JX-yxs01cL4_j?*<M>O)~Qh5Sb>hnbfba
z7=A7w?g#N{aCSfmhw{jUD3l=f0PtCA+)R~n6GUm+C`}VZbDuu{BJhNUC>ZLZd%&T<
zNvJWexK{EFAf>h6)?PzZ%}bKs1*p=47kdOFVp3Ya1h)p1ITVk-#-nVsf08tO{CjCF
zfzYkY85+bFhXWuq;V%I@fxpz+Nsv6l(K8g<&k2|>z*`7iGbCNglpAS=^>#VXldig4
zBt2#}$<D((E!oc~<N9$)D}hgFh43|Pt_)imuP=HMa1P3!Q%<P`)(QS8zwwZGM^tey
z>&JB+U<Yz!K~&YP%O02GLYN;qP!k|++9xka_3!uSXZHbMe|-Zd1M`Qo_@4qktdI8t
z<^ZQ?J1K9WY--s<;!#5os^xU&OL$+s#UD`+Ilwk>0$32hl)6b%b)c4{sncYcw9vxS
z3SbuS9(_J~17FqJX~@%|S_^rRb3z;3Cj-5)8&B)8nR5+66*p=o?jOKc`oMF5jUBFy
z8W6oA6)<I(8Nzu<HgV`iU^2l{GQd+mw;%9c;9Z70IvlusIGno|0W%Gs9SocROvq3(
z%vs_Q;u6M|*6F^-Sv5E%90A(Mjn+Y56>?qx2M30ZR_H*r-o#~rDSB=Ua5OL}<*qK!
zEz6LlKL@^;@|_7<D~(U633h*y#HWf#3>^@WX>S0Z+YPSU;Sf0h&q?Jy0j9d}OBaqx
zoBP)|R|BVN=;}x5tDz!)^k%%X<r=14?JjZ&xDA+>@%uY~jk?74uDwK1!=)DUgw%A7
z9_##C4L$<=p$~XBPUm*<-yV3@X9O@U&tlX;O<cT!M%^w4<^Txbbl}{fDDua2cQ8*6
z?jVaZvZU=E)pVJ{1sL)nA<V66CEd}@Sy?%adqOxTREBltMX42_;y@^%<{MxdpA(?E
z!nguBq@Bf`2rO#hk&V~JT(ov5s3bmNLerH7Qbbvw-3JqP08e$Of$csa8wHvfz$}xa
zxsm~<z=6=y_EKHm-MYuz%7X0^fCcR=?uDq}R;{%9<8)yL;HlzK!D({9S5iQV$@jPr
zPO4i19SPAv1BE(W8+)l*C`oA1;jfAdRUc$o%e_cX>muNI!)Lw^y}dALlFAb%K&fQ-
z@{z!0w7yEp1-g-xsNxae4lc6=po$%+?m)G%9Xs2|`Hch#Juckq!iVzAN;WOFsgGuq
zVqTb*(`_22Dhig9PlnmE;n-tg$`mN;fy_z;Hg1H~tKqT7VC72KRG+_dy>7~irD%U4
z+Lx%s4Cw?Tx{+n`@o%Lvu(!Ui16wrb*XpKcy6~_A2P8q{kZ*xa9i*}Cf@lZuwJEUw
zJeYUBf~Q=z|0W3F`RC!M%V5ci@bZncV@xH~9mbI6@#vbNHzo}bMP7GGHG25ishtSX
z!|J9#@4)R2IB|&bhCQes_h?T`@z^y&^`>@T4Lv8c_J?bB!*yd|nQm7KB#D{}w>t%(
zEE-4-K3)Xe@SzTb$So=LJS)i1D>K<Z{jprpO<8e(#sc32eh6buX#EdojDhb1|Dwq*
z=vXVo%H3oW<}|c*p4Hc(W|6xM_6y+nJce|C0zCEieY$3KwFRJm2L4VT7ffBiLg2f)
zr(Yn|8`8dn3e=wfRA4c<Bl14BI?Qtz+6GYoQv#Tp+I_e5%A&ciEe5p!u0oB*wmF#F
zXS8xF7rVPI3p6&(Wbq?S3DwA9=Rp+0kpWD!HD7^63q>a<)+Z<y_r88YtBoNFDS45G
zsX*${W$jDRLZ(WXp!vrIYOt;&HPO-9SCQEsiff_1SX0(h=$57cSGT7Lvw6d>1g5wC
z7u_21J_|_w>EJ~DMSdqkG%d-fu4I6xlF*dZoz<<UdD>My#OWyD3$6dWKDECuR*@<x
z8Yu;+X`Kqu)WG6h%>q+@q(*j8B>dVW;QZk${U=d#(^~AMb;kh81CIfuLpv3s$+jje
zNHL`2!s{+{J0}Cj4qxeyq|m&jo{Ta{lBEHpj_sXIw1tY!;v1@Kp-SPd{p@1hrrf2c
zwei?US3fk^MYdj=MHBUQDn#S*`iS}sMs--o9`c7*3pE^(t#>C&)c3eaZq~8@6oYAO
zM?w^Wm!%m?b2iqy_pSSf#^|2eFsFl1(}h~ZJ~U{de$u_ymF6B=M|!NCYa~0surS<U
zP};h^XQ5UA<sAZYm_#p+Ack2Rg&Sb=90=FvH>`I7522Pnn&gsK4&RV_Zx6bbA^JuF
zM6Hei_5&+W1C)6rA%TfZ;&vWk+Au@(rw#C_Iq=H*e7#DkJy{<q;L%Ew(KVe2(N&V|
zb%ic7)+T8<ejE4+v=lgHJQMg84|C#h_=qBD?OHhXG}!c7{@;!TK8>=5WdayZMlBva
z|4$tVksCnOH2pQJlQC)&wQ5-Rv71e79CiV0*#f(Ev~Cksv3so3#?WH2uhD_Y4Pa-U
zX|T2)T7CcDR#Jrut64ql0(kB@*tM%TL|MnsQo8uNIu)XACV&F+4S56w{X~!P7{Ty_
z1W`?~RI_M{_=y5b?<}p0p8(SKPK9W5UQJ}vMnyc<D_P0&JU?uOU%wt6d8GB<M@RDW
z4t*Fj(d(TG(FW_9GSY`WqRzG=V`rP##83I@uoeF2KZlnJL<R1~J~1uL>6if1D;)_@
z2x|k7X`4MKspzDkkD{aaOIX61VF(<)VFTQ9OY6U{motkN%CWKb+D_F(F9gt+bs9*T
z*P4P&+RMDmbzDbZ<KNn!s#UoDdU*EPVp_;0`xMy>(?P;eMXKybh}Oo9>nvUUibZfm
zXErWl8Q<soLssaeON(itx;+#Y2Pc|$1`MM?*yiT!)u>&Ry6&Fz=?_KcSXZd<O}@!e
zmJW#>bk$Yxc7dq0uD1R9ESf0Kn3>M61$5@V4eke(7W#db9$MC^vXbHxI<~Qmg)HPo
zZlqFlv6ybc?zjUkzBsZdwm{e3$*F}hEE!r;RS~;852AaOT7Dv=^)>iIweD;yTlqR)
z=Muiki>z<?e>QA_MT_8)ONs*o&Fju=BlkA{TP#Azs=f{ln&xVFejC7>d785{pd{^?
z*U(QtxAJ2?&Kj;mMJUcPHXu>qu)hPG`7(U>N5z`3dJ>KMN}ha{Wtbx&?+##9r-t2g
zbO3>IHCQg;RNLBd(^_*=ob>iZN4)^J9q8gv)Qr|sQS-?TiZq=SU<;~?^BC|5+Q<k|
zaUgGM4@7mFFUvlF88_ViKSzc2dj0WET#G+bHuhk-M#49eAWF(<0IAO%)Sz^camC5N
zJ*aTAgVPw)^n<!zDnP}4NF0D#gNk{+u86c$umZPc-f_##0aGO2!Q!{zvI)Rbowydi
zYv92@6u^#<^iX?gO<I6M6@hF-6)O_j@(YOofeNay5m>MDYgk4wXP_3;7VMJA5>!1E
z&?~L^${2R9KZIY5DJZ4A3el5JquF^Tgr~CxxiSG&#YHw&W!0lxjcw7)J_h(o`${|C
z$YXjMql=;=z)4?4(XGRjW=LBirmYTOWk*L!12{}|&36TGcgBE~O@a$?k&V3;l7cpl
z%Xw=86|DTQ_LcTPQ~;N}Qw_$VLN>-@fBGOj75vn;OgaUmd-uQ_eZbS5Hy>>PqCe_d
z5Ww;f*2OmqvgIlcwMG=|B!J5LsZA!|jQG<Sl7)<CYuhM~20BO=!LpN8%~LVHbHGCg
zTLQSNM(gvi-Z2oppjGlzH3V{xB}ipN^ElK7X`i&v`aS9jnLru`{1rp8469pfqe&S7
zI!wQoutgvqfJrpN6p|P<mH-~C!LuRoLWgQ0qPCo?J1`+E4dM0BQiGJ;BQS5^kra8}
z*KkbF0LLd$J>DTo?*~4c@}2Rh=>Pj+-z6YH1X4iNZLWYZn05wmN1tM@qf-MS-JBtn
zaea5fUKCVuG(2e=eE134ss1_vwYkS+!!1ogg_RjX1@8ctV2%nhN#Eim()TN|Y|bc!
z+FU0|mH|9ig%u-Vr=bQ!n;iA#ZK#HDvu>|-p;gnBefy@As!A_v-Tm~0j_sHA6CC0+
z4Y)LRc?T6{>J-%CIWI#|GVEF<brToSL_0#bsUP}XU^C9hfQU$K@!_cemMVu~-EEd-
zC%ioSfsNBoYj(s=Isy37@Rj~E`to)A=Y9HpFRgEPX4+3rK+SFV<bGC#Uyp<xhDdVW
zl%#SNN|*-jauCy#qgBVZ{f=+{Z38U6`NwwPf3-0^e|RNu7w`|LU8^RMJ~c7kF2!@w
zM$3bPT)#?{vmAKFmrxmrd%%W(WDHPV3;qq@h33s)(>8ncF>e|hJwFAQtNYO#hR5wz
zLv5EXQPKUTl5M+J(>AZRq7L4GaWP|gM*1T|3t@C4OHXSF#)4Q1Vy-#ld6Fiwfn(Y;
ztQ>Jn9?8J)YN@>?4j34veGzy|pNkK}+vaVgX`-Y^=}HUziYn(Jc~dRaYZm{A+0tB<
zrbj<m=L8UUftYHC$Rpd9)M*gaU&rVk+`IJaSp7SvHE?#J7UaBwn)<bi<oO%@WZ&V%
z22e9dTc~j!l1J$S-Zs?Vkp<Cs?I3gj7Jyg`qMST_ZG$KdQYpo|U5*`>BjXOe4D9w(
zpOE3GES-U7s<9(7DrCo7+U(lJKs2r_Q99cPQI#rJQsR2{=xc2sIS`o#j-4I)iMW7R
z0^TilZPQ9l(rQWCPHG~yYBjPMctg{%M?I;k@=vf`Yn=Mmw(9dW!(~j$RHWQ`zGD9b
zkDD5%-u6y+FJ^@Zz}cc}dZ_~5HQ+teEM<`al%)5<0#tm4PJ9;;hvwZeB5$Lmb1i=*
zEZn96B{Bo_I38Eyvl|E4GO_?lhX^7~hPMU8BJh6Ky5>m&DbL(MCzfL^vXhYGGr&x<
z$4q?%ksF$5UW>;S_-ts~eBq9S$XTZ)@<+h`1Bgq(d%0P%NmW^-Xc>_cBqsr;1dy=6
z<XQmAs*yy7y5X@AkFVjes$l}IbM{e)0G#J_m)isU6(BAL@tVEKN|LzE{z;oi>KL?<
zliXdf0hFal%i_^6*PE>f7UA(gV*%dtBNL$P5CJ&9i%8yE4&GN4NH(e3B%P#rlAtna
zA4`AJF>vR$8K~rXvlYQYN-S#><98z$pnMPkI8R0;c@KDB0kJMks;xC$Y0X#yP)-JI
z<QU*dYvQuB&K?^PT#Ca|9DVM|kquCOhya`wQOVy2-seI5KA*i~dxB|AS_(i;4s9fI
z+DLZIv=+evT$VMu|0_m5K&?Rp;QV)_O1h7NxDdp{*$rl4c!F8Laj=KiGyvt2Z6DIK
z&25u?O^+j(hpTNMAGM?IK9X8rrQ$rGrS%*jo&_-v#7!V7t@XxSgDsRp8`*55v~Ism
zL7I=N2$mwa0GCzD69U}7?*LQ`A^_)Z)C4jga5sZ@1&D<pUM;+wFE2D{;G}J@?PdUJ
z@cS(YuEgVFTsAaDXzt#(04fd<fO97Ui;JCpkT-!i7sUM_s`)|6VoYa*%So}3(ze%j
z6YGIQ@GAu85pX>YyBp)eckX)t0XUHXzb-9`J#G18zCIqreDD{7cSQ53zHRDY3Hw~_
zghAY@NZ%96G_X3bgvC72s$O3uWHBK(%Wv^!L~ilTCik>Uj-3RN#N1gf2-82z0PiyJ
z&j)XR^XPsnF!{|81uej1Ti>HzcM$S30=^@!;h9MBWNPvEk>)HZ#A0{5E+DyP4U{ei
zcP_X~K)jVJUWRqN%+k$I>-J}HKDz8g@SnJxi^rE^0F9=ICYlHh)m%^eqb5<b_hNj<
z191v?p9B9)@D9m0;lE@)u8P#n#1hXXH(^@{c#x1gsIo#Xq~B1aZr!u^P3-(^;OTv(
zNgGy(24K3~1vvx!x!|7--f`e}=WpT?Aj%PrBL+`D0jmkPmyo-t@vK~sX&Ur2)I{58
zI*JYrC)_a*4F>AY3E-au-p9b71O9aI$K_t*7KJE#-c7(-LRJv)3qn@PPw__1BJ5T9
zjY8A})Pobjn*shT@MeL3EcjCtRK9P8DIKDakevj)M!*^ZRuQm@kk#^|g|<T&h3K6G
z(O{rf32+Yp|8Vf%t+F=_{6oP%0Q_F?$AT|n5Y-6SMaXsnUMJuc0@f1n90AW0@)A`x
z%UNw(u`>!$8z6ERm|b6=Jrion#1s}k$+wc_cSWvc`<@f|zhDR;8m{uD`T9(s7n6~c
za-wWb6Qz`7$aAEWw@Y)nT}nAS_M0pz>38kA)*VvHv!s-hbv{d<v;B`Pr^#=q%6qMp
z@^H&_NRdU`WK;yA*)n^oU$9%|OS6aYTK7vS@5}H%MIdUmynm77H)9Of>5kl^>GQV8
z$ZgqVX<jt{04nm&`}J`&EzrM7a$?Q}u0Vx|ji+-A*LoBcM(uokob_7KbOvyy<?{t?
z@Hi*k!$*PRf#WQ4x-fQrzLwK$?U$N?iX7me;-98Dj7^`nMMkYcRMvkGO?RR;I9a2Q
z<3cb+N?ZplL&fO0HTKye!?jj1usCQ{j%(#f?fRd1dI@+z`;km?ia(bx0`JlGN_}Be
znY|ySZ$8k~s$o5z=B+0G40ttiydn1ae%dgLU+X{y?>Ok|8nQ<la7ounOC{7&**6n3
z7^ryaS<df=3XR>WVVx#hlbntL9#6UM4|SzmVYtpg4D1y$iRN7$_t&q5Wi(Wwlk=<v
zj)wrL$22dp8La8IH|U)8yf?%(*(9fxzy~xaHZAZ!s31>C?g|mBR7pL<w#di?(WDf6
zAZgp552F^#_v+)U4>m0&U2B!L8$KSf6W*(9woS!vHE7ta1^hY_4f4Yx+b*4La{3K$
zHELMpz1r5iI>83~yg^2%N1n&&Ii5#u8JQqD3^o2UF_!CwSbst-xlkK?GiZ(-{6mW`
zBrPRfYZh=3Dl}C^*SbBZRrfY0;#-EM@hw{03A!6NAmRK07NhkrEu*7T<WwI8^dl8x
zHE>%-8MXR6^2?}&Zm5j-F|wvPDP7Gh{-~_U*1evtbJp`|_m<^eWD9Z{+k#u5UC$%8
zjPf|dk{ng1WpDt_$>{V-%W2n=Qp&$cxmI^hp9#YRQIebv*AB%zziG$w$StGj^w=zZ
zgQRJnj&9%mm}|biWxTZbF!Ii~NxD}3dV37*yy;qb&)b@`ZiAeXdQBhIZjCoG$f*_C
zw)1&pI`4F1P^At^Ne~@{ijFa21n-VM=OIl=+U!pw37}C;G(2g@7D0?cv~Q(WZNQF5
Z{}1R4%vk=CZo2>g002ovPDHLkV1f&Z^~L}I

literal 0
HcmV?d00001

diff --git a/src/script/image.c b/src/script/image.c
index f056c7d49..7705ebd9a 100644
--- a/src/script/image.c
+++ b/src/script/image.c
@@ -141,6 +141,7 @@ mSCRIPT_DECLARE_STRUCT_VOID_METHOD(mPainter, setStrokeColor, _mPainterSetStrokeC
 mSCRIPT_DECLARE_STRUCT_VOID_METHOD(mPainter, drawRectangle, mPainterDrawRectangle, 4, S32, x, S32, y, S32, width, S32, height);
 mSCRIPT_DECLARE_STRUCT_VOID_METHOD(mPainter, drawLine, mPainterDrawLine, 4, S32, x1, S32, y1, S32, x2, S32, y2);
 mSCRIPT_DECLARE_STRUCT_VOID_METHOD(mPainter, drawCircle, mPainterDrawCircle, 3, S32, x, S32, y, S32, diameter);
+mSCRIPT_DECLARE_STRUCT_VOID_METHOD(mPainter, drawMask, mPainterDrawMask, 3, CS(mImage), mask, S32, x, S32, y);
 
 mSCRIPT_DEFINE_STRUCT(mPainter)
 	mSCRIPT_DEFINE_CLASS_DOCSTRING(
@@ -162,6 +163,13 @@ mSCRIPT_DEFINE_STRUCT(mPainter)
 	mSCRIPT_DEFINE_STRUCT_METHOD(mPainter, drawLine)
 	mSCRIPT_DEFINE_DOCSTRING("Draw a circle with the specified diameter with the given origin at the top-left corner of the bounding box")
 	mSCRIPT_DEFINE_STRUCT_METHOD(mPainter, drawCircle)
+	mSCRIPT_DEFINE_DOCSTRING(
+		"Draw a mask image with each color channel multiplied by the current fill color. This can "
+		"be useful for displaying graphics with dynamic colors. By making a grayscale template "
+		"image on a transparent background in advance, a script can set the fill color to a desired "
+		"target color and use this function to draw it into a destination image."
+	)
+	mSCRIPT_DEFINE_STRUCT_METHOD(mPainter, drawMask)
 mSCRIPT_DEFINE_END;
 
 mSCRIPT_DECLARE_STRUCT_METHOD(mScriptPainter, W(mPainter), _get, _mScriptPainterGet, 1, CHARP, name);
diff --git a/src/util/image.c b/src/util/image.c
index a0fefafe7..f1f1a0fef 100644
--- a/src/util/image.c
+++ b/src/util/image.c
@@ -42,6 +42,53 @@
 	memcpy((void*) (DST), &_color, (DEPTH)); \
 } while (0);
 
+static uint32_t _mColorMultiply(uint32_t colorA, uint32_t colorB) {
+	uint32_t color = 0;
+
+	uint32_t a, b;
+	a = colorA & 0xFF;
+	b = colorB & 0xFF;
+	b = a * b;
+	b /= 0xFF;
+	if (b > 0xFF) {
+		color |= 0xFF;
+	} else {
+		color |= b;
+	}
+
+	a = (colorA >> 8) & 0xFF;
+	b = (colorB >> 8) & 0xFF;
+	b = a * b;
+	b /= 0xFF;
+	if (b > 0xFF) {
+		color |= 0xFF00;
+	} else {
+		color |= b << 8;
+	}
+
+	a = (colorA >> 16) & 0xFF;
+	b = (colorB >> 16) & 0xFF;
+	b = a * b;
+	b /= 0xFF;
+	if (b > 0xFF) {
+		color |= 0xFF0000;
+	} else {
+		color |= b << 16;
+	}
+
+	a = (colorA >> 24) & 0xFF;
+	b = (colorB >> 24) & 0xFF;
+	b = a * b;
+	b /= 0xFF;
+	if (b > 0xFF) {
+		color |= 0xFF000000;
+	} else {
+		color |= b << 24;
+	}
+
+	return color;
+}
+
 struct mImage* mImageCreate(unsigned width, unsigned height, enum mColorFormat format) {
 	return mImageCreateWithStride(width, height, width, format);
 }
@@ -395,18 +442,18 @@ void mImageSetPaletteEntry(struct mImage* image, unsigned index, uint32_t color)
 	image->palette[index] = color;
 }
 
-#define COMPOSITE_BOUNDS_INIT \
+#define COMPOSITE_BOUNDS_INIT(SOURCE, DEST) \
 	struct mRectangle dstRect = { \
 		.x = 0, \
 		.y = 0, \
-		.width = image->width, \
-		.height = image->height \
+		.width = (DEST)->width, \
+		.height = (DEST)->height \
 	}; \
 	struct mRectangle srcRect = { \
 		.x = x, \
 		.y = y, \
-		.width = source->width, \
-		.height = source->height \
+		.width = (SOURCE)->width, \
+		.height = (SOURCE)->height \
 	}; \
 	if (!mRectangleIntersection(&srcRect, &dstRect)) { \
 		return; \
@@ -436,7 +483,7 @@ void mImageBlit(struct mImage* image, const struct mImage* source, int x, int y)
 		return;
 	}
 
-	COMPOSITE_BOUNDS_INIT;
+	COMPOSITE_BOUNDS_INIT(source, image);
 
 	for (y = 0; y < srcRect.height; ++y) {
 		uintptr_t srcPixel = (uintptr_t) PIXEL(source, srcStartX, srcStartY + y);
@@ -461,7 +508,7 @@ void mImageComposite(struct mImage* image, const struct mImage* source, int x, i
 		return;
 	}
 
-	COMPOSITE_BOUNDS_INIT;
+	COMPOSITE_BOUNDS_INIT(source, image);
 
 	for (y = 0; y < srcRect.height; ++y) {
 		uintptr_t srcPixel = (uintptr_t) PIXEL(source, srcStartX, srcStartY + y);
@@ -498,7 +545,7 @@ void mImageCompositeWithAlpha(struct mImage* image, const struct mImage* source,
 		alpha = 256;
 	}
 
-	COMPOSITE_BOUNDS_INIT;
+	COMPOSITE_BOUNDS_INIT(source, image);
 
 	int fixedAlpha = alpha * 0x200;
 
@@ -821,6 +868,33 @@ void mPainterDrawCircle(struct mPainter* painter, int x, int y, int diameter) {
 	}
 }
 
+void mPainterDrawMask(struct mPainter* painter, const struct mImage* mask, int x, int y) {
+	if (!painter->fill) {
+		return;
+	}
+
+	COMPOSITE_BOUNDS_INIT(mask, painter->backing);
+
+	for (y = 0; y < srcRect.height; ++y) {
+		uintptr_t dstPixel = (uintptr_t) PIXEL(painter->backing, dstStartX, dstStartY + y);
+		uintptr_t maskPixel = (uintptr_t) PIXEL(mask, srcStartX, srcStartY + y);
+		for (x = 0; x < srcRect.width; ++x, dstPixel += painter->backing->depth, maskPixel += mask->depth) {
+			uint32_t color;
+			GET_PIXEL(color, maskPixel, mask->depth);
+			color = mColorConvert(color, mask->format, mCOLOR_ARGB8);
+			color = _mColorMultiply(painter->fillColor, color);
+			if (painter->blend || painter->fillColor < 0xFF000000) {
+				uint32_t current;
+				GET_PIXEL(current, dstPixel, painter->backing->depth);
+				current = mColorConvert(current, painter->backing->format, mCOLOR_ARGB8);
+				color = mColorMixARGB8(color, current);
+			}
+			color = mColorConvert(color, mCOLOR_ARGB8, painter->backing->format);
+			PUT_PIXEL(color, dstPixel, painter->backing->depth);
+		}
+	}
+}
+
 uint32_t mColorConvert(uint32_t color, enum mColorFormat from, enum mColorFormat to) {
 	if (from == to) {
 		return color;
diff --git a/src/util/test/image.c b/src/util/test/image.c
index a27e53d5c..e3ea16e24 100644
--- a/src/util/test/image.c
+++ b/src/util/test/image.c
@@ -2038,6 +2038,97 @@ M_TEST_DEFINE(painterDrawCircleInvalid) {
 	mImageDestroy(image);
 }
 
+M_TEST_DEFINE(painterDrawMask) {
+	struct mImage* image;
+	struct mImage* mask;
+	struct mPainter painter;
+
+	image = mImageCreate(4, 4, mCOLOR_XRGB8);
+	mPainterInit(&painter, image);
+	painter.blend = false;
+	painter.fill = true;
+
+	mask = mImageCreate(2, 2, mCOLOR_XRGB8);
+	mImageSetPixel(mask, 0, 0, 0xFFFFFFFF);
+	mImageSetPixel(mask, 1, 0, 0xFFFF0000);
+	mImageSetPixel(mask, 0, 1, 0xFF00FF00);
+	mImageSetPixel(mask, 1, 1, 0xFF0000FF);
+
+	painter.fillColor = 0xFFFFFFFF;
+	mPainterDrawMask(&painter, mask, 0, 0);
+	painter.fillColor = 0xFFFF0000;
+	mPainterDrawMask(&painter, mask, 2, 0);
+	painter.fillColor = 0xFF00FF00;
+	mPainterDrawMask(&painter, mask, 0, 2);
+	painter.fillColor = 0xFF0000FF;
+	mPainterDrawMask(&painter, mask, 2, 2);
+
+	COMPARE4X(0xFFFFFF, 0xFF0000, 0xFF0000, 0xFF0000,
+			  0x00FF00, 0x0000FF, 0x000000, 0x000000,
+			  0x00FF00, 0x000000, 0x0000FF, 0x000000,
+			  0x00FF00, 0x000000, 0x000000, 0x0000FF);
+
+	painter.fillColor = 0xFF808080;
+	mPainterDrawMask(&painter, mask, 0, 0);
+	painter.fillColor = 0xFFFFFF00;
+	mPainterDrawMask(&painter, mask, 2, 0);
+	painter.fillColor = 0xFF00FFFF;
+	mPainterDrawMask(&painter, mask, 0, 2);
+	painter.fillColor = 0xFFFF00FF;
+	mPainterDrawMask(&painter, mask, 2, 2);
+
+	COMPARE4X(0x808080, 0x800000, 0xFFFF00, 0xFF0000,
+			  0x008000, 0x000080, 0x00FF00, 0x000000,
+			  0x00FFFF, 0x000000, 0xFF00FF, 0xFF0000,
+			  0x00FF00, 0x0000FF, 0x000000, 0x0000FF);
+
+	painter.fillColor = 0xFFFFFFFF;
+	mPainterDrawMask(&painter, mask, -1, -1);
+	mPainterDrawMask(&painter, mask, 3, 3);
+	assert_int_equal(0xFF0000FF, mImageGetPixel(image, 0, 0));
+	assert_int_equal(0xFFFFFFFF, mImageGetPixel(image, 3, 3));
+
+	mImageDestroy(image);
+	mImageDestroy(mask);
+}
+
+M_TEST_DEFINE(painterDrawMaskBlend) {
+	struct mImage* image;
+	struct mImage* mask;
+	struct mPainter painter;
+	const uint8_t lut[4] = { 0x00, 0x55, 0xAA, 0xFF };
+	int x, y;
+
+	image = mImageCreate(4, 4, mCOLOR_XRGB8);
+	mPainterInit(&painter, image);
+	painter.blend = true;
+	painter.fill = true;
+	painter.fillColor = 0xFFFF8000;
+
+	for (y = 0; y < 4; ++y) {
+		for (x = 0; x < 4; ++x) {
+			mImageSetPixel(image, x, y, 0xFF808080);
+		}
+	}
+
+	mask = mImageCreate(4, 4, mCOLOR_ARGB8);
+	for (y = 0; y < 4; ++y) {
+		for (x = 0; x < 4; ++x) {
+			mImageSetPixel(mask, x, y, (lut[x] << 24) | (lut[y] * 0x010101));
+		}
+	}
+
+	mPainterDrawMask(&painter, mask, 0, 0);
+
+	COMPARE4X(0x808080, 0x555555, 0x2A2A2A, 0x000000,
+			  0x808080, 0x716355, 0x63462A, 0x552A00,
+			  0x808080, 0x8E7155, 0x9C632A, 0xAA5500,
+			  0x808080, 0xAA8055, 0xD4802A, 0xFF8000);
+
+	mImageDestroy(image);
+	mImageDestroy(mask);
+}
+
 #undef COMPARE3X
 #undef COMPARE3
 #undef COMPARE4X
@@ -2083,4 +2174,6 @@ M_TEST_SUITE_DEFINE(Image,
 	cmocka_unit_test(painterDrawCircleOffset),
 	cmocka_unit_test(painterDrawCircleBlend),
 	cmocka_unit_test(painterDrawCircleInvalid),
+	cmocka_unit_test(painterDrawMask),
+	cmocka_unit_test(painterDrawMaskBlend),
 )

From 4fc223edc6dee493fee63039758189061b5d8546 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Mon, 18 Mar 2024 23:26:01 -0700
Subject: [PATCH 13/53] Qt: Reattach video backend when resetting scripts
 (fixes #3167)

---
 src/platform/qt/scripting/ScriptingController.cpp | 2 ++
 src/platform/qt/scripting/ScriptingController.h   | 1 +
 2 files changed, 3 insertions(+)

diff --git a/src/platform/qt/scripting/ScriptingController.cpp b/src/platform/qt/scripting/ScriptingController.cpp
index 06adafdf5..79b46e9d0 100644
--- a/src/platform/qt/scripting/ScriptingController.cpp
+++ b/src/platform/qt/scripting/ScriptingController.cpp
@@ -92,6 +92,7 @@ void ScriptingController::setInputController(InputController* input) {
 }
 
 void ScriptingController::setVideoBackend(VideoBackend* backend) {
+	m_videoBackend = backend;
 	mScriptCanvasUpdateBackend(&m_scriptContext, backend);
 }
 
@@ -339,6 +340,7 @@ void ScriptingController::init() {
 
 	mScriptContextAttachLogger(&m_scriptContext, &m_logger);
 	m_bufferModel->attachToContext(&m_scriptContext);
+	mScriptCanvasUpdateBackend(&m_scriptContext, m_videoBackend);
 
 	HashTableEnumerate(&m_scriptContext.engines, [](const char* key, void* engine, void* context) {
 	ScriptingController* self = static_cast<ScriptingController*>(context);
diff --git a/src/platform/qt/scripting/ScriptingController.h b/src/platform/qt/scripting/ScriptingController.h
index 9e5b3f6b5..5c579a768 100644
--- a/src/platform/qt/scripting/ScriptingController.h
+++ b/src/platform/qt/scripting/ScriptingController.h
@@ -87,6 +87,7 @@ private:
 	mScriptEngineContext* m_activeEngine = nullptr;
 	QHash<QString, mScriptEngineContext*> m_engines;
 	ScriptingTextBufferModel* m_bufferModel;
+	VideoBackend* m_videoBackend = nullptr;
 
 	mScriptGamepad m_gamepad;
 

From b5151d2d5fcd8f788404f92a45371c17785eafa1 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Tue, 19 Mar 2024 21:30:47 -0700
Subject: [PATCH 14/53] Core: Clean up thread state mutex usage

---
 src/core/thread.c | 32 ++++++++++++++++++++------------
 1 file changed, 20 insertions(+), 12 deletions(-)

diff --git a/src/core/thread.c b/src/core/thread.c
index 63b8e0d56..4b470777d 100644
--- a/src/core/thread.c
+++ b/src/core/thread.c
@@ -42,13 +42,9 @@ static BOOL CALLBACK _createTLS(PINIT_ONCE once, PVOID param, PVOID* context) {
 
 static void _mCoreLog(struct mLogger* logger, int category, enum mLogLevel level, const char* format, va_list args);
 
-static void _changeState(struct mCoreThreadInternal* threadContext, enum mCoreThreadState newState, bool broadcast) {
-	MutexLock(&threadContext->stateMutex);
+static void _changeState(struct mCoreThreadInternal* threadContext, enum mCoreThreadState newState) {
 	threadContext->state = newState;
-	if (broadcast) {
-		ConditionWake(&threadContext->stateCond);
-	}
-	MutexUnlock(&threadContext->stateMutex);
+	ConditionWake(&threadContext->stateCond);
 }
 
 static void _waitOnInterrupt(struct mCoreThreadInternal* threadContext) {
@@ -178,7 +174,9 @@ void _crashed(void* context) {
 	if (!thread) {
 		return;
 	}
-	_changeState(thread->impl, mTHREAD_CRASHED, true);
+	MutexLock(&thread->impl->stateMutex);
+	_changeState(thread->impl, mTHREAD_CRASHED);
+	MutexUnlock(&thread->impl->stateMutex);
 }
 
 void _coreSleep(void* context) {
@@ -196,7 +194,9 @@ void _coreShutdown(void* context) {
 	if (!thread) {
 		return;
 	}
-	_changeState(thread->impl, mTHREAD_EXITING, true);
+	MutexLock(&thread->impl->stateMutex);
+	_changeState(thread->impl, mTHREAD_EXITING);
+	MutexUnlock(&thread->impl->stateMutex);
 }
 
 #ifdef ENABLE_SCRIPTING
@@ -303,7 +303,9 @@ static THREAD_ENTRY _mCoreThreadRun(void* context) {
 
 	core->reset(core);
 	threadContext->impl->core = core;
-	_changeState(threadContext->impl, mTHREAD_RUNNING, true);
+	MutexLock(&threadContext->impl->stateMutex);
+	_changeState(threadContext->impl, mTHREAD_RUNNING);
+	MutexUnlock(&threadContext->impl->stateMutex);
 
 	if (threadContext->resetCallback) {
 		threadContext->resetCallback(threadContext);
@@ -326,23 +328,27 @@ static THREAD_ENTRY _mCoreThreadRun(void* context) {
 	bool wasPaused = false;
 	int pendingRequests = 0;
 
+	MutexLock(&impl->stateMutex);
 	while (impl->state < mTHREAD_EXITING) {
 #ifdef USE_DEBUGGERS
 		struct mDebugger* debugger = core->debugger;
 		if (debugger) {
+			MutexUnlock(&impl->stateMutex);
 			mDebuggerRun(debugger);
+			MutexLock(&impl->stateMutex);
 			if (debugger->state == DEBUGGER_SHUTDOWN) {
-				_changeState(impl, mTHREAD_EXITING, false);
+				impl->state = mTHREAD_EXITING;
 			}
 		} else
 #endif
 		{
 			while (impl->state == mTHREAD_RUNNING) {
+				MutexUnlock(&impl->stateMutex);
 				core->runLoop(core);
+				MutexLock(&impl->stateMutex);
 			}
 		}
 
-		MutexLock(&impl->stateMutex);
 		while (impl->state >= mTHREAD_MIN_WAITING && impl->state < mTHREAD_EXITING) {
 			if (impl->state == mTHREAD_INTERRUPTING) {
 				impl->state = mTHREAD_INTERRUPTED;
@@ -430,7 +436,9 @@ static THREAD_ENTRY _mCoreThreadRun(void* context) {
 	}
 
 	while (impl->state < mTHREAD_SHUTDOWN) {
-		_changeState(impl, mTHREAD_SHUTDOWN, false);
+		MutexLock(&impl->stateMutex);
+		impl->state = mTHREAD_SHUTDOWN;
+		MutexUnlock(&impl->stateMutex);
 	}
 
 	if (core->opts.rewindEnable) {

From 3023cf7383097f71d7b64c0ad21d7defb6aad5fb Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Tue, 19 Mar 2024 21:40:38 -0700
Subject: [PATCH 15/53] Util: Code cleanup to remove unreachable code

---
 src/util/string.c | 14 +++++---------
 1 file changed, 5 insertions(+), 9 deletions(-)

diff --git a/src/util/string.c b/src/util/string.c
index 1a2ffe7a4..b2bf376c6 100644
--- a/src/util/string.c
+++ b/src/util/string.c
@@ -177,16 +177,12 @@ size_t toUtf8(uint32_t unichar, char* buffer) {
 		buffer[2] = (unichar & 0x3F) | 0x80;
 		return 3;
 	}
-	if (unichar < 0x200000) {
-		buffer[0] = (unichar >> 18) | 0xF0;
-		buffer[1] = ((unichar >> 12) & 0x3F) | 0x80;
-		buffer[2] = ((unichar >> 6) & 0x3F) | 0x80;
-		buffer[3] = (unichar & 0x3F) | 0x80;
-		return 4;
-	}
 
-	// This shouldn't be possible
-	return 0;
+	buffer[0] = (unichar >> 18) | 0xF0;
+	buffer[1] = ((unichar >> 12) & 0x3F) | 0x80;
+	buffer[2] = ((unichar >> 6) & 0x3F) | 0x80;
+	buffer[3] = (unichar & 0x3F) | 0x80;
+	return 4;
 }
 
 size_t toUtf16(uint32_t unichar, uint16_t* buffer) {

From b0252c6dbca86d766c2315df6fc12bf46e76286e Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Sun, 24 Mar 2024 14:46:34 -0700
Subject: [PATCH 16/53] Qt: Get InputController compiling with Qt6

Cameras still don't work though
---
 src/platform/qt/InputController.cpp | 49 +++++++++++++++++++++++++++--
 src/platform/qt/InputController.h   |  9 ++++--
 2 files changed, 53 insertions(+), 5 deletions(-)

diff --git a/src/platform/qt/InputController.cpp b/src/platform/qt/InputController.cpp
index 337e7df6b..e195505a4 100644
--- a/src/platform/qt/InputController.cpp
+++ b/src/platform/qt/InputController.cpp
@@ -16,8 +16,13 @@
 #include <QTimer>
 #include <QWidget>
 #ifdef BUILD_QT_MULTIMEDIA
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
 #include <QCameraInfo>
 #include <QVideoSurfaceFormat>
+#else
+#include <QCameraDevice>
+#include <QMediaDevices>
+#endif
 #endif
 
 #include <mgba/core/interface.h>
@@ -50,7 +55,9 @@ InputController::InputController(QWidget* topLevel, QObject* parent)
 	m_gamepadTimer.start();
 
 #ifdef BUILD_QT_MULTIMEDIA
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
 	connect(&m_videoDumper, &VideoDumper::imageAvailable, this, &InputController::setCamImage);
+#endif
 #endif
 
 	mInputBindKey(&m_inputMap, KEYBOARD, Qt::Key_X, GBA_KEY_A);
@@ -90,10 +97,20 @@ InputController::InputController(QWidget* topLevel, QObject* parent)
 #ifdef BUILD_QT_MULTIMEDIA
 		image->p->m_cameraActive = true;
 		QByteArray camera = image->p->m_config->getQtOption("camera").toByteArray();
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
 		if (!camera.isNull()) {
 			image->p->m_cameraDevice = camera;
 		}
 		QMetaObject::invokeMethod(image->p, "setupCam");
+#else
+		if (!camera.isNull()) {
+			for (const auto& cam : QMediaDevices::videoInputs()) {
+				if (cam.id() == camera) {
+					image->p->m_cameraDevice = cam;
+				}
+			}
+		}
+#endif
 #endif
 	};
 
@@ -595,9 +612,13 @@ void InputController::setCamImage(const QImage& image) {
 QList<QPair<QByteArray, QString>> InputController::listCameras() const {
 	QList<QPair<QByteArray, QString>> out;
 #ifdef BUILD_QT_MULTIMEDIA
-	QList<QCameraInfo> cams = QCameraInfo::availableCameras();
-	for (const auto& cam : cams) {
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
+	for (const auto& cam : QCameraInfo::availableCameras()) {
 		out.append(qMakePair(cam.deviceName().toLatin1(), cam.description()));
+#else
+	for (const auto& cam : QMediaDevices::videoInputs()) {
+		out.append(qMakePair(cam.id(), cam.description()));
+#endif
 	}
 #endif
 	return out;
@@ -639,6 +660,7 @@ void InputController::setupCam() {
 		return;
 	}
 
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
 	if (!m_camera) {
 		m_camera = std::make_unique<QCamera>(m_cameraDevice);
 		connect(m_camera.get(), &QCamera::statusChanged, this, &InputController::prepareCamSettings, Qt::QueuedConnection);
@@ -650,10 +672,16 @@ void InputController::setupCam() {
 	m_camera->setCaptureMode(QCamera::CaptureVideo);
 	m_camera->setViewfinder(&m_videoDumper);
 	m_camera->load();
+#else
+	if (!m_camera) {
+		m_camera = std::make_unique<QCamera>(m_cameraDevice);
+		m_captureSession.setCamera(m_camera.get());
+	}
+#endif
 #endif
 }
 
-#ifdef BUILD_QT_MULTIMEDIA
+#if defined(BUILD_QT_MULTIMEDIA) && (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
 void InputController::prepareCamSettings(QCamera::Status status) {
 	if (status != QCamera::LoadedStatus || m_camera->state() == QCamera::ActiveState) {
 		return;
@@ -697,7 +725,11 @@ void InputController::prepareCamSettings(QCamera::Status status) {
 void InputController::teardownCam() {
 #ifdef BUILD_QT_MULTIMEDIA
 	if (m_camera) {
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
 		m_camera->unload();
+#else
+		m_captureSession.setCamera(nullptr);
+#endif
 		m_camera.reset();
 	}
 #endif
@@ -705,6 +737,7 @@ void InputController::teardownCam() {
 
 void InputController::setCamera(const QByteArray& name) {
 #ifdef BUILD_QT_MULTIMEDIA
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
 	if (m_cameraDevice == name) {
 		return;
 	}
@@ -715,5 +748,15 @@ void InputController::setCamera(const QByteArray& name) {
 	if (m_cameraActive) {
 		setupCam();
 	}
+#else
+	if (m_cameraDevice.id() == name) {
+		return;
+	}
+	for (const auto& cam : QMediaDevices::videoInputs()) {
+		if (cam.id() == name) {
+			m_cameraDevice = cam;
+		}
+	}
+#endif
 #endif
 }
diff --git a/src/platform/qt/InputController.h b/src/platform/qt/InputController.h
index 06871ff1e..51be333ed 100644
--- a/src/platform/qt/InputController.h
+++ b/src/platform/qt/InputController.h
@@ -27,6 +27,8 @@
 #ifdef BUILD_QT_MULTIMEDIA
 #if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
 #include "VideoDumper.h"
+#else
+#include <QMediaCaptureSession>
 #endif
 #include <QCamera>
 #endif
@@ -126,7 +128,7 @@ public slots:
 	void setCamera(const QByteArray& id);
 
 private slots:
-#ifdef BUILD_QT_MULTIMEDIA
+#if defined(BUILD_QT_MULTIMEDIA) && (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
 	void prepareCamSettings(QCamera::Status);
 #endif
 	void setupCam();
@@ -168,10 +170,13 @@ private:
 
 #ifdef BUILD_QT_MULTIMEDIA
 	bool m_cameraActive = false;
-	QByteArray m_cameraDevice;
 	std::unique_ptr<QCamera> m_camera;
 #if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
+	QByteArray m_cameraDevice;
 	VideoDumper m_videoDumper;
+#else
+	QCameraDevice m_cameraDevice;
+	QMediaCaptureSession m_captureSession;
 #endif
 #endif
 

From 2f963cd13b2caf20bb2273463ee74979d9347cf1 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Sun, 24 Mar 2024 15:55:39 -0700
Subject: [PATCH 17/53] Qt: Port AudioProcessorQt to Qt6

---
 src/platform/qt/AudioProcessorQt.cpp | 33 +++++++++++++++++++++-------
 src/platform/qt/AudioProcessorQt.h   | 12 +++++++++-
 src/platform/qt/Window.cpp           |  4 +++-
 3 files changed, 39 insertions(+), 10 deletions(-)

diff --git a/src/platform/qt/AudioProcessorQt.cpp b/src/platform/qt/AudioProcessorQt.cpp
index 8d12cd935..4b53c7bb7 100644
--- a/src/platform/qt/AudioProcessorQt.cpp
+++ b/src/platform/qt/AudioProcessorQt.cpp
@@ -9,6 +9,9 @@
 #include "LogController.h"
 
 #include <QAudioOutput>
+#if (QT_VERSION >= QT_VERSION_CHECK(6, 0, 0))
+#include <QMediaDevices>
+#endif
 
 #include <mgba/core/core.h>
 #include <mgba/core/thread.h>
@@ -31,10 +34,13 @@ void AudioProcessorQt::setInput(std::shared_ptr<CoreController> controller) {
 }
 
 void AudioProcessorQt::stop() {
+	if (m_audioOutput) {
+		m_audioOutput->stop();
+		m_audioOutput.reset();
+	}
 	if (m_device) {
 		m_device.reset();
 	}
-	pause();
 	AudioProcessor::stop();
 }
 
@@ -52,25 +58,36 @@ bool AudioProcessorQt::start() {
 		QAudioFormat format;
 		format.setSampleRate(m_sampleRate);
 		format.setChannelCount(2);
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
 		format.setSampleSize(16);
 		format.setCodec("audio/pcm");
 		format.setByteOrder(QAudioFormat::Endian(QSysInfo::ByteOrder));
 		format.setSampleType(QAudioFormat::SignedInt);
 
-		m_audioOutput = new QAudioOutput(format, this);
+		m_audioOutput = std::make_unique<QAudioOutput>(format);
 		m_audioOutput->setCategory("game");
-	}
+#else
+		format.setSampleFormat(QAudioFormat::Int16);
 
-	m_device->setInput(input());
-	m_device->setFormat(m_audioOutput->format());
+		QAudioDevice device(QMediaDevices::defaultAudioOutput());
+		m_audioOutput = std::make_unique<QAudioSink>(device, format);
+		LOG(QT, INFO) << "Audio outputting to " << device.description();
+#endif
+	}
 
-	m_audioOutput->start(m_device.get());
-	return m_audioOutput->state() == QAudio::ActiveState;
+	if (m_audioOutput->state() == QAudio::SuspendedState) {
+		m_audioOutput->resume();
+	} else {
+		m_device->setInput(input());
+		m_device->setFormat(m_audioOutput->format());
+		m_audioOutput->start(m_device.get());
+	}
+	return m_audioOutput->state() == QAudio::ActiveState && m_audioOutput->error() == QAudio::NoError;
 }
 
 void AudioProcessorQt::pause() {
 	if (m_audioOutput) {
-		m_audioOutput->stop();
+		m_audioOutput->suspend();
 	}
 }
 
diff --git a/src/platform/qt/AudioProcessorQt.h b/src/platform/qt/AudioProcessorQt.h
index 0e56907e1..1648b967f 100644
--- a/src/platform/qt/AudioProcessorQt.h
+++ b/src/platform/qt/AudioProcessorQt.h
@@ -7,6 +7,12 @@
 
 #include "AudioProcessor.h"
 
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
+#include <QAudioOutput>
+#else
+#include <QAudioSink>
+#endif
+
 class QAudioOutput;
 
 namespace QGBA {
@@ -33,7 +39,11 @@ public slots:
 	virtual void requestSampleRate(unsigned) override;
 
 private:
-	QAudioOutput* m_audioOutput = nullptr;
+#if (QT_VERSION >= QT_VERSION_CHECK(6, 0, 0))
+	std::unique_ptr<QAudioSink> m_audioOutput;
+#else
+	std::unique_ptr<QAudioOutput> m_audioOutput;
+#endif
 	std::unique_ptr<AudioDevice> m_device;
 	unsigned m_sampleRate = 44100;
 };
diff --git a/src/platform/qt/Window.cpp b/src/platform/qt/Window.cpp
index 6b77a1ef3..cc439f60f 100644
--- a/src/platform/qt/Window.cpp
+++ b/src/platform/qt/Window.cpp
@@ -1093,7 +1093,9 @@ void Window::reloadAudioDriver() {
 	m_audioProcessor = std::unique_ptr<AudioProcessor>(AudioProcessor::create());
 	m_audioProcessor->setInput(m_controller);
 	m_audioProcessor->configure(m_config);
-	m_audioProcessor->start();
+	if (!m_audioProcessor->start()) {
+		LOG(QT, WARN) << "Failed to start audio processor";
+	}
 }
 
 void Window::changeRenderer() {

From 7a2f98677d591738da5fc8871768112780f31b05 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Sun, 24 Mar 2024 19:51:09 -0700
Subject: [PATCH 18/53] Qt: Get VideoDumper compiling with Qt6

Cameras still don't work though
---
 src/platform/qt/CMakeLists.txt  |   7 +-
 src/platform/qt/VideoDumper.cpp | 126 ++++++++++++++++++++++----------
 src/platform/qt/VideoDumper.h   |  34 ++++++++-
 3 files changed, 121 insertions(+), 46 deletions(-)

diff --git a/src/platform/qt/CMakeLists.txt b/src/platform/qt/CMakeLists.txt
index cb224b0a6..19d4293d0 100644
--- a/src/platform/qt/CMakeLists.txt
+++ b/src/platform/qt/CMakeLists.txt
@@ -225,11 +225,8 @@ endif()
 if(${QT}Multimedia_FOUND)
 	list(APPEND AUDIO_SRC
 		AudioProcessorQt.cpp
-		AudioDevice.cpp)
-	if(QT_V LESS 6)
-		list(APPEND SOURCE_FILES
-			VideoDumper.cpp)
-	endif()
+		AudioDevice.cpp
+		VideoDumper.cpp)
 	if (WIN32 AND QT_STATIC)
 		list(APPEND QT_LIBRARIES ${QT}::QWindowsAudioPlugin ${QT}::DSServicePlugin ${QT}::QWindowsVistaStylePlugin ${QT}::QJpegPlugin
                                  strmiids mfuuid mfplat mf ksguid dxva2 evr d3d9)
diff --git a/src/platform/qt/VideoDumper.cpp b/src/platform/qt/VideoDumper.cpp
index 7fdb433bb..1f1185200 100644
--- a/src/platform/qt/VideoDumper.cpp
+++ b/src/platform/qt/VideoDumper.cpp
@@ -5,59 +5,69 @@
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 #include "VideoDumper.h"
 
+#include "VideoProcessor.h"
+
 #include <QImage>
-#include <QVideoSurfaceFormat>
 
 using namespace QGBA;
 
 VideoDumper::VideoDumper(QObject* parent)
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
 	: QAbstractVideoSurface(parent)
+#else
+	: QObject(parent)
+#endif
 {
 }
 
 bool VideoDumper::present(const QVideoFrame& frame) {
 	QVideoFrame mappedFrame(frame);
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
 	if (!mappedFrame.map(QAbstractVideoBuffer::ReadOnly)) {
 		return false;
 	}
-	QVideoFrame::PixelFormat vFormat = mappedFrame.pixelFormat();
-	QImage::Format format = QVideoFrame::imageFormatFromPixelFormat(vFormat);
+#else
+	if (!mappedFrame.map(QVideoFrame::ReadOnly)) {
+		return false;
+	}
+#endif
+	PixelFormat vFormat = mappedFrame.pixelFormat();
+	QImage::Format format = imageFormatFromPixelFormat(vFormat);
 	bool swap = false;
 #ifdef USE_FFMPEG
 	bool useScaler = false;
 #endif
 	if (format == QImage::Format_Invalid) {
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
 		if (vFormat < QVideoFrame::Format_BGRA5658_Premultiplied) {
 			vFormat = static_cast<QVideoFrame::PixelFormat>(vFormat - QVideoFrame::Format_BGRA32 + QVideoFrame::Format_ARGB32);
-			format = QVideoFrame::imageFormatFromPixelFormat(vFormat);
-			if (format == QImage::Format_ARGB32) {
-				format = QImage::Format_RGBA8888;
-			} else if (format == QImage::Format_ARGB32_Premultiplied) {
-				format = QImage::Format_RGBA8888_Premultiplied;
-			}
+#else
+		if (vFormat < PixelFormat::Format_AYUV) {
+#endif
+			format = imageFormatFromPixelFormat(vFormat);
 			swap = true;
 		} else {
 #ifdef USE_FFMPEG
 			enum AVPixelFormat pixelFormat;
 			switch (vFormat) {
-			case QVideoFrame::Format_YUV420P:
+			case VideoDumper::PixelFormat::Format_YUV420P:
 				pixelFormat = AV_PIX_FMT_YUV420P;
 				break;
 #if (QT_VERSION >= QT_VERSION_CHECK(5, 14, 0))
-			case QVideoFrame::Format_YUV422P:
+			case VideoDumper::PixelFormat::Format_YUV422P:
 				pixelFormat = AV_PIX_FMT_YUV422P;
 				break;
 #endif
-			case QVideoFrame::Format_YUYV:
+			case VideoDumper::PixelFormat::Format_YUYV:
 				pixelFormat = AV_PIX_FMT_YUYV422;
 				break;
-			case QVideoFrame::Format_UYVY:
+			case VideoDumper::PixelFormat::Format_UYVY:
 				pixelFormat = AV_PIX_FMT_UYVY422;
 				break;
-			case QVideoFrame::Format_NV12:
+			case VideoDumper::PixelFormat::Format_NV12:
 				pixelFormat = AV_PIX_FMT_NV12;
 				break;
-			case QVideoFrame::Format_NV21:
+			case VideoDumper::PixelFormat::Format_NV21:
 				pixelFormat = AV_PIX_FMT_NV12;
 				break;
 			default:
@@ -80,11 +90,15 @@ bool VideoDumper::present(const QVideoFrame& frame) {
 #endif
 		}
 	}
-	uchar* bits = mappedFrame.bits();
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
+	Direction direction = surfaceFormat().scanLineDirection();
+#else
+	Direction direction = mappedFrame.surfaceFormat().scanLineDirection();
+#endif
 #ifdef USE_FFMPEG
 	QImage image;
 	if (!useScaler) {
-		image = QImage(bits, mappedFrame.width(), mappedFrame.height(), mappedFrame.bytesPerLine(), format);
+		image = QImage(mappedFrame.bits(0), mappedFrame.width(), mappedFrame.height(), mappedFrame.bytesPerLine(0), format);
 	}
 	if (useScaler) {
 		image = QImage(mappedFrame.width(), mappedFrame.height(), format);
@@ -99,14 +113,14 @@ bool VideoDumper::present(const QVideoFrame& frame) {
 		sws_scale(m_scaler, planes, strides, 0, mappedFrame.height(), &outBits, &outStride);
 	} else
 #else
-	QImage image(bits, mappedFrame.width(), mappedFrame.height(), mappedFrame.bytesPerLine(), format);
+	QImage image(mappedFrame.bits(0), mappedFrame.width(), mappedFrame.height(), mappedFrame.bytesPerLine(0), format);
 #endif
 	if (swap) {
 		image = image.rgbSwapped();
-	} else if (surfaceFormat().scanLineDirection() != QVideoSurfaceFormat::BottomToTop) {
+	} else if (direction != Direction::BottomToTop) {
 		image = image.copy(); // Create a deep copy of the bits
 	}
-	if (surfaceFormat().scanLineDirection() == QVideoSurfaceFormat::BottomToTop) {
+	if (direction == Direction::BottomToTop) {
 		image = image.mirrored();
 	}
 	mappedFrame.unmap();
@@ -114,29 +128,63 @@ bool VideoDumper::present(const QVideoFrame& frame) {
 	return true;
 }
 
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
 QList<QVideoFrame::PixelFormat> VideoDumper::supportedPixelFormats(QAbstractVideoBuffer::HandleType) const {
-	QList<QVideoFrame::PixelFormat> list;
-	list.append(QVideoFrame::Format_RGB32);
-	list.append(QVideoFrame::Format_ARGB32);
-	list.append(QVideoFrame::Format_RGB24);
-	list.append(QVideoFrame::Format_ARGB32_Premultiplied);
-	list.append(QVideoFrame::Format_RGB565);
-	list.append(QVideoFrame::Format_RGB555);
-	list.append(QVideoFrame::Format_BGR32);
-	list.append(QVideoFrame::Format_BGRA32);
-	list.append(QVideoFrame::Format_BGR24);
-	list.append(QVideoFrame::Format_BGRA32_Premultiplied);
-	list.append(QVideoFrame::Format_BGR565);
-	list.append(QVideoFrame::Format_BGR555);
+	return VideoDumper::supportedPixelFormats();
+}
+#endif
+
+QList<VideoDumper::PixelFormat> VideoDumper::supportedPixelFormats() {
+	QList<VideoDumper::PixelFormat> list{{
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
+		VideoDumper::PixelFormat::Format_RGB32,
+		VideoDumper::PixelFormat::Format_ARGB32,
+		VideoDumper::PixelFormat::Format_RGB24,
+		VideoDumper::PixelFormat::Format_ARGB32_Premultiplied,
+		VideoDumper::PixelFormat::Format_RGB565,
+		VideoDumper::PixelFormat::Format_RGB555,
+		VideoDumper::PixelFormat::Format_BGR32,
+		VideoDumper::PixelFormat::Format_BGRA32,
+		VideoDumper::PixelFormat::Format_BGR24,
+		VideoDumper::PixelFormat::Format_BGRA32_Premultiplied,
+		VideoDumper::PixelFormat::Format_BGR565,
+		VideoDumper::PixelFormat::Format_BGR555,
+#else
+		VideoDumper::PixelFormat::Format_XRGB8888,
+		VideoDumper::PixelFormat::Format_ARGB8888,
+		VideoDumper::PixelFormat::Format_ARGB8888_Premultiplied,
+		VideoDumper::PixelFormat::Format_RGBX8888,
+		VideoDumper::PixelFormat::Format_RGBA8888,
+		VideoDumper::PixelFormat::Format_XBGR8888,
+		VideoDumper::PixelFormat::Format_ABGR8888,
+		VideoDumper::PixelFormat::Format_BGRX8888,
+		VideoDumper::PixelFormat::Format_BGRA8888,
+		VideoDumper::PixelFormat::Format_BGRA8888_Premultiplied,
+#endif
 #ifdef USE_FFMPEG
-	list.append(QVideoFrame::Format_YUYV);
-	list.append(QVideoFrame::Format_UYVY);
+		VideoDumper::PixelFormat::Format_YUYV,
+		VideoDumper::PixelFormat::Format_UYVY,
 #if (QT_VERSION >= QT_VERSION_CHECK(5, 14, 0))
-	list.append(QVideoFrame::Format_YUV422P);
+		VideoDumper::PixelFormat::Format_YUV422P,
 #endif
-	list.append(QVideoFrame::Format_YUV420P);
-	list.append(QVideoFrame::Format_NV12);
-	list.append(QVideoFrame::Format_NV21);
+		VideoDumper::PixelFormat::Format_YUV420P,
+		VideoDumper::PixelFormat::Format_NV12,
+		VideoDumper::PixelFormat::Format_NV21,
 #endif
+	}};
 	return list;
 }
+
+QImage::Format VideoDumper::imageFormatFromPixelFormat(VideoDumper::PixelFormat vFormat) {
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
+	QImage::Format format = QVideoFrame::imageFormatFromPixelFormat(vFormat);
+#else
+	QImage::Format format = QVideoFrameFormat::imageFormatFromPixelFormat(vFormat);
+#endif
+	if (format == QImage::Format_ARGB32) {
+		format = QImage::Format_RGBA8888;
+	} else if (format == QImage::Format_ARGB32_Premultiplied) {
+		format = QImage::Format_RGBA8888_Premultiplied;
+	}
+	return format;
+}
diff --git a/src/platform/qt/VideoDumper.h b/src/platform/qt/VideoDumper.h
index c22688c2b..65433462c 100644
--- a/src/platform/qt/VideoDumper.h
+++ b/src/platform/qt/VideoDumper.h
@@ -5,7 +5,13 @@
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 #pragma once
 
+#include <QObject>
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
 #include <QAbstractVideoSurface>
+#include <QVideoSurfaceFormat>
+#else
+#include <QVideoFrameFormat>
+#endif
 
 #ifdef USE_FFMPEG
 extern "C" {
@@ -15,14 +21,38 @@ extern "C" {
 
 namespace QGBA {
 
-class VideoDumper : public QAbstractVideoSurface {
+class VideoDumper : public
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
+QAbstractVideoSurface
+#else
+QObject
+#endif
+{
 Q_OBJECT
 
 public:
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
+	using PixelFormat = QVideoFrame::PixelFormat;
+	using Direction = QVideoSurfaceFormat::Direction;
+#else
+	using PixelFormat = QVideoFrameFormat::PixelFormat;
+	using Direction = QVideoFrameFormat::Direction;
+#endif
+
 	VideoDumper(QObject* parent = nullptr);
 
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
+	QList<QVideoFrame::PixelFormat> supportedPixelFormats(QAbstractVideoBuffer::HandleType type) const override;
+#endif
+	static QList<PixelFormat> supportedPixelFormats();
+	static QImage::Format imageFormatFromPixelFormat(PixelFormat);
+
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
 	bool present(const QVideoFrame& frame) override;
-	QList<QVideoFrame::PixelFormat> supportedPixelFormats(QAbstractVideoBuffer::HandleType type = QAbstractVideoBuffer::NoHandle) const override;
+#else
+public slots:
+	bool present(const QVideoFrame& frame);
+#endif
 
 signals:
 	void imageAvailable(const QImage& image);

From cc692aafebdce884a5524603f909e4a210630453 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Sun, 24 Mar 2024 21:18:41 -0700
Subject: [PATCH 19/53] Qt: Hook up cameras in Qt6

---
 src/platform/qt/InputController.cpp | 47 +++++++++++++++++++++++------
 src/platform/qt/InputController.h   | 14 ++++++---
 2 files changed, 47 insertions(+), 14 deletions(-)

diff --git a/src/platform/qt/InputController.cpp b/src/platform/qt/InputController.cpp
index e195505a4..4a0236199 100644
--- a/src/platform/qt/InputController.cpp
+++ b/src/platform/qt/InputController.cpp
@@ -54,11 +54,11 @@ InputController::InputController(QWidget* topLevel, QObject* parent)
 	m_gamepadTimer.setInterval(15);
 	m_gamepadTimer.start();
 
-#ifdef BUILD_QT_MULTIMEDIA
-#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
-	connect(&m_videoDumper, &VideoDumper::imageAvailable, this, &InputController::setCamImage);
-#endif
+#if defined(BUILD_QT_MULTIMEDIA) && (QT_VERSION >= QT_VERSION_CHECK(6, 0, 0))
+	m_captureSession.setVideoSink(&m_videoSink);
+	connect(&m_videoSink, &QVideoSink::videoFrameChanged, &m_videoDumper, &VideoDumper::present);
 #endif
+	connect(&m_videoDumper, &VideoDumper::imageAvailable, this, &InputController::setCamImage);
 
 	mInputBindKey(&m_inputMap, KEYBOARD, Qt::Key_X, GBA_KEY_A);
 	mInputBindKey(&m_inputMap, KEYBOARD, Qt::Key_Z, GBA_KEY_B);
@@ -101,7 +101,6 @@ InputController::InputController(QWidget* topLevel, QObject* parent)
 		if (!camera.isNull()) {
 			image->p->m_cameraDevice = camera;
 		}
-		QMetaObject::invokeMethod(image->p, "setupCam");
 #else
 		if (!camera.isNull()) {
 			for (const auto& cam : QMediaDevices::videoInputs()) {
@@ -111,6 +110,7 @@ InputController::InputController(QWidget* topLevel, QObject* parent)
 			}
 		}
 #endif
+		QMetaObject::invokeMethod(image->p, "setupCam");
 #endif
 	};
 
@@ -677,18 +677,26 @@ void InputController::setupCam() {
 		m_camera = std::make_unique<QCamera>(m_cameraDevice);
 		m_captureSession.setCamera(m_camera.get());
 	}
+	prepareCamFormat();
 #endif
 #endif
 }
 
-#if defined(BUILD_QT_MULTIMEDIA) && (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
+#ifdef BUILD_QT_MULTIMEDIA
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
 void InputController::prepareCamSettings(QCamera::Status status) {
 	if (status != QCamera::LoadedStatus || m_camera->state() == QCamera::ActiveState) {
 		return;
 	}
+	prepareCamFormat();
+}
+#endif
+
+void InputController::prepareCamFormat() {
 #if (QT_VERSION >= QT_VERSION_CHECK(5, 5, 0))
-	QCameraViewfinderSettings settings;
 	QSize size(1280, 720);
+#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
+	QCameraViewfinderSettings settings;
 	auto cameraRes = m_camera->supportedViewfinderResolutions(settings);
 	for (auto& cameraSize : cameraRes) {
 		if (cameraSize.width() < m_image.w || cameraSize.height() < m_image.h) {
@@ -717,6 +725,25 @@ void InputController::prepareCamSettings(QCamera::Status status) {
 		}
 	}
 	m_camera->setViewfinderSettings(settings);
+#else
+	bool goodFormatFound = false;
+	auto goodFormats = m_videoDumper.supportedPixelFormats();
+	QCameraFormat bestFormat;
+	for (const auto& format : m_cameraDevice.videoFormats()) {
+		if (!goodFormats.contains(format.pixelFormat())) {
+			continue;
+		}
+		if (format.resolution().width() <= size.width() && format.resolution().height() <= size.height()) {
+			size = format.resolution();
+			bestFormat = format;
+			goodFormatFound = true;
+		}
+	}
+	if (!goodFormatFound) {
+		LOG(QT, WARN) << "Could not find a valid camera format!";
+	}
+	m_camera->setCameraFormat(bestFormat);
+#endif
 #endif
 	m_camera->start();
 }
@@ -745,9 +772,6 @@ void InputController::setCamera(const QByteArray& name) {
 	if (m_camera && m_camera->state() == QCamera::ActiveState) {
 		teardownCam();
 	}
-	if (m_cameraActive) {
-		setupCam();
-	}
 #else
 	if (m_cameraDevice.id() == name) {
 		return;
@@ -758,5 +782,8 @@ void InputController::setCamera(const QByteArray& name) {
 		}
 	}
 #endif
+	if (m_cameraActive) {
+		setupCam();
+	}
 #endif
 }
diff --git a/src/platform/qt/InputController.h b/src/platform/qt/InputController.h
index 51be333ed..07e752fd7 100644
--- a/src/platform/qt/InputController.h
+++ b/src/platform/qt/InputController.h
@@ -25,12 +25,13 @@
 #include <mgba/gba/interface.h>
 
 #ifdef BUILD_QT_MULTIMEDIA
-#if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
 #include "VideoDumper.h"
-#else
+
+#include <QCamera>
+#if (QT_VERSION >= QT_VERSION_CHECK(6, 0, 0))
 #include <QMediaCaptureSession>
+#include <QVideoSink>
 #endif
-#include <QCamera>
 #endif
 
 struct mRotationSource;
@@ -152,6 +153,10 @@ private:
 	QSet<QPair<int, GamepadAxisEvent::Direction>> activeGamepadAxes(uint32_t type);
 	QSet<QPair<int, GamepadHatEvent::Direction>> activeGamepadHats(uint32_t type);
 
+#if defined(BUILD_QT_MULTIMEDIA)
+	void prepareCamFormat();
+#endif
+
 	struct InputControllerLux : GBALuminanceSource {
 		InputController* p;
 		uint8_t value;
@@ -171,12 +176,13 @@ private:
 #ifdef BUILD_QT_MULTIMEDIA
 	bool m_cameraActive = false;
 	std::unique_ptr<QCamera> m_camera;
+	VideoDumper m_videoDumper;
 #if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
 	QByteArray m_cameraDevice;
-	VideoDumper m_videoDumper;
 #else
 	QCameraDevice m_cameraDevice;
 	QMediaCaptureSession m_captureSession;
+	QVideoSink m_videoSink;
 #endif
 #endif
 

From 3611fdd7344db4548653be469993df1ba04fc022 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Sun, 24 Mar 2024 21:31:53 -0700
Subject: [PATCH 20/53] Qt: Fix build

---
 src/platform/qt/VideoDumper.cpp | 2 --
 1 file changed, 2 deletions(-)

diff --git a/src/platform/qt/VideoDumper.cpp b/src/platform/qt/VideoDumper.cpp
index 1f1185200..913406a70 100644
--- a/src/platform/qt/VideoDumper.cpp
+++ b/src/platform/qt/VideoDumper.cpp
@@ -5,8 +5,6 @@
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 #include "VideoDumper.h"
 
-#include "VideoProcessor.h"
-
 #include <QImage>
 
 using namespace QGBA;

From 239400ae713ce73299135c6193609f509c53e3be Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Sun, 24 Mar 2024 22:07:31 -0700
Subject: [PATCH 21/53] Qt: Fix non-Multimedia build

---
 src/platform/qt/InputController.cpp | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/src/platform/qt/InputController.cpp b/src/platform/qt/InputController.cpp
index 4a0236199..d5e799b5a 100644
--- a/src/platform/qt/InputController.cpp
+++ b/src/platform/qt/InputController.cpp
@@ -54,11 +54,13 @@ InputController::InputController(QWidget* topLevel, QObject* parent)
 	m_gamepadTimer.setInterval(15);
 	m_gamepadTimer.start();
 
-#if defined(BUILD_QT_MULTIMEDIA) && (QT_VERSION >= QT_VERSION_CHECK(6, 0, 0))
+#ifdef BUILD_QT_MULTIMEDIA
+#if (QT_VERSION >= QT_VERSION_CHECK(6, 0, 0))
 	m_captureSession.setVideoSink(&m_videoSink);
 	connect(&m_videoSink, &QVideoSink::videoFrameChanged, &m_videoDumper, &VideoDumper::present);
 #endif
 	connect(&m_videoDumper, &VideoDumper::imageAvailable, this, &InputController::setCamImage);
+#endif
 
 	mInputBindKey(&m_inputMap, KEYBOARD, Qt::Key_X, GBA_KEY_A);
 	mInputBindKey(&m_inputMap, KEYBOARD, Qt::Key_Z, GBA_KEY_B);
@@ -115,10 +117,12 @@ InputController::InputController(QWidget* topLevel, QObject* parent)
 	};
 
 	m_image.stopRequestImage = [](mImageSource* context) {
-		InputControllerImage* image = static_cast<InputControllerImage*>(context);
 #ifdef BUILD_QT_MULTIMEDIA
+		InputControllerImage* image = static_cast<InputControllerImage*>(context);
 		image->p->m_cameraActive = false;
 		QMetaObject::invokeMethod(image->p, "teardownCam");
+#else
+		UNUSED(context);
 #endif
 	};
 
@@ -785,5 +789,7 @@ void InputController::setCamera(const QByteArray& name) {
 	if (m_cameraActive) {
 		setupCam();
 	}
+#else
+	UNUSED(name);
 #endif
 }

From 4e137d0a9d75b943fa1bebed424bc2727f6da051 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Sun, 24 Mar 2024 22:57:51 -0700
Subject: [PATCH 22/53] GBA Savedata: Prefix SavedataType constants and type
 name

---
 include/mgba/internal/gba/overrides.h |   2 +-
 include/mgba/internal/gba/savedata.h  |  22 +--
 src/gba/core.c                        |  14 +-
 src/gba/dma.c                         |   6 +-
 src/gba/gba.c                         |   4 +-
 src/gba/memory.c                      |  28 +--
 src/gba/overrides.c                   | 260 +++++++++++++-------------
 src/gba/savedata.c                    | 128 ++++++-------
 src/gba/sharkport.c                   |  10 +-
 src/platform/libretro/libretro.c      |   2 +-
 src/platform/qt/OverrideView.cpp      |   4 +-
 src/platform/qt/SaveConverter.cpp     |  56 +++---
 src/platform/qt/SaveConverter.h       |   4 +-
 13 files changed, 270 insertions(+), 270 deletions(-)

diff --git a/include/mgba/internal/gba/overrides.h b/include/mgba/internal/gba/overrides.h
index c835a62a1..83a63f0a4 100644
--- a/include/mgba/internal/gba/overrides.h
+++ b/include/mgba/internal/gba/overrides.h
@@ -16,7 +16,7 @@ CXX_GUARD_START
 
 struct GBACartridgeOverride {
 	char id[4];
-	enum SavedataType savetype;
+	enum GBASavedataType savetype;
 	int hardware;
 	uint32_t idleLoop;
 	bool mirroring;
diff --git a/include/mgba/internal/gba/savedata.h b/include/mgba/internal/gba/savedata.h
index 102c23041..a03f2960c 100644
--- a/include/mgba/internal/gba/savedata.h
+++ b/include/mgba/internal/gba/savedata.h
@@ -17,15 +17,15 @@ mLOG_DECLARE_CATEGORY(GBA_SAVE);
 
 struct VFile;
 
-enum SavedataType {
-	SAVEDATA_AUTODETECT = -1,
-	SAVEDATA_FORCE_NONE = 0,
-	SAVEDATA_SRAM = 1,
-	SAVEDATA_FLASH512 = 2,
-	SAVEDATA_FLASH1M = 3,
-	SAVEDATA_EEPROM = 4,
-	SAVEDATA_EEPROM512 = 5,
-	SAVEDATA_SRAM512 = 6,
+enum GBASavedataType {
+	GBA_SAVEDATA_AUTODETECT = -1,
+	GBA_SAVEDATA_FORCE_NONE = 0,
+	GBA_SAVEDATA_SRAM = 1,
+	GBA_SAVEDATA_FLASH512 = 2,
+	GBA_SAVEDATA_FLASH1M = 3,
+	GBA_SAVEDATA_EEPROM = 4,
+	GBA_SAVEDATA_EEPROM512 = 5,
+	GBA_SAVEDATA_SRAM512 = 6,
 };
 
 enum SavedataCommand {
@@ -68,7 +68,7 @@ enum {
 };
 
 struct GBASavedata {
-	enum SavedataType type;
+	enum GBASavedataType type;
 	uint8_t* data;
 	enum SavedataCommand command;
 	struct VFile* vf;
@@ -108,7 +108,7 @@ void GBASavedataUnmask(struct GBASavedata* savedata);
 size_t GBASavedataSize(const struct GBASavedata* savedata);
 bool GBASavedataClone(struct GBASavedata* savedata, struct VFile* out);
 bool GBASavedataLoad(struct GBASavedata* savedata, struct VFile* in);
-void GBASavedataForceType(struct GBASavedata* savedata, enum SavedataType type);
+void GBASavedataForceType(struct GBASavedata* savedata, enum GBASavedataType type);
 
 void GBASavedataInitFlash(struct GBASavedata* savedata);
 void GBASavedataInitEEPROM(struct GBASavedata* savedata);
diff --git a/src/gba/core.c b/src/gba/core.c
index 46ad70f08..89bcaafc6 100644
--- a/src/gba/core.c
+++ b/src/gba/core.c
@@ -1004,27 +1004,27 @@ size_t _GBACoreListMemoryBlocks(const struct mCore* core, const struct mCoreMemo
 
 	if (gbacore->memoryBlockType != gba->memory.savedata.type) {
 		switch (gba->memory.savedata.type) {
-		case SAVEDATA_SRAM:
+		case GBA_SAVEDATA_SRAM:
 			memcpy(gbacore->memoryBlocks, _GBAMemoryBlocksSRAM, sizeof(_GBAMemoryBlocksSRAM));
 			gbacore->nMemoryBlocks = sizeof(_GBAMemoryBlocksSRAM) / sizeof(*_GBAMemoryBlocksSRAM);
 			break;
-		case SAVEDATA_SRAM512:
+		case GBA_SAVEDATA_SRAM512:
 			memcpy(gbacore->memoryBlocks, _GBAMemoryBlocksSRAM512, sizeof(_GBAMemoryBlocksSRAM512));
 			gbacore->nMemoryBlocks = sizeof(_GBAMemoryBlocksSRAM512) / sizeof(*_GBAMemoryBlocksSRAM512);
 			break;
-		case SAVEDATA_FLASH512:
+		case GBA_SAVEDATA_FLASH512:
 			memcpy(gbacore->memoryBlocks, _GBAMemoryBlocksFlash512, sizeof(_GBAMemoryBlocksFlash512));
 			gbacore->nMemoryBlocks = sizeof(_GBAMemoryBlocksFlash512) / sizeof(*_GBAMemoryBlocksFlash512);
 			break;
-		case SAVEDATA_FLASH1M:
+		case GBA_SAVEDATA_FLASH1M:
 			memcpy(gbacore->memoryBlocks, _GBAMemoryBlocksFlash1M, sizeof(_GBAMemoryBlocksFlash1M));
 			gbacore->nMemoryBlocks = sizeof(_GBAMemoryBlocksFlash1M) / sizeof(*_GBAMemoryBlocksFlash1M);
 			break;
-		case SAVEDATA_EEPROM:
+		case GBA_SAVEDATA_EEPROM:
 			memcpy(gbacore->memoryBlocks, _GBAMemoryBlocksEEPROM, sizeof(_GBAMemoryBlocksEEPROM));
 			gbacore->nMemoryBlocks = sizeof(_GBAMemoryBlocksEEPROM) / sizeof(*_GBAMemoryBlocksEEPROM);
 			break;
-		case SAVEDATA_EEPROM512:
+		case GBA_SAVEDATA_EEPROM512:
 			memcpy(gbacore->memoryBlocks, _GBAMemoryBlocksEEPROM512, sizeof(_GBAMemoryBlocksEEPROM512));
 			gbacore->nMemoryBlocks = sizeof(_GBAMemoryBlocksEEPROM512) / sizeof(*_GBAMemoryBlocksEEPROM512);
 			break;
@@ -1076,7 +1076,7 @@ void* _GBACoreGetMemoryBlock(struct mCore* core, size_t id, size_t* sizeOut) {
 		*sizeOut = gba->memory.romSize;
 		return gba->memory.rom;
 	case GBA_REGION_SRAM:
-		if (gba->memory.savedata.type == SAVEDATA_FLASH1M) {
+		if (gba->memory.savedata.type == GBA_SAVEDATA_FLASH1M) {
 			*sizeOut = GBA_SIZE_FLASH1M;
 			return gba->memory.savedata.currentBank;
 		}
diff --git a/src/gba/dma.c b/src/gba/dma.c
index 11daee2a1..ad7e9bc65 100644
--- a/src/gba/dma.c
+++ b/src/gba/dma.c
@@ -278,7 +278,7 @@ void GBADMAService(struct GBA* gba, int number, struct GBADMA* info) {
 		}
 		cpu->memory.store32(cpu, dest, memory->dmaTransferRegister, 0);
 	} else {
-		if (sourceRegion == GBA_REGION_ROM2_EX && (memory->savedata.type == SAVEDATA_EEPROM || memory->savedata.type == SAVEDATA_EEPROM512)) {
+		if (sourceRegion == GBA_REGION_ROM2_EX && (memory->savedata.type == GBA_SAVEDATA_EEPROM || memory->savedata.type == GBA_SAVEDATA_EEPROM512)) {
 			memory->dmaTransferRegister = GBASavedataReadEEPROM(&memory->savedata);
 			memory->dmaTransferRegister |= memory->dmaTransferRegister << 16;
 		} else if (source) {
@@ -286,11 +286,11 @@ void GBADMAService(struct GBA* gba, int number, struct GBADMA* info) {
 			memory->dmaTransferRegister |= memory->dmaTransferRegister << 16;
 		}
 		if (destRegion == GBA_REGION_ROM2_EX) {
-			if (memory->savedata.type == SAVEDATA_AUTODETECT) {
+			if (memory->savedata.type == GBA_SAVEDATA_AUTODETECT) {
 				mLOG(GBA_MEM, INFO, "Detected EEPROM savegame");
 				GBASavedataInitEEPROM(&memory->savedata);
 			}
-			if (memory->savedata.type == SAVEDATA_EEPROM512 || memory->savedata.type == SAVEDATA_EEPROM) {
+			if (memory->savedata.type == GBA_SAVEDATA_EEPROM512 || memory->savedata.type == GBA_SAVEDATA_EEPROM) {
 				GBASavedataWriteEEPROM(&memory->savedata, memory->dmaTransferRegister, info->nextCount);
 			}
 		} else {
diff --git a/src/gba/gba.c b/src/gba/gba.c
index 7586ae66c..409bd2b3a 100644
--- a/src/gba/gba.c
+++ b/src/gba/gba.c
@@ -469,10 +469,10 @@ bool GBALoadROM(struct GBA* gba, struct VFile* vf) {
 }
 
 bool GBALoadSave(struct GBA* gba, struct VFile* sav) {
-	enum SavedataType type = gba->memory.savedata.type;
+	enum GBASavedataType type = gba->memory.savedata.type;
 	GBASavedataDeinit(&gba->memory.savedata);
 	GBASavedataInit(&gba->memory.savedata, sav);
-	if (type != SAVEDATA_AUTODETECT) {
+	if (type != GBA_SAVEDATA_AUTODETECT) {
 		GBASavedataForceType(&gba->memory.savedata, type);
 	}
 	return sav;
diff --git a/src/gba/memory.c b/src/gba/memory.c
index 9418a2706..455c70bdb 100644
--- a/src/gba/memory.c
+++ b/src/gba/memory.c
@@ -595,7 +595,7 @@ uint32_t GBALoad16(struct ARMCore* cpu, uint32_t address, int* cycleCounter) {
 		break;
 	case GBA_REGION_ROM2_EX:
 		wait = memory->waitstatesNonseq16[address >> BASE_OFFSET];
-		if (memory->savedata.type == SAVEDATA_EEPROM || memory->savedata.type == SAVEDATA_EEPROM512) {
+		if (memory->savedata.type == GBA_SAVEDATA_EEPROM || memory->savedata.type == GBA_SAVEDATA_EEPROM512) {
 			value = GBASavedataReadEEPROM(&memory->savedata);
 		} else if ((address & 0x0DFC0000) >= 0x0DF80000 && memory->hw.devices & HW_EREADER) {
 			value = GBACartEReaderRead(&memory->ereader, address);
@@ -702,7 +702,7 @@ uint32_t GBALoad8(struct ARMCore* cpu, uint32_t address, int* cycleCounter) {
 	case GBA_REGION_SRAM:
 	case GBA_REGION_SRAM_MIRROR:
 		wait = memory->waitstatesNonseq16[address >> BASE_OFFSET];
-		if (memory->savedata.type == SAVEDATA_AUTODETECT) {
+		if (memory->savedata.type == GBA_SAVEDATA_AUTODETECT) {
 			mLOG(GBA_MEM, INFO, "Detected SRAM savegame");
 			GBASavedataInitSRAM(&memory->savedata);
 		}
@@ -711,13 +711,13 @@ uint32_t GBALoad8(struct ARMCore* cpu, uint32_t address, int* cycleCounter) {
 		}
 		if (memory->hw.devices & HW_EREADER && (address & 0xE00FF80) >= 0xE00FF80) {
 			value = GBACartEReaderReadFlash(&memory->ereader, address);
-		} else if (memory->savedata.type == SAVEDATA_SRAM) {
+		} else if (memory->savedata.type == GBA_SAVEDATA_SRAM) {
 			value = memory->savedata.data[address & (GBA_SIZE_SRAM - 1)];
-		} else if (memory->savedata.type == SAVEDATA_FLASH512 || memory->savedata.type == SAVEDATA_FLASH1M) {
+		} else if (memory->savedata.type == GBA_SAVEDATA_FLASH512 || memory->savedata.type == GBA_SAVEDATA_FLASH1M) {
 			value = GBASavedataReadFlash(&memory->savedata, address);
 		} else if (memory->hw.devices & HW_TILT) {
 			value = GBAHardwareTiltRead(&memory->hw, address & OFFSET_MASK);
-		} else if (memory->savedata.type == SAVEDATA_SRAM512) {
+		} else if (memory->savedata.type == GBA_SAVEDATA_SRAM512) {
 			value = memory->savedata.data[address & (GBA_SIZE_SRAM512 - 1)];
 		} else {
 			mLOG(GBA_MEM, GAME_ERROR, "Reading from non-existent SRAM: 0x%08X", address);
@@ -975,11 +975,11 @@ void GBAStore16(struct ARMCore* cpu, uint32_t address, int16_t value, int* cycle
 		if ((address & 0x0DFC0000) >= 0x0DF80000 && memory->hw.devices & HW_EREADER) {
 			GBACartEReaderWrite(&memory->ereader, address, value);
 			break;
-		} else if (memory->savedata.type == SAVEDATA_AUTODETECT) {
+		} else if (memory->savedata.type == GBA_SAVEDATA_AUTODETECT) {
 			mLOG(GBA_MEM, INFO, "Detected EEPROM savegame");
 			GBASavedataInitEEPROM(&memory->savedata);
 		}
-		if (memory->savedata.type == SAVEDATA_EEPROM512 || memory->savedata.type == SAVEDATA_EEPROM) {
+		if (memory->savedata.type == GBA_SAVEDATA_EEPROM512 || memory->savedata.type == GBA_SAVEDATA_EEPROM) {
 			GBASavedataWriteEEPROM(&memory->savedata, value, 1);
 			break;
 		}
@@ -1050,7 +1050,7 @@ void GBAStore8(struct ARMCore* cpu, uint32_t address, int8_t value, int* cycleCo
 		break;
 	case GBA_REGION_SRAM:
 	case GBA_REGION_SRAM_MIRROR:
-		if (memory->savedata.type == SAVEDATA_AUTODETECT) {
+		if (memory->savedata.type == GBA_SAVEDATA_AUTODETECT) {
 			if (address == SAVEDATA_FLASH_BASE) {
 				mLOG(GBA_MEM, INFO, "Detected Flash savegame");
 				GBASavedataInitFlash(&memory->savedata);
@@ -1061,9 +1061,9 @@ void GBAStore8(struct ARMCore* cpu, uint32_t address, int8_t value, int* cycleCo
 		}
 		if (memory->hw.devices & HW_EREADER && (address & 0xE00FF80) >= 0xE00FF80) {
 			GBACartEReaderWriteFlash(&memory->ereader, address, value);
-		} else if (memory->savedata.type == SAVEDATA_FLASH512 || memory->savedata.type == SAVEDATA_FLASH1M) {
+		} else if (memory->savedata.type == GBA_SAVEDATA_FLASH512 || memory->savedata.type == GBA_SAVEDATA_FLASH1M) {
 			GBASavedataWriteFlash(&memory->savedata, address, value);
-		} else if (memory->savedata.type == SAVEDATA_SRAM) {
+		} else if (memory->savedata.type == GBA_SAVEDATA_SRAM) {
 			if (memory->vfame.cartType) {
 				GBAVFameSramWrite(&memory->vfame, address, value, memory->savedata.data);
 			} else {
@@ -1072,7 +1072,7 @@ void GBAStore8(struct ARMCore* cpu, uint32_t address, int8_t value, int* cycleCo
 			memory->savedata.dirty |= mSAVEDATA_DIRT_NEW;
 		} else if (memory->hw.devices & HW_TILT) {
 			GBAHardwareTiltWrite(&memory->hw, address & OFFSET_MASK, value);
-		} else if (memory->savedata.type == SAVEDATA_SRAM512) {
+		} else if (memory->savedata.type == GBA_SAVEDATA_SRAM512) {
 			memory->savedata.data[address & (GBA_SIZE_SRAM512 - 1)] = value;
 			memory->savedata.dirty |= mSAVEDATA_DIRT_NEW;
 		} else {
@@ -1263,7 +1263,7 @@ void GBAPatch32(struct ARMCore* cpu, uint32_t address, int32_t value, int32_t* o
 		break;
 	case GBA_REGION_SRAM:
 	case GBA_REGION_SRAM_MIRROR:
-		if (memory->savedata.type == SAVEDATA_SRAM) {
+		if (memory->savedata.type == GBA_SAVEDATA_SRAM) {
 			LOAD_32(oldValue, address & (GBA_SIZE_SRAM - 4), memory->savedata.data);
 			STORE_32(value, address & (GBA_SIZE_SRAM - 4), memory->savedata.data);
 		} else {
@@ -1333,7 +1333,7 @@ void GBAPatch16(struct ARMCore* cpu, uint32_t address, int16_t value, int16_t* o
 		break;
 	case GBA_REGION_SRAM:
 	case GBA_REGION_SRAM_MIRROR:
-		if (memory->savedata.type == SAVEDATA_SRAM) {
+		if (memory->savedata.type == GBA_SAVEDATA_SRAM) {
 			LOAD_16(oldValue, address & (GBA_SIZE_SRAM - 2), memory->savedata.data);
 			STORE_16(value, address & (GBA_SIZE_SRAM - 2), memory->savedata.data);
 		} else {
@@ -1391,7 +1391,7 @@ void GBAPatch8(struct ARMCore* cpu, uint32_t address, int8_t value, int8_t* old)
 		break;
 	case GBA_REGION_SRAM:
 	case GBA_REGION_SRAM_MIRROR:
-		if (memory->savedata.type == SAVEDATA_SRAM) {
+		if (memory->savedata.type == GBA_SAVEDATA_SRAM) {
 			oldValue = ((int8_t*) memory->savedata.data)[address & (GBA_SIZE_SRAM - 1)];
 			((int8_t*) memory->savedata.data)[address & (GBA_SIZE_SRAM - 1)] = value;
 		} else {
diff --git a/src/gba/overrides.c b/src/gba/overrides.c
index ccc871e62..44a47efb5 100644
--- a/src/gba/overrides.c
+++ b/src/gba/overrides.c
@@ -13,210 +13,210 @@
 
 static const struct GBACartridgeOverride _overrides[] = {
 	// Advance Wars
-	{ "AWRE", SAVEDATA_FLASH512, HW_NONE, 0x8038810, false },
-	{ "AWRP", SAVEDATA_FLASH512, HW_NONE, 0x8038810, false },
+	{ "AWRE", GBA_SAVEDATA_FLASH512, HW_NONE, 0x8038810, false },
+	{ "AWRP", GBA_SAVEDATA_FLASH512, HW_NONE, 0x8038810, false },
 
 	// Advance Wars 2: Black Hole Rising
-	{ "AW2E", SAVEDATA_FLASH512, HW_NONE, 0x8036E08, false },
-	{ "AW2P", SAVEDATA_FLASH512, HW_NONE, 0x803719C, false },
+	{ "AW2E", GBA_SAVEDATA_FLASH512, HW_NONE, 0x8036E08, false },
+	{ "AW2P", GBA_SAVEDATA_FLASH512, HW_NONE, 0x803719C, false },
 
 	// Boktai: The Sun is in Your Hand
-	{ "U3IJ", SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
-	{ "U3IE", SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
-	{ "U3IP", SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
+	{ "U3IJ", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
+	{ "U3IE", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
+	{ "U3IP", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
 
 	// Boktai 2: Solar Boy Django
-	{ "U32J", SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
-	{ "U32E", SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
-	{ "U32P", SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
+	{ "U32J", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
+	{ "U32E", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
+	{ "U32P", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
 
 	// Crash Bandicoot 2 - N-Tranced
-	{ "AC8J", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "AC8E", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "AC8P", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "AC8J", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "AC8E", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "AC8P", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
 
 	// DigiCommunication Nyo - Datou! Black Gemagema Dan
-	{ "BDKJ", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BDKJ", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
 
 	// Dragon Ball Z - The Legacy of Goku
-	{ "ALGP", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "ALGP", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
 
 	// Dragon Ball Z - The Legacy of Goku II
-	{ "ALFJ", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "ALFE", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "ALFP", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "ALFJ", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "ALFE", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "ALFP", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
 
 	// Dragon Ball Z - Taiketsu
-	{ "BDBE", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BDBP", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BDBE", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BDBP", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
 
 	// Drill Dozer
-	{ "V49J", SAVEDATA_SRAM, HW_RUMBLE, IDLE_LOOP_NONE, false },
-	{ "V49E", SAVEDATA_SRAM, HW_RUMBLE, IDLE_LOOP_NONE, false },
-	{ "V49P", SAVEDATA_SRAM, HW_RUMBLE, IDLE_LOOP_NONE, false },
+	{ "V49J", GBA_SAVEDATA_SRAM, HW_RUMBLE, IDLE_LOOP_NONE, false },
+	{ "V49E", GBA_SAVEDATA_SRAM, HW_RUMBLE, IDLE_LOOP_NONE, false },
+	{ "V49P", GBA_SAVEDATA_SRAM, HW_RUMBLE, IDLE_LOOP_NONE, false },
 
 	// e-Reader
-	{ "PEAJ", SAVEDATA_FLASH1M, HW_EREADER, IDLE_LOOP_NONE },
-	{ "PSAJ", SAVEDATA_FLASH1M, HW_EREADER, IDLE_LOOP_NONE },
-	{ "PSAE", SAVEDATA_FLASH1M, HW_EREADER, IDLE_LOOP_NONE },
+	{ "PEAJ", GBA_SAVEDATA_FLASH1M, HW_EREADER, IDLE_LOOP_NONE },
+	{ "PSAJ", GBA_SAVEDATA_FLASH1M, HW_EREADER, IDLE_LOOP_NONE },
+	{ "PSAE", GBA_SAVEDATA_FLASH1M, HW_EREADER, IDLE_LOOP_NONE },
 
 	// Final Fantasy Tactics Advance
-	{ "AFXE", SAVEDATA_FLASH512, HW_NONE, 0x8000428, false },
+	{ "AFXE", GBA_SAVEDATA_FLASH512, HW_NONE, 0x8000428, false },
 
 	// F-Zero - Climax
-	{ "BFTJ", SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BFTJ", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
 
 	// Goodboy Galaxy
-	{ "2GBP", SAVEDATA_SRAM, HW_RUMBLE, IDLE_LOOP_NONE, false },
+	{ "2GBP", GBA_SAVEDATA_SRAM, HW_RUMBLE, IDLE_LOOP_NONE, false },
 
 	// Iridion II
-	{ "AI2E", SAVEDATA_FORCE_NONE, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "AI2P", SAVEDATA_FORCE_NONE, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "AI2E", GBA_SAVEDATA_FORCE_NONE, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "AI2P", GBA_SAVEDATA_FORCE_NONE, HW_NONE, IDLE_LOOP_NONE, false },
 
 	// Game Boy Wars Advance 1+2
-	{ "BGWJ", SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BGWJ", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
 
 	// Golden Sun: The Lost Age
-	{ "AGFE", SAVEDATA_FLASH512, HW_NONE, 0x801353A, false },
+	{ "AGFE", GBA_SAVEDATA_FLASH512, HW_NONE, 0x801353A, false },
 
 	// Koro Koro Puzzle - Happy Panechu!
-	{ "KHPJ", SAVEDATA_EEPROM, HW_TILT, IDLE_LOOP_NONE, false },
+	{ "KHPJ", GBA_SAVEDATA_EEPROM, HW_TILT, IDLE_LOOP_NONE, false },
 
 	// Legendz - Yomigaeru Shiren no Shima
-	{ "BLJJ", SAVEDATA_FLASH512, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "BLJK", SAVEDATA_FLASH512, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "BLJJ", GBA_SAVEDATA_FLASH512, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "BLJK", GBA_SAVEDATA_FLASH512, HW_RTC, IDLE_LOOP_NONE, false },
 
 	// Legendz - Sign of Nekuromu
-	{ "BLVJ", SAVEDATA_FLASH512, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "BLVJ", GBA_SAVEDATA_FLASH512, HW_RTC, IDLE_LOOP_NONE, false },
 
 	// Mega Man Battle Network
-	{ "AREE", SAVEDATA_SRAM, HW_NONE, 0x800032E, false },
+	{ "AREE", GBA_SAVEDATA_SRAM, HW_NONE, 0x800032E, false },
 
 	// Mega Man Zero
-	{ "AZCE", SAVEDATA_SRAM, HW_NONE, 0x80004E8, false },
+	{ "AZCE", GBA_SAVEDATA_SRAM, HW_NONE, 0x80004E8, false },
 
 	// Metal Slug Advance
-	{ "BSME", SAVEDATA_EEPROM, HW_NONE, 0x8000290, false },
+	{ "BSME", GBA_SAVEDATA_EEPROM, HW_NONE, 0x8000290, false },
 
 	// Pokemon Ruby
-	{ "AXVJ", SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXVE", SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXVP", SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXVI", SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXVS", SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXVD", SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXVF", SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "AXVJ", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "AXVE", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "AXVP", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "AXVI", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "AXVS", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "AXVD", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "AXVF", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
 
 	// Pokemon Sapphire
-	{ "AXPJ", SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXPE", SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXPP", SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXPI", SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXPS", SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXPD", SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXPF", SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "AXPJ", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "AXPE", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "AXPP", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "AXPI", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "AXPS", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "AXPD", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "AXPF", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
 
 	// Pokemon Emerald
-	{ "BPEJ", SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
-	{ "BPEE", SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
-	{ "BPEP", SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
-	{ "BPEI", SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
-	{ "BPES", SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
-	{ "BPED", SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
-	{ "BPEF", SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
+	{ "BPEJ", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
+	{ "BPEE", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
+	{ "BPEP", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
+	{ "BPEI", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
+	{ "BPES", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
+	{ "BPED", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
+	{ "BPEF", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
 
 	// Pokemon Mystery Dungeon
-	{ "B24E", SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "B24P", SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "B24E", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "B24P", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
 
 	// Pokemon FireRed
-	{ "BPRJ", SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPRE", SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPRP", SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPRI", SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPRS", SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPRD", SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPRF", SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BPRJ", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BPRE", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BPRP", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BPRI", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BPRS", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BPRD", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BPRF", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
 
 	// Pokemon LeafGreen
-	{ "BPGJ", SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPGE", SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPGP", SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPGI", SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPGS", SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPGD", SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPGF", SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BPGJ", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BPGE", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BPGP", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BPGI", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BPGS", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BPGD", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BPGF", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
 
 	// RockMan EXE 4.5 - Real Operation
-	{ "BR4J", SAVEDATA_FLASH512, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "BR4J", GBA_SAVEDATA_FLASH512, HW_RTC, IDLE_LOOP_NONE, false },
 
 	// Rocky
-	{ "AR8E", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "AROP", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "AR8E", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "AROP", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
 
 	// Sennen Kazoku
-	{ "BKAJ", SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "BKAJ", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
 
 	// Shin Bokura no Taiyou: Gyakushuu no Sabata
-	{ "U33J", SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
+	{ "U33J", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
 
 	// Stuart Little 2
-	{ "ASLE", SAVEDATA_FORCE_NONE, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "ASLF", SAVEDATA_FORCE_NONE, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "ASLE", GBA_SAVEDATA_FORCE_NONE, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "ASLF", GBA_SAVEDATA_FORCE_NONE, HW_NONE, IDLE_LOOP_NONE, false },
 
 	// Super Mario Advance 2
-	{ "AA2J", SAVEDATA_EEPROM, HW_NONE, 0x800052E, false },
-	{ "AA2E", SAVEDATA_EEPROM, HW_NONE, 0x800052E, false },
-	{ "AA2P", SAVEDATA_AUTODETECT, HW_NONE, 0x800052E, false },
+	{ "AA2J", GBA_SAVEDATA_EEPROM, HW_NONE, 0x800052E, false },
+	{ "AA2E", GBA_SAVEDATA_EEPROM, HW_NONE, 0x800052E, false },
+	{ "AA2P", GBA_SAVEDATA_AUTODETECT, HW_NONE, 0x800052E, false },
 
 	// Super Mario Advance 3
-	{ "A3AJ", SAVEDATA_EEPROM, HW_NONE, 0x8002B9C, false },
-	{ "A3AE", SAVEDATA_EEPROM, HW_NONE, 0x8002B9C, false },
-	{ "A3AP", SAVEDATA_EEPROM, HW_NONE, 0x8002B9C, false },
+	{ "A3AJ", GBA_SAVEDATA_EEPROM, HW_NONE, 0x8002B9C, false },
+	{ "A3AE", GBA_SAVEDATA_EEPROM, HW_NONE, 0x8002B9C, false },
+	{ "A3AP", GBA_SAVEDATA_EEPROM, HW_NONE, 0x8002B9C, false },
 
 	// Super Mario Advance 4
-	{ "AX4J", SAVEDATA_FLASH1M, HW_NONE, 0x800072A, false },
-	{ "AX4E", SAVEDATA_FLASH1M, HW_NONE, 0x800072A, false },
-	{ "AX4P", SAVEDATA_FLASH1M, HW_NONE, 0x800072A, false },
+	{ "AX4J", GBA_SAVEDATA_FLASH1M, HW_NONE, 0x800072A, false },
+	{ "AX4E", GBA_SAVEDATA_FLASH1M, HW_NONE, 0x800072A, false },
+	{ "AX4P", GBA_SAVEDATA_FLASH1M, HW_NONE, 0x800072A, false },
 
 	// Super Monkey Ball Jr.
-	{ "ALUE", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "ALUP", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "ALUE", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "ALUP", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
 
 	// Top Gun - Combat Zones
-	{ "A2YE", SAVEDATA_FORCE_NONE, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "A2YE", GBA_SAVEDATA_FORCE_NONE, HW_NONE, IDLE_LOOP_NONE, false },
 
 	// Ueki no Housoku - Jingi Sakuretsu! Nouryokusha Battle
-	{ "BUHJ", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BUHJ", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
 
 	// Wario Ware Twisted
-	{ "RZWJ", SAVEDATA_SRAM, HW_RUMBLE | HW_GYRO, IDLE_LOOP_NONE, false },
-	{ "RZWE", SAVEDATA_SRAM, HW_RUMBLE | HW_GYRO, IDLE_LOOP_NONE, false },
-	{ "RZWP", SAVEDATA_SRAM, HW_RUMBLE | HW_GYRO, IDLE_LOOP_NONE, false },
+	{ "RZWJ", GBA_SAVEDATA_SRAM, HW_RUMBLE | HW_GYRO, IDLE_LOOP_NONE, false },
+	{ "RZWE", GBA_SAVEDATA_SRAM, HW_RUMBLE | HW_GYRO, IDLE_LOOP_NONE, false },
+	{ "RZWP", GBA_SAVEDATA_SRAM, HW_RUMBLE | HW_GYRO, IDLE_LOOP_NONE, false },
 
 	// Yoshi's Universal Gravitation
-	{ "KYGJ", SAVEDATA_EEPROM, HW_TILT, IDLE_LOOP_NONE, false },
-	{ "KYGE", SAVEDATA_EEPROM, HW_TILT, IDLE_LOOP_NONE, false },
-	{ "KYGP", SAVEDATA_EEPROM, HW_TILT, IDLE_LOOP_NONE, false },
+	{ "KYGJ", GBA_SAVEDATA_EEPROM, HW_TILT, IDLE_LOOP_NONE, false },
+	{ "KYGE", GBA_SAVEDATA_EEPROM, HW_TILT, IDLE_LOOP_NONE, false },
+	{ "KYGP", GBA_SAVEDATA_EEPROM, HW_TILT, IDLE_LOOP_NONE, false },
 
 	// Aging cartridge
-	{ "TCHK", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "TCHK", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
 
 	// Famicom Mini series 3 (FDS), some aren't mirrored (22 - 28)
 	// See https://forum.no-intro.org/viewtopic.php?f=2&t=4221 for discussion
-	{ "FNMJ", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "FMRJ", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "FPTJ", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "FLBJ", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "FFMJ", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "FTKJ", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "FTUJ", SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "FNMJ", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "FMRJ", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "FPTJ", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "FLBJ", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "FFMJ", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "FTKJ", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "FTUJ", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
 
 	{ { 0, 0, 0, 0 }, 0, 0, IDLE_LOOP_NONE, false }
 };
 
 bool GBAOverrideFind(const struct Configuration* config, struct GBACartridgeOverride* override) {
-	override->savetype = SAVEDATA_AUTODETECT;
+	override->savetype = GBA_SAVEDATA_AUTODETECT;
 	override->hardware = HW_NONE;
 	override->idleLoop = IDLE_LOOP_NONE;
 	override->mirroring = false;
@@ -233,7 +233,7 @@ bool GBAOverrideFind(const struct Configuration* config, struct GBACartridgeOver
 	}
 	if (!found && override->id[0] == 'F') {
 		// Classic NES Series
-		override->savetype = SAVEDATA_EEPROM;
+		override->savetype = GBA_SAVEDATA_EEPROM;
 		found = true;
 	}
 
@@ -247,25 +247,25 @@ bool GBAOverrideFind(const struct Configuration* config, struct GBACartridgeOver
 		if (savetype) {
 			if (strcasecmp(savetype, "SRAM") == 0) {
 				found = true;
-				override->savetype = SAVEDATA_SRAM;
+				override->savetype = GBA_SAVEDATA_SRAM;
 			} else if (strcasecmp(savetype, "SRAM512") == 0) {
 				found = true;
-				override->savetype = SAVEDATA_SRAM512;
+				override->savetype = GBA_SAVEDATA_SRAM512;
 			} else if (strcasecmp(savetype, "EEPROM") == 0) {
 				found = true;
-				override->savetype = SAVEDATA_EEPROM;
+				override->savetype = GBA_SAVEDATA_EEPROM;
 			} else if (strcasecmp(savetype, "EEPROM512") == 0) {
 				found = true;
-				override->savetype = SAVEDATA_EEPROM512;
+				override->savetype = GBA_SAVEDATA_EEPROM512;
 			} else if (strcasecmp(savetype, "FLASH512") == 0) {
 				found = true;
-				override->savetype = SAVEDATA_FLASH512;
+				override->savetype = GBA_SAVEDATA_FLASH512;
 			} else if (strcasecmp(savetype, "FLASH1M") == 0) {
 				found = true;
-				override->savetype = SAVEDATA_FLASH1M;
+				override->savetype = GBA_SAVEDATA_FLASH1M;
 			} else if (strcasecmp(savetype, "NONE") == 0) {
 				found = true;
-				override->savetype = SAVEDATA_FORCE_NONE;
+				override->savetype = GBA_SAVEDATA_FORCE_NONE;
 			}
 		}
 
@@ -295,28 +295,28 @@ void GBAOverrideSave(struct Configuration* config, const struct GBACartridgeOver
 	snprintf(sectionName, sizeof(sectionName), "override.%c%c%c%c", override->id[0], override->id[1], override->id[2], override->id[3]);
 	const char* savetype = 0;
 	switch (override->savetype) {
-	case SAVEDATA_SRAM:
+	case GBA_SAVEDATA_SRAM:
 		savetype = "SRAM";
 		break;
-	case SAVEDATA_SRAM512:
+	case GBA_SAVEDATA_SRAM512:
 		savetype = "SRAM512";
 		break;
-	case SAVEDATA_EEPROM:
+	case GBA_SAVEDATA_EEPROM:
 		savetype = "EEPROM";
 		break;
-	case SAVEDATA_EEPROM512:
+	case GBA_SAVEDATA_EEPROM512:
 		savetype = "EEPROM512";
 		break;
-	case SAVEDATA_FLASH512:
+	case GBA_SAVEDATA_FLASH512:
 		savetype = "FLASH512";
 		break;
-	case SAVEDATA_FLASH1M:
+	case GBA_SAVEDATA_FLASH1M:
 		savetype = "FLASH1M";
 		break;
-	case SAVEDATA_FORCE_NONE:
+	case GBA_SAVEDATA_FORCE_NONE:
 		savetype = "NONE";
 		break;
-	case SAVEDATA_AUTODETECT:
+	case GBA_SAVEDATA_AUTODETECT:
 		break;
 	}
 	ConfigurationSetValue(config, sectionName, "savetype", savetype);
@@ -335,7 +335,7 @@ void GBAOverrideSave(struct Configuration* config, const struct GBACartridgeOver
 }
 
 void GBAOverrideApply(struct GBA* gba, const struct GBACartridgeOverride* override) {
-	if (override->savetype != SAVEDATA_AUTODETECT) {
+	if (override->savetype != GBA_SAVEDATA_AUTODETECT) {
 		GBASavedataForceType(&gba->memory.savedata, override->savetype);
 	}
 
@@ -429,7 +429,7 @@ void GBAOverrideApplyDefaults(struct GBA* gba, const struct Configuration* overr
 
 		if (isPokemon && !isKnownPokemon) {
 			// Enable FLASH1M and RTC on Pokémon ROM hacks
-			override.savetype = SAVEDATA_FLASH1M;
+			override.savetype = GBA_SAVEDATA_FLASH1M;
 			override.hardware = HW_RTC;
 			override.vbaBugCompat = true;
 			GBAOverrideApply(gba, &override);
diff --git a/src/gba/savedata.c b/src/gba/savedata.c
index e7176650b..11be3e0ab 100644
--- a/src/gba/savedata.c
+++ b/src/gba/savedata.c
@@ -44,7 +44,7 @@ static void _ashesToAshes(struct mTiming* timing, void* user, uint32_t cyclesLat
 }
 
 void GBASavedataInit(struct GBASavedata* savedata, struct VFile* vf) {
-	savedata->type = SAVEDATA_AUTODETECT;
+	savedata->type = GBA_SAVEDATA_AUTODETECT;
 	savedata->data = 0;
 	savedata->command = EEPROM_COMMAND_NULL;
 	savedata->flashState = FLASH_STATE_RAW;
@@ -72,35 +72,35 @@ void GBASavedataDeinit(struct GBASavedata* savedata) {
 		savedata->vf = NULL;
 	} else {
 		switch (savedata->type) {
-		case SAVEDATA_SRAM:
+		case GBA_SAVEDATA_SRAM:
 			mappedMemoryFree(savedata->data, GBA_SIZE_SRAM);
 			break;
-		case SAVEDATA_SRAM512:
+		case GBA_SAVEDATA_SRAM512:
 			mappedMemoryFree(savedata->data, GBA_SIZE_SRAM512);
 			break;
-		case SAVEDATA_FLASH512:
+		case GBA_SAVEDATA_FLASH512:
 			mappedMemoryFree(savedata->data, GBA_SIZE_FLASH512);
 			break;
-		case SAVEDATA_FLASH1M:
+		case GBA_SAVEDATA_FLASH1M:
 			mappedMemoryFree(savedata->data, GBA_SIZE_FLASH1M);
 			break;
-		case SAVEDATA_EEPROM:
+		case GBA_SAVEDATA_EEPROM:
 			mappedMemoryFree(savedata->data, GBA_SIZE_EEPROM);
 			break;
-		case SAVEDATA_EEPROM512:
+		case GBA_SAVEDATA_EEPROM512:
 			mappedMemoryFree(savedata->data, GBA_SIZE_EEPROM512);
 			break;
-		case SAVEDATA_FORCE_NONE:
-		case SAVEDATA_AUTODETECT:
+		case GBA_SAVEDATA_FORCE_NONE:
+		case GBA_SAVEDATA_AUTODETECT:
 			break;
 		}
 	}
 	savedata->data = 0;
-	savedata->type = SAVEDATA_AUTODETECT;
+	savedata->type = GBA_SAVEDATA_AUTODETECT;
 }
 
 void GBASavedataMask(struct GBASavedata* savedata, struct VFile* vf, bool writeback) {
-	enum SavedataType type = savedata->type;
+	enum GBASavedataType type = savedata->type;
 	struct VFile* oldVf = savedata->vf;
 	GBASavedataDeinit(savedata);
 	if (oldVf && oldVf != savedata->realVf) {
@@ -116,7 +116,7 @@ void GBASavedataUnmask(struct GBASavedata* savedata) {
 	if (!savedata->realVf || savedata->vf == savedata->realVf) {
 		return;
 	}
-	enum SavedataType type = savedata->type;
+	enum GBASavedataType type = savedata->type;
 	struct VFile* vf = savedata->vf;
 	GBASavedataDeinit(savedata);
 	savedata->vf = savedata->realVf;
@@ -132,20 +132,20 @@ void GBASavedataUnmask(struct GBASavedata* savedata) {
 bool GBASavedataClone(struct GBASavedata* savedata, struct VFile* out) {
 	if (savedata->data) {
 		switch (savedata->type) {
-		case SAVEDATA_SRAM:
+		case GBA_SAVEDATA_SRAM:
 			return out->write(out, savedata->data, GBA_SIZE_SRAM) == GBA_SIZE_SRAM;
-		case SAVEDATA_SRAM512:
+		case GBA_SAVEDATA_SRAM512:
 			return out->write(out, savedata->data, GBA_SIZE_SRAM512) == GBA_SIZE_SRAM512;
-		case SAVEDATA_FLASH512:
+		case GBA_SAVEDATA_FLASH512:
 			return out->write(out, savedata->data, GBA_SIZE_FLASH512) == GBA_SIZE_FLASH512;
-		case SAVEDATA_FLASH1M:
+		case GBA_SAVEDATA_FLASH1M:
 			return out->write(out, savedata->data, GBA_SIZE_FLASH1M) == GBA_SIZE_FLASH1M;
-		case SAVEDATA_EEPROM:
+		case GBA_SAVEDATA_EEPROM:
 			return out->write(out, savedata->data, GBA_SIZE_EEPROM) == GBA_SIZE_EEPROM;
-		case SAVEDATA_EEPROM512:
+		case GBA_SAVEDATA_EEPROM512:
 			return out->write(out, savedata->data, GBA_SIZE_EEPROM512) == GBA_SIZE_EEPROM512;
-		case SAVEDATA_AUTODETECT:
-		case SAVEDATA_FORCE_NONE:
+		case GBA_SAVEDATA_AUTODETECT:
+		case GBA_SAVEDATA_FORCE_NONE:
 			return true;
 		}
 	} else if (savedata->vf) {
@@ -163,21 +163,21 @@ bool GBASavedataClone(struct GBASavedata* savedata, struct VFile* out) {
 
 size_t GBASavedataSize(const struct GBASavedata* savedata) {
 	switch (savedata->type) {
-	case SAVEDATA_SRAM:
+	case GBA_SAVEDATA_SRAM:
 		return GBA_SIZE_SRAM;
-	case SAVEDATA_SRAM512:
+	case GBA_SAVEDATA_SRAM512:
 		return GBA_SIZE_SRAM512;
-	case SAVEDATA_FLASH512:
+	case GBA_SAVEDATA_FLASH512:
 		return GBA_SIZE_FLASH512;
-	case SAVEDATA_FLASH1M:
+	case GBA_SAVEDATA_FLASH1M:
 		return GBA_SIZE_FLASH1M;
-	case SAVEDATA_EEPROM:
+	case GBA_SAVEDATA_EEPROM:
 		return GBA_SIZE_EEPROM;
-	case SAVEDATA_EEPROM512:
+	case GBA_SAVEDATA_EEPROM512:
 		return GBA_SIZE_EEPROM512;
-	case SAVEDATA_FORCE_NONE:
+	case GBA_SAVEDATA_FORCE_NONE:
 		return 0;
-	case SAVEDATA_AUTODETECT:
+	case GBA_SAVEDATA_AUTODETECT:
 	default:
 		if (savedata->vf) {
 			return savedata->vf->size(savedata->vf);
@@ -188,7 +188,7 @@ size_t GBASavedataSize(const struct GBASavedata* savedata) {
 
 bool GBASavedataLoad(struct GBASavedata* savedata, struct VFile* in) {
 	if (savedata->data) {
-		if (!in || savedata->type == SAVEDATA_FORCE_NONE) {
+		if (!in || savedata->type == GBA_SAVEDATA_FORCE_NONE) {
 			return false;
 		}
 		ssize_t size = GBASavedataSize(savedata);
@@ -220,11 +220,11 @@ bool GBASavedataLoad(struct GBASavedata* savedata, struct VFile* in) {
 	return true;
 }
 
-void GBASavedataForceType(struct GBASavedata* savedata, enum SavedataType type) {
+void GBASavedataForceType(struct GBASavedata* savedata, enum GBASavedataType type) {
 	if (savedata->type == type) {
 		return;
 	}
-	if (savedata->type != SAVEDATA_AUTODETECT) {
+	if (savedata->type != GBA_SAVEDATA_AUTODETECT) {
 		struct VFile* vf = savedata->vf;
 		int mapMode = savedata->mapMode;
 		bool maskWriteback = savedata->maskWriteback;
@@ -234,40 +234,40 @@ void GBASavedataForceType(struct GBASavedata* savedata, enum SavedataType type)
 		savedata->maskWriteback = maskWriteback;
 	}
 	switch (type) {
-	case SAVEDATA_FLASH512:
-	case SAVEDATA_FLASH1M:
+	case GBA_SAVEDATA_FLASH512:
+	case GBA_SAVEDATA_FLASH1M:
 		savedata->type = type;
 		GBASavedataInitFlash(savedata);
 		break;
-	case SAVEDATA_EEPROM:
-	case SAVEDATA_EEPROM512:
+	case GBA_SAVEDATA_EEPROM:
+	case GBA_SAVEDATA_EEPROM512:
 		savedata->type = type;
 		GBASavedataInitEEPROM(savedata);
 		break;
-	case SAVEDATA_SRAM:
+	case GBA_SAVEDATA_SRAM:
 		GBASavedataInitSRAM(savedata);
 		break;
-	case SAVEDATA_SRAM512:
+	case GBA_SAVEDATA_SRAM512:
 		GBASavedataInitSRAM512(savedata);
 		break;
-	case SAVEDATA_FORCE_NONE:
-		savedata->type = SAVEDATA_FORCE_NONE;
+	case GBA_SAVEDATA_FORCE_NONE:
+		savedata->type = GBA_SAVEDATA_FORCE_NONE;
 		break;
-	case SAVEDATA_AUTODETECT:
+	case GBA_SAVEDATA_AUTODETECT:
 		break;
 	}
 }
 
 void GBASavedataInitFlash(struct GBASavedata* savedata) {
-	if (savedata->type == SAVEDATA_AUTODETECT) {
-		savedata->type = SAVEDATA_FLASH512;
+	if (savedata->type == GBA_SAVEDATA_AUTODETECT) {
+		savedata->type = GBA_SAVEDATA_FLASH512;
 	}
-	if (savedata->type != SAVEDATA_FLASH512 && savedata->type != SAVEDATA_FLASH1M) {
+	if (savedata->type != GBA_SAVEDATA_FLASH512 && savedata->type != GBA_SAVEDATA_FLASH1M) {
 		mLOG(GBA_SAVE, WARN, "Can't re-initialize savedata");
 		return;
 	}
 	int32_t flashSize = GBA_SIZE_FLASH512;
-	if (savedata->type == SAVEDATA_FLASH1M) {
+	if (savedata->type == GBA_SAVEDATA_FLASH1M) {
 		flashSize = GBA_SIZE_FLASH1M;
 	}
 	off_t end;
@@ -289,14 +289,14 @@ void GBASavedataInitFlash(struct GBASavedata* savedata) {
 }
 
 void GBASavedataInitEEPROM(struct GBASavedata* savedata) {
-	if (savedata->type == SAVEDATA_AUTODETECT) {
-		savedata->type = SAVEDATA_EEPROM512;
-	} else if (savedata->type != SAVEDATA_EEPROM512 && savedata->type != SAVEDATA_EEPROM) {
+	if (savedata->type == GBA_SAVEDATA_AUTODETECT) {
+		savedata->type = GBA_SAVEDATA_EEPROM512;
+	} else if (savedata->type != GBA_SAVEDATA_EEPROM512 && savedata->type != GBA_SAVEDATA_EEPROM) {
 		mLOG(GBA_SAVE, WARN, "Can't re-initialize savedata");
 		return;
 	}
 	int32_t eepromSize = GBA_SIZE_EEPROM512;
-	if (savedata->type == SAVEDATA_EEPROM) {
+	if (savedata->type == GBA_SAVEDATA_EEPROM) {
 		eepromSize = GBA_SIZE_EEPROM;
 	}
 	off_t end;
@@ -316,8 +316,8 @@ void GBASavedataInitEEPROM(struct GBASavedata* savedata) {
 }
 
 void GBASavedataInitSRAM(struct GBASavedata* savedata) {
-	if (savedata->type == SAVEDATA_AUTODETECT) {
-		savedata->type = SAVEDATA_SRAM;
+	if (savedata->type == GBA_SAVEDATA_AUTODETECT) {
+		savedata->type = GBA_SAVEDATA_SRAM;
 	} else {
 		mLOG(GBA_SAVE, WARN, "Can't re-initialize savedata");
 		return;
@@ -340,8 +340,8 @@ void GBASavedataInitSRAM(struct GBASavedata* savedata) {
 }
 
 void GBASavedataInitSRAM512(struct GBASavedata* savedata) {
-	if (savedata->type == SAVEDATA_AUTODETECT) {
-		savedata->type = SAVEDATA_SRAM512;
+	if (savedata->type == GBA_SAVEDATA_AUTODETECT) {
+		savedata->type = GBA_SAVEDATA_SRAM512;
 	} else {
 		mLOG(GBA_SAVE, WARN, "Can't re-initialize savedata");
 		return;
@@ -365,11 +365,11 @@ void GBASavedataInitSRAM512(struct GBASavedata* savedata) {
 
 uint8_t GBASavedataReadFlash(struct GBASavedata* savedata, uint16_t address) {
 	if (savedata->command == FLASH_COMMAND_ID) {
-		if (savedata->type == SAVEDATA_FLASH512) {
+		if (savedata->type == GBA_SAVEDATA_FLASH512) {
 			if (address < 2) {
 				return FLASH_MFG_PANASONIC >> (address * 8);
 			}
-		} else if (savedata->type == SAVEDATA_FLASH1M) {
+		} else if (savedata->type == GBA_SAVEDATA_FLASH1M) {
 			if (address < 2) {
 				return FLASH_MFG_SANYO >> (address * 8);
 			}
@@ -472,10 +472,10 @@ static void _ensureEeprom(struct GBASavedata* savedata, uint32_t size) {
 	if (size < GBA_SIZE_EEPROM512) {
 		return;
 	}
-	if (savedata->type == SAVEDATA_EEPROM) {
+	if (savedata->type == GBA_SAVEDATA_EEPROM) {
 		return;
 	}
-	savedata->type = SAVEDATA_EEPROM;
+	savedata->type = GBA_SAVEDATA_EEPROM;
 	if (!savedata->vf) {
 		return;
 	}
@@ -605,7 +605,7 @@ void GBASavedataRTCWrite(struct GBASavedata* savedata) {
 	int bank = 0;
 	if ((savedata->vf->size(savedata->vf) & 0xFF) != sizeof(buffer)) {
 		// Writing past the end of the file can invalidate the file mapping
-		if (savedata->type == SAVEDATA_FLASH1M) {
+		if (savedata->type == GBA_SAVEDATA_FLASH1M) {
 			bank = savedata->currentBank == &savedata->data[0x10000];
 		}
 		savedata->vf->unmap(savedata->vf, savedata->data, size);
@@ -614,9 +614,9 @@ void GBASavedataRTCWrite(struct GBASavedata* savedata) {
 	savedata->vf->write(savedata->vf, &buffer, sizeof(buffer));
 	if (!savedata->data) {
 		savedata->data = savedata->vf->map(savedata->vf, size, MAP_WRITE);
-		if (savedata->type == SAVEDATA_FLASH1M) {
+		if (savedata->type == GBA_SAVEDATA_FLASH1M) {
 			savedata->currentBank = &savedata->data[bank << 16];
-		} else if (savedata->type == SAVEDATA_FLASH512) {
+		} else if (savedata->type == GBA_SAVEDATA_FLASH512) {
 			savedata->currentBank = savedata->data;
 		}
 	}
@@ -730,7 +730,7 @@ void GBASavedataDeserialize(struct GBASavedata* savedata, const struct GBASerial
 	LOAD_32(savedata->writeAddress, 0, &state->savedata.writeAddress);
 	LOAD_16(savedata->settling, 0, &state->savedata.settlingSector);
 
-	if (savedata->type == SAVEDATA_FLASH1M) {
+	if (savedata->type == GBA_SAVEDATA_FLASH1M) {
 		_flashSwitchBank(savedata, GBASerializedSavedataFlagsGetFlashBank(flags));
 	}
 
@@ -743,9 +743,9 @@ void GBASavedataDeserialize(struct GBASavedata* savedata, const struct GBASerial
 
 void _flashSwitchBank(struct GBASavedata* savedata, int bank) {
 	mLOG(GBA_SAVE, DEBUG, "Performing flash bank switch to bank %i", bank);
-	if (bank > 0 && savedata->type == SAVEDATA_FLASH512) {
+	if (bank > 0 && savedata->type == GBA_SAVEDATA_FLASH512) {
 		mLOG(GBA_SAVE, INFO, "Updating flash chip from 512kb to 1Mb");
-		savedata->type = SAVEDATA_FLASH1M;
+		savedata->type = GBA_SAVEDATA_FLASH1M;
 		if (savedata->vf) {
 			savedata->vf->unmap(savedata->vf, savedata->data, GBA_SIZE_FLASH512);
 			if (savedata->vf->size(savedata->vf) < GBA_SIZE_FLASH1M) {
@@ -764,7 +764,7 @@ void _flashErase(struct GBASavedata* savedata) {
 	mLOG(GBA_SAVE, DEBUG, "Performing flash chip erase");
 	savedata->dirty |= mSAVEDATA_DIRT_NEW;
 	size_t size = GBA_SIZE_FLASH512;
-	if (savedata->type == SAVEDATA_FLASH1M) {
+	if (savedata->type == GBA_SAVEDATA_FLASH1M) {
 		size = GBA_SIZE_FLASH1M;
 	}
 	memset(savedata->data, 0xFF, size);
@@ -774,7 +774,7 @@ void _flashEraseSector(struct GBASavedata* savedata, uint16_t sectorStart) {
 	mLOG(GBA_SAVE, DEBUG, "Performing flash sector erase at 0x%04x", sectorStart);
 	savedata->dirty |= mSAVEDATA_DIRT_NEW;
 	size_t size = 0x1000;
-	if (savedata->type == SAVEDATA_FLASH1M) {
+	if (savedata->type == GBA_SAVEDATA_FLASH1M) {
 		mLOG(GBA_SAVE, DEBUG, "Performing unknown sector-size erase at 0x%04x", sectorStart);
 	}
 	savedata->settling = sectorStart >> 12;
diff --git a/src/gba/sharkport.c b/src/gba/sharkport.c
index 9e1e64518..2f33e3d41 100644
--- a/src/gba/sharkport.c
+++ b/src/gba/sharkport.c
@@ -18,9 +18,9 @@ static const int GSV_PAYLOAD_OFFSET = 0x430;
 static bool _importSavedata(struct GBA* gba, void* payload, size_t size) {
 	bool success = false;
 	switch (gba->memory.savedata.type) {
-	case SAVEDATA_FLASH512:
+	case GBA_SAVEDATA_FLASH512:
 		if (size > GBA_SIZE_FLASH512) {
-			GBASavedataForceType(&gba->memory.savedata, SAVEDATA_FLASH1M);
+			GBASavedataForceType(&gba->memory.savedata, GBA_SAVEDATA_FLASH1M);
 		}
 	// Fall through
 	default:
@@ -28,8 +28,8 @@ static bool _importSavedata(struct GBA* gba, void* payload, size_t size) {
 			size = GBASavedataSize(&gba->memory.savedata);
 		}
 		break;
-	case SAVEDATA_FORCE_NONE:
-	case SAVEDATA_AUTODETECT:
+	case GBA_SAVEDATA_FORCE_NONE:
+	case GBA_SAVEDATA_AUTODETECT:
 		goto cleanup;
 	}
 
@@ -276,7 +276,7 @@ bool GBASavedataExportSharkPort(const struct GBA* gba, struct VFile* vf) {
 		checksum += buffer.c[i] << (checksum % 24);
 	}
 
-	if (gba->memory.savedata.type == SAVEDATA_EEPROM) {
+	if (gba->memory.savedata.type == GBA_SAVEDATA_EEPROM) {
 		for (i = 0; i < size; ++i) {
 			char byte = gba->memory.savedata.data[i ^ 7];
 			checksum += byte << (checksum % 24);
diff --git a/src/platform/libretro/libretro.c b/src/platform/libretro/libretro.c
index ca1698b01..8ee80ff7d 100644
--- a/src/platform/libretro/libretro.c
+++ b/src/platform/libretro/libretro.c
@@ -2315,7 +2315,7 @@ size_t retro_get_memory_size(unsigned id) {
 #ifdef M_CORE_GBA
 		case mPLATFORM_GBA:
 			switch (((struct GBA*) core->board)->memory.savedata.type) {
-			case SAVEDATA_AUTODETECT:
+			case GBA_SAVEDATA_AUTODETECT:
 				return GBA_SIZE_FLASH1M;
 			default:
 				return GBASavedataSize(&((struct GBA*) core->board)->memory.savedata);
diff --git a/src/platform/qt/OverrideView.cpp b/src/platform/qt/OverrideView.cpp
index 07e114c1c..9e51fab4a 100644
--- a/src/platform/qt/OverrideView.cpp
+++ b/src/platform/qt/OverrideView.cpp
@@ -153,14 +153,14 @@ void OverrideView::updateOverrides() {
 	if (m_ui.tabWidget->currentWidget() == m_ui.tabGBA) {
 		auto gba = std::make_unique<GBAOverride>();
 		memset(gba->override.id, 0, 4);
-		gba->override.savetype = static_cast<SavedataType>(m_ui.savetype->currentIndex() - 1);
+		gba->override.savetype = static_cast<GBASavedataType>(m_ui.savetype->currentIndex() - 1);
 		gba->override.hardware = HW_NO_OVERRIDE;
 		gba->override.idleLoop = IDLE_LOOP_NONE;
 		gba->override.mirroring = false;
 		gba->override.vbaBugCompat = false;
 		gba->vbaBugCompatSet = false;
 
-		if (gba->override.savetype != SAVEDATA_AUTODETECT) {
+		if (gba->override.savetype != GBA_SAVEDATA_AUTODETECT) {
 			hasOverride = true;
 		}
 		if (!m_ui.hwAutodetect->isChecked()) {
diff --git a/src/platform/qt/SaveConverter.cpp b/src/platform/qt/SaveConverter.cpp
index 44e061c8f..d16eeeea4 100644
--- a/src/platform/qt/SaveConverter.cpp
+++ b/src/platform/qt/SaveConverter.cpp
@@ -170,8 +170,8 @@ void SaveConverter::detectFromSavestate(VFile* vf) {
 	switch (platform) {
 #ifdef M_CORE_GBA
 	case mPLATFORM_GBA:
-		save.gba.type = static_cast<SavedataType>(state.at(offsetof(GBASerializedState, savedata.type)));
-		if (save.gba.type == SAVEDATA_EEPROM || save.gba.type == SAVEDATA_EEPROM512) {
+		save.gba.type = static_cast<GBASavedataType>(state.at(offsetof(GBASerializedState, savedata.type)));
+		if (save.gba.type == GBA_SAVEDATA_EEPROM || save.gba.type == GBA_SAVEDATA_EEPROM512) {
 			save.endianness = Endian::LITTLE;
 		}
 		break;
@@ -198,25 +198,25 @@ void SaveConverter::detectFromSize(std::shared_ptr<VFileDevice> vf) {
 	switch (vf->size()) {
 	case GBA_SIZE_SRAM:
 	case GBA_SIZE_SRAM + 16:
-		m_validSaves.append(AnnotatedSave{SAVEDATA_SRAM, vf});
+		m_validSaves.append(AnnotatedSave{GBA_SAVEDATA_SRAM, vf});
 		break;
 	case GBA_SIZE_FLASH512:
 	case GBA_SIZE_FLASH512 + 16:
-		m_validSaves.append(AnnotatedSave{SAVEDATA_FLASH512, vf});
+		m_validSaves.append(AnnotatedSave{GBA_SAVEDATA_FLASH512, vf});
 		break;
 	case GBA_SIZE_FLASH1M:
 	case GBA_SIZE_FLASH1M + 16:
-		m_validSaves.append(AnnotatedSave{SAVEDATA_FLASH1M, vf});
+		m_validSaves.append(AnnotatedSave{GBA_SAVEDATA_FLASH1M, vf});
 		break;
 	case GBA_SIZE_EEPROM:
 	case GBA_SIZE_EEPROM + 16:
-		m_validSaves.append(AnnotatedSave{SAVEDATA_EEPROM, vf, Endian::LITTLE});
-		m_validSaves.append(AnnotatedSave{SAVEDATA_EEPROM, vf, Endian::BIG});
+		m_validSaves.append(AnnotatedSave{GBA_SAVEDATA_EEPROM, vf, Endian::LITTLE});
+		m_validSaves.append(AnnotatedSave{GBA_SAVEDATA_EEPROM, vf, Endian::BIG});
 		break;
 	case GBA_SIZE_EEPROM512:
 	case GBA_SIZE_EEPROM512 + 16:
-		m_validSaves.append(AnnotatedSave{SAVEDATA_EEPROM512, vf, Endian::LITTLE});
-		m_validSaves.append(AnnotatedSave{SAVEDATA_EEPROM512, vf, Endian::BIG});
+		m_validSaves.append(AnnotatedSave{GBA_SAVEDATA_EEPROM512, vf, Endian::LITTLE});
+		m_validSaves.append(AnnotatedSave{GBA_SAVEDATA_EEPROM512, vf, Endian::BIG});
 		break;
 	}
 #endif
@@ -272,12 +272,12 @@ void SaveConverter::detectFromHeaders(std::shared_ptr<VFileDevice> vf) {
 			QByteArray bytes = QByteArray::fromRawData(static_cast<const char*>(data), size);
 			bytes.data(); // Trigger a deep copy before we delete the backing
 			if (size == GBA_SIZE_FLASH1M) {
-				m_validSaves.append(AnnotatedSave{SAVEDATA_FLASH1M, std::make_shared<VFileDevice>(bytes), Endian::NONE, Container::SHARKPORT});
+				m_validSaves.append(AnnotatedSave{GBA_SAVEDATA_FLASH1M, std::make_shared<VFileDevice>(bytes), Endian::NONE, Container::SHARKPORT});
 			} else {
-				m_validSaves.append(AnnotatedSave{SAVEDATA_SRAM, std::make_shared<VFileDevice>(bytes.left(GBA_SIZE_SRAM)), Endian::NONE, Container::SHARKPORT});
-				m_validSaves.append(AnnotatedSave{SAVEDATA_FLASH512, std::make_shared<VFileDevice>(bytes.left(GBA_SIZE_FLASH512)), Endian::NONE, Container::SHARKPORT});
-				m_validSaves.append(AnnotatedSave{SAVEDATA_EEPROM, std::make_shared<VFileDevice>(bytes.left(GBA_SIZE_EEPROM)), Endian::BIG, Container::SHARKPORT});
-				m_validSaves.append(AnnotatedSave{SAVEDATA_EEPROM512, std::make_shared<VFileDevice>(bytes.left(GBA_SIZE_EEPROM512)), Endian::BIG, Container::SHARKPORT});
+				m_validSaves.append(AnnotatedSave{GBA_SAVEDATA_SRAM, std::make_shared<VFileDevice>(bytes.left(GBA_SIZE_SRAM)), Endian::NONE, Container::SHARKPORT});
+				m_validSaves.append(AnnotatedSave{GBA_SAVEDATA_FLASH512, std::make_shared<VFileDevice>(bytes.left(GBA_SIZE_FLASH512)), Endian::NONE, Container::SHARKPORT});
+				m_validSaves.append(AnnotatedSave{GBA_SAVEDATA_EEPROM, std::make_shared<VFileDevice>(bytes.left(GBA_SIZE_EEPROM)), Endian::BIG, Container::SHARKPORT});
+				m_validSaves.append(AnnotatedSave{GBA_SAVEDATA_EEPROM512, std::make_shared<VFileDevice>(bytes.left(GBA_SIZE_EEPROM512)), Endian::BIG, Container::SHARKPORT});
 			}
 			free(data);
 		}
@@ -289,20 +289,20 @@ void SaveConverter::detectFromHeaders(std::shared_ptr<VFileDevice> vf) {
 			bytes.data(); // Trigger a deep copy before we delete the backing
 			switch (size) {
 			case GBA_SIZE_FLASH1M:
-				m_validSaves.append(AnnotatedSave{SAVEDATA_FLASH1M, std::make_shared<VFileDevice>(bytes), Endian::NONE, Container::GSV});
+				m_validSaves.append(AnnotatedSave{GBA_SAVEDATA_FLASH1M, std::make_shared<VFileDevice>(bytes), Endian::NONE, Container::GSV});
 				break;
 			case GBA_SIZE_FLASH512:
-				m_validSaves.append(AnnotatedSave{SAVEDATA_FLASH512, std::make_shared<VFileDevice>(bytes), Endian::NONE, Container::GSV});
-				m_validSaves.append(AnnotatedSave{SAVEDATA_FLASH1M, std::make_shared<VFileDevice>(bytes), Endian::NONE, Container::GSV});
+				m_validSaves.append(AnnotatedSave{GBA_SAVEDATA_FLASH512, std::make_shared<VFileDevice>(bytes), Endian::NONE, Container::GSV});
+				m_validSaves.append(AnnotatedSave{GBA_SAVEDATA_FLASH1M, std::make_shared<VFileDevice>(bytes), Endian::NONE, Container::GSV});
 				break;
 			case GBA_SIZE_SRAM:
-				m_validSaves.append(AnnotatedSave{SAVEDATA_SRAM, std::make_shared<VFileDevice>(bytes.left(GBA_SIZE_SRAM)), Endian::NONE, Container::GSV});
+				m_validSaves.append(AnnotatedSave{GBA_SAVEDATA_SRAM, std::make_shared<VFileDevice>(bytes.left(GBA_SIZE_SRAM)), Endian::NONE, Container::GSV});
 				break;
 			case GBA_SIZE_EEPROM:
-				m_validSaves.append(AnnotatedSave{SAVEDATA_EEPROM, std::make_shared<VFileDevice>(bytes.left(GBA_SIZE_EEPROM)), Endian::BIG, Container::GSV});
+				m_validSaves.append(AnnotatedSave{GBA_SAVEDATA_EEPROM, std::make_shared<VFileDevice>(bytes.left(GBA_SIZE_EEPROM)), Endian::BIG, Container::GSV});
 				break;
 			case GBA_SIZE_EEPROM512:
-				m_validSaves.append(AnnotatedSave{SAVEDATA_EEPROM512, std::make_shared<VFileDevice>(bytes.left(GBA_SIZE_EEPROM512)), Endian::BIG, Container::GSV});
+				m_validSaves.append(AnnotatedSave{GBA_SAVEDATA_EEPROM512, std::make_shared<VFileDevice>(bytes.left(GBA_SIZE_EEPROM512)), Endian::BIG, Container::GSV});
 				break;
 			}
 			free(data);
@@ -401,7 +401,7 @@ SaveConverter::AnnotatedSave::AnnotatedSave(mPlatform platform, std::shared_ptr<
 }
 
 #ifdef M_CORE_GBA
-SaveConverter::AnnotatedSave::AnnotatedSave(SavedataType type, std::shared_ptr<VFileDevice> vf, Endian endianness, Container container)
+SaveConverter::AnnotatedSave::AnnotatedSave(GBASavedataType type, std::shared_ptr<VFileDevice> vf, Endian endianness, Container container)
 	: container(container)
 	, platform(mPLATFORM_GBA)
 	, size(vf->size())
@@ -468,15 +468,15 @@ SaveConverter::AnnotatedSave::operator QString() const {
 #ifdef M_CORE_GBA
 	case mPLATFORM_GBA:
 		switch (gba.type) {
-		case SAVEDATA_SRAM:
+		case GBA_SAVEDATA_SRAM:
 			typeFormat = QCoreApplication::translate("QGBA::SaveConverter", "SRAM");
 			break;
-		case SAVEDATA_FLASH512:
-		case SAVEDATA_FLASH1M:
+		case GBA_SAVEDATA_FLASH512:
+		case GBA_SAVEDATA_FLASH1M:
 			typeFormat = QCoreApplication::translate("QGBA::SaveConverter", "%1 flash");
 			break;
-		case SAVEDATA_EEPROM:
-		case SAVEDATA_EEPROM512:
+		case GBA_SAVEDATA_EEPROM:
+		case GBA_SAVEDATA_EEPROM512:
 			typeFormat = QCoreApplication::translate("QGBA::SaveConverter", "%1 EEPROM");
 			break;
 		default:
@@ -664,8 +664,8 @@ QByteArray SaveConverter::AnnotatedSave::convertTo(const SaveConverter::Annotate
 #ifdef M_CORE_GBA
 	case mPLATFORM_GBA:
 		switch (gba.type) {
-		case SAVEDATA_EEPROM:
-		case SAVEDATA_EEPROM512:
+		case GBA_SAVEDATA_EEPROM:
+		case GBA_SAVEDATA_EEPROM512:
 			if (endianness == target.endianness) {
 				break;
 			}
diff --git a/src/platform/qt/SaveConverter.h b/src/platform/qt/SaveConverter.h
index 2fa133071..764e13d9c 100644
--- a/src/platform/qt/SaveConverter.h
+++ b/src/platform/qt/SaveConverter.h
@@ -48,7 +48,7 @@ private slots:
 private:
 #ifdef M_CORE_GBA
 	struct GBASave {
-		SavedataType type;
+		GBASavedataType type;
 	};
 #endif
 #ifdef M_CORE_GB
@@ -66,7 +66,7 @@ private:
 		AnnotatedSave();
 		AnnotatedSave(mPlatform, std::shared_ptr<VFileDevice>, Endian = Endian::NONE, Container = Container::NONE);
 #ifdef M_CORE_GBA
-		AnnotatedSave(SavedataType, std::shared_ptr<VFileDevice>, Endian = Endian::NONE, Container = Container::NONE);
+		AnnotatedSave(GBASavedataType, std::shared_ptr<VFileDevice>, Endian = Endian::NONE, Container = Container::NONE);
 #endif
 #ifdef M_CORE_GB
 		AnnotatedSave(GBMemoryBankControllerType, std::shared_ptr<VFileDevice>, Endian = Endian::NONE, Container = Container::NONE);

From c6bd778b151c36b4a5dc9be566f9baae05af98d5 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Sun, 24 Mar 2024 23:03:59 -0700
Subject: [PATCH 23/53] GB, GBA: Move override structs to public API

---
 include/mgba/gb/interface.h           |  15 +++
 include/mgba/gba/interface.h          |  22 +++
 include/mgba/internal/gb/overrides.h  |  15 ---
 include/mgba/internal/gba/overrides.h |  13 +-
 include/mgba/internal/gba/savedata.h  |  12 +-
 src/gba/core.c                        |   2 +-
 src/gba/overrides.c                   | 184 +++++++++++++-------------
 src/platform/qt/OverrideView.cpp      |   4 +-
 8 files changed, 134 insertions(+), 133 deletions(-)

diff --git a/include/mgba/gb/interface.h b/include/mgba/gb/interface.h
index ecd99e2f9..485111b41 100644
--- a/include/mgba/gb/interface.h
+++ b/include/mgba/gb/interface.h
@@ -58,6 +58,13 @@ enum GBVideoLayer {
 	GB_LAYER_OBJ
 };
 
+enum GBColorLookup {
+	GB_COLORS_NONE = 0,
+	GB_COLORS_CGB = 1,
+	GB_COLORS_SGB = 2,
+	GB_COLORS_SGB_CGB_FALLBACK = GB_COLORS_CGB | GB_COLORS_SGB
+};
+
 struct GBSIODriver {
 	struct GBSIO* p;
 
@@ -67,6 +74,14 @@ struct GBSIODriver {
 	uint8_t (*writeSC)(struct GBSIODriver* driver, uint8_t value);
 };
 
+struct GBCartridgeOverride {
+	int headerCrc32;
+	enum GBModel model;
+	enum GBMemoryBankControllerType mbc;
+
+	uint32_t gbColors[12];
+};
+
 struct VFile;
 
 bool GBIsROM(struct VFile* vf);
diff --git a/include/mgba/gba/interface.h b/include/mgba/gba/interface.h
index bf10c59ba..f2f05064d 100644
--- a/include/mgba/gba/interface.h
+++ b/include/mgba/gba/interface.h
@@ -13,6 +13,8 @@ CXX_GUARD_START
 #include <mgba/core/interface.h>
 #include <mgba/core/timing.h>
 
+#define GBA_IDLE_LOOP_NONE 0xFFFFFFFF
+
 enum {
 	GBA_VIDEO_HORIZONTAL_PIXELS = 240,
 	GBA_VIDEO_VERTICAL_PIXELS = 160,
@@ -45,6 +47,17 @@ enum GBAVideoLayer {
 	GBA_LAYER_OBJWIN,
 };
 
+enum GBASavedataType {
+	GBA_SAVEDATA_AUTODETECT = -1,
+	GBA_SAVEDATA_FORCE_NONE = 0,
+	GBA_SAVEDATA_SRAM = 1,
+	GBA_SAVEDATA_FLASH512 = 2,
+	GBA_SAVEDATA_FLASH1M = 3,
+	GBA_SAVEDATA_EEPROM = 4,
+	GBA_SAVEDATA_EEPROM512 = 5,
+	GBA_SAVEDATA_SRAM512 = 6,
+};
+
 struct GBA;
 struct GBAAudio;
 struct GBASIO;
@@ -78,6 +91,15 @@ struct GBASIODriver {
 	uint16_t (*writeRegister)(struct GBASIODriver* driver, uint32_t address, uint16_t value);
 };
 
+struct GBACartridgeOverride {
+	char id[4];
+	enum GBASavedataType savetype;
+	int hardware;
+	uint32_t idleLoop;
+	bool mirroring;
+	bool vbaBugCompat;
+};
+
 void GBASIOJOYCreate(struct GBASIODriver* sio);
 
 enum GBASIOBattleChipGateFlavor {
diff --git a/include/mgba/internal/gb/overrides.h b/include/mgba/internal/gb/overrides.h
index 86cac0f9d..6e683f0de 100644
--- a/include/mgba/internal/gb/overrides.h
+++ b/include/mgba/internal/gb/overrides.h
@@ -12,21 +12,6 @@ CXX_GUARD_START
 
 #include <mgba/gb/interface.h>
 
-enum GBColorLookup {
-	GB_COLORS_NONE = 0,
-	GB_COLORS_CGB = 1,
-	GB_COLORS_SGB = 2,
-	GB_COLORS_SGB_CGB_FALLBACK = GB_COLORS_CGB | GB_COLORS_SGB
-};
-
-struct GBCartridgeOverride {
-	int headerCrc32;
-	enum GBModel model;
-	enum GBMemoryBankControllerType mbc;
-
-	uint32_t gbColors[12];
-};
-
 struct GBColorPreset {
 	const char* name;
 	uint32_t colors[12];
diff --git a/include/mgba/internal/gba/overrides.h b/include/mgba/internal/gba/overrides.h
index 83a63f0a4..b2eba2d7a 100644
--- a/include/mgba/internal/gba/overrides.h
+++ b/include/mgba/internal/gba/overrides.h
@@ -10,18 +10,7 @@
 
 CXX_GUARD_START
 
-#include <mgba/internal/gba/savedata.h>
-
-#define IDLE_LOOP_NONE 0xFFFFFFFF
-
-struct GBACartridgeOverride {
-	char id[4];
-	enum GBASavedataType savetype;
-	int hardware;
-	uint32_t idleLoop;
-	bool mirroring;
-	bool vbaBugCompat;
-};
+#include <mgba/gba/interface.h>
 
 struct Configuration;
 bool GBAOverrideFind(const struct Configuration*, struct GBACartridgeOverride* override);
diff --git a/include/mgba/internal/gba/savedata.h b/include/mgba/internal/gba/savedata.h
index a03f2960c..274241a76 100644
--- a/include/mgba/internal/gba/savedata.h
+++ b/include/mgba/internal/gba/savedata.h
@@ -12,22 +12,12 @@ CXX_GUARD_START
 
 #include <mgba/core/log.h>
 #include <mgba/core/timing.h>
+#include <mgba/gba/interface.h>
 
 mLOG_DECLARE_CATEGORY(GBA_SAVE);
 
 struct VFile;
 
-enum GBASavedataType {
-	GBA_SAVEDATA_AUTODETECT = -1,
-	GBA_SAVEDATA_FORCE_NONE = 0,
-	GBA_SAVEDATA_SRAM = 1,
-	GBA_SAVEDATA_FLASH512 = 2,
-	GBA_SAVEDATA_FLASH1M = 3,
-	GBA_SAVEDATA_EEPROM = 4,
-	GBA_SAVEDATA_EEPROM512 = 5,
-	GBA_SAVEDATA_SRAM512 = 6,
-};
-
 enum SavedataCommand {
 	EEPROM_COMMAND_NULL = 0,
 	EEPROM_COMMAND_PENDING = 1,
diff --git a/src/gba/core.c b/src/gba/core.c
index 89bcaafc6..54c436b3a 100644
--- a/src/gba/core.c
+++ b/src/gba/core.c
@@ -374,7 +374,7 @@ static void _GBACoreLoadConfig(struct mCore* core, const struct mCoreConfig* con
 		} else if (strcasecmp(idleOptimization, "remove") == 0) {
 			gba->idleOptimization = IDLE_LOOP_REMOVE;
 		} else if (strcasecmp(idleOptimization, "detect") == 0) {
-			if (gba->idleLoop == IDLE_LOOP_NONE) {
+			if (gba->idleLoop == GBA_IDLE_LOOP_NONE) {
 				gba->idleOptimization = IDLE_LOOP_DETECT;
 			} else {
 				gba->idleOptimization = IDLE_LOOP_REMOVE;
diff --git a/src/gba/overrides.c b/src/gba/overrides.c
index 44a47efb5..a35830705 100644
--- a/src/gba/overrides.c
+++ b/src/gba/overrides.c
@@ -21,73 +21,73 @@ static const struct GBACartridgeOverride _overrides[] = {
 	{ "AW2P", GBA_SAVEDATA_FLASH512, HW_NONE, 0x803719C, false },
 
 	// Boktai: The Sun is in Your Hand
-	{ "U3IJ", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
-	{ "U3IE", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
-	{ "U3IP", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
+	{ "U3IJ", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE, false },
+	{ "U3IE", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE, false },
+	{ "U3IP", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE, false },
 
 	// Boktai 2: Solar Boy Django
-	{ "U32J", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
-	{ "U32E", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
-	{ "U32P", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
+	{ "U32J", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE, false },
+	{ "U32E", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE, false },
+	{ "U32P", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE, false },
 
 	// Crash Bandicoot 2 - N-Tranced
-	{ "AC8J", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "AC8E", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "AC8P", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "AC8J", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "AC8E", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "AC8P", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
 
 	// DigiCommunication Nyo - Datou! Black Gemagema Dan
-	{ "BDKJ", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BDKJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
 
 	// Dragon Ball Z - The Legacy of Goku
-	{ "ALGP", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "ALGP", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
 
 	// Dragon Ball Z - The Legacy of Goku II
-	{ "ALFJ", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "ALFE", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "ALFP", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "ALFJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "ALFE", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "ALFP", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
 
 	// Dragon Ball Z - Taiketsu
-	{ "BDBE", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BDBP", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BDBE", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "BDBP", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
 
 	// Drill Dozer
-	{ "V49J", GBA_SAVEDATA_SRAM, HW_RUMBLE, IDLE_LOOP_NONE, false },
-	{ "V49E", GBA_SAVEDATA_SRAM, HW_RUMBLE, IDLE_LOOP_NONE, false },
-	{ "V49P", GBA_SAVEDATA_SRAM, HW_RUMBLE, IDLE_LOOP_NONE, false },
+	{ "V49J", GBA_SAVEDATA_SRAM, HW_RUMBLE, GBA_IDLE_LOOP_NONE, false },
+	{ "V49E", GBA_SAVEDATA_SRAM, HW_RUMBLE, GBA_IDLE_LOOP_NONE, false },
+	{ "V49P", GBA_SAVEDATA_SRAM, HW_RUMBLE, GBA_IDLE_LOOP_NONE, false },
 
 	// e-Reader
-	{ "PEAJ", GBA_SAVEDATA_FLASH1M, HW_EREADER, IDLE_LOOP_NONE },
-	{ "PSAJ", GBA_SAVEDATA_FLASH1M, HW_EREADER, IDLE_LOOP_NONE },
-	{ "PSAE", GBA_SAVEDATA_FLASH1M, HW_EREADER, IDLE_LOOP_NONE },
+	{ "PEAJ", GBA_SAVEDATA_FLASH1M, HW_EREADER, GBA_IDLE_LOOP_NONE },
+	{ "PSAJ", GBA_SAVEDATA_FLASH1M, HW_EREADER, GBA_IDLE_LOOP_NONE },
+	{ "PSAE", GBA_SAVEDATA_FLASH1M, HW_EREADER, GBA_IDLE_LOOP_NONE },
 
 	// Final Fantasy Tactics Advance
 	{ "AFXE", GBA_SAVEDATA_FLASH512, HW_NONE, 0x8000428, false },
 
 	// F-Zero - Climax
-	{ "BFTJ", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BFTJ", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
 
 	// Goodboy Galaxy
-	{ "2GBP", GBA_SAVEDATA_SRAM, HW_RUMBLE, IDLE_LOOP_NONE, false },
+	{ "2GBP", GBA_SAVEDATA_SRAM, HW_RUMBLE, GBA_IDLE_LOOP_NONE, false },
 
 	// Iridion II
-	{ "AI2E", GBA_SAVEDATA_FORCE_NONE, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "AI2P", GBA_SAVEDATA_FORCE_NONE, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "AI2E", GBA_SAVEDATA_FORCE_NONE, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "AI2P", GBA_SAVEDATA_FORCE_NONE, HW_NONE, GBA_IDLE_LOOP_NONE, false },
 
 	// Game Boy Wars Advance 1+2
-	{ "BGWJ", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BGWJ", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
 
 	// Golden Sun: The Lost Age
 	{ "AGFE", GBA_SAVEDATA_FLASH512, HW_NONE, 0x801353A, false },
 
 	// Koro Koro Puzzle - Happy Panechu!
-	{ "KHPJ", GBA_SAVEDATA_EEPROM, HW_TILT, IDLE_LOOP_NONE, false },
+	{ "KHPJ", GBA_SAVEDATA_EEPROM, HW_TILT, GBA_IDLE_LOOP_NONE, false },
 
 	// Legendz - Yomigaeru Shiren no Shima
-	{ "BLJJ", GBA_SAVEDATA_FLASH512, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "BLJK", GBA_SAVEDATA_FLASH512, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "BLJJ", GBA_SAVEDATA_FLASH512, HW_RTC, GBA_IDLE_LOOP_NONE, false },
+	{ "BLJK", GBA_SAVEDATA_FLASH512, HW_RTC, GBA_IDLE_LOOP_NONE, false },
 
 	// Legendz - Sign of Nekuromu
-	{ "BLVJ", GBA_SAVEDATA_FLASH512, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "BLVJ", GBA_SAVEDATA_FLASH512, HW_RTC, GBA_IDLE_LOOP_NONE, false },
 
 	// Mega Man Battle Network
 	{ "AREE", GBA_SAVEDATA_SRAM, HW_NONE, 0x800032E, false },
@@ -99,22 +99,22 @@ static const struct GBACartridgeOverride _overrides[] = {
 	{ "BSME", GBA_SAVEDATA_EEPROM, HW_NONE, 0x8000290, false },
 
 	// Pokemon Ruby
-	{ "AXVJ", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXVE", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXVP", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXVI", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXVS", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXVD", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXVF", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "AXVJ", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
+	{ "AXVE", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
+	{ "AXVP", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
+	{ "AXVI", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
+	{ "AXVS", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
+	{ "AXVD", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
+	{ "AXVF", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
 
 	// Pokemon Sapphire
-	{ "AXPJ", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXPE", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXPP", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXPI", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXPS", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXPD", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
-	{ "AXPF", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "AXPJ", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
+	{ "AXPE", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
+	{ "AXPP", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
+	{ "AXPI", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
+	{ "AXPS", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
+	{ "AXPD", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
+	{ "AXPF", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
 
 	// Pokemon Emerald
 	{ "BPEJ", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
@@ -126,43 +126,43 @@ static const struct GBACartridgeOverride _overrides[] = {
 	{ "BPEF", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
 
 	// Pokemon Mystery Dungeon
-	{ "B24E", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "B24P", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "B24E", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "B24P", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
 
 	// Pokemon FireRed
-	{ "BPRJ", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPRE", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPRP", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPRI", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPRS", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPRD", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPRF", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BPRJ", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "BPRE", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "BPRP", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "BPRI", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "BPRS", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "BPRD", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "BPRF", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
 
 	// Pokemon LeafGreen
-	{ "BPGJ", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPGE", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPGP", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPGI", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPGS", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPGD", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "BPGF", GBA_SAVEDATA_FLASH1M, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BPGJ", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "BPGE", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "BPGP", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "BPGI", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "BPGS", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "BPGD", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "BPGF", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
 
 	// RockMan EXE 4.5 - Real Operation
-	{ "BR4J", GBA_SAVEDATA_FLASH512, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "BR4J", GBA_SAVEDATA_FLASH512, HW_RTC, GBA_IDLE_LOOP_NONE, false },
 
 	// Rocky
-	{ "AR8E", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "AROP", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "AR8E", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "AROP", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
 
 	// Sennen Kazoku
-	{ "BKAJ", GBA_SAVEDATA_FLASH1M, HW_RTC, IDLE_LOOP_NONE, false },
+	{ "BKAJ", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
 
 	// Shin Bokura no Taiyou: Gyakushuu no Sabata
-	{ "U33J", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, IDLE_LOOP_NONE, false },
+	{ "U33J", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE, false },
 
 	// Stuart Little 2
-	{ "ASLE", GBA_SAVEDATA_FORCE_NONE, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "ASLF", GBA_SAVEDATA_FORCE_NONE, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "ASLE", GBA_SAVEDATA_FORCE_NONE, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "ASLF", GBA_SAVEDATA_FORCE_NONE, HW_NONE, GBA_IDLE_LOOP_NONE, false },
 
 	// Super Mario Advance 2
 	{ "AA2J", GBA_SAVEDATA_EEPROM, HW_NONE, 0x800052E, false },
@@ -180,45 +180,45 @@ static const struct GBACartridgeOverride _overrides[] = {
 	{ "AX4P", GBA_SAVEDATA_FLASH1M, HW_NONE, 0x800072A, false },
 
 	// Super Monkey Ball Jr.
-	{ "ALUE", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "ALUP", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "ALUE", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "ALUP", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
 
 	// Top Gun - Combat Zones
-	{ "A2YE", GBA_SAVEDATA_FORCE_NONE, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "A2YE", GBA_SAVEDATA_FORCE_NONE, HW_NONE, GBA_IDLE_LOOP_NONE, false },
 
 	// Ueki no Housoku - Jingi Sakuretsu! Nouryokusha Battle
-	{ "BUHJ", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "BUHJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
 
 	// Wario Ware Twisted
-	{ "RZWJ", GBA_SAVEDATA_SRAM, HW_RUMBLE | HW_GYRO, IDLE_LOOP_NONE, false },
-	{ "RZWE", GBA_SAVEDATA_SRAM, HW_RUMBLE | HW_GYRO, IDLE_LOOP_NONE, false },
-	{ "RZWP", GBA_SAVEDATA_SRAM, HW_RUMBLE | HW_GYRO, IDLE_LOOP_NONE, false },
+	{ "RZWJ", GBA_SAVEDATA_SRAM, HW_RUMBLE | HW_GYRO, GBA_IDLE_LOOP_NONE, false },
+	{ "RZWE", GBA_SAVEDATA_SRAM, HW_RUMBLE | HW_GYRO, GBA_IDLE_LOOP_NONE, false },
+	{ "RZWP", GBA_SAVEDATA_SRAM, HW_RUMBLE | HW_GYRO, GBA_IDLE_LOOP_NONE, false },
 
 	// Yoshi's Universal Gravitation
-	{ "KYGJ", GBA_SAVEDATA_EEPROM, HW_TILT, IDLE_LOOP_NONE, false },
-	{ "KYGE", GBA_SAVEDATA_EEPROM, HW_TILT, IDLE_LOOP_NONE, false },
-	{ "KYGP", GBA_SAVEDATA_EEPROM, HW_TILT, IDLE_LOOP_NONE, false },
+	{ "KYGJ", GBA_SAVEDATA_EEPROM, HW_TILT, GBA_IDLE_LOOP_NONE, false },
+	{ "KYGE", GBA_SAVEDATA_EEPROM, HW_TILT, GBA_IDLE_LOOP_NONE, false },
+	{ "KYGP", GBA_SAVEDATA_EEPROM, HW_TILT, GBA_IDLE_LOOP_NONE, false },
 
 	// Aging cartridge
-	{ "TCHK", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
+	{ "TCHK", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
 
 	// Famicom Mini series 3 (FDS), some aren't mirrored (22 - 28)
 	// See https://forum.no-intro.org/viewtopic.php?f=2&t=4221 for discussion
-	{ "FNMJ", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "FMRJ", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "FPTJ", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "FLBJ", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "FFMJ", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "FTKJ", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-	{ "FTUJ", GBA_SAVEDATA_EEPROM, HW_NONE, IDLE_LOOP_NONE, false },
-
-	{ { 0, 0, 0, 0 }, 0, 0, IDLE_LOOP_NONE, false }
+	{ "FNMJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "FMRJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "FPTJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "FLBJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "FFMJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "FTKJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "FTUJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+
+	{ { 0, 0, 0, 0 }, 0, 0, GBA_IDLE_LOOP_NONE, false }
 };
 
 bool GBAOverrideFind(const struct Configuration* config, struct GBACartridgeOverride* override) {
 	override->savetype = GBA_SAVEDATA_AUTODETECT;
 	override->hardware = HW_NONE;
-	override->idleLoop = IDLE_LOOP_NONE;
+	override->idleLoop = GBA_IDLE_LOOP_NONE;
 	override->mirroring = false;
 	override->vbaBugCompat = false;
 	bool found = false;
@@ -327,7 +327,7 @@ void GBAOverrideSave(struct Configuration* config, const struct GBACartridgeOver
 		ConfigurationClearValue(config, sectionName, "hardware");
 	}
 
-	if (override->idleLoop != IDLE_LOOP_NONE) {
+	if (override->idleLoop != GBA_IDLE_LOOP_NONE) {
 		ConfigurationSetUIntValue(config, sectionName, "idleLoop", override->idleLoop);
 	} else {
 		ConfigurationClearValue(config, sectionName, "idleLoop");
@@ -376,7 +376,7 @@ void GBAOverrideApply(struct GBA* gba, const struct GBACartridgeOverride* overri
 		}
 	}
 
-	if (override->idleLoop != IDLE_LOOP_NONE) {
+	if (override->idleLoop != GBA_IDLE_LOOP_NONE) {
 		gba->idleLoop = override->idleLoop;
 		if (gba->idleOptimization == IDLE_LOOP_DETECT) {
 			gba->idleOptimization = IDLE_LOOP_REMOVE;
@@ -385,7 +385,7 @@ void GBAOverrideApply(struct GBA* gba, const struct GBACartridgeOverride* overri
 }
 
 void GBAOverrideApplyDefaults(struct GBA* gba, const struct Configuration* overrides) {
-	struct GBACartridgeOverride override = { .idleLoop = IDLE_LOOP_NONE };
+	struct GBACartridgeOverride override = { .idleLoop = GBA_IDLE_LOOP_NONE };
 	const struct GBACartridge* cart = (const struct GBACartridge*) gba->memory.rom;
 	if (cart) {
 		memcpy(override.id, &cart->id, sizeof(override.id));
diff --git a/src/platform/qt/OverrideView.cpp b/src/platform/qt/OverrideView.cpp
index 9e51fab4a..1d2737521 100644
--- a/src/platform/qt/OverrideView.cpp
+++ b/src/platform/qt/OverrideView.cpp
@@ -155,7 +155,7 @@ void OverrideView::updateOverrides() {
 		memset(gba->override.id, 0, 4);
 		gba->override.savetype = static_cast<GBASavedataType>(m_ui.savetype->currentIndex() - 1);
 		gba->override.hardware = HW_NO_OVERRIDE;
-		gba->override.idleLoop = IDLE_LOOP_NONE;
+		gba->override.idleLoop = GBA_IDLE_LOOP_NONE;
 		gba->override.mirroring = false;
 		gba->override.vbaBugCompat = false;
 		gba->vbaBugCompatSet = false;
@@ -246,7 +246,7 @@ void OverrideView::gameStarted() {
 		m_ui.hwGBPlayer->setChecked(gba->memory.hw.devices & HW_GB_PLAYER_DETECTION);
 		m_ui.vbaBugCompat->setChecked(gba->vbaBugCompat);
 
-		if (gba->idleLoop != IDLE_LOOP_NONE) {
+		if (gba->idleLoop != GBA_IDLE_LOOP_NONE) {
 			m_ui.idleLoop->setText(QString::number(gba->idleLoop, 16));
 		} else {
 			m_ui.idleLoop->clear();

From 23e8fa7a47b68e99fec14ba771580dcb6d0ddfda Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Mon, 25 Mar 2024 01:23:14 -0700
Subject: [PATCH 24/53] GBA: Fix build

---
 src/gba/gba.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/gba/gba.c b/src/gba/gba.c
index 409bd2b3a..31008507c 100644
--- a/src/gba/gba.c
+++ b/src/gba/gba.c
@@ -111,7 +111,7 @@ static void GBAInit(void* cpu, struct mCPUComponent* component) {
 	gba->biosChecksum = GBAChecksum(gba->memory.bios, GBA_SIZE_BIOS);
 
 	gba->idleOptimization = IDLE_LOOP_REMOVE;
-	gba->idleLoop = IDLE_LOOP_NONE;
+	gba->idleLoop = GBA_IDLE_LOOP_NONE;
 
 	gba->vbaBugCompat = false;
 	gba->hardCrash = true;
@@ -165,7 +165,7 @@ void GBAUnloadROM(struct GBA* gba) {
 		gba->memory.savedata.realVf->close(gba->memory.savedata.realVf);
 		gba->memory.savedata.realVf = 0;
 	}
-	gba->idleLoop = IDLE_LOOP_NONE;
+	gba->idleLoop = GBA_IDLE_LOOP_NONE;
 }
 
 void GBADestroy(struct GBA* gba) {

From 5ce57430067a5329faabec7b8e00a9ebe9e46317 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Mon, 25 Mar 2024 01:23:39 -0700
Subject: [PATCH 25/53] GBA: Remove legacy "mirroring" field from overrides

---
 include/mgba/gba/interface.h       |   1 -
 include/mgba/internal/gba/memory.h |   2 -
 src/gba/overrides.c                | 213 ++++++++++++++---------------
 src/platform/qt/OverrideView.cpp   |   1 -
 4 files changed, 101 insertions(+), 116 deletions(-)

diff --git a/include/mgba/gba/interface.h b/include/mgba/gba/interface.h
index f2f05064d..9d19a55c8 100644
--- a/include/mgba/gba/interface.h
+++ b/include/mgba/gba/interface.h
@@ -96,7 +96,6 @@ struct GBACartridgeOverride {
 	enum GBASavedataType savetype;
 	int hardware;
 	uint32_t idleLoop;
-	bool mirroring;
 	bool vbaBugCompat;
 };
 
diff --git a/include/mgba/internal/gba/memory.h b/include/mgba/internal/gba/memory.h
index f9e963d76..c88e1d092 100644
--- a/include/mgba/internal/gba/memory.h
+++ b/include/mgba/internal/gba/memory.h
@@ -138,8 +138,6 @@ struct GBAMemory {
 	struct GBAPrintContext agbPrintCtxBackup;
 	uint32_t agbPrintFuncBackup;
 	uint16_t* agbPrintBufferBackup;
-
-	bool mirroring;
 };
 
 struct GBA;
diff --git a/src/gba/overrides.c b/src/gba/overrides.c
index a35830705..a63616e61 100644
--- a/src/gba/overrides.c
+++ b/src/gba/overrides.c
@@ -13,47 +13,47 @@
 
 static const struct GBACartridgeOverride _overrides[] = {
 	// Advance Wars
-	{ "AWRE", GBA_SAVEDATA_FLASH512, HW_NONE, 0x8038810, false },
-	{ "AWRP", GBA_SAVEDATA_FLASH512, HW_NONE, 0x8038810, false },
+	{ "AWRE", GBA_SAVEDATA_FLASH512, HW_NONE, 0x8038810 },
+	{ "AWRP", GBA_SAVEDATA_FLASH512, HW_NONE, 0x8038810 },
 
 	// Advance Wars 2: Black Hole Rising
-	{ "AW2E", GBA_SAVEDATA_FLASH512, HW_NONE, 0x8036E08, false },
-	{ "AW2P", GBA_SAVEDATA_FLASH512, HW_NONE, 0x803719C, false },
+	{ "AW2E", GBA_SAVEDATA_FLASH512, HW_NONE, 0x8036E08 },
+	{ "AW2P", GBA_SAVEDATA_FLASH512, HW_NONE, 0x803719C },
 
 	// Boktai: The Sun is in Your Hand
-	{ "U3IJ", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE, false },
-	{ "U3IE", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE, false },
-	{ "U3IP", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE, false },
+	{ "U3IJ", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE },
+	{ "U3IE", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE },
+	{ "U3IP", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE },
 
 	// Boktai 2: Solar Boy Django
-	{ "U32J", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE, false },
-	{ "U32E", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE, false },
-	{ "U32P", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE, false },
+	{ "U32J", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE },
+	{ "U32E", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE },
+	{ "U32P", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE },
 
 	// Crash Bandicoot 2 - N-Tranced
-	{ "AC8J", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "AC8E", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "AC8P", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "AC8J", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "AC8E", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "AC8P", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE },
 
 	// DigiCommunication Nyo - Datou! Black Gemagema Dan
-	{ "BDKJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "BDKJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE },
 
 	// Dragon Ball Z - The Legacy of Goku
-	{ "ALGP", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "ALGP", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE },
 
 	// Dragon Ball Z - The Legacy of Goku II
-	{ "ALFJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "ALFE", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "ALFP", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "ALFJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "ALFE", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "ALFP", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE },
 
 	// Dragon Ball Z - Taiketsu
-	{ "BDBE", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "BDBP", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "BDBE", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "BDBP", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE },
 
 	// Drill Dozer
-	{ "V49J", GBA_SAVEDATA_SRAM, HW_RUMBLE, GBA_IDLE_LOOP_NONE, false },
-	{ "V49E", GBA_SAVEDATA_SRAM, HW_RUMBLE, GBA_IDLE_LOOP_NONE, false },
-	{ "V49P", GBA_SAVEDATA_SRAM, HW_RUMBLE, GBA_IDLE_LOOP_NONE, false },
+	{ "V49J", GBA_SAVEDATA_SRAM, HW_RUMBLE, GBA_IDLE_LOOP_NONE },
+	{ "V49E", GBA_SAVEDATA_SRAM, HW_RUMBLE, GBA_IDLE_LOOP_NONE },
+	{ "V49P", GBA_SAVEDATA_SRAM, HW_RUMBLE, GBA_IDLE_LOOP_NONE },
 
 	// e-Reader
 	{ "PEAJ", GBA_SAVEDATA_FLASH1M, HW_EREADER, GBA_IDLE_LOOP_NONE },
@@ -61,156 +61,146 @@ static const struct GBACartridgeOverride _overrides[] = {
 	{ "PSAE", GBA_SAVEDATA_FLASH1M, HW_EREADER, GBA_IDLE_LOOP_NONE },
 
 	// Final Fantasy Tactics Advance
-	{ "AFXE", GBA_SAVEDATA_FLASH512, HW_NONE, 0x8000428, false },
+	{ "AFXE", GBA_SAVEDATA_FLASH512, HW_NONE, 0x8000428 },
 
 	// F-Zero - Climax
-	{ "BFTJ", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "BFTJ", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE },
 
 	// Goodboy Galaxy
-	{ "2GBP", GBA_SAVEDATA_SRAM, HW_RUMBLE, GBA_IDLE_LOOP_NONE, false },
+	{ "2GBP", GBA_SAVEDATA_SRAM, HW_RUMBLE, GBA_IDLE_LOOP_NONE },
 
 	// Iridion II
-	{ "AI2E", GBA_SAVEDATA_FORCE_NONE, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "AI2P", GBA_SAVEDATA_FORCE_NONE, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "AI2E", GBA_SAVEDATA_FORCE_NONE, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "AI2P", GBA_SAVEDATA_FORCE_NONE, HW_NONE, GBA_IDLE_LOOP_NONE },
 
 	// Game Boy Wars Advance 1+2
-	{ "BGWJ", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "BGWJ", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE },
 
 	// Golden Sun: The Lost Age
-	{ "AGFE", GBA_SAVEDATA_FLASH512, HW_NONE, 0x801353A, false },
+	{ "AGFE", GBA_SAVEDATA_FLASH512, HW_NONE, 0x801353A },
 
 	// Koro Koro Puzzle - Happy Panechu!
-	{ "KHPJ", GBA_SAVEDATA_EEPROM, HW_TILT, GBA_IDLE_LOOP_NONE, false },
+	{ "KHPJ", GBA_SAVEDATA_EEPROM, HW_TILT, GBA_IDLE_LOOP_NONE },
 
 	// Legendz - Yomigaeru Shiren no Shima
-	{ "BLJJ", GBA_SAVEDATA_FLASH512, HW_RTC, GBA_IDLE_LOOP_NONE, false },
-	{ "BLJK", GBA_SAVEDATA_FLASH512, HW_RTC, GBA_IDLE_LOOP_NONE, false },
+	{ "BLJJ", GBA_SAVEDATA_FLASH512, HW_RTC, GBA_IDLE_LOOP_NONE },
+	{ "BLJK", GBA_SAVEDATA_FLASH512, HW_RTC, GBA_IDLE_LOOP_NONE },
 
 	// Legendz - Sign of Nekuromu
-	{ "BLVJ", GBA_SAVEDATA_FLASH512, HW_RTC, GBA_IDLE_LOOP_NONE, false },
+	{ "BLVJ", GBA_SAVEDATA_FLASH512, HW_RTC, GBA_IDLE_LOOP_NONE },
 
 	// Mega Man Battle Network
-	{ "AREE", GBA_SAVEDATA_SRAM, HW_NONE, 0x800032E, false },
+	{ "AREE", GBA_SAVEDATA_SRAM, HW_NONE, 0x800032E },
 
 	// Mega Man Zero
-	{ "AZCE", GBA_SAVEDATA_SRAM, HW_NONE, 0x80004E8, false },
+	{ "AZCE", GBA_SAVEDATA_SRAM, HW_NONE, 0x80004E8 },
 
 	// Metal Slug Advance
-	{ "BSME", GBA_SAVEDATA_EEPROM, HW_NONE, 0x8000290, false },
+	{ "BSME", GBA_SAVEDATA_EEPROM, HW_NONE, 0x8000290 },
 
 	// Pokemon Ruby
-	{ "AXVJ", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
-	{ "AXVE", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
-	{ "AXVP", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
-	{ "AXVI", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
-	{ "AXVS", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
-	{ "AXVD", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
-	{ "AXVF", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
+	{ "AXVJ", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE },
+	{ "AXVE", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE },
+	{ "AXVP", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE },
+	{ "AXVI", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE },
+	{ "AXVS", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE },
+	{ "AXVD", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE },
+	{ "AXVF", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE },
 
 	// Pokemon Sapphire
-	{ "AXPJ", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
-	{ "AXPE", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
-	{ "AXPP", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
-	{ "AXPI", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
-	{ "AXPS", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
-	{ "AXPD", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
-	{ "AXPF", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
+	{ "AXPJ", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE },
+	{ "AXPE", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE },
+	{ "AXPP", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE },
+	{ "AXPI", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE },
+	{ "AXPS", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE },
+	{ "AXPD", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE },
+	{ "AXPF", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE },
 
 	// Pokemon Emerald
-	{ "BPEJ", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
-	{ "BPEE", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
-	{ "BPEP", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
-	{ "BPEI", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
-	{ "BPES", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
-	{ "BPED", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
-	{ "BPEF", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6, false },
+	{ "BPEJ", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6 },
+	{ "BPEE", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6 },
+	{ "BPEP", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6 },
+	{ "BPEI", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6 },
+	{ "BPES", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6 },
+	{ "BPED", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6 },
+	{ "BPEF", GBA_SAVEDATA_FLASH1M, HW_RTC, 0x80008C6 },
 
 	// Pokemon Mystery Dungeon
-	{ "B24E", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "B24P", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "B24E", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "B24P", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE },
 
 	// Pokemon FireRed
-	{ "BPRJ", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "BPRE", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "BPRP", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "BPRI", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "BPRS", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "BPRD", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "BPRF", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "BPRJ", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "BPRE", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "BPRP", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "BPRI", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "BPRS", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "BPRD", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "BPRF", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE },
 
 	// Pokemon LeafGreen
-	{ "BPGJ", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "BPGE", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "BPGP", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "BPGI", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "BPGS", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "BPGD", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "BPGF", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "BPGJ", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "BPGE", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "BPGP", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "BPGI", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "BPGS", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "BPGD", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "BPGF", GBA_SAVEDATA_FLASH1M, HW_NONE, GBA_IDLE_LOOP_NONE },
 
 	// RockMan EXE 4.5 - Real Operation
-	{ "BR4J", GBA_SAVEDATA_FLASH512, HW_RTC, GBA_IDLE_LOOP_NONE, false },
+	{ "BR4J", GBA_SAVEDATA_FLASH512, HW_RTC, GBA_IDLE_LOOP_NONE },
 
 	// Rocky
-	{ "AR8E", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "AROP", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "AR8E", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "AROP", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE },
 
 	// Sennen Kazoku
-	{ "BKAJ", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE, false },
+	{ "BKAJ", GBA_SAVEDATA_FLASH1M, HW_RTC, GBA_IDLE_LOOP_NONE },
 
 	// Shin Bokura no Taiyou: Gyakushuu no Sabata
-	{ "U33J", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE, false },
+	{ "U33J", GBA_SAVEDATA_EEPROM, HW_RTC | HW_LIGHT_SENSOR, GBA_IDLE_LOOP_NONE },
 
 	// Stuart Little 2
-	{ "ASLE", GBA_SAVEDATA_FORCE_NONE, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "ASLF", GBA_SAVEDATA_FORCE_NONE, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "ASLE", GBA_SAVEDATA_FORCE_NONE, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "ASLF", GBA_SAVEDATA_FORCE_NONE, HW_NONE, GBA_IDLE_LOOP_NONE },
 
 	// Super Mario Advance 2
-	{ "AA2J", GBA_SAVEDATA_EEPROM, HW_NONE, 0x800052E, false },
-	{ "AA2E", GBA_SAVEDATA_EEPROM, HW_NONE, 0x800052E, false },
-	{ "AA2P", GBA_SAVEDATA_AUTODETECT, HW_NONE, 0x800052E, false },
+	{ "AA2J", GBA_SAVEDATA_EEPROM, HW_NONE, 0x800052E },
+	{ "AA2E", GBA_SAVEDATA_EEPROM, HW_NONE, 0x800052E },
+	{ "AA2P", GBA_SAVEDATA_AUTODETECT, HW_NONE, 0x800052E },
 
 	// Super Mario Advance 3
-	{ "A3AJ", GBA_SAVEDATA_EEPROM, HW_NONE, 0x8002B9C, false },
-	{ "A3AE", GBA_SAVEDATA_EEPROM, HW_NONE, 0x8002B9C, false },
-	{ "A3AP", GBA_SAVEDATA_EEPROM, HW_NONE, 0x8002B9C, false },
+	{ "A3AJ", GBA_SAVEDATA_EEPROM, HW_NONE, 0x8002B9C },
+	{ "A3AE", GBA_SAVEDATA_EEPROM, HW_NONE, 0x8002B9C },
+	{ "A3AP", GBA_SAVEDATA_EEPROM, HW_NONE, 0x8002B9C },
 
 	// Super Mario Advance 4
-	{ "AX4J", GBA_SAVEDATA_FLASH1M, HW_NONE, 0x800072A, false },
-	{ "AX4E", GBA_SAVEDATA_FLASH1M, HW_NONE, 0x800072A, false },
-	{ "AX4P", GBA_SAVEDATA_FLASH1M, HW_NONE, 0x800072A, false },
+	{ "AX4J", GBA_SAVEDATA_FLASH1M, HW_NONE, 0x800072A },
+	{ "AX4E", GBA_SAVEDATA_FLASH1M, HW_NONE, 0x800072A },
+	{ "AX4P", GBA_SAVEDATA_FLASH1M, HW_NONE, 0x800072A },
 
 	// Super Monkey Ball Jr.
-	{ "ALUE", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "ALUP", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "ALUE", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE },
+	{ "ALUP", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE },
 
 	// Top Gun - Combat Zones
-	{ "A2YE", GBA_SAVEDATA_FORCE_NONE, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "A2YE", GBA_SAVEDATA_FORCE_NONE, HW_NONE, GBA_IDLE_LOOP_NONE },
 
 	// Ueki no Housoku - Jingi Sakuretsu! Nouryokusha Battle
-	{ "BUHJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "BUHJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE },
 
 	// Wario Ware Twisted
-	{ "RZWJ", GBA_SAVEDATA_SRAM, HW_RUMBLE | HW_GYRO, GBA_IDLE_LOOP_NONE, false },
-	{ "RZWE", GBA_SAVEDATA_SRAM, HW_RUMBLE | HW_GYRO, GBA_IDLE_LOOP_NONE, false },
-	{ "RZWP", GBA_SAVEDATA_SRAM, HW_RUMBLE | HW_GYRO, GBA_IDLE_LOOP_NONE, false },
+	{ "RZWJ", GBA_SAVEDATA_SRAM, HW_RUMBLE | HW_GYRO, GBA_IDLE_LOOP_NONE },
+	{ "RZWE", GBA_SAVEDATA_SRAM, HW_RUMBLE | HW_GYRO, GBA_IDLE_LOOP_NONE },
+	{ "RZWP", GBA_SAVEDATA_SRAM, HW_RUMBLE | HW_GYRO, GBA_IDLE_LOOP_NONE },
 
 	// Yoshi's Universal Gravitation
-	{ "KYGJ", GBA_SAVEDATA_EEPROM, HW_TILT, GBA_IDLE_LOOP_NONE, false },
-	{ "KYGE", GBA_SAVEDATA_EEPROM, HW_TILT, GBA_IDLE_LOOP_NONE, false },
-	{ "KYGP", GBA_SAVEDATA_EEPROM, HW_TILT, GBA_IDLE_LOOP_NONE, false },
+	{ "KYGJ", GBA_SAVEDATA_EEPROM, HW_TILT, GBA_IDLE_LOOP_NONE },
+	{ "KYGE", GBA_SAVEDATA_EEPROM, HW_TILT, GBA_IDLE_LOOP_NONE },
+	{ "KYGP", GBA_SAVEDATA_EEPROM, HW_TILT, GBA_IDLE_LOOP_NONE },
 
 	// Aging cartridge
-	{ "TCHK", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-
-	// Famicom Mini series 3 (FDS), some aren't mirrored (22 - 28)
-	// See https://forum.no-intro.org/viewtopic.php?f=2&t=4221 for discussion
-	{ "FNMJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "FMRJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "FPTJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "FLBJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "FFMJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "FTKJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
-	{ "FTUJ", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, false },
+	{ "TCHK", GBA_SAVEDATA_EEPROM, HW_NONE, GBA_IDLE_LOOP_NONE, },
 
 	{ { 0, 0, 0, 0 }, 0, 0, GBA_IDLE_LOOP_NONE, false }
 };
@@ -219,7 +209,6 @@ bool GBAOverrideFind(const struct Configuration* config, struct GBACartridgeOver
 	override->savetype = GBA_SAVEDATA_AUTODETECT;
 	override->hardware = HW_NONE;
 	override->idleLoop = GBA_IDLE_LOOP_NONE;
-	override->mirroring = false;
 	override->vbaBugCompat = false;
 	bool found = false;
 
diff --git a/src/platform/qt/OverrideView.cpp b/src/platform/qt/OverrideView.cpp
index 1d2737521..bec404a00 100644
--- a/src/platform/qt/OverrideView.cpp
+++ b/src/platform/qt/OverrideView.cpp
@@ -156,7 +156,6 @@ void OverrideView::updateOverrides() {
 		gba->override.savetype = static_cast<GBASavedataType>(m_ui.savetype->currentIndex() - 1);
 		gba->override.hardware = HW_NO_OVERRIDE;
 		gba->override.idleLoop = GBA_IDLE_LOOP_NONE;
-		gba->override.mirroring = false;
 		gba->override.vbaBugCompat = false;
 		gba->vbaBugCompatSet = false;
 

From 5ee60362a18bf96e90afa1aa6da13827b47f1f60 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Mon, 25 Mar 2024 01:24:50 -0700
Subject: [PATCH 26/53] GBA: Move GBAHardwareDevice to public API

---
 include/mgba/gba/interface.h          | 13 +++++++++++++
 include/mgba/internal/gba/cart/gpio.h | 13 -------------
 2 files changed, 13 insertions(+), 13 deletions(-)

diff --git a/include/mgba/gba/interface.h b/include/mgba/gba/interface.h
index 9d19a55c8..c54277e83 100644
--- a/include/mgba/gba/interface.h
+++ b/include/mgba/gba/interface.h
@@ -58,6 +58,19 @@ enum GBASavedataType {
 	GBA_SAVEDATA_SRAM512 = 6,
 };
 
+enum GBAHardwareDevice {
+	HW_NO_OVERRIDE = 0x8000,
+	HW_NONE = 0,
+	HW_RTC = 1,
+	HW_RUMBLE = 2,
+	HW_LIGHT_SENSOR = 4,
+	HW_GYRO = 8,
+	HW_TILT = 16,
+	HW_GB_PLAYER = 32,
+	HW_GB_PLAYER_DETECTION = 64,
+	HW_EREADER = 128
+};
+
 struct GBA;
 struct GBAAudio;
 struct GBASIO;
diff --git a/include/mgba/internal/gba/cart/gpio.h b/include/mgba/internal/gba/cart/gpio.h
index 86ddc941f..77785e612 100644
--- a/include/mgba/internal/gba/cart/gpio.h
+++ b/include/mgba/internal/gba/cart/gpio.h
@@ -18,19 +18,6 @@ mLOG_DECLARE_CATEGORY(GBA_HW);
 
 #define IS_GPIO_REGISTER(reg) ((reg) == GPIO_REG_DATA || (reg) == GPIO_REG_DIRECTION || (reg) == GPIO_REG_CONTROL)
 
-enum GBAHardwareDevice {
-	HW_NO_OVERRIDE = 0x8000,
-	HW_NONE = 0,
-	HW_RTC = 1,
-	HW_RUMBLE = 2,
-	HW_LIGHT_SENSOR = 4,
-	HW_GYRO = 8,
-	HW_TILT = 16,
-	HW_GB_PLAYER = 32,
-	HW_GB_PLAYER_DETECTION = 64,
-	HW_EREADER = 128
-};
-
 enum GPIORegister {
 	GPIO_REG_DATA = 0xC4,
 	GPIO_REG_DIRECTION = 0xC6,

From a7143aa84c5f277fd6ca1550db251a489bb3910b Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Mon, 25 Mar 2024 01:47:32 -0700
Subject: [PATCH 27/53] GB, GBA: Move more override-adjacent stuff to public
 API

---
 include/mgba/gb/interface.h           | 12 ++++++++++++
 include/mgba/gba/interface.h          | 28 +++++++++++++++------------
 include/mgba/internal/gb/overrides.h  | 12 ------------
 include/mgba/internal/gba/overrides.h |  4 ----
 src/feature/gui/gui-config.c          |  2 +-
 src/platform/qt/ConfigController.cpp  |  2 +-
 src/platform/qt/GBAOverride.h         |  2 +-
 src/platform/qt/GBOverride.h          |  2 +-
 src/platform/qt/SettingsView.cpp      |  2 +-
 9 files changed, 33 insertions(+), 33 deletions(-)

diff --git a/include/mgba/gb/interface.h b/include/mgba/gb/interface.h
index 485111b41..de26ef731 100644
--- a/include/mgba/gb/interface.h
+++ b/include/mgba/gb/interface.h
@@ -82,6 +82,12 @@ struct GBCartridgeOverride {
 	uint32_t gbColors[12];
 };
 
+struct GBColorPreset {
+	const char* name;
+	uint32_t colors[12];
+};
+
+struct Configuration;
 struct VFile;
 
 bool GBIsROM(struct VFile* vf);
@@ -93,6 +99,12 @@ const char* GBModelToName(enum GBModel);
 
 int GBValidModels(const uint8_t* bank0);
 
+bool GBOverrideFind(const struct Configuration*, struct GBCartridgeOverride* override);
+bool GBOverrideColorFind(struct GBCartridgeOverride* override, enum GBColorLookup);
+void GBOverrideSave(struct Configuration*, const struct GBCartridgeOverride* override);
+
+size_t GBColorPresetList(const struct GBColorPreset** presets);
+
 CXX_GUARD_END
 
 #endif
diff --git a/include/mgba/gba/interface.h b/include/mgba/gba/interface.h
index c54277e83..c64d00391 100644
--- a/include/mgba/gba/interface.h
+++ b/include/mgba/gba/interface.h
@@ -71,7 +71,7 @@ enum GBAHardwareDevice {
 	HW_EREADER = 128
 };
 
-struct GBA;
+struct Configuration;
 struct GBAAudio;
 struct GBASIO;
 struct GBAVideoRenderer;
@@ -84,9 +84,13 @@ enum {
 	mPERIPH_GBA_BATTLECHIP_GATE,
 };
 
-bool GBAIsROM(struct VFile* vf);
-bool GBAIsMB(struct VFile* vf);
-bool GBAIsBIOS(struct VFile* vf);
+struct GBACartridgeOverride {
+	char id[4];
+	enum GBASavedataType savetype;
+	int hardware;
+	uint32_t idleLoop;
+	bool vbaBugCompat;
+};
 
 struct GBALuminanceSource {
 	void (*sample)(struct GBALuminanceSource*);
@@ -94,6 +98,13 @@ struct GBALuminanceSource {
 	uint8_t (*readLuminance)(struct GBALuminanceSource*);
 };
 
+bool GBAIsROM(struct VFile* vf);
+bool GBAIsMB(struct VFile* vf);
+bool GBAIsBIOS(struct VFile* vf);
+
+bool GBAOverrideFind(const struct Configuration*, struct GBACartridgeOverride* override);
+void GBAOverrideSave(struct Configuration*, const struct GBACartridgeOverride* override);
+
 struct GBASIODriver {
 	struct GBASIO* p;
 
@@ -104,14 +115,6 @@ struct GBASIODriver {
 	uint16_t (*writeRegister)(struct GBASIODriver* driver, uint32_t address, uint16_t value);
 };
 
-struct GBACartridgeOverride {
-	char id[4];
-	enum GBASavedataType savetype;
-	int hardware;
-	uint32_t idleLoop;
-	bool vbaBugCompat;
-};
-
 void GBASIOJOYCreate(struct GBASIODriver* sio);
 
 enum GBASIOBattleChipGateFlavor {
@@ -132,6 +135,7 @@ struct GBASIOBattlechipGate {
 
 void GBASIOBattlechipGateCreate(struct GBASIOBattlechipGate*);
 
+struct GBA;
 void GBACartEReaderQueueCard(struct GBA* gba, const void* data, size_t size);
 
 struct EReaderScan;
diff --git a/include/mgba/internal/gb/overrides.h b/include/mgba/internal/gb/overrides.h
index 6e683f0de..9d16ce65c 100644
--- a/include/mgba/internal/gb/overrides.h
+++ b/include/mgba/internal/gb/overrides.h
@@ -12,18 +12,6 @@ CXX_GUARD_START
 
 #include <mgba/gb/interface.h>
 
-struct GBColorPreset {
-	const char* name;
-	uint32_t colors[12];
-};
-
-struct Configuration;
-bool GBOverrideFind(const struct Configuration*, struct GBCartridgeOverride* override);
-bool GBOverrideColorFind(struct GBCartridgeOverride* override, enum GBColorLookup);
-void GBOverrideSave(struct Configuration*, const struct GBCartridgeOverride* override);
-
-size_t GBColorPresetList(const struct GBColorPreset** presets);
-
 struct GB;
 void GBOverrideApply(struct GB*, const struct GBCartridgeOverride*);
 void GBOverrideApplyDefaults(struct GB*);
diff --git a/include/mgba/internal/gba/overrides.h b/include/mgba/internal/gba/overrides.h
index b2eba2d7a..4bec8bf15 100644
--- a/include/mgba/internal/gba/overrides.h
+++ b/include/mgba/internal/gba/overrides.h
@@ -12,10 +12,6 @@ CXX_GUARD_START
 
 #include <mgba/gba/interface.h>
 
-struct Configuration;
-bool GBAOverrideFind(const struct Configuration*, struct GBACartridgeOverride* override);
-void GBAOverrideSave(struct Configuration*, const struct GBACartridgeOverride* override);
-
 struct GBA;
 void GBAOverrideApply(struct GBA*, const struct GBACartridgeOverride*);
 void GBAOverrideApplyDefaults(struct GBA*, const struct Configuration*);
diff --git a/src/feature/gui/gui-config.c b/src/feature/gui/gui-config.c
index 4a6c79871..e110ef768 100644
--- a/src/feature/gui/gui-config.c
+++ b/src/feature/gui/gui-config.c
@@ -12,7 +12,7 @@
 #include <mgba/internal/gba/gba.h>
 #ifdef M_CORE_GB
 #include <mgba/internal/gb/gb.h>
-#include <mgba/internal/gb/overrides.h>
+#include <mgba/gb/interface.h>
 #endif
 #include <mgba-util/gui/file-select.h>
 #include <mgba-util/gui/menu.h>
diff --git a/src/platform/qt/ConfigController.cpp b/src/platform/qt/ConfigController.cpp
index e1bf35408..91ecf8e7a 100644
--- a/src/platform/qt/ConfigController.cpp
+++ b/src/platform/qt/ConfigController.cpp
@@ -13,7 +13,7 @@
 
 #include <mgba/feature/commandline.h>
 #ifdef M_CORE_GB
-#include <mgba/internal/gb/overrides.h>
+#include <mgba/gb/interface.h>
 #endif
 
 static const mOption s_frontendOptions[] = {
diff --git a/src/platform/qt/GBAOverride.h b/src/platform/qt/GBAOverride.h
index 477af0014..b93cb1953 100644
--- a/src/platform/qt/GBAOverride.h
+++ b/src/platform/qt/GBAOverride.h
@@ -7,7 +7,7 @@
 
 #include "Override.h"
 
-#include <mgba/internal/gba/overrides.h>
+#include <mgba/gba/interface.h>
 
 namespace QGBA {
 
diff --git a/src/platform/qt/GBOverride.h b/src/platform/qt/GBOverride.h
index e967211de..fc1a7d2c9 100644
--- a/src/platform/qt/GBOverride.h
+++ b/src/platform/qt/GBOverride.h
@@ -7,7 +7,7 @@
 
 #include "Override.h"
 
-#include <mgba/internal/gb/overrides.h>
+#include <mgba/gb/interface.h>
 
 namespace QGBA {
 
diff --git a/src/platform/qt/SettingsView.cpp b/src/platform/qt/SettingsView.cpp
index 04d7d1649..7c41cb4a4 100644
--- a/src/platform/qt/SettingsView.cpp
+++ b/src/platform/qt/SettingsView.cpp
@@ -18,7 +18,7 @@
 
 #ifdef M_CORE_GB
 #include "GameBoy.h"
-#include <mgba/internal/gb/overrides.h>
+#include <mgba/gb/interface.h>
 #endif
 
 #include <mgba/core/serialize.h>

From 62fb834b6455aef15a39f7ceca652020ba96a420 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Mon, 25 Mar 2024 02:35:03 -0700
Subject: [PATCH 28/53] Qt: Fix Qt6 build

---
 src/platform/qt/VideoDumper.h | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/platform/qt/VideoDumper.h b/src/platform/qt/VideoDumper.h
index 65433462c..2dcceac0f 100644
--- a/src/platform/qt/VideoDumper.h
+++ b/src/platform/qt/VideoDumper.h
@@ -6,6 +6,7 @@
 #pragma once
 
 #include <QObject>
+#include <QVideoFrame>
 #if (QT_VERSION < QT_VERSION_CHECK(6, 0, 0))
 #include <QAbstractVideoSurface>
 #include <QVideoSurfaceFormat>

From 35e139c76a1e68b67c3e511cfd024bc066507105 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Mon, 25 Mar 2024 21:16:09 -0700
Subject: [PATCH 29/53] Qt: Fix underrun stalling with Qt6

---
 src/platform/qt/AudioDevice.cpp      | 10 ++++++++++
 src/platform/qt/AudioDevice.h        |  1 +
 src/platform/qt/AudioProcessorQt.cpp | 29 ++++++++++++++++++++++++++++
 src/platform/qt/AudioProcessorQt.h   |  8 +++++++-
 4 files changed, 47 insertions(+), 1 deletion(-)

diff --git a/src/platform/qt/AudioDevice.cpp b/src/platform/qt/AudioDevice.cpp
index 74f863444..d19fc20d3 100644
--- a/src/platform/qt/AudioDevice.cpp
+++ b/src/platform/qt/AudioDevice.cpp
@@ -62,3 +62,13 @@ qint64 AudioDevice::writeData(const char*, qint64) {
 	LOG(QT, WARN) << tr("Writing data to read-only audio device");
 	return 0;
 }
+
+bool AudioDevice::atEnd() const {
+	if (!m_context->core) {
+		return true;
+	}
+	mCoreSyncLockAudio(&m_context->impl->sync);
+	bool available = blip_samples_avail(m_context->core->getAudioChannel(m_context->core, 0)) == 0;
+	mCoreSyncUnlockAudio(&m_context->impl->sync);
+	return available;
+}
diff --git a/src/platform/qt/AudioDevice.h b/src/platform/qt/AudioDevice.h
index 0794b3743..86c5b17a6 100644
--- a/src/platform/qt/AudioDevice.h
+++ b/src/platform/qt/AudioDevice.h
@@ -20,6 +20,7 @@ public:
 
 	void setInput(mCoreThread* input);
 	void setFormat(const QAudioFormat& format);
+	bool atEnd() const override;
 
 protected:
 	virtual qint64 readData(char* data, qint64 maxSize) override;
diff --git a/src/platform/qt/AudioProcessorQt.cpp b/src/platform/qt/AudioProcessorQt.cpp
index 4b53c7bb7..3e4c5474e 100644
--- a/src/platform/qt/AudioProcessorQt.cpp
+++ b/src/platform/qt/AudioProcessorQt.cpp
@@ -21,6 +21,10 @@ using namespace QGBA;
 AudioProcessorQt::AudioProcessorQt(QObject* parent)
 	: AudioProcessor(parent)
 {
+#if (QT_VERSION >= QT_VERSION_CHECK(6, 0, 0))
+	m_recheckTimer.setInterval(1);
+	connect(&m_recheckTimer, &QTimer::timeout, this, &AudioProcessorQt::recheckUnderflow);
+#endif
 }
 
 void AudioProcessorQt::setInput(std::shared_ptr<CoreController> controller) {
@@ -34,6 +38,9 @@ void AudioProcessorQt::setInput(std::shared_ptr<CoreController> controller) {
 }
 
 void AudioProcessorQt::stop() {
+#if (QT_VERSION >= QT_VERSION_CHECK(6, 0, 0))
+	m_recheckTimer.stop();
+#endif
 	if (m_audioOutput) {
 		m_audioOutput->stop();
 		m_audioOutput.reset();
@@ -72,6 +79,12 @@ bool AudioProcessorQt::start() {
 		QAudioDevice device(QMediaDevices::defaultAudioOutput());
 		m_audioOutput = std::make_unique<QAudioSink>(device, format);
 		LOG(QT, INFO) << "Audio outputting to " << device.description();
+		connect(m_audioOutput.get(), &QAudioSink::stateChanged, this, [this](QAudio::State state) {
+			if (state != QAudio::IdleState) {
+				return;
+			}
+			m_recheckTimer.start();
+		});
 #endif
 	}
 
@@ -86,6 +99,9 @@ bool AudioProcessorQt::start() {
 }
 
 void AudioProcessorQt::pause() {
+#if (QT_VERSION >= QT_VERSION_CHECK(6, 0, 0))
+	m_recheckTimer.stop();
+#endif
 	if (m_audioOutput) {
 		m_audioOutput->suspend();
 	}
@@ -115,3 +131,16 @@ unsigned AudioProcessorQt::sampleRate() const {
 	}
 	return m_audioOutput->format().sampleRate();
 }
+
+#if (QT_VERSION >= QT_VERSION_CHECK(6, 0, 0))
+void AudioProcessorQt::recheckUnderflow() {
+	if (!m_device) {
+		m_recheckTimer.stop();
+		return;
+	}
+	if (!m_device->atEnd()) {
+		start();
+		m_recheckTimer.stop();
+	}
+}
+#endif
diff --git a/src/platform/qt/AudioProcessorQt.h b/src/platform/qt/AudioProcessorQt.h
index 1648b967f..bdfa17a77 100644
--- a/src/platform/qt/AudioProcessorQt.h
+++ b/src/platform/qt/AudioProcessorQt.h
@@ -11,6 +11,7 @@
 #include <QAudioOutput>
 #else
 #include <QAudioSink>
+#include <QTimer>
 #endif
 
 class QAudioOutput;
@@ -38,10 +39,15 @@ public slots:
 
 	virtual void requestSampleRate(unsigned) override;
 
-private:
 #if (QT_VERSION >= QT_VERSION_CHECK(6, 0, 0))
+private slots:
+	void recheckUnderflow();
+
+private:
+	QTimer m_recheckTimer;
 	std::unique_ptr<QAudioSink> m_audioOutput;
 #else
+private:
 	std::unique_ptr<QAudioOutput> m_audioOutput;
 #endif
 	std::unique_ptr<AudioDevice> m_device;

From 4445c981651f375764c1b53c3ddb422d04ead1ea Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Mon, 25 Mar 2024 21:27:58 -0700
Subject: [PATCH 30/53] Qt: Enable building against Qt6 by default

---
 src/platform/qt/CMakeLists.txt | 19 +++++++++++++------
 1 file changed, 13 insertions(+), 6 deletions(-)

diff --git a/src/platform/qt/CMakeLists.txt b/src/platform/qt/CMakeLists.txt
index 19d4293d0..fe898be1e 100644
--- a/src/platform/qt/CMakeLists.txt
+++ b/src/platform/qt/CMakeLists.txt
@@ -25,12 +25,19 @@ set(CMAKE_INCLUDE_CURRENT_DIR ON)
 
 set(QT_LIBRARIES)
 
-set(QT_V 5)
-find_package(Qt${QT_V} COMPONENTS Core Widgets Network OPTIONAL_COMPONENTS Multimedia)
-if(QT_V GREATER_EQUAL 6)
-	find_package(Qt${QT_V} COMPONENTS OpenGL OpenGLWidgets)
-endif()
-set(QT Qt${QT_V})
+set(QT_VERSIONS 6 5)
+foreach(V ${QT_VERSIONS})
+	set(QT Qt${V})
+	set(QT_V ${V})
+	message("${V} ${QT} ${QT_V}")
+	find_package(${QT} COMPONENTS Core Widgets Network OPTIONAL_COMPONENTS Multimedia)
+	if(QT_V GREATER_EQUAL 6)
+		find_package(${QT} COMPONENTS OpenGL OpenGLWidgets)
+	endif()
+	if(${${QT}Widgets_FOUND})
+		break()
+	endif()
+endforeach()
 
 if(NOT BUILD_GL AND NOT BUILD_GLES2 AND NOT BUILD_GLES3)
 	message(WARNING "OpenGL is recommended to build the Qt port")

From ba23a5b0bc68143c5499f15b984815abdf4e904d Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Tue, 26 Mar 2024 22:24:14 -0700
Subject: [PATCH 31/53] Scripting: Attempt to shake out single-lua_State
 requirement

---
 src/script/engines/lua.c | 270 +++++++++++++++++++--------------------
 1 file changed, 133 insertions(+), 137 deletions(-)

diff --git a/src/script/engines/lua.c b/src/script/engines/lua.c
index 32ed0d13e..f6bdabea2 100644
--- a/src/script/engines/lua.c
+++ b/src/script/engines/lua.c
@@ -40,12 +40,12 @@ static void _freeFrame(struct mScriptList* frame);
 static void _autofreeFrame(struct mScriptContext* context, struct mScriptList* frame);
 
 struct mScriptEngineContextLua;
-static bool _luaPushFrame(struct mScriptEngineContextLua*, struct mScriptList*);
-static bool _luaPopFrame(struct mScriptEngineContextLua*, struct mScriptList*);
+static bool _luaPushFrame(struct mScriptEngineContextLua*, lua_State*, struct mScriptList*);
+static bool _luaPopFrame(struct mScriptEngineContextLua*, lua_State*, struct mScriptList*);
 static bool _luaInvoke(struct mScriptEngineContextLua*, struct mScriptFrame*);
 
-static struct mScriptValue* _luaCoerce(struct mScriptEngineContextLua* luaContext, bool pop);
-static bool _luaWrap(struct mScriptEngineContextLua* luaContext, struct mScriptValue*);
+static struct mScriptValue* _luaCoerce(struct mScriptEngineContextLua* luaContext, lua_State*, bool pop);
+static bool _luaWrap(struct mScriptEngineContextLua* luaContext, lua_State*, struct mScriptValue*);
 
 static void _luaDeref(struct mScriptValue*);
 
@@ -516,14 +516,14 @@ bool _luaIsScript(struct mScriptEngineContext* ctx, const char* name, struct VFi
 struct mScriptValue* _luaGetGlobal(struct mScriptEngineContext* ctx, const char* name) {
 	struct mScriptEngineContextLua* luaContext = (struct mScriptEngineContextLua*) ctx;
 	lua_getglobal(luaContext->lua, name);
-	return _luaCoerce(luaContext, true);
+	return _luaCoerce(luaContext, luaContext->lua, true);
 }
 
 bool _luaSetGlobal(struct mScriptEngineContext* ctx, const char* name, struct mScriptValue* value) {
 	struct mScriptEngineContextLua* luaContext = (struct mScriptEngineContextLua*) ctx;
 	if (!value) {
 		lua_pushnil(luaContext->lua);
-	} else if (!_luaWrap(luaContext, value)) {
+	} else if (!_luaWrap(luaContext, luaContext->lua, value)) {
 		return false;
 	}
 	lua_setglobal(luaContext->lua, name);
@@ -540,7 +540,7 @@ struct mScriptValue* _luaRootScope(struct mScriptEngineContext* ctx) {
 		struct mScriptValue* key;
 
 		lua_pop(luaContext->lua, 1);
-		key = _luaCoerce(luaContext, false);
+		key = _luaCoerce(luaContext, luaContext->lua, false);
 		mScriptValueWrap(key, mScriptListAppend(list->value.list));
 		mScriptValueRef(key);
 		mScriptContextFillPool(luaContext->d.context, key);
@@ -550,60 +550,60 @@ struct mScriptValue* _luaRootScope(struct mScriptEngineContext* ctx) {
 	return list;
 }
 
-struct mScriptValue* _luaCoerceFunction(struct mScriptEngineContextLua* luaContext) {
+struct mScriptValue* _luaCoerceFunction(struct mScriptEngineContextLua* luaContext, lua_State* lua) {
 	struct mScriptValue* value = mScriptValueAlloc(&mSTLuaFunc);
 	struct mScriptFunction* fn = calloc(1, sizeof(*fn));
 	struct mScriptEngineContextLuaRef* ref = calloc(1, sizeof(*ref));
 	fn->call = _luaCall;
 	fn->context = ref;
 	ref->context = luaContext;
-	ref->ref = luaL_ref(luaContext->lua, LUA_REGISTRYINDEX);
+	ref->ref = luaL_ref(lua, LUA_REGISTRYINDEX);
 	value->value.opaque = fn;
 	return value;
 }
 
-struct mScriptValue* _luaCoerceTable(struct mScriptEngineContextLua* luaContext, struct Table* markedObjects) {
+struct mScriptValue* _luaCoerceTable(struct mScriptEngineContextLua* luaContext, lua_State* lua, struct Table* markedObjects) {
 	struct mScriptValue* table = mScriptValueAlloc(mSCRIPT_TYPE_MS_TABLE);
 	bool isList = true;
 
-	lua_pushnil(luaContext->lua);
+	lua_pushnil(lua);
 
 	const void* tablePointer;
-	while (lua_next(luaContext->lua, -2) != 0) {
+	while (lua_next(lua, -2) != 0) {
 		struct mScriptValue* value = NULL;
-		int type = lua_type(luaContext->lua, -1);
+		int type = lua_type(lua, -1);
 		switch (type) {
 		case LUA_TNUMBER:
 		case LUA_TBOOLEAN:
 		case LUA_TSTRING:
 		case LUA_TFUNCTION:
-			value = _luaCoerce(luaContext, true);
+			value = _luaCoerce(luaContext, lua, true);
 			break;
 		case LUA_TTABLE:
-			tablePointer = lua_topointer(luaContext->lua, -1);
+			tablePointer = lua_topointer(lua, -1);
 			// Ensure this table doesn't contain any cycles
 			if (!HashTableLookupBinary(markedObjects, &tablePointer, sizeof(tablePointer))) {
 				HashTableInsertBinary(markedObjects, &tablePointer, sizeof(tablePointer), (void*) tablePointer);
-				value = _luaCoerceTable(luaContext, markedObjects);
+				value = _luaCoerceTable(luaContext, lua, markedObjects);
 			}
 		default:
 			break;
 		}
 		if (!value) {
-			lua_pop(luaContext->lua, type == LUA_TTABLE ? 2 : 3);
+			lua_pop(lua, type == LUA_TTABLE ? 2 : 3);
 			mScriptValueDeref(table);
 			return NULL;
 		}
 
 		struct mScriptValue* key = NULL;
-		type = lua_type(luaContext->lua, -1);
+		type = lua_type(lua, -1);
 		switch (type) {
 		case LUA_TBOOLEAN:
 		case LUA_TSTRING:
 			isList = false;
 			// Fall through
 		case LUA_TNUMBER:
-			key = _luaCoerce(luaContext, false);
+			key = _luaCoerce(luaContext, lua, false);
 			break;
 		default:
 			// Limit keys to hashable types
@@ -611,7 +611,7 @@ struct mScriptValue* _luaCoerceTable(struct mScriptEngineContextLua* luaContext,
 		}
 
 		if (!key) {
-			lua_pop(luaContext->lua, 2);
+			lua_pop(lua, 2);
 			mScriptValueDeref(table);
 			return false;
 		}
@@ -619,7 +619,7 @@ struct mScriptValue* _luaCoerceTable(struct mScriptEngineContextLua* luaContext,
 		mScriptValueDeref(key);
 		mScriptValueDeref(value);
 	}
-	lua_pop(luaContext->lua, 1);
+	lua_pop(lua, 1);
 
 	size_t len = mScriptTableSize(table);
 	if (!isList || !len) {
@@ -652,9 +652,9 @@ struct mScriptValue* _luaCoerceTable(struct mScriptEngineContextLua* luaContext,
 	return list;
 }
 
-struct mScriptValue* _luaCoerce(struct mScriptEngineContextLua* luaContext, bool pop) {
-	if (lua_isnone(luaContext->lua, -1)) {
-		lua_pop(luaContext->lua, 1);
+struct mScriptValue* _luaCoerce(struct mScriptEngineContextLua* luaContext, lua_State* lua, bool pop) {
+	if (lua_isnone(lua, -1)) {
+		lua_pop(lua, 1);
 		return NULL;
 	}
 
@@ -662,27 +662,27 @@ struct mScriptValue* _luaCoerce(struct mScriptEngineContextLua* luaContext, bool
 	const void* buffer;
 	struct Table markedObjects;
 	struct mScriptValue* value = NULL;
-	switch (lua_type(luaContext->lua, -1)) {
+	switch (lua_type(lua, -1)) {
 	case LUA_TNIL:
 		value = &mScriptValueNull;
 		break;
 	case LUA_TNUMBER:
 #if LUA_VERSION_NUM >= 503
-		if (lua_isinteger(luaContext->lua, -1)) {
+		if (lua_isinteger(lua, -1)) {
 			value = mScriptValueAlloc(mSCRIPT_TYPE_MS_S64);
-			value->value.s64 = lua_tointeger(luaContext->lua, -1);
+			value->value.s64 = lua_tointeger(lua, -1);
 			break;
 		}
 #endif
 		value = mScriptValueAlloc(mSCRIPT_TYPE_MS_F64);
-		value->value.f64 = lua_tonumber(luaContext->lua, -1);
+		value->value.f64 = lua_tonumber(lua, -1);
 		break;
 	case LUA_TBOOLEAN:
 		value = mScriptValueAlloc(mSCRIPT_TYPE_MS_BOOL);
-		value->value.u32 = lua_toboolean(luaContext->lua, -1);
+		value->value.u32 = lua_toboolean(lua, -1);
 		break;
 	case LUA_TSTRING:
-		buffer = lua_tolstring(luaContext->lua, -1, &size);
+		buffer = lua_tolstring(lua, -1, &size);
 		value = mScriptStringCreateFromBytes(buffer, size);
 		break;
 	case LUA_TFUNCTION:
@@ -690,35 +690,35 @@ struct mScriptValue* _luaCoerce(struct mScriptEngineContextLua* luaContext, bool
 		if (!pop) {
 			break;
 		}
-		return _luaCoerceFunction(luaContext);
+		return _luaCoerceFunction(luaContext, lua);
 	case LUA_TTABLE:
 		// This function pops the value internally
 		if (!pop) {
 			break;
 		}
 		HashTableInit(&markedObjects, 0, NULL);
-		value = _luaCoerceTable(luaContext, &markedObjects);
+		value = _luaCoerceTable(luaContext, lua, &markedObjects);
 		HashTableDeinit(&markedObjects);
 		return value;
 	case LUA_TUSERDATA:
-		if (!lua_getmetatable(luaContext->lua, -1)) {
+		if (!lua_getmetatable(lua, -1)) {
 			break;
 		}
-		luaL_getmetatable(luaContext->lua, "mSTStruct");
-		if (!lua_rawequal(luaContext->lua, -1, -2)) {
-			lua_pop(luaContext->lua, 1);
-			luaL_getmetatable(luaContext->lua, "mSTList");
-			if (!lua_rawequal(luaContext->lua, -1, -2)) {
-				lua_pop(luaContext->lua, 1);
-				luaL_getmetatable(luaContext->lua, "mSTTable");
-				if (!lua_rawequal(luaContext->lua, -1, -2)) {
-					lua_pop(luaContext->lua, 2);
+		luaL_getmetatable(lua, "mSTStruct");
+		if (!lua_rawequal(lua, -1, -2)) {
+			lua_pop(lua, 1);
+			luaL_getmetatable(lua, "mSTList");
+			if (!lua_rawequal(lua, -1, -2)) {
+				lua_pop(lua, 1);
+				luaL_getmetatable(lua, "mSTTable");
+				if (!lua_rawequal(lua, -1, -2)) {
+					lua_pop(lua, 2);
 					break;
 				}
 			}
 		}
-		lua_pop(luaContext->lua, 2);
-		value = lua_touserdata(luaContext->lua, -1);
+		lua_pop(lua, 2);
+		value = lua_touserdata(lua, -1);
 		value = mScriptContextAccessWeakref(luaContext->d.context, value);
 		if (value->type->base == mSCRIPT_TYPE_WRAPPER) {
 			value = mScriptValueUnwrap(value);
@@ -729,14 +729,14 @@ struct mScriptValue* _luaCoerce(struct mScriptEngineContextLua* luaContext, bool
 		break;
 	}
 	if (pop) {
-		lua_pop(luaContext->lua, 1);
+		lua_pop(lua, 1);
 	}
 	return value;
 }
 
-bool _luaWrap(struct mScriptEngineContextLua* luaContext, struct mScriptValue* value) {
+bool _luaWrap(struct mScriptEngineContextLua* luaContext, lua_State* lua, struct mScriptValue* value) {
 	if (!value) {
-		lua_pushnil(luaContext->lua);
+		lua_pushnil(lua);
 		return true;
 	}
 	uint32_t weakref;
@@ -744,7 +744,7 @@ bool _luaWrap(struct mScriptEngineContextLua* luaContext, struct mScriptValue* v
 	if (value->type->base == mSCRIPT_TYPE_WRAPPER) {
 		value = mScriptValueUnwrap(value);
 		if (!value) {
-			lua_pushnil(luaContext->lua);
+			lua_pushnil(lua);
 			return true;
 		}
 		mScriptContextFillPool(luaContext->d.context, value);
@@ -778,7 +778,7 @@ bool _luaWrap(struct mScriptEngineContextLua* luaContext, struct mScriptValue* v
 		weakref = value->value.u32;
 		value = mScriptContextAccessWeakref(luaContext->d.context, value);
 		if (!value) {
-			lua_pushnil(luaContext->lua);
+			lua_pushnil(lua);
 			return true;
 		}
 		needsWeakref = true;
@@ -787,95 +787,95 @@ bool _luaWrap(struct mScriptEngineContextLua* luaContext, struct mScriptValue* v
 	struct mScriptValue* newValue;
 	switch (value->type->base) {
 	case mSCRIPT_TYPE_VOID:
-		lua_pushnil(luaContext->lua);
+		lua_pushnil(lua);
 		break;
 	case mSCRIPT_TYPE_SINT:
 		if (value->type->size <= 4) {
-			lua_pushinteger(luaContext->lua, value->value.s32);
+			lua_pushinteger(lua, value->value.s32);
 		} else if (value->type->size == 8) {
-			lua_pushinteger(luaContext->lua, value->value.s64);
+			lua_pushinteger(lua, value->value.s64);
 		} else {
 			ok = false;
 		}
 		break;
 	case mSCRIPT_TYPE_UINT:
 		if (value->type == mSCRIPT_TYPE_MS_BOOL) {
-			lua_pushboolean(luaContext->lua, !!value->value.u32);
+			lua_pushboolean(lua, !!value->value.u32);
 		} else if (value->type->size <= 4) {
-			lua_pushinteger(luaContext->lua, value->value.u32);
+			lua_pushinteger(lua, value->value.u32);
 		} else if (value->type->size == 8) {
-			lua_pushinteger(luaContext->lua, value->value.u64);
+			lua_pushinteger(lua, value->value.u64);
 		} else {
 			ok = false;
 		}
 		break;
 	case mSCRIPT_TYPE_FLOAT:
 		if (value->type->size == 4) {
-			lua_pushnumber(luaContext->lua, value->value.f32);
+			lua_pushnumber(lua, value->value.f32);
 		} else if (value->type->size == 8) {
-			lua_pushnumber(luaContext->lua, value->value.f64);
+			lua_pushnumber(lua, value->value.f64);
 		} else {
 			ok = false;
 		}
 		break;
 	case mSCRIPT_TYPE_STRING:
 		if (!value->value.string) {
-			lua_pushnil(luaContext->lua);
+			lua_pushnil(lua);
 			break;
 		}
 		if (value->type == mSCRIPT_TYPE_MS_STR) {
-			lua_pushlstring(luaContext->lua, value->value.string->buffer, value->value.string->size);
+			lua_pushlstring(lua, value->value.string->buffer, value->value.string->size);
 			break;
 		}
 		if (value->type == mSCRIPT_TYPE_MS_CHARP) {
-			lua_pushstring(luaContext->lua, value->value.copaque);
+			lua_pushstring(lua, value->value.copaque);
 			break;
 		}
 		ok = false;
 		break;
 	case mSCRIPT_TYPE_LIST:
-		newValue = lua_newuserdata(luaContext->lua, sizeof(*newValue));
+		newValue = lua_newuserdata(lua, sizeof(*newValue));
 		if (needsWeakref) {
 			*newValue = mSCRIPT_MAKE(WEAKREF, weakref);
 		} else {
 			mScriptValueRef(value);
 			mScriptValueWrap(value, newValue);
 		}
-		lua_getfield(luaContext->lua, LUA_REGISTRYINDEX, "mSTList");
-		lua_setmetatable(luaContext->lua, -2);
+		lua_getfield(lua, LUA_REGISTRYINDEX, "mSTList");
+		lua_setmetatable(lua, -2);
 		break;
 	case mSCRIPT_TYPE_TABLE:
-		newValue = lua_newuserdata(luaContext->lua, sizeof(*newValue));
+		newValue = lua_newuserdata(lua, sizeof(*newValue));
 		if (needsWeakref) {
 			*newValue = mSCRIPT_MAKE(WEAKREF, weakref);
 		} else {
 			mScriptValueRef(value);
 			mScriptValueWrap(value, newValue);
 		}
-		lua_getfield(luaContext->lua, LUA_REGISTRYINDEX, "mSTTable");
-		lua_setmetatable(luaContext->lua, -2);
+		lua_getfield(lua, LUA_REGISTRYINDEX, "mSTTable");
+		lua_setmetatable(lua, -2);
 		break;
 	case mSCRIPT_TYPE_FUNCTION:
-		newValue = lua_newuserdata(luaContext->lua, sizeof(*newValue));
+		newValue = lua_newuserdata(lua, sizeof(*newValue));
 		newValue->type = value->type;
 		newValue->refs = mSCRIPT_VALUE_UNREF;
 		newValue->type->alloc(newValue);
-		lua_pushcclosure(luaContext->lua, _luaThunk, 1);
+		lua_pushcclosure(lua, _luaThunk, 1);
 		break;
 	case mSCRIPT_TYPE_OBJECT:
 		if (!value->value.opaque) {
-			lua_pushnil(luaContext->lua);
+			lua_pushnil(lua);
 			break;
 		}
-		newValue = lua_newuserdata(luaContext->lua, sizeof(*newValue));
+		newValue = lua_newuserdata(lua, sizeof(*newValue));
 		if (needsWeakref) {
 			*newValue = mSCRIPT_MAKE(WEAKREF, weakref);
 		} else {
 			mScriptValueRef(value);
 			mScriptValueWrap(value, newValue);
 		}
-		lua_getfield(luaContext->lua, LUA_REGISTRYINDEX, "mSTStruct");
-		lua_setmetatable(luaContext->lua, -2);
+		lua_getfield(lua, LUA_REGISTRYINDEX, "mSTStruct");
+		lua_setmetatable(lua, -2);
 		break;
 	default:
 		ok = false;
@@ -1032,31 +1032,31 @@ const char* _luaGetError(struct mScriptEngineContext* context) {
 	return luaContext->lastError;
 }
 
-bool _luaPushFrame(struct mScriptEngineContextLua* luaContext, struct mScriptList* frame) {
+bool _luaPushFrame(struct mScriptEngineContextLua* luaContext, lua_State* lua, struct mScriptList* frame) {
 	bool ok = true;
 	if (frame) {
 		size_t i;
 		for (i = 0; i < mScriptListSize(frame); ++i) {
 			struct mScriptValue* value = mScriptListGetPointer(frame, i);
-			if (!_luaWrap(luaContext, value)) {
+			if (!_luaWrap(luaContext, lua, value)) {
 				ok = false;
 				break;
 			}
 		}
 	}
 	if (!ok) {
-		lua_pop(luaContext->lua, lua_gettop(luaContext->lua));
+		lua_pop(lua, lua_gettop(lua));
 	}
 	return ok;
 }
 
-bool _luaPopFrame(struct mScriptEngineContextLua* luaContext, struct mScriptList* frame) {
-	int count = lua_gettop(luaContext->lua);
+bool _luaPopFrame(struct mScriptEngineContextLua* luaContext, lua_State* lua, struct mScriptList* frame) {
+	int count = lua_gettop(lua);
 	bool ok = true;
 	if (frame) {
 		int i;
 		for (i = 0; i < count; ++i) {
-			struct mScriptValue* value = _luaCoerce(luaContext, true);
+			struct mScriptValue* value = _luaCoerce(luaContext, lua, true);
 			if (!value) {
 				ok = false;
 				break;
@@ -1068,7 +1068,7 @@ bool _luaPopFrame(struct mScriptEngineContextLua* luaContext, struct mScriptList
 			}
 		}
 		if (count > i) {
-			lua_pop(luaContext->lua, count - i);
+			lua_pop(lua, count - i);
 		}
 
 		if (ok) {
@@ -1127,7 +1127,7 @@ bool _luaInvoke(struct mScriptEngineContextLua* luaContext, struct mScriptFrame*
 		return false;
 	}
 
-	if (frame && !_luaPushFrame(luaContext, &frame->arguments)) {
+	if (frame && !_luaPushFrame(luaContext, luaContext->lua, &frame->arguments)) {
 		mScriptContextDeactivate(luaContext->d.context);
 		return false;
 	}
@@ -1151,7 +1151,7 @@ bool _luaInvoke(struct mScriptEngineContextLua* luaContext, struct mScriptFrame*
 		return false;
 	}
 
-	if (frame && !_luaPopFrame(luaContext, &frame->returnValues)) {
+	if (frame && !_luaPopFrame(luaContext, luaContext->lua, &frame->returnValues)) {
 		mScriptContextDrainPool(luaContext->d.context);
 		return false;
 	}
@@ -1184,10 +1184,6 @@ static struct mScriptEngineContextLua* _luaGetContext(lua_State* lua) {
 
 	struct mScriptEngineContextLua* luaContext = lua_touserdata(lua, -1);
 	lua_pop(lua, 1);
-	if (luaContext->lua != lua) {
-		lua_pushliteral(lua, "Function called from invalid context");
-		lua_error(lua);
-	}
 	return luaContext;
 }
 
@@ -1195,7 +1191,7 @@ int _luaThunk(lua_State* lua) {
 	struct mScriptEngineContextLua* luaContext = _luaGetContext(lua);
 	struct mScriptFrame frame;
 	mScriptFrameInit(&frame);
-	if (!_luaPopFrame(luaContext, &frame.arguments)) {
+	if (!_luaPopFrame(luaContext, lua, &frame.arguments)) {
 		_freeFrame(&frame.arguments);
 		mScriptContextDrainPool(luaContext->d.context);
 		mScriptFrameDeinit(&frame);
@@ -1212,7 +1208,7 @@ int _luaThunk(lua_State* lua) {
 		return lua_error(lua);
 	}
 
-	bool ok = _luaPushFrame(luaContext, &frame.returnValues);
+	bool ok = _luaPushFrame(luaContext, lua, &frame.returnValues);
 	mScriptContextDrainPool(luaContext->d.context);
 	mScriptFrameDeinit(&frame);
 	if (!ok) {
@@ -1220,7 +1216,7 @@ int _luaThunk(lua_State* lua) {
 		return lua_error(lua);
 	}
 
-	return lua_gettop(luaContext->lua);
+	return lua_gettop(lua);
 }
 
 int _luaGetObject(lua_State* lua) {
@@ -1251,7 +1247,7 @@ int _luaGetObject(lua_State* lua) {
 		return lua_error(lua);
 	}
 
-	if (!_luaWrap(luaContext, &val)) {
+	if (!_luaWrap(luaContext, lua, &val)) {
 		luaL_traceback(lua, lua, "Error translating value from runtime", 1);
 		return lua_error(lua);
 	}
@@ -1263,7 +1259,7 @@ int _luaSetObject(lua_State* lua) {
 	char key[MAX_KEY_SIZE];
 	const char* keyPtr = lua_tostring(lua, -2);
 	struct mScriptValue* obj = lua_touserdata(lua, -3);
-	struct mScriptValue* val = _luaCoerce(luaContext, true);
+	struct mScriptValue* val = _luaCoerce(luaContext, lua, true);
 
 	if (!keyPtr) {
 		lua_pop(lua, 2);
@@ -1312,12 +1308,12 @@ static int _luaGcObject(lua_State* lua) {
 int _luaGetTable(lua_State* lua) {
 	struct mScriptEngineContextLua* luaContext = _luaGetContext(lua);
 	char key[MAX_KEY_SIZE];
-	int type = lua_type(luaContext->lua, -1);
+	int type = lua_type(lua, -1);
 	const char* keyPtr = NULL;
 	int64_t intKey;
 	switch (type) {
 	case LUA_TNUMBER:
-		intKey = lua_tointeger(luaContext->lua, -1);
+		intKey = lua_tointeger(lua, -1);
 		break;
 	case LUA_TSTRING:
 		keyPtr = lua_tostring(lua, -1);
@@ -1355,7 +1351,7 @@ int _luaGetTable(lua_State* lua) {
 		return 0;
 	}
 
-	if (!_luaWrap(luaContext, val)) {
+	if (!_luaWrap(luaContext, lua, val)) {
 		luaL_traceback(lua, lua, "Error translating value from runtime", 1);
 		return lua_error(lua);
 	}
@@ -1378,7 +1374,7 @@ int _luaLenTable(lua_State* lua) {
 
 	struct mScriptValue val = mSCRIPT_MAKE_U64(mScriptTableSize(obj));
 
-	if (!_luaWrap(luaContext, &val)) {
+	if (!_luaWrap(luaContext, lua, &val)) {
 		luaL_traceback(lua, lua, "Error translating value from runtime", 1);
 		return lua_error(lua);
 	}
@@ -1388,12 +1384,12 @@ int _luaLenTable(lua_State* lua) {
 static int _luaNextTable(lua_State* lua) {
 	struct mScriptEngineContextLua* luaContext = _luaGetContext(lua);
 	char key[MAX_KEY_SIZE];
-	int type = lua_type(luaContext->lua, -1);
+	int type = lua_type(lua, -1);
 	const char* keyPtr = NULL;
 	struct mScriptValue keyVal = {0};
 	switch (type) {
 	case LUA_TNUMBER:
-		keyVal = mSCRIPT_MAKE_S64(lua_tointeger(luaContext->lua, -1));
+		keyVal = mSCRIPT_MAKE_S64(lua_tointeger(lua, -1));
 		break;
 	case LUA_TSTRING:
 		keyPtr = lua_tostring(lua, -1);
@@ -1429,12 +1425,12 @@ static int _luaNextTable(lua_State* lua) {
 		}
 	}
 
-	if (!_luaWrap(luaContext, mScriptTableIteratorGetKey(table, &iter))) {
+	if (!_luaWrap(luaContext, lua, mScriptTableIteratorGetKey(table, &iter))) {
 		luaL_traceback(lua, lua, "Iteration error", 1);
 		return lua_error(lua);
 	}
 
-	if (!_luaWrap(luaContext, mScriptTableIteratorGetValue(table, &iter))) {
+	if (!_luaWrap(luaContext, lua, mScriptTableIteratorGetValue(table, &iter))) {
 		luaL_traceback(lua, lua, "Iteration error", 1);
 		return lua_error(lua);
 	}
@@ -1453,9 +1449,9 @@ int _luaGetList(lua_State* lua) {
 	struct mScriptEngineContextLua* luaContext = _luaGetContext(lua);
 	ssize_t index;
 #if LUA_VERSION_NUM >= 503
-	index = lua_tointeger(luaContext->lua, -1);
+	index = lua_tointeger(lua, -1);
 #else
-	index = lua_tonumber(luaContext->lua, -1);
+	index = lua_tonumber(lua, -1);
 #endif
 	struct mScriptValue* obj = lua_touserdata(lua, -2);
 	lua_pop(lua, 2);
@@ -1481,7 +1477,7 @@ int _luaGetList(lua_State* lua) {
 	--index;
 
 	struct mScriptValue* val = mScriptListGetPointer(list, index);
-	if (!_luaWrap(luaContext, val)) {
+	if (!_luaWrap(luaContext, lua, val)) {
 		luaL_traceback(lua, lua, "Error translating value from runtime", 1);
 		return lua_error(lua);
 	}
@@ -1509,21 +1505,21 @@ static int _luaLenList(lua_State* lua) {
 static int _luaRequireShim(lua_State* lua) {
 	struct mScriptEngineContextLua* luaContext = _luaGetContext(lua);
 
-	int oldtop = lua_gettop(luaContext->lua);
+	int oldtop = lua_gettop(lua);
 	const char* path = lua_tostring(lua, lua_upvalueindex(1));
 
-	lua_getglobal(luaContext->lua, "package");
+	lua_getglobal(lua, "package");
 
-	lua_pushliteral(luaContext->lua, "path");
-	lua_pushstring(luaContext->lua, path);
-	lua_pushliteral(luaContext->lua, "/?.lua;");
-	lua_pushstring(luaContext->lua, path);
-	lua_pushliteral(luaContext->lua, "/?/init.lua;");
-	lua_pushliteral(luaContext->lua, "path");
-	lua_gettable(luaContext->lua, -7);
-	char* oldpath = strdup(lua_tostring(luaContext->lua, -1));
-	lua_concat(luaContext->lua, 5);
-	lua_settable(luaContext->lua, -3);
+	lua_pushliteral(lua, "path");
+	lua_pushstring(lua, path);
+	lua_pushliteral(lua, "/?.lua;");
+	lua_pushstring(lua, path);
+	lua_pushliteral(lua, "/?/init.lua;");
+	lua_pushliteral(lua, "path");
+	lua_gettable(lua, -7);
+	char* oldpath = strdup(lua_tostring(lua, -1));
+	lua_concat(lua, 5);
+	lua_settable(lua, -3);
 
 #ifdef _WIN32
 #define DLL "dll"
@@ -1532,42 +1528,42 @@ static int _luaRequireShim(lua_State* lua) {
 #else
 #define DLL "so"
 #endif
-	lua_pushliteral(luaContext->lua, "cpath");
-	lua_pushstring(luaContext->lua, path);
-	lua_pushliteral(luaContext->lua, "/?." DLL ";");
-	lua_pushstring(luaContext->lua, path);
-	lua_pushliteral(luaContext->lua, "/?/init." DLL ";");
-	lua_pushliteral(luaContext->lua, "cpath");
-	lua_gettable(luaContext->lua, -7);
-	char* oldcpath = strdup(lua_tostring(luaContext->lua, -1));
-	lua_concat(luaContext->lua, 5);
-	lua_settable(luaContext->lua, -3);
+	lua_pushliteral(lua, "cpath");
+	lua_pushstring(lua, path);
+	lua_pushliteral(lua, "/?." DLL ";");
+	lua_pushstring(lua, path);
+	lua_pushliteral(lua, "/?/init." DLL ";");
+	lua_pushliteral(lua, "cpath");
+	lua_gettable(lua, -7);
+	char* oldcpath = strdup(lua_tostring(lua, -1));
+	lua_concat(lua, 5);
+	lua_settable(lua, -3);
 
-	lua_pop(luaContext->lua, 1);
+	lua_pop(lua, 1);
 
-	lua_rawgeti(luaContext->lua, LUA_REGISTRYINDEX, luaContext->require);
-	lua_insert(luaContext->lua, -2);
-	int ret = lua_pcall(luaContext->lua, 1, LUA_MULTRET, 0);
+	lua_rawgeti(lua, LUA_REGISTRYINDEX, luaContext->require);
+	lua_insert(lua, -2);
+	int ret = lua_pcall(lua, 1, LUA_MULTRET, 0);
 
-	lua_getglobal(luaContext->lua, "package");
+	lua_getglobal(lua, "package");
 
-	lua_pushliteral(luaContext->lua, "path");
-	lua_pushstring(luaContext->lua, oldpath);
-	lua_settable(luaContext->lua, -3);
+	lua_pushliteral(lua, "path");
+	lua_pushstring(lua, oldpath);
+	lua_settable(lua, -3);
 
-	lua_pushliteral(luaContext->lua, "cpath");
-	lua_pushstring(luaContext->lua, oldcpath);
-	lua_settable(luaContext->lua, -3);
+	lua_pushliteral(lua, "cpath");
+	lua_pushstring(lua, oldcpath);
+	lua_settable(lua, -3);
 
-	lua_pop(luaContext->lua, 1);
+	lua_pop(lua, 1);
 
 	free(oldpath);
 	free(oldcpath);
 	if (ret) {
-		return lua_error(luaContext->lua);
+		return lua_error(lua);
 	}
 
-	int newtop = lua_gettop(luaContext->lua);
+	int newtop = lua_gettop(lua);
 	return newtop - oldtop + 1;
 }
 

From 3e0d0e67a099694d21b9b96f36eb07aa5db44ec0 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Tue, 2 Apr 2024 22:53:02 -0700
Subject: [PATCH 32/53] Scripting: Add overloads, overload isKeyActive

---
 include/mgba/script/macros.h | 84 +++++++++++++++++++++++++++++++-----
 include/mgba/script/types.h  | 10 ++++-
 src/script/context.c         |  2 +-
 src/script/input.c           | 45 ++++++++-----------
 src/script/test/classes.c    | 67 +++++++++++++++++++++++++++-
 src/script/test/input.c      | 38 ++++++++++++++++
 src/script/test/types.c      | 12 +++---
 src/script/types.c           | 46 +++++++++++++++-----
 src/tools/docgen.c           |  8 ++++
 9 files changed, 256 insertions(+), 56 deletions(-)

diff --git a/include/mgba/script/macros.h b/include/mgba/script/macros.h
index 4acf7591a..7d2057d4e 100644
--- a/include/mgba/script/macros.h
+++ b/include/mgba/script/macros.h
@@ -254,7 +254,7 @@ CXX_GUARD_START
 		return false; \
 	}
 
-#define _mSCRIPT_DECLARE_STRUCT_METHOD(TYPE, NAME, S, NRET, RETURN, NPARAMS, DEFAULTS, ...) \
+#define _mSCRIPT_DECLARE_STRUCT_METHOD_HEAD(TYPE, NAME) \
 	static bool _mSTStructBinding_ ## TYPE ## _ ## NAME(struct mScriptFrame* frame, void* ctx); \
 	static const struct mScriptFunction _mSTStructBindingFunction_ ## TYPE ## _ ## NAME = { \
 		.call = &_mSTStructBinding_ ## TYPE ## _ ## NAME \
@@ -269,6 +269,9 @@ CXX_GUARD_START
 		.alloc = _mSTStructBindingAlloc_ ## TYPE ## _ ## NAME, \
 		.details = { \
 			.function = { \
+
+#define _mSCRIPT_DECLARE_STRUCT_METHOD(TYPE, NAME, S, NRET, RETURN, NPARAMS, DEFAULTS, ...) \
+		_mSCRIPT_DECLARE_STRUCT_METHOD_HEAD(TYPE, NAME) \
 				.parameters = { \
 					.count = _mSUCC_ ## NPARAMS, \
 					.entries = { mSCRIPT_TYPE_MS_ ## S(TYPE), _mCALL(mSCRIPT_PREFIX_ ## NPARAMS, mSCRIPT_TYPE_MS_, _mEVEN_ ## NPARAMS(__VA_ARGS__)) }, \
@@ -283,6 +286,23 @@ CXX_GUARD_START
 		} \
 	};
 
+#define _mSCRIPT_DECLARE_STRUCT_OVERLOADED_METHOD(TYPE, NAME, S, NRET, RETURN) \
+	_mSCRIPT_DECLARE_STRUCT_METHOD_HEAD(TYPE, NAME) \
+				.parameters = { \
+					.count = 1, \
+					.entries = { mSCRIPT_TYPE_MS_ ## S(TYPE) }, \
+					.names = { "this" }, \
+					.defaults = NULL, \
+					.variable = true, \
+				}, \
+				.returnType = { \
+					.count = NRET, \
+					.entries = { RETURN } \
+				}, \
+			}, \
+		} \
+	};
+
 #define _mSCRIPT_DECLARE_STRUCT_METHOD_SIGNATURE(TYPE, RETURN, NAME, CONST, NPARAMS, ...) \
 	typedef RETURN (*_mSTStructFunctionType_ ## TYPE ## _ ## NAME)(_mCOMMA_ ## NPARAMS(CONST struct TYPE* , mSCRIPT_PREFIX_ ## NPARAMS(mSCRIPT_TYPE_C_, __VA_ARGS__)))
 
@@ -302,6 +322,20 @@ CXX_GUARD_START
 		return true; \
 	} \
 
+#define _mSCRIPT_DECLARE_STRUCT_OVERLOADED_METHOD_BINDING(TYPE, NAME, T) \
+	static const struct mScriptFunctionOverload _mSTStructBindingOverloads_ ## TYPE ## _ ## NAME[]; \
+	static bool _mSTStructBinding_ ## TYPE ## _ ## NAME(struct mScriptFrame* frame, void* ctx) { \
+		UNUSED(ctx); \
+		const struct mScriptFunctionOverload* overload = mScriptFunctionFindOverload(_mSTStructBindingOverloads_ ## TYPE ## _ ## NAME, &frame->arguments); \
+		if (!overload) { \
+			return false; \
+		} \
+		if (!mScriptCoerceFrame(&overload->type->details.function.parameters, &frame->arguments, &frame->arguments)) { \
+			return false; \
+		} \
+		return overload->function->call(frame, overload->function->context); \
+	}
+
 #define mSCRIPT_DECLARE_STRUCT_METHOD(TYPE, RETURN, NAME, FUNCTION, NPARAMS, ...) \
 	_mSCRIPT_DECLARE_STRUCT_METHOD_SIGNATURE(TYPE, mSCRIPT_TYPE_C_ ## RETURN, NAME, , NPARAMS, _mEVEN_ ## NPARAMS(__VA_ARGS__)); \
 	_mSCRIPT_DECLARE_STRUCT_METHOD(TYPE, NAME, S, 1, mSCRIPT_TYPE_MS_ ## RETURN, NPARAMS, NULL, __VA_ARGS__) \
@@ -346,6 +380,22 @@ CXX_GUARD_START
 	_mSCRIPT_DECLARE_STRUCT_METHOD(TYPE, NAME, CS, 0, 0, NPARAMS, _mIDENT(_mSTStructBindingDefaults_ ## TYPE ## _ ## NAME, __VA_ARGS__) \
 	_mSCRIPT_DECLARE_STRUCT_VOID_METHOD_BINDING(TYPE, NAME, FUNCTION, CS, NPARAMS, __VA_ARGS__)
 
+#define mSCRIPT_DECLARE_STRUCT_OVERLOADED_METHOD(TYPE, RETURN, NAME) \
+	_mSCRIPT_DECLARE_STRUCT_OVERLOADED_METHOD(TYPE, NAME, S, 1, mSCRIPT_TYPE_MS_ ## RETURN) \
+	_mSCRIPT_DECLARE_STRUCT_OVERLOADED_METHOD_BINDING(TYPE, NAME, S)
+
+#define mSCRIPT_DECLARE_STRUCT_OVERLOADED_VOID_METHOD(TYPE, NAME) \
+	_mSCRIPT_DECLARE_STRUCT_OVERLOADED_METHOD(TYPE, NAME, S, 0, 0) \
+	_mSCRIPT_DECLARE_STRUCT_OVERLOADED_METHOD_BINDING(TYPE, NAME, S)
+
+#define mSCRIPT_DECLARE_STRUCT_OVERLOADED_C_METHOD(TYPE, RETURN, NAME) \
+	_mSCRIPT_DECLARE_STRUCT_OVERLOADED_METHOD(TYPE, NAME, CS, 1, mSCRIPT_TYPE_MS_ ## RETURN) \
+	_mSCRIPT_DECLARE_STRUCT_OVERLOADED_METHOD_BINDING(TYPE, NAME, CS)
+
+#define mSCRIPT_DECLARE_STRUCT_OVERLOADED_VOID_C_METHOD(TYPE, NAME) \
+	_mSCRIPT_DECLARE_STRUCT_OVERLOADED_METHOD(TYPE, NAME, CS, 0, 0) \
+	_mSCRIPT_DECLARE_STRUCT_OVERLOADED_METHOD_BINDING(TYPE, NAME, CS)
+
 #define mSCRIPT_DECLARE_STRUCT_D_METHOD(TYPE, RETURN, NAME, NPARAMS, ...) \
 	mSCRIPT_DECLARE_STRUCT_METHOD(TYPE, RETURN, NAME, p0->NAME, NPARAMS, __VA_ARGS__)
 
@@ -417,27 +467,39 @@ CXX_GUARD_START
 
 #define mSCRIPT_DEFINE_DEFAULTS_END }
 
-#define _mSCRIPT_DEFINE_STRUCT_BINDING(INIT_TYPE, TYPE, EXPORTED_NAME, NAME) { \
+#define mSCRIPT_DEFINE_STRUCT_METHOD_OVERLOADS(STRUCT, METHOD) \
+	static const struct mScriptFunctionOverload _mSTStructBindingOverloads_ ## STRUCT ## _ ## METHOD[] = { \
+
+#define mSCRIPT_DEFINE_STRUCT_METHOD_OVERLOAD(TYPE, FUNCTION) { \
+	.type = &_mSTStructBindingType_ ## TYPE ## _ ## FUNCTION, \
+	.function = &_mSTStructBindingFunction_ ## TYPE ## _ ## FUNCTION \
+},
+
+#define mSCRIPT_DEFINE_OVERLOADS_END { NULL, NULL } }
+
+#define _mSCRIPT_DEFINE_STRUCT_BINDING(INIT_TYPE, TYPE, EXPORTED_NAME, NAME, OVERLOADS) { \
 	.type = mSCRIPT_CLASS_INIT_ ## INIT_TYPE, \
 	.info = { \
 		.member = { \
 			.name = #EXPORTED_NAME, \
-			.type = &_mSTStructBindingType_ ## TYPE ## _ ## NAME \
+			.type = &_mSTStructBindingType_ ## TYPE ## _ ## NAME, \
+			.overloads = OVERLOADS, \
 		} \
 	}, \
 },
 
 #define mSCRIPT_DEFINE_STRUCT_METHOD_NAMED(TYPE, EXPORTED_NAME, NAME) \
-	_mSCRIPT_DEFINE_STRUCT_BINDING(INSTANCE_MEMBER, TYPE, EXPORTED_NAME, NAME)
+	_mSCRIPT_DEFINE_STRUCT_BINDING(INSTANCE_MEMBER, TYPE, EXPORTED_NAME, NAME, NULL)
 
 #define mSCRIPT_DEFINE_STRUCT_METHOD(TYPE, NAME) mSCRIPT_DEFINE_STRUCT_METHOD_NAMED(TYPE, NAME, NAME)
-
-#define mSCRIPT_DEFINE_STRUCT_INIT(TYPE) _mSCRIPT_DEFINE_STRUCT_BINDING(INIT, TYPE, _init, _init)
-#define mSCRIPT_DEFINE_STRUCT_INIT_NAMED(TYPE, NAME) _mSCRIPT_DEFINE_STRUCT_BINDING(INIT, TYPE, _init, NAME)
-#define mSCRIPT_DEFINE_STRUCT_DEINIT(TYPE) _mSCRIPT_DEFINE_STRUCT_BINDING(DEINIT, TYPE, _deinit, _deinit)
-#define mSCRIPT_DEFINE_STRUCT_DEINIT_NAMED(TYPE, NAME) _mSCRIPT_DEFINE_STRUCT_BINDING(DEINIT, TYPE, _deinit, NAME)
-#define mSCRIPT_DEFINE_STRUCT_DEFAULT_GET(TYPE) _mSCRIPT_DEFINE_STRUCT_BINDING(GET, TYPE, _get, _get)
-#define mSCRIPT_DEFINE_STRUCT_DEFAULT_SET(TYPE, SETTER) _mSCRIPT_DEFINE_STRUCT_BINDING(SET, TYPE, SETTER, SETTER)
+#define mSCRIPT_DEFINE_STRUCT_OVERLOADED_METHOD(TYPE, NAME) _mSCRIPT_DEFINE_STRUCT_BINDING(INSTANCE_MEMBER, TYPE, NAME, NAME, _mSTStructBindingOverloads_ ## TYPE ## _ ## NAME)
+
+#define mSCRIPT_DEFINE_STRUCT_INIT(TYPE) _mSCRIPT_DEFINE_STRUCT_BINDING(INIT, TYPE, _init, _init, NULL)
+#define mSCRIPT_DEFINE_STRUCT_INIT_NAMED(TYPE, NAME) _mSCRIPT_DEFINE_STRUCT_BINDING(INIT, TYPE, _init, NAME, NULL)
+#define mSCRIPT_DEFINE_STRUCT_DEINIT(TYPE) _mSCRIPT_DEFINE_STRUCT_BINDING(DEINIT, TYPE, _deinit, _deinit, NULL)
+#define mSCRIPT_DEFINE_STRUCT_DEINIT_NAMED(TYPE, NAME) _mSCRIPT_DEFINE_STRUCT_BINDING(DEINIT, TYPE, _deinit, NAME, NULL)
+#define mSCRIPT_DEFINE_STRUCT_DEFAULT_GET(TYPE) _mSCRIPT_DEFINE_STRUCT_BINDING(GET, TYPE, _get, _get, NULL)
+#define mSCRIPT_DEFINE_STRUCT_DEFAULT_SET(TYPE, SETTER) _mSCRIPT_DEFINE_STRUCT_BINDING(SET, TYPE, SETTER, SETTER, NULL)
 
 #define mSCRIPT_DEFINE_DOC_STRUCT_METHOD(SCOPE, TYPE, NAME) mSCRIPT_DEFINE_STRUCT_METHOD_NAMED(doc_ ## TYPE, NAME, NAME)
 
diff --git a/include/mgba/script/types.h b/include/mgba/script/types.h
index 1475f1a6e..5770456e6 100644
--- a/include/mgba/script/types.h
+++ b/include/mgba/script/types.h
@@ -259,6 +259,7 @@ struct mScriptClassMember {
 	const char* name;
 	const char* docstring;
 	const struct mScriptType* type;
+	const struct mScriptFunctionOverload* overloads;
 	size_t offset;
 	bool readonly;
 };
@@ -275,6 +276,7 @@ struct mScriptClassInitDetails {
 		const struct mScriptType* parent;
 		struct mScriptClassMember member;
 		struct mScriptClassCastMember castMember;
+		const struct mScriptFunctionOverload* overload;
 	} info;
 };
 
@@ -332,6 +334,11 @@ struct mScriptFunction {
 	void* context;
 };
 
+struct mScriptFunctionOverload {
+	const struct mScriptType* type;
+	const struct mScriptFunction* function;
+};
+
 struct mScriptValue* mScriptValueAlloc(const struct mScriptType* type);
 void mScriptValueRef(struct mScriptValue* val);
 void mScriptValueDeref(struct mScriptValue* val);
@@ -385,7 +392,8 @@ bool mScriptPopBool(struct mScriptList* list, bool* out);
 bool mScriptPopPointer(struct mScriptList* list, void** out);
 
 bool mScriptCast(const struct mScriptType* type, const struct mScriptValue* input, struct mScriptValue* output);
-bool mScriptCoerceFrame(const struct mScriptTypeTuple* types, struct mScriptList* frame);
+bool mScriptCoerceFrame(const struct mScriptTypeTuple* types, const struct mScriptList* input, struct mScriptList* output);
+const struct mScriptFunctionOverload* mScriptFunctionFindOverload(const struct mScriptFunctionOverload* overloads, struct mScriptList* frame);
 
 CXX_GUARD_END
 
diff --git a/src/script/context.c b/src/script/context.c
index 090daf66d..47a4460f6 100644
--- a/src/script/context.c
+++ b/src/script/context.c
@@ -481,7 +481,7 @@ bool mScriptInvoke(const struct mScriptValue* val, struct mScriptFrame* frame) {
 		return false;
 	}
 	const struct mScriptTypeFunction* signature = &val->type->details.function;
-	if (!mScriptCoerceFrame(&signature->parameters, &frame->arguments)) {
+	if (!mScriptCoerceFrame(&signature->parameters, &frame->arguments, &frame->arguments)) {
 		return false;
 	}
 	const struct mScriptFunction* fn = val->value.opaque;
diff --git a/src/script/input.c b/src/script/input.c
index c103fa82c..1cb9f488b 100644
--- a/src/script/input.c
+++ b/src/script/input.c
@@ -35,20 +35,28 @@ struct mScriptInputContext {
 };
 
 static void _mScriptInputDeinit(struct mScriptInputContext*);
-static bool _mScriptInputIsKeyActive(const struct mScriptInputContext*, struct mScriptValue*);
+static bool _mScriptInputIsKeyActiveStr(const struct mScriptInputContext*, const char*);
+static bool _mScriptInputIsKeyActiveNum(const struct mScriptInputContext*, uint32_t);
 static struct mScriptValue* _mScriptInputActiveKeys(const struct mScriptInputContext*);
 
 mSCRIPT_DECLARE_STRUCT(mScriptInputContext);
 mSCRIPT_DECLARE_STRUCT_VOID_METHOD(mScriptInputContext, _deinit, _mScriptInputDeinit, 0);
-mSCRIPT_DECLARE_STRUCT_C_METHOD(mScriptInputContext, BOOL, isKeyActive, _mScriptInputIsKeyActive, 1, WRAPPER, key);
+mSCRIPT_DECLARE_STRUCT_C_METHOD(mScriptInputContext, BOOL, isKeyActiveStr, _mScriptInputIsKeyActiveStr, 1, CHARP, key);
+mSCRIPT_DECLARE_STRUCT_C_METHOD(mScriptInputContext, BOOL, isKeyActiveNum, _mScriptInputIsKeyActiveNum, 1, U32, key);
+mSCRIPT_DECLARE_STRUCT_OVERLOADED_C_METHOD(mScriptInputContext, BOOL, isKeyActive);
 mSCRIPT_DECLARE_STRUCT_C_METHOD(mScriptInputContext, WLIST, activeKeys, _mScriptInputActiveKeys, 0);
 
+mSCRIPT_DEFINE_STRUCT_METHOD_OVERLOADS(mScriptInputContext, isKeyActive)
+	mSCRIPT_DEFINE_STRUCT_METHOD_OVERLOAD(mScriptInputContext, isKeyActiveStr)
+	mSCRIPT_DEFINE_STRUCT_METHOD_OVERLOAD(mScriptInputContext, isKeyActiveNum)
+mSCRIPT_DEFINE_OVERLOADS_END;
+
 mSCRIPT_DEFINE_STRUCT(mScriptInputContext)
 	mSCRIPT_DEFINE_STRUCT_DEINIT(mScriptInputContext)
 	mSCRIPT_DEFINE_DOCSTRING("Sequence number of the next event to be emitted")
 	mSCRIPT_DEFINE_STRUCT_MEMBER(mScriptInputContext, U64, seq)
 	mSCRIPT_DEFINE_DOCSTRING("Check if a given keyboard key is currently held. The input can be either the printable character for a key, the numerical Unicode codepoint, or a special value from C.KEY")
-	mSCRIPT_DEFINE_STRUCT_METHOD(mScriptInputContext, isKeyActive)
+	mSCRIPT_DEFINE_STRUCT_OVERLOADED_METHOD(mScriptInputContext, isKeyActive)
 	mSCRIPT_DEFINE_DOCSTRING("Get a list of the currently active keys. The values are Unicode codepoints or special key values from C.KEY, not strings, so make sure to convert as needed")
 	mSCRIPT_DEFINE_STRUCT_METHOD(mScriptInputContext, activeKeys)
 	mSCRIPT_DEFINE_DOCSTRING("The currently active gamepad, if any")
@@ -319,33 +327,18 @@ void _mScriptInputDeinit(struct mScriptInputContext* context) {
 	TableDeinit(&context->activeKeys);
 }
 
-bool _mScriptInputIsKeyActive(const struct mScriptInputContext* context, struct mScriptValue* value) {
+bool _mScriptInputIsKeyActiveStr(const struct mScriptInputContext* context, const char* value) {
 	uint32_t key;
-	struct mScriptValue intValue;
-	size_t length;
-	const char* strbuf;
-
-	switch (value->type->base) {
-	case mSCRIPT_TYPE_SINT:
-	case mSCRIPT_TYPE_UINT:
-	case mSCRIPT_TYPE_FLOAT:
-		if (!mScriptCast(mSCRIPT_TYPE_MS_U32, value, &intValue)) {
-			return false;
-		}
-		key = intValue.value.u32;
-		break;
-	case mSCRIPT_TYPE_STRING:
-		if (value->value.string->length > 1) {
-			return false;
-		}
-		strbuf = value->value.string->buffer;
-		length = value->value.string->size;
-		key = utf8Char(&strbuf, &length);
-		break;
-	default:
+	size_t length = strlen(value);
+	key = utf8Char(&value, &length);
+	if (length > 0) {
 		return false;
 	}
+	void* down = TableLookup(&context->activeKeys, key);
+	return down != NULL;
+}
 
+bool _mScriptInputIsKeyActiveNum(const struct mScriptInputContext* context, uint32_t key) {
 	void* down = TableLookup(&context->activeKeys, key);
 	return down != NULL;
 }
diff --git a/src/script/test/classes.c b/src/script/test/classes.c
index f7c5eb128..e0ce39d47 100644
--- a/src/script/test/classes.c
+++ b/src/script/test/classes.c
@@ -57,6 +57,11 @@ struct TestH {
 	int32_t j;
 };
 
+struct TestI {
+	uint32_t num;
+	const char* str;
+};
+
 static int32_t testAi0(struct TestA* a) {
 	return a->i;
 }
@@ -114,6 +119,14 @@ static void testSetC(struct TestG* g, const char* name, const char* val) {
 	g->c = val;
 }
 
+static void callNum(struct TestI* i, uint32_t num) {
+	i->num = num;
+}
+
+static void callStr(struct TestI* i, const char* str) {
+	i->str = str;
+}
+
 #define MEMBER_A_DOCSTRING "Member a"
 
 mSCRIPT_DECLARE_STRUCT(TestA);
@@ -201,12 +214,25 @@ mSCRIPT_DEFINE_STRUCT(TestG)
 	mSCRIPT_DEFINE_STRUCT_DEFAULT_SET(TestG, setC)
 mSCRIPT_DEFINE_END;
 
-
 mSCRIPT_DEFINE_STRUCT(TestH)
 	mSCRIPT_DEFINE_STRUCT_MEMBER(TestH, S32, i)
 	mSCRIPT_DEFINE_STRUCT_CONST_MEMBER(TestH, S32, j)
 mSCRIPT_DEFINE_END;
 
+mSCRIPT_DECLARE_STRUCT(TestI);
+mSCRIPT_DECLARE_STRUCT_VOID_METHOD(TestI, callStr, callStr, 1, CHARP, value);
+mSCRIPT_DECLARE_STRUCT_VOID_METHOD(TestI, callNum, callNum, 1, U32, value);
+mSCRIPT_DECLARE_STRUCT_OVERLOADED_VOID_METHOD(TestI, call);
+
+mSCRIPT_DEFINE_STRUCT_METHOD_OVERLOADS(TestI, call)
+	mSCRIPT_DEFINE_STRUCT_METHOD_OVERLOAD(TestI, callStr)
+	mSCRIPT_DEFINE_STRUCT_METHOD_OVERLOAD(TestI, callNum)
+mSCRIPT_DEFINE_OVERLOADS_END;
+
+mSCRIPT_DEFINE_STRUCT(TestI)
+	mSCRIPT_DEFINE_STRUCT_OVERLOADED_METHOD(TestI, call)
+mSCRIPT_DEFINE_END;
+
 M_TEST_DEFINE(testALayout) {
 	struct mScriptTypeClass* cls = mSCRIPT_TYPE_MS_S(TestA)->details.cls;
 	assert_false(cls->init);
@@ -1184,6 +1210,44 @@ M_TEST_DEFINE(testHSet) {
 	assert_false(cls->init);
 }
 
+M_TEST_DEFINE(testOverloadsBasic) {
+	struct mScriptTypeClass* cls = mSCRIPT_TYPE_MS_S(TestI)->details.cls;
+	assert_false(cls->init);
+	mScriptClassInit(cls);
+	assert_true(cls->init);
+
+	struct TestI s = {
+		.num = 0,
+		.str = NULL,
+	};
+
+	struct mScriptValue sval = mSCRIPT_MAKE_S(TestI, &s);
+	struct mScriptValue fn;
+	struct mScriptFrame frame;
+
+	assert_true(mScriptObjectGet(&sval, "call", &fn));
+
+	mScriptFrameInit(&frame);
+	mSCRIPT_PUSH(&frame.arguments, S(TestI), &s);
+	mSCRIPT_PUSH(&frame.arguments, U32, 1);
+	assert_true(mScriptInvoke(&fn, &frame));
+	mScriptFrameDeinit(&frame);
+	assert_int_equal(s.num, 1);
+	assert_null(s.str);
+
+	mScriptFrameInit(&frame);
+	mSCRIPT_PUSH(&frame.arguments, S(TestI), &s);
+	mSCRIPT_PUSH(&frame.arguments, CHARP, "called");
+	assert_true(mScriptInvoke(&fn, &frame));
+	mScriptFrameDeinit(&frame);
+	assert_int_equal(s.num, 1);
+	assert_string_equal(s.str, "called");
+
+	assert_true(cls->init);
+	mScriptClassDeinit(cls);
+	assert_false(cls->init);
+}
+
 M_TEST_SUITE_DEFINE(mScriptClasses,
 	cmocka_unit_test(testALayout),
 	cmocka_unit_test(testASignatures),
@@ -1201,4 +1265,5 @@ M_TEST_SUITE_DEFINE(mScriptClasses,
 	cmocka_unit_test(testFDeinit),
 	cmocka_unit_test(testGSet),
 	cmocka_unit_test(testHSet),
+	cmocka_unit_test(testOverloadsBasic),
 )
diff --git a/src/script/test/input.c b/src/script/test/input.c
index 4c689a6ef..641e1c6ab 100644
--- a/src/script/test/input.c
+++ b/src/script/test/input.c
@@ -172,6 +172,43 @@ M_TEST_DEFINE(clearKeys) {
 	mScriptContextDeinit(&context);
 }
 
+M_TEST_DEFINE(numericKeys) {
+	SETUP_LUA;
+
+	TEST_PROGRAM("assert(not input:isKeyActive(C.KEY.F1))");
+
+	TEST_PROGRAM(
+		"activeKey = false\n"
+		"state = nil\n"
+		"function cb(ev)\n"
+		"	assert(ev.type == C.EV_TYPE.KEY)\n"
+		"	activeKey = ev.key\n"
+		"	state = ev.state\n"
+		"end\n"
+		"id = callbacks:add('key', cb)\n"
+		"assert(id)\n"
+		"assert(not activeKey)\n"
+	);
+
+	struct mScriptKeyEvent keyEvent = {
+		.d = { .type = mSCRIPT_EV_TYPE_KEY },
+		.state = mSCRIPT_INPUT_STATE_DOWN,
+		.key = mSCRIPT_KEY_F1
+	};
+	mScriptContextFireEvent(&context, &keyEvent.d);
+
+	TEST_PROGRAM("assert(input:isKeyActive(C.KEY.F1))");
+	TEST_PROGRAM("assert(activeKey == C.KEY.F1)");
+	TEST_PROGRAM("assert(state == C.INPUT_STATE.DOWN)");
+
+	keyEvent.state = mSCRIPT_INPUT_STATE_UP;
+	mScriptContextFireEvent(&context, &keyEvent.d);
+
+	TEST_PROGRAM("assert(not input:isKeyActive(C.KEY.F1))");
+	TEST_PROGRAM("assert(state == C.INPUT_STATE.UP)");
+
+	mScriptContextDeinit(&context);
+}
 
 M_TEST_DEFINE(gamepadExport) {
 	SETUP_LUA;
@@ -219,5 +256,6 @@ M_TEST_SUITE_DEFINE_SETUP_TEARDOWN(mScriptInput,
 	cmocka_unit_test(fireKey),
 	cmocka_unit_test(activeKeys),
 	cmocka_unit_test(clearKeys),
+	cmocka_unit_test(numericKeys),
 	cmocka_unit_test(gamepadExport),
 )
diff --git a/src/script/test/types.c b/src/script/test/types.c
index 5c66b3f76..67b6fba9a 100644
--- a/src/script/test/types.c
+++ b/src/script/test/types.c
@@ -372,25 +372,25 @@ M_TEST_DEFINE(wrongConst) {
 	mScriptFrameInit(&frame);
 	mSCRIPT_PUSH(&frame.arguments, S(Test), &a);
 	signature.entries[0] = mSCRIPT_TYPE_MS_S(Test);
-	assert_true(mScriptCoerceFrame(&signature, &frame.arguments));
+	assert_true(mScriptCoerceFrame(&signature, &frame.arguments, &frame.arguments));
 	mScriptFrameDeinit(&frame);
 
 	mScriptFrameInit(&frame);
 	mSCRIPT_PUSH(&frame.arguments, CS(Test), &a);
 	signature.entries[0] = mSCRIPT_TYPE_MS_CS(Test);
-	assert_true(mScriptCoerceFrame(&signature, &frame.arguments));
+	assert_true(mScriptCoerceFrame(&signature, &frame.arguments, &frame.arguments));
 	mScriptFrameDeinit(&frame);
 
 	mScriptFrameInit(&frame);
 	mSCRIPT_PUSH(&frame.arguments, S(Test), &a);
 	signature.entries[0] = mSCRIPT_TYPE_MS_CS(Test);
-	assert_true(mScriptCoerceFrame(&signature, &frame.arguments));
+	assert_true(mScriptCoerceFrame(&signature, &frame.arguments, &frame.arguments));
 	mScriptFrameDeinit(&frame);
 
 	mScriptFrameInit(&frame);
 	mSCRIPT_PUSH(&frame.arguments, CS(Test), &a);
 	signature.entries[0] = mSCRIPT_TYPE_MS_S(Test);
-	assert_false(mScriptCoerceFrame(&signature, &frame.arguments));
+	assert_false(mScriptCoerceFrame(&signature, &frame.arguments, &frame.arguments));
 	mScriptFrameDeinit(&frame);
 
 	mScriptFrameInit(&frame);
@@ -402,7 +402,7 @@ M_TEST_DEFINE(wrongConst) {
 	mSCRIPT_PUSH(&frame.arguments, S(Test), &a);
 	assert_false(mScriptPopCSTest(&frame.arguments, &cb));
 	signature.entries[0] = mSCRIPT_TYPE_MS_CS(Test);
-	assert_true(mScriptCoerceFrame(&signature, &frame.arguments));
+	assert_true(mScriptCoerceFrame(&signature, &frame.arguments, &frame.arguments));
 	assert_true(mScriptPopCSTest(&frame.arguments, &cb));
 	mScriptFrameDeinit(&frame);
 
@@ -410,7 +410,7 @@ M_TEST_DEFINE(wrongConst) {
 	mSCRIPT_PUSH(&frame.arguments, CS(Test), &a);
 	assert_false(mScriptPopSTest(&frame.arguments, &b));
 	signature.entries[0] = mSCRIPT_TYPE_MS_S(Test);
-	assert_false(mScriptCoerceFrame(&signature, &frame.arguments));
+	assert_false(mScriptCoerceFrame(&signature, &frame.arguments, &frame.arguments));
 	assert_false(mScriptPopSTest(&frame.arguments, &b));
 	mScriptFrameDeinit(&frame);
 
diff --git a/src/script/types.c b/src/script/types.c
index 20f945839..d860d40c0 100644
--- a/src/script/types.c
+++ b/src/script/types.c
@@ -1238,6 +1238,9 @@ static void _mScriptClassInit(struct mScriptTypeClass* cls, const struct mScript
 				member->docstring = docstring;
 				docstring = NULL;
 			}
+			if (detail->info.member.type->base != mSCRIPT_TYPE_FUNCTION) {
+				abort();
+			}
 			if (detail->info.member.type->details.function.parameters.count != 3) {
 				abort();
 			}
@@ -1773,21 +1776,24 @@ bool mScriptCast(const struct mScriptType* type, const struct mScriptValue* inpu
 	return false;
 }
 
-bool mScriptCoerceFrame(const struct mScriptTypeTuple* types, struct mScriptList* frame) {
-	if (types->count < mScriptListSize(frame) && !types->variable) {
+bool mScriptCoerceFrame(const struct mScriptTypeTuple* types, const struct mScriptList* input, struct mScriptList* output) {
+	if (types->count < mScriptListSize(input) && !types->variable) {
 		return false;
 	}
-	if (types->count > mScriptListSize(frame) && !types->variable && !types->defaults) {
+	if (types->count > mScriptListSize(input) && !types->variable && !types->defaults) {
 		return false;
 	}
+	if (output) {
+		mScriptListResize(output, mScriptListSize(input) - mScriptListSize(output));
+	}
 	size_t i;
-	for (i = 0; i < mScriptListSize(frame) && i < types->count; ++i) {
-		if (types->entries[i] == mScriptListGetPointer(frame, i)->type) {
+	for (i = 0; i < mScriptListSize(input) && i < types->count; ++i) {
+		if (types->entries[i] == mScriptListGetConstPointer(input, i)->type) {
 			continue;
 		}
-		struct mScriptValue* unwrapped = NULL;
-		if (mScriptListGetPointer(frame, i)->type->base == mSCRIPT_TYPE_WRAPPER) {
-			unwrapped = mScriptValueUnwrap(mScriptListGetPointer(frame, i));
+		const struct mScriptValue* unwrapped = NULL;
+		if (mScriptListGetConstPointer(input, i)->type->base == mSCRIPT_TYPE_WRAPPER) {
+			unwrapped = mScriptValueUnwrapConst(mScriptListGetConstPointer(input, i));
 			if (types->entries[i]->base == mSCRIPT_TYPE_WRAPPER) {
 				if (types->entries[i]->details.type == unwrapped->type) {
 					continue;
@@ -1796,7 +1802,12 @@ bool mScriptCoerceFrame(const struct mScriptTypeTuple* types, struct mScriptList
 				continue;
 			}
 		}
-		if (!mScriptCast(types->entries[i], mScriptListGetPointer(frame, i), mScriptListGetPointer(frame, i))) {
+		struct mScriptValue fakeVal;
+		struct mScriptValue* castTo = &fakeVal;
+		if (output) {
+			castTo = mScriptListGetPointer(output, i);
+		}
+		if (!mScriptCast(types->entries[i], mScriptListGetConstPointer(input, i), castTo)) {
 			return false;
 		}
 	}
@@ -1808,11 +1819,26 @@ bool mScriptCoerceFrame(const struct mScriptTypeTuple* types, struct mScriptList
 		if (!types->defaults[i].type) {
 			return false;
 		}
-		memcpy(mScriptListAppend(frame), &types->defaults[i], sizeof(struct mScriptValue));
+		if (output) {
+			memcpy(mScriptListAppend(output), &types->defaults[i], sizeof(struct mScriptValue));
+		}
 	}
 	return true;
 }
 
+const struct mScriptFunctionOverload* mScriptFunctionFindOverload(const struct mScriptFunctionOverload* overloads, struct mScriptList* frame) {
+	size_t i;
+	for (i = 0; overloads[i].type; ++i) {
+		if (overloads[i].type->base != mSCRIPT_TYPE_FUNCTION) {
+			continue;
+		}
+		if (mScriptCoerceFrame(&overloads[i].type->details.function.parameters, frame, NULL)) {
+			return &overloads[i];
+		}
+	}
+	return NULL;
+}
+
 static void addTypesFromTuple(struct Table* types, const struct mScriptTypeTuple* tuple) {
 	size_t i;
 	for (i = 0; i < tuple->count; ++i) {
diff --git a/src/tools/docgen.c b/src/tools/docgen.c
index f57fb8d44..cdabb472c 100644
--- a/src/tools/docgen.c
+++ b/src/tools/docgen.c
@@ -190,6 +190,14 @@ void explainClass(struct mScriptTypeClass* cls, int level) {
 				fprintf(out, "%s    readonly: true\n", indent);
 			}
 			fprintf(out, "%s    type: %s\n", indent, details->info.member.type->name);
+			if (details->info.member.overloads) {
+				fprintf(out, "%s    overloads:\n", indent);
+				size_t i;
+				for (i = 0; details->info.member.overloads[i].type; ++i) {
+					mScriptTypeAdd(&types, details->info.member.overloads[i].type);
+					fprintf(out, "%s      - %s\n", indent, details->info.member.overloads[i].type->name);
+				}
+			}
 			break;
 		case mSCRIPT_CLASS_INIT_END:
 			break;

From 782f6c2b0cf316858aa8b7f6ace97b1072b85758 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Wed, 3 Apr 2024 02:55:59 -0700
Subject: [PATCH 33/53] Qt: Actually load defaults again

---
 src/platform/qt/InputController.cpp | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

diff --git a/src/platform/qt/InputController.cpp b/src/platform/qt/InputController.cpp
index d5e799b5a..3deca07f3 100644
--- a/src/platform/qt/InputController.cpp
+++ b/src/platform/qt/InputController.cpp
@@ -172,15 +172,16 @@ void InputController::setConfiguration(ConfigController* config) {
 }
 
 bool InputController::loadConfiguration(uint32_t type) {
-	if (!mInputMapLoad(&m_inputMap, type, m_config->input())) {
-		return false;
-	}
+	bool loaded = mInputMapLoad(&m_inputMap, type, m_config->input());
 	auto driver = m_inputDrivers.value(type);
 	if (!driver) {
 		return false;
 	}
+	if (!loaded) {
+		driver->bindDefaults(this);
+	}
 	driver->loadConfiguration(m_config);
-	return true;
+	return loaded;
 }
 
 bool InputController::loadProfile(uint32_t type, const QString& profile) {

From cab653904ed82df05ffc496efb2e612053a100d4 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Wed, 3 Apr 2024 02:56:29 -0700
Subject: [PATCH 34/53] SDL: Start actually using SDL_GameController for its
 intended purpose

---
 src/platform/qt/GBAKeyEditor.cpp       |  6 +-
 src/platform/qt/SettingsView.cpp       |  5 ++
 src/platform/qt/Window.cpp             |  5 ++
 src/platform/qt/input/SDLInputDriver.h |  4 ++
 src/platform/sdl/sdl-events.c          | 94 ++++++++++++++++++++------
 src/platform/sdl/sdl-events.h          |  1 +
 6 files changed, 93 insertions(+), 22 deletions(-)

diff --git a/src/platform/qt/GBAKeyEditor.cpp b/src/platform/qt/GBAKeyEditor.cpp
index 4536bda2a..2afb546ad 100644
--- a/src/platform/qt/GBAKeyEditor.cpp
+++ b/src/platform/qt/GBAKeyEditor.cpp
@@ -54,7 +54,7 @@ GBAKeyEditor::GBAKeyEditor(InputController* controller, int type, const QString&
 	refresh();
 
 #ifdef BUILD_SDL
-	if (type == SDL_BINDING_BUTTON) {
+	if (type == SDL_BINDING_BUTTON || type == SDL_BINDING_CONTROLLER) {
 		m_profileSelect = new QComboBox(this);
 		connect(m_profileSelect, static_cast<void(QComboBox::*)(int)>(&QComboBox::currentIndexChanged),
 		        this, &GBAKeyEditor::selectGamepad);
@@ -265,7 +265,7 @@ void GBAKeyEditor::refresh() {
 
 void GBAKeyEditor::lookupBinding(const mInputMap* map, KeyEditor* keyEditor, int key) {
 #ifdef BUILD_SDL
-	if (m_type == SDL_BINDING_BUTTON) {
+	if (m_type == SDL_BINDING_BUTTON || m_type == SDL_BINDING_CONTROLLER) {
 		int value = mInputQueryBinding(map, m_type, key);
 		keyEditor->setValueButton(value);
 		return;
@@ -329,7 +329,7 @@ void GBAKeyEditor::lookupHats(const mInputMap* map) {
 void GBAKeyEditor::bindKey(const KeyEditor* keyEditor, int key) {
 	InputMapper mapper = m_controller->mapper(m_type);
 #ifdef BUILD_SDL
-	if (m_type == SDL_BINDING_BUTTON && keyEditor->axis() >= 0) {
+	if ((m_type == SDL_BINDING_BUTTON || m_type == SDL_BINDING_CONTROLLER) && keyEditor->axis() >= 0) {
 		mapper.bindAxis(keyEditor->axis(), keyEditor->direction(), key);
 	}
 	if (m_type == SDL_BINDING_BUTTON && keyEditor->hat() >= 0) {
diff --git a/src/platform/qt/SettingsView.cpp b/src/platform/qt/SettingsView.cpp
index 7c41cb4a4..e95da696c 100644
--- a/src/platform/qt/SettingsView.cpp
+++ b/src/platform/qt/SettingsView.cpp
@@ -334,8 +334,13 @@ SettingsView::SettingsView(ConfigController* controller, InputController* inputC
 
 	GBAKeyEditor* buttonEditor = nullptr;
 #ifdef BUILD_SDL
+#if SDL_VERSION_ATLEAST(2, 0, 0)
+	QString profile = inputController->profileForType(SDL_BINDING_CONTROLLER);
+	buttonEditor = new GBAKeyEditor(inputController, SDL_BINDING_CONTROLLER, profile);
+#else
 	QString profile = inputController->profileForType(SDL_BINDING_BUTTON);
 	buttonEditor = new GBAKeyEditor(inputController, SDL_BINDING_BUTTON, profile);
+#endif
 	addPage(tr("Controllers"), buttonEditor, Page::CONTROLLERS);
 	connect(m_ui.buttonBox, &QDialogButtonBox::accepted, buttonEditor, &GBAKeyEditor::save);
 #endif
diff --git a/src/platform/qt/Window.cpp b/src/platform/qt/Window.cpp
index cc439f60f..6216e2247 100644
--- a/src/platform/qt/Window.cpp
+++ b/src/platform/qt/Window.cpp
@@ -177,8 +177,13 @@ Window::Window(CoreManager* manager, ConfigController* config, int playerId, QWi
 
 #ifdef BUILD_SDL
 	m_inputController.addInputDriver(std::make_shared<SDLInputDriver>(&m_inputController));
+#if SDL_VERSION_ATLEAST(2, 0, 0)
+	m_inputController.setGamepadDriver(SDL_BINDING_CONTROLLER);
+	m_inputController.setSensorDriver(SDL_BINDING_CONTROLLER);
+#else
 	m_inputController.setGamepadDriver(SDL_BINDING_BUTTON);
 	m_inputController.setSensorDriver(SDL_BINDING_BUTTON);
+#endif
 #endif
 
 	m_shortcutController->setConfigController(m_config);
diff --git a/src/platform/qt/input/SDLInputDriver.h b/src/platform/qt/input/SDLInputDriver.h
index 4a4916ad3..d10661ed7 100644
--- a/src/platform/qt/input/SDLInputDriver.h
+++ b/src/platform/qt/input/SDLInputDriver.h
@@ -31,7 +31,11 @@ public:
 	SDLInputDriver(InputController*, QObject* parent = nullptr);
 	~SDLInputDriver();
 
+#if SDL_VERSION_ATLEAST(2, 0, 0)
+	uint32_t type() const override { return SDL_BINDING_CONTROLLER; }
+#else
 	uint32_t type() const override { return SDL_BINDING_BUTTON; }
+#endif
 	QString visibleName() const override { return QLatin1String("SDL"); }
 	QString currentProfile() const override;
 
diff --git a/src/platform/sdl/sdl-events.c b/src/platform/sdl/sdl-events.c
index 41783b3c3..e146bfd90 100644
--- a/src/platform/sdl/sdl-events.c
+++ b/src/platform/sdl/sdl-events.c
@@ -167,12 +167,30 @@ void mSDLInitBindingsGBA(struct mInputMap* inputMap) {
 	mInputBindKey(inputMap, SDL_BINDING_KEY, SDLK_RIGHT, GBA_KEY_RIGHT);
 #endif
 
+#if SDL_VERSION_ATLEAST(2, 0, 0)
+	mInputBindKey(inputMap, SDL_BINDING_CONTROLLER, SDL_CONTROLLER_BUTTON_A, GBA_KEY_A);
+	mInputBindKey(inputMap, SDL_BINDING_CONTROLLER, SDL_CONTROLLER_BUTTON_B, GBA_KEY_B);
+	mInputBindKey(inputMap, SDL_BINDING_CONTROLLER, SDL_CONTROLLER_BUTTON_LEFTSHOULDER, GBA_KEY_L);
+	mInputBindKey(inputMap, SDL_BINDING_CONTROLLER, SDL_CONTROLLER_BUTTON_RIGHTSHOULDER, GBA_KEY_R);
+	mInputBindKey(inputMap, SDL_BINDING_CONTROLLER, SDL_CONTROLLER_BUTTON_START, GBA_KEY_START);
+	mInputBindKey(inputMap, SDL_BINDING_CONTROLLER, SDL_CONTROLLER_BUTTON_BACK, GBA_KEY_SELECT);
+	mInputBindKey(inputMap, SDL_BINDING_CONTROLLER, SDL_CONTROLLER_BUTTON_DPAD_UP, GBA_KEY_UP);
+	mInputBindKey(inputMap, SDL_BINDING_CONTROLLER, SDL_CONTROLLER_BUTTON_DPAD_DOWN, GBA_KEY_DOWN);
+	mInputBindKey(inputMap, SDL_BINDING_CONTROLLER, SDL_CONTROLLER_BUTTON_DPAD_LEFT, GBA_KEY_LEFT);
+	mInputBindKey(inputMap, SDL_BINDING_CONTROLLER, SDL_CONTROLLER_BUTTON_DPAD_RIGHT, GBA_KEY_RIGHT);
+
+	struct mInputAxis description = (struct mInputAxis) { GBA_KEY_RIGHT, GBA_KEY_LEFT, 0x4000, -0x4000 };
+	mInputBindAxis(inputMap, SDL_BINDING_CONTROLLER, SDL_CONTROLLER_AXIS_LEFTX, &description);
+	description = (struct mInputAxis) { GBA_KEY_DOWN, GBA_KEY_UP, 0x4000, -0x4000 };
+	mInputBindAxis(inputMap, SDL_BINDING_CONTROLLER, SDL_CONTROLLER_AXIS_LEFTY, &description);
+#else
 	struct mInputAxis description = { GBA_KEY_RIGHT, GBA_KEY_LEFT, 0x4000, -0x4000 };
 	mInputBindAxis(inputMap, SDL_BINDING_BUTTON, 0, &description);
 	description = (struct mInputAxis) { GBA_KEY_DOWN, GBA_KEY_UP, 0x4000, -0x4000 };
 	mInputBindAxis(inputMap, SDL_BINDING_BUTTON, 1, &description);
 
 	mInputBindHat(inputMap, SDL_BINDING_BUTTON, 0, &GBAInputInfo.hat);
+#endif
 }
 
 bool mSDLAttachPlayer(struct mSDLEvents* events, struct mSDLPlayer* player) {
@@ -284,17 +302,19 @@ void mSDLDetachPlayer(struct mSDLEvents* events, struct mSDLPlayer* player) {
 void mSDLPlayerLoadConfig(struct mSDLPlayer* context, const struct Configuration* config) {
 	mInputMapLoad(context->bindings, SDL_BINDING_KEY, config);
 	if (context->joystick) {
-		mInputMapLoad(context->bindings, SDL_BINDING_BUTTON, config);
 #if SDL_VERSION_ATLEAST(2, 0, 0)
+		mInputMapLoad(context->bindings, SDL_BINDING_CONTROLLER, config);
 		char name[34] = {0};
 		SDL_JoystickGetGUIDString(SDL_JoystickGetGUID(context->joystick->joystick), name, sizeof(name));
+		mInputProfileLoad(context->bindings, SDL_BINDING_CONTROLLER, config, name);
 #else
+		mInputMapLoad(context->bindings, SDL_BINDING_BUTTON, config);
 		const char* name = SDL_JoystickName(SDL_JoystickIndex(context->joystick->joystick));
 		if (!name) {
 			return;
 		}
-#endif
 		mInputProfileLoad(context->bindings, SDL_BINDING_BUTTON, config, name);
+#endif
 
 		const char* value;
 		char* end;
@@ -410,7 +430,7 @@ void mSDLUpdateJoysticks(struct mSDLEvents* events, const struct Configuration*
 				if (events->preferredJoysticks[i] && strcmp(events->preferredJoysticks[i], joystickName) == 0) {
 					events->players[i]->joystick = joystick;
 					if (config) {
-						mInputProfileLoad(events->players[i]->bindings, SDL_BINDING_BUTTON, config, joystickName);
+						mInputProfileLoad(events->players[i]->bindings, SDL_BINDING_CONTROLLER, config, joystickName);
 					}
 					return;
 				}
@@ -421,7 +441,7 @@ void mSDLUpdateJoysticks(struct mSDLEvents* events, const struct Configuration*
 				}
 				events->players[i]->joystick = joystick;
 				if (config && joystickName[0]) {
-					mInputProfileLoad(events->players[i]->bindings, SDL_BINDING_BUTTON, config, joystickName);
+					mInputProfileLoad(events->players[i]->bindings, SDL_BINDING_CONTROLLER, config, joystickName);
 				}
 				break;
 			}
@@ -574,6 +594,45 @@ static void _mSDLHandleKeypress(struct mCoreThread* context, struct mSDLPlayer*
 	}
 }
 
+#if SDL_VERSION_ATLEAST(2, 0, 0)
+static void _mSDLHandleControllerButton(struct mCoreThread* context, struct mSDLPlayer* sdlContext, const struct SDL_ControllerButtonEvent* event) {
+	int key = 0;
+	key = mInputMapKey(sdlContext->bindings, SDL_BINDING_CONTROLLER, event->button);
+	if (key == -1) {
+		return;
+	}
+
+	mCoreThreadInterrupt(context);
+	if (event->type == SDL_CONTROLLERBUTTONDOWN) {
+		context->core->addKeys(context->core, 1 << key);
+	} else {
+		context->core->clearKeys(context->core, 1 << key);
+	}
+	mCoreThreadContinue(context);
+}
+
+static void _mSDLHandleControllerAxis(struct mCoreThread* context, struct mSDLPlayer* sdlContext, const struct SDL_ControllerAxisEvent* event) {
+	int clearKeys = ~mInputClearAxis(sdlContext->bindings, SDL_BINDING_CONTROLLER, event->axis, -1);
+	int newKeys = 0;
+	int key = mInputMapAxis(sdlContext->bindings, SDL_BINDING_CONTROLLER, event->axis, event->value);
+	if (key != -1) {
+		newKeys |= 1 << key;
+	}
+	clearKeys &= ~newKeys;
+	mCoreThreadInterrupt(context);
+	context->core->clearKeys(context->core, clearKeys);
+	context->core->addKeys(context->core, newKeys);
+	mCoreThreadContinue(context);
+}
+
+static void _mSDLHandleWindowEvent(struct mSDLPlayer* sdlContext, const struct SDL_WindowEvent* event) {
+	switch (event->event) {
+	case SDL_WINDOWEVENT_SIZE_CHANGED:
+		sdlContext->windowUpdated = 1;
+		break;
+	}
+}
+#else
 static void _mSDLHandleJoyButton(struct mCoreThread* context, struct mSDLPlayer* sdlContext, const struct SDL_JoyButtonEvent* event) {
 	int key = 0;
 	key = mInputMapKey(sdlContext->bindings, SDL_BINDING_BUTTON, event->button);
@@ -616,16 +675,6 @@ static void _mSDLHandleJoyAxis(struct mCoreThread* context, struct mSDLPlayer* s
 	context->core->clearKeys(context->core, clearKeys);
 	context->core->addKeys(context->core, newKeys);
 	mCoreThreadContinue(context);
-
-}
-
-#if SDL_VERSION_ATLEAST(2, 0, 0)
-static void _mSDLHandleWindowEvent(struct mSDLPlayer* sdlContext, const struct SDL_WindowEvent* event) {
-	switch (event->event) {
-	case SDL_WINDOWEVENT_SIZE_CHANGED:
-		sdlContext->windowUpdated = 1;
-		break;
-	}
 }
 #endif
 
@@ -638,17 +687,19 @@ void mSDLHandleEvent(struct mCoreThread* context, struct mSDLPlayer* sdlContext,
 	case SDL_WINDOWEVENT:
 		_mSDLHandleWindowEvent(sdlContext, &event->window);
 		break;
+	case SDL_CONTROLLERBUTTONDOWN:
+	case SDL_CONTROLLERBUTTONUP:
+		_mSDLHandleControllerButton(context, sdlContext, &event->cbutton);
+		break;
+	case SDL_CONTROLLERAXISMOTION:
+		_mSDLHandleControllerAxis(context, sdlContext, &event->caxis);
+		break;
 #else
 	case SDL_VIDEORESIZE:
 		sdlContext->newWidth = event->resize.w;
 		sdlContext->newHeight = event->resize.h;
 		sdlContext->windowUpdated = 1;
 		break;
-#endif
-	case SDL_KEYDOWN:
-	case SDL_KEYUP:
-		_mSDLHandleKeypress(context, sdlContext, &event->key);
-		break;
 	case SDL_JOYBUTTONDOWN:
 	case SDL_JOYBUTTONUP:
 		_mSDLHandleJoyButton(context, sdlContext, &event->jbutton);
@@ -659,6 +710,11 @@ void mSDLHandleEvent(struct mCoreThread* context, struct mSDLPlayer* sdlContext,
 	case SDL_JOYAXISMOTION:
 		_mSDLHandleJoyAxis(context, sdlContext, &event->jaxis);
 		break;
+#endif
+	case SDL_KEYDOWN:
+	case SDL_KEYUP:
+		_mSDLHandleKeypress(context, sdlContext, &event->key);
+		break;
 	}
 }
 
diff --git a/src/platform/sdl/sdl-events.h b/src/platform/sdl/sdl-events.h
index 8bdbd7c0b..e49613932 100644
--- a/src/platform/sdl/sdl-events.h
+++ b/src/platform/sdl/sdl-events.h
@@ -29,6 +29,7 @@ mLOG_DECLARE_CATEGORY(SDL_EVENTS);
 
 #define SDL_BINDING_KEY 0x53444C4BU
 #define SDL_BINDING_BUTTON 0x53444C42U
+#define SDL_BINDING_CONTROLLER 0x53444C43U
 
 #define MAX_PLAYERS 4
 

From 8807d3d7fe8517e5a48047fb7710b2cc054874cb Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Wed, 3 Apr 2024 04:41:54 -0700
Subject: [PATCH 35/53] Qt: Switch SDL controller usage from Joystick to
 GameController

---
 CMakeLists.txt                           |   2 +-
 src/platform/qt/GBAKeyEditor.cpp         |   1 +
 src/platform/qt/KeyEditor.cpp            |  32 +++-
 src/platform/qt/KeyEditor.h              |   5 +
 src/platform/qt/ShortcutView.cpp         |   1 +
 src/platform/qt/input/Gamepad.h          |   3 +
 src/platform/qt/input/SDLInputDriver.cpp |  56 +++++-
 src/platform/qt/input/SDLInputDriver.h   |   3 +
 src/platform/sdl/sdl-events.c            | 207 +++++++++++++++++++++++
 src/platform/sdl/sdl-events.h            |   3 +
 10 files changed, 307 insertions(+), 6 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 4bf160665..3f2ff4686 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -39,7 +39,7 @@ if(NOT MSVC)
 		# TODO: Remove this once mScript KV pairs support const correctness
 		set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -Werror=incompatible-pointer-types")
 	endif()
-	set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${WARNING_FLAGS} -Woverloaded-virtual")
+	set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${WARNING_FLAGS} -Woverloaded-virtual -Werror=reorder")
 else()
 	set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -D_CRT_SECURE_NO_WARNINGS /wd4003 /wd4244 /wd4146 /wd4267 /Zc:preprocessor-")
 	set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -D_CRT_SECURE_NO_WARNINGS /wd4003 /wd4244 /wd4146 /wd4267 /Zc:preprocessor-")
diff --git a/src/platform/qt/GBAKeyEditor.cpp b/src/platform/qt/GBAKeyEditor.cpp
index 2afb546ad..8a8427973 100644
--- a/src/platform/qt/GBAKeyEditor.cpp
+++ b/src/platform/qt/GBAKeyEditor.cpp
@@ -122,6 +122,7 @@ GBAKeyEditor::GBAKeyEditor(InputController* controller, int type, const QString&
 		connect(key, &KeyEditor::valueChanged, this, &GBAKeyEditor::setNext);
 		connect(key, &KeyEditor::axisChanged, this, &GBAKeyEditor::setNext);
 		connect(key, &KeyEditor::hatChanged, this, &GBAKeyEditor::setNext);
+		key->setInputController(m_controller);
 		key->installEventFilter(this);
 	}
 
diff --git a/src/platform/qt/KeyEditor.cpp b/src/platform/qt/KeyEditor.cpp
index 7d3ba1990..50702da73 100644
--- a/src/platform/qt/KeyEditor.cpp
+++ b/src/platform/qt/KeyEditor.cpp
@@ -5,6 +5,8 @@
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 #include "KeyEditor.h"
 
+#include "InputController.h"
+#include "input/Gamepad.h"
 #include "input/GamepadAxisEvent.h"
 #include "input/GamepadButtonEvent.h"
 #include "ShortcutController.h"
@@ -18,6 +20,7 @@ using namespace QGBA;
 
 KeyEditor::KeyEditor(QWidget* parent)
 	: QLineEdit(parent)
+	, m_controller(nullptr)
 	, m_direction(GamepadAxisEvent::NEUTRAL)
 	, m_hatDirection(GamepadHatEvent::CENTER)
 {
@@ -26,6 +29,13 @@ KeyEditor::KeyEditor(QWidget* parent)
 	m_lastKey.setSingleShot(true);
 }
 
+void KeyEditor::setInputController(InputController* controller) {
+	m_controller = controller;
+	if (m_button) {
+		updateButtonText();
+	}
+}
+
 void KeyEditor::setValue(int key) {
 	m_key = key;
 	if (m_button) {
@@ -204,10 +214,28 @@ void KeyEditor::updateButtonText() {
 		}
 	}
 	if (m_key >= 0) {
-		text.append(QString::number(m_key));
+		std::shared_ptr<Gamepad> gamepad;
+		if (m_controller && m_controller->gamepadDriver()) {
+			gamepad = m_controller->gamepadDriver()->activeGamepad();
+		}
+		if (!gamepad) {
+			text.append(QString::number(m_key));
+		} else {
+			text.append(gamepad->buttonHumanName(m_key));
+		}
 	}
 	if (m_direction != GamepadAxisEvent::NEUTRAL) {
-		text.append((m_direction == GamepadAxisEvent::NEGATIVE ? "-" : "+") + QString::number(m_axis));
+		QString name;
+		std::shared_ptr<Gamepad> gamepad;
+		if (m_controller && m_controller->gamepadDriver()) {
+			gamepad = m_controller->gamepadDriver()->activeGamepad();
+		}
+		if (!gamepad) {
+			name = QString::number(m_axis);
+		} else {
+			name = gamepad->axisHumanName(m_axis);
+		}
+		text.append((m_direction == GamepadAxisEvent::NEGATIVE ? "-" : "+") + name);
 	}
 	if (text.isEmpty()) {
 		setText(tr("---"));
diff --git a/src/platform/qt/KeyEditor.h b/src/platform/qt/KeyEditor.h
index c1bb56fae..93af927ac 100644
--- a/src/platform/qt/KeyEditor.h
+++ b/src/platform/qt/KeyEditor.h
@@ -13,12 +13,16 @@
 
 namespace QGBA {
 
+class InputController;
+
 class KeyEditor : public QLineEdit {
 Q_OBJECT
 
 public:
 	KeyEditor(QWidget* parent = nullptr);
 
+	void setInputController(InputController* controller);
+
 	int value() const { return m_key; }
 
 	GamepadAxisEvent::Direction direction() const { return m_direction; }
@@ -57,6 +61,7 @@ private:
 	int m_axis = -1;
 	int m_hat = -1;
 	bool m_button = false;
+	InputController* m_controller;
 	GamepadAxisEvent::Direction m_direction;
 	GamepadHatEvent::Direction m_hatDirection;
 	QTimer m_lastKey;
diff --git a/src/platform/qt/ShortcutView.cpp b/src/platform/qt/ShortcutView.cpp
index 5efbc4d62..f457263c5 100644
--- a/src/platform/qt/ShortcutView.cpp
+++ b/src/platform/qt/ShortcutView.cpp
@@ -54,6 +54,7 @@ void ShortcutView::setInputController(InputController* controller) {
 	}
 	m_input = controller;
 	m_input->stealFocus(this);
+	m_ui.keyEdit->setInputController(controller);
 }
 
 void ShortcutView::load(const QModelIndex& index) {
diff --git a/src/platform/qt/input/Gamepad.h b/src/platform/qt/input/Gamepad.h
index 1781885cd..9a1cf19ec 100644
--- a/src/platform/qt/input/Gamepad.h
+++ b/src/platform/qt/input/Gamepad.h
@@ -22,6 +22,9 @@ public:
 	virtual QList<int16_t> currentAxes() = 0;
 	virtual QList<GamepadHatEvent::Direction> currentHats() = 0;
 
+	virtual QString buttonHumanName(int) const = 0;
+	virtual QString axisHumanName(int) const = 0;
+
 	virtual int buttonCount() const = 0;
 	virtual int axisCount() const = 0;
 	virtual int hatCount() const = 0;
diff --git a/src/platform/qt/input/SDLInputDriver.cpp b/src/platform/qt/input/SDLInputDriver.cpp
index e3a77094f..72d148057 100644
--- a/src/platform/qt/input/SDLInputDriver.cpp
+++ b/src/platform/qt/input/SDLInputDriver.cpp
@@ -257,13 +257,20 @@ QList<bool> SDLGamepad::currentButtons() {
 		return {};
 	}
 
-	SDL_Joystick* joystick = SDL_JoystickListGetPointer(&s_sdlEvents.joysticks, m_index)->joystick;
 	QList<bool> buttons;
 
+#if SDL_VERSION_ATLEAST(2, 0, 0)
+	SDL_GameController* controller = SDL_JoystickListGetPointer(&s_sdlEvents.joysticks, m_index)->controller;
+	for (int i = 0; i < SDL_CONTROLLER_BUTTON_MAX; ++i) {
+		buttons.append(SDL_GameControllerGetButton(controller, static_cast<SDL_GameControllerButton>(i)));
+	}
+#else
+	SDL_Joystick* joystick = SDL_JoystickListGetPointer(&s_sdlEvents.joysticks, m_index)->joystick;
 	int numButtons = SDL_JoystickNumButtons(joystick);
 	for (int i = 0; i < numButtons; ++i) {
 		buttons.append(SDL_JoystickGetButton(joystick, i));
 	}
+#endif
 
 	return buttons;
 }
@@ -273,13 +280,20 @@ QList<int16_t> SDLGamepad::currentAxes() {
 		return {};
 	}
 
-	SDL_Joystick* joystick = SDL_JoystickListGetPointer(&s_sdlEvents.joysticks, m_index)->joystick;
 	QList<int16_t> axes;
 
+#if SDL_VERSION_ATLEAST(2, 0, 0)
+	SDL_GameController* controller = SDL_JoystickListGetPointer(&s_sdlEvents.joysticks, m_index)->controller;
+	for (int i = 0; i < SDL_CONTROLLER_AXIS_MAX; ++i) {
+		axes.append(SDL_GameControllerGetAxis(controller, static_cast<SDL_GameControllerAxis>(i)));
+	}
+#else
+	SDL_Joystick* joystick = SDL_JoystickListGetPointer(&s_sdlEvents.joysticks, m_index)->joystick;
 	int numAxes = SDL_JoystickNumAxes(joystick);
 	for (int i = 0; i < numAxes; ++i) {
 		axes.append(SDL_JoystickGetAxis(joystick, i));
 	}
+#endif
 
 	return axes;
 }
@@ -289,24 +303,52 @@ QList<GamepadHatEvent::Direction> SDLGamepad::currentHats() {
 		return {};
 	}
 
-	SDL_Joystick* joystick = SDL_JoystickListGetPointer(&s_sdlEvents.joysticks, m_index)->joystick;
 	QList<GamepadHatEvent::Direction> hats;
 
+#if !SDL_VERSION_ATLEAST(2, 0, 0)
+	SDL_Joystick* joystick = SDL_JoystickListGetPointer(&s_sdlEvents.joysticks, m_index)->joystick;
 	int numHats = SDL_JoystickNumHats(joystick);
 	for (int i = 0; i < numHats; ++i) {
 		hats.append(static_cast<GamepadHatEvent::Direction>(SDL_JoystickGetHat(joystick, i)));
 	}
+#endif
 
 	return hats;
 }
 
+QString SDLGamepad::buttonHumanName(int button) const {
+#if SDL_VERSION_ATLEAST(2, 0, 0)
+	SDL_GameController* controller = SDL_JoystickListGetPointer(&s_sdlEvents.joysticks, m_index)->controller;
+	const char* name = mSDLButtonName(controller, static_cast<SDL_GameControllerButton>(button));
+	if (name) {
+		return QString::fromUtf8(name);
+	}
+#endif
+	return QString::number(button);
+}
+
+QString SDLGamepad::axisHumanName(int axis) const {
+#if SDL_VERSION_ATLEAST(2, 0, 0)
+	SDL_GameController* controller = SDL_JoystickListGetPointer(&s_sdlEvents.joysticks, m_index)->controller;
+	const char* name = mSDLAxisName(controller, static_cast<SDL_GameControllerAxis>(axis));
+	if (name) {
+		return QString::fromUtf8(name);
+	}
+#endif
+	return QString::number(axis);
+}
+
 int SDLGamepad::buttonCount() const {
 	if (!verify()) {
 		return -1;
 	}
 
+#if SDL_VERSION_ATLEAST(2, 0, 0)
+	return SDL_CONTROLLER_BUTTON_MAX;
+#else
 	SDL_Joystick* joystick = SDL_JoystickListGetPointer(&s_sdlEvents.joysticks, m_index)->joystick;
 	return SDL_JoystickNumButtons(joystick);
+#endif
 }
 
 int SDLGamepad::axisCount() const {
@@ -314,8 +356,12 @@ int SDLGamepad::axisCount() const {
 		return -1;
 	}
 
+#if SDL_VERSION_ATLEAST(2, 0, 0)
+	return SDL_CONTROLLER_AXIS_MAX;
+#else
 	SDL_Joystick* joystick = SDL_JoystickListGetPointer(&s_sdlEvents.joysticks, m_index)->joystick;
 	return SDL_JoystickNumAxes(joystick);
+#endif
 }
 
 int SDLGamepad::hatCount() const {
@@ -323,8 +369,12 @@ int SDLGamepad::hatCount() const {
 		return -1;
 	}
 
+#if SDL_VERSION_ATLEAST(2, 0, 0)
+	return 0;
+#else
 	SDL_Joystick* joystick = SDL_JoystickListGetPointer(&s_sdlEvents.joysticks, m_index)->joystick;
 	return SDL_JoystickNumHats(joystick);
+#endif
 }
 
 QString SDLGamepad::name() const {
diff --git a/src/platform/qt/input/SDLInputDriver.h b/src/platform/qt/input/SDLInputDriver.h
index d10661ed7..217dc40a7 100644
--- a/src/platform/qt/input/SDLInputDriver.h
+++ b/src/platform/qt/input/SDLInputDriver.h
@@ -93,6 +93,9 @@ public:
 	int axisCount() const override;
 	int hatCount() const override;
 
+	QString buttonHumanName(int) const override;
+	QString axisHumanName(int) const override;
+
 	QString name() const override;
 	QString visibleName() const override;
 
diff --git a/src/platform/sdl/sdl-events.c b/src/platform/sdl/sdl-events.c
index e146bfd90..383775636 100644
--- a/src/platform/sdl/sdl-events.c
+++ b/src/platform/sdl/sdl-events.c
@@ -886,4 +886,211 @@ void mSDLSetScreensaverSuspendable(struct mSDLEvents* events, bool suspendable)
 		SDL_EnableScreenSaver();
 	}
 }
+
+static const char* const buttonNamesXbox360[SDL_CONTROLLER_BUTTON_MAX] = {
+	[SDL_CONTROLLER_BUTTON_A] = "A",
+	[SDL_CONTROLLER_BUTTON_B] = "B",
+	[SDL_CONTROLLER_BUTTON_X] = "X",
+	[SDL_CONTROLLER_BUTTON_Y] = "Y",
+	[SDL_CONTROLLER_BUTTON_BACK] = "Back",
+	[SDL_CONTROLLER_BUTTON_GUIDE] = "Xbox",
+	[SDL_CONTROLLER_BUTTON_START] = "Start",
+	[SDL_CONTROLLER_BUTTON_LEFTSTICK] = "LS",
+	[SDL_CONTROLLER_BUTTON_RIGHTSTICK] = "RS",
+	[SDL_CONTROLLER_BUTTON_LEFTSHOULDER] = "LB",
+	[SDL_CONTROLLER_BUTTON_RIGHTSHOULDER] = "RB",
+	[SDL_CONTROLLER_BUTTON_MISC1] = "Misc",
+	[SDL_CONTROLLER_BUTTON_PADDLE1] = "P1",
+	[SDL_CONTROLLER_BUTTON_PADDLE2] = "P2",
+	[SDL_CONTROLLER_BUTTON_PADDLE3] = "P3",
+	[SDL_CONTROLLER_BUTTON_PADDLE4] = "P4",
+	[SDL_CONTROLLER_BUTTON_TOUCHPAD] = "Touch",
+};
+
+#if SDL_VERSION_ATLEAST(2, 0, 12)
+static const char* const buttonNamesXboxOne[SDL_CONTROLLER_BUTTON_MAX] = {
+	[SDL_CONTROLLER_BUTTON_A] = "A",
+	[SDL_CONTROLLER_BUTTON_B] = "B",
+	[SDL_CONTROLLER_BUTTON_X] = "X",
+	[SDL_CONTROLLER_BUTTON_Y] = "Y",
+	[SDL_CONTROLLER_BUTTON_BACK] = "View",
+	[SDL_CONTROLLER_BUTTON_GUIDE] = "Xbox",
+	[SDL_CONTROLLER_BUTTON_START] = "Menu",
+	[SDL_CONTROLLER_BUTTON_LEFTSTICK] = "LS",
+	[SDL_CONTROLLER_BUTTON_RIGHTSTICK] = "RS",
+	[SDL_CONTROLLER_BUTTON_LEFTSHOULDER] = "LB",
+	[SDL_CONTROLLER_BUTTON_RIGHTSHOULDER] = "RB",
+	[SDL_CONTROLLER_BUTTON_MISC1] = "Share",
+	[SDL_CONTROLLER_BUTTON_PADDLE1] = "P1",
+	[SDL_CONTROLLER_BUTTON_PADDLE2] = "P2",
+	[SDL_CONTROLLER_BUTTON_PADDLE3] = "P3",
+	[SDL_CONTROLLER_BUTTON_PADDLE4] = "P4",
+	[SDL_CONTROLLER_BUTTON_TOUCHPAD] = "Touch",
+};
+
+static const char* const buttonNamesPlayStation[SDL_CONTROLLER_BUTTON_MAX] = {
+	[SDL_CONTROLLER_BUTTON_A] = "×",
+	[SDL_CONTROLLER_BUTTON_B] = "○",
+	[SDL_CONTROLLER_BUTTON_X] = "□",
+	[SDL_CONTROLLER_BUTTON_Y] = "△",
+	[SDL_CONTROLLER_BUTTON_BACK] = "Share",
+	[SDL_CONTROLLER_BUTTON_GUIDE] = "PS",
+	[SDL_CONTROLLER_BUTTON_START] = "Options",
+	[SDL_CONTROLLER_BUTTON_LEFTSTICK] = "L3",
+	[SDL_CONTROLLER_BUTTON_RIGHTSTICK] = "R3",
+	[SDL_CONTROLLER_BUTTON_LEFTSHOULDER] = "L1",
+	[SDL_CONTROLLER_BUTTON_RIGHTSHOULDER] = "R1",
+	[SDL_CONTROLLER_BUTTON_MISC1] = "Misc",
+	[SDL_CONTROLLER_BUTTON_PADDLE1] = "P1",
+	[SDL_CONTROLLER_BUTTON_PADDLE2] = "P2",
+	[SDL_CONTROLLER_BUTTON_PADDLE3] = "P3",
+	[SDL_CONTROLLER_BUTTON_PADDLE4] = "P4",
+	[SDL_CONTROLLER_BUTTON_TOUCHPAD] = "Touch",
+};
+
+static const char* const buttonNamesNintedo[SDL_CONTROLLER_BUTTON_MAX] = {
+	[SDL_CONTROLLER_BUTTON_A] = "A",
+	[SDL_CONTROLLER_BUTTON_B] = "B",
+	[SDL_CONTROLLER_BUTTON_X] = "X",
+	[SDL_CONTROLLER_BUTTON_Y] = "Y",
+	[SDL_CONTROLLER_BUTTON_BACK] = "-",
+	[SDL_CONTROLLER_BUTTON_GUIDE] = "Home",
+	[SDL_CONTROLLER_BUTTON_START] = "+",
+	[SDL_CONTROLLER_BUTTON_LEFTSTICK] = "LS",
+	[SDL_CONTROLLER_BUTTON_RIGHTSTICK] = "RS",
+	[SDL_CONTROLLER_BUTTON_LEFTSHOULDER] = "L",
+	[SDL_CONTROLLER_BUTTON_RIGHTSHOULDER] = "R",
+	[SDL_CONTROLLER_BUTTON_MISC1] = "Share",
+	[SDL_CONTROLLER_BUTTON_PADDLE1] = "P1",
+	[SDL_CONTROLLER_BUTTON_PADDLE2] = "P2",
+	[SDL_CONTROLLER_BUTTON_PADDLE3] = "P3",
+	[SDL_CONTROLLER_BUTTON_PADDLE4] = "P4",
+	[SDL_CONTROLLER_BUTTON_TOUCHPAD] = "Touch",
+};
+
+static const char* const buttonNamesGeneric[SDL_CONTROLLER_BUTTON_MAX] = {
+	[SDL_CONTROLLER_BUTTON_A] = "A",
+	[SDL_CONTROLLER_BUTTON_B] = "B",
+	[SDL_CONTROLLER_BUTTON_X] = "X",
+	[SDL_CONTROLLER_BUTTON_Y] = "Y",
+	[SDL_CONTROLLER_BUTTON_BACK] = "Select",
+	[SDL_CONTROLLER_BUTTON_GUIDE] = "Guide",
+	[SDL_CONTROLLER_BUTTON_START] = "Start",
+	[SDL_CONTROLLER_BUTTON_LEFTSTICK] = "LS",
+	[SDL_CONTROLLER_BUTTON_RIGHTSTICK] = "RS",
+	[SDL_CONTROLLER_BUTTON_LEFTSHOULDER] = "LB",
+	[SDL_CONTROLLER_BUTTON_RIGHTSHOULDER] = "RB",
+	[SDL_CONTROLLER_BUTTON_MISC1] = "Misc",
+	[SDL_CONTROLLER_BUTTON_PADDLE1] = "P1",
+	[SDL_CONTROLLER_BUTTON_PADDLE2] = "P2",
+	[SDL_CONTROLLER_BUTTON_PADDLE3] = "P3",
+	[SDL_CONTROLLER_BUTTON_PADDLE4] = "P4",
+	[SDL_CONTROLLER_BUTTON_TOUCHPAD] = "Touch",
+};
+#endif
+
+const char* mSDLButtonName(SDL_GameController* controller, SDL_GameControllerButton button) {
+	const char* const* buttonNames = buttonNamesXbox360;
+
+#if SDL_VERSION_ATLEAST(2, 0, 12)
+	switch (SDL_GameControllerGetType(controller)) {
+	case SDL_CONTROLLER_TYPE_XBOX360:
+		buttonNames = buttonNamesXbox360;
+		break;
+	case SDL_CONTROLLER_TYPE_XBOXONE:
+		buttonNames = buttonNamesXboxOne;
+		break;
+	case SDL_CONTROLLER_TYPE_PS3:
+	case SDL_CONTROLLER_TYPE_PS4:
+#if SDL_VERSION_ATLEAST(2, 0, 14)
+	case SDL_CONTROLLER_TYPE_PS5:
+#endif
+		buttonNames = buttonNamesPlayStation;
+		break;
+	case SDL_CONTROLLER_TYPE_NINTENDO_SWITCH_PRO:
+		buttonNames = buttonNamesNintedo;
+		break;
+	default:
+		buttonNames = buttonNamesGeneric;
+		break;
+	}
+#endif
+
+	switch (button) {
+	case SDL_CONTROLLER_BUTTON_DPAD_UP:
+		return "D↑";
+	case SDL_CONTROLLER_BUTTON_DPAD_DOWN:
+		return "D↓";
+	case SDL_CONTROLLER_BUTTON_DPAD_LEFT:
+		return "D←";
+	case SDL_CONTROLLER_BUTTON_DPAD_RIGHT:
+		return "D→";
+	default:
+		return buttonNames[button];
+	case SDL_CONTROLLER_BUTTON_INVALID:
+	case SDL_CONTROLLER_BUTTON_MAX:
+		break;
+	}
+	return NULL;
+}
+
+static const char* const axisNamesXbox[SDL_CONTROLLER_AXIS_MAX] = {
+	[SDL_CONTROLLER_AXIS_TRIGGERLEFT] = "LT",
+	[SDL_CONTROLLER_AXIS_TRIGGERRIGHT] = "RT",
+};
+
+#if SDL_VERSION_ATLEAST(2, 0, 12)
+static const char* const axisNamesPlayStation[SDL_CONTROLLER_AXIS_MAX] = {
+	[SDL_CONTROLLER_AXIS_TRIGGERLEFT] = "L3",
+	[SDL_CONTROLLER_AXIS_TRIGGERRIGHT] = "R3",
+};
+
+static const char* const axisNamesNintendo[SDL_CONTROLLER_AXIS_MAX] = {
+	[SDL_CONTROLLER_AXIS_TRIGGERLEFT] = "ZL",
+	[SDL_CONTROLLER_AXIS_TRIGGERRIGHT] = "ZR",
+};
+#endif
+
+const char* mSDLAxisName(SDL_GameController* controller, SDL_GameControllerAxis axis) {
+	const char* const* axisNames = axisNamesXbox;
+
+#if SDL_VERSION_ATLEAST(2, 0, 12)
+	switch (SDL_GameControllerGetType(controller)) {
+	case SDL_CONTROLLER_TYPE_XBOX360:
+	case SDL_CONTROLLER_TYPE_XBOXONE:
+	default:
+		axisNames = axisNamesXbox;
+		break;
+	case SDL_CONTROLLER_TYPE_PS3:
+	case SDL_CONTROLLER_TYPE_PS4:
+#if SDL_VERSION_ATLEAST(2, 0, 14)
+	case SDL_CONTROLLER_TYPE_PS5:
+#endif
+		axisNames = axisNamesPlayStation;
+		break;
+	case SDL_CONTROLLER_TYPE_NINTENDO_SWITCH_PRO:
+		axisNames = axisNamesNintendo;
+		break;
+	}
+#endif
+
+	switch (axis) {
+	case SDL_CONTROLLER_AXIS_LEFTX:
+		return "X";
+	case SDL_CONTROLLER_AXIS_LEFTY:
+		return "Y";
+	case SDL_CONTROLLER_AXIS_RIGHTX:
+		return "RX";
+	case SDL_CONTROLLER_AXIS_RIGHTY:
+		return "RY";
+	case SDL_CONTROLLER_AXIS_TRIGGERLEFT:
+	case SDL_CONTROLLER_AXIS_TRIGGERRIGHT:
+		return axisNames[axis];
+	case SDL_CONTROLLER_AXIS_INVALID:
+	case SDL_CONTROLLER_AXIS_MAX:
+		break;
+	}
+	return NULL;
+}
+
 #endif
diff --git a/src/platform/sdl/sdl-events.h b/src/platform/sdl/sdl-events.h
index e49613932..741503be4 100644
--- a/src/platform/sdl/sdl-events.h
+++ b/src/platform/sdl/sdl-events.h
@@ -126,6 +126,9 @@ void mSDLHandleEvent(struct mCoreThread* context, struct mSDLPlayer* sdlContext,
 void mSDLSuspendScreensaver(struct mSDLEvents*);
 void mSDLResumeScreensaver(struct mSDLEvents*);
 void mSDLSetScreensaverSuspendable(struct mSDLEvents*, bool suspendable);
+
+const char* mSDLButtonName(SDL_GameController*, SDL_GameControllerButton);
+const char* mSDLAxisName(SDL_GameController*, SDL_GameControllerAxis);
 #endif
 
 CXX_GUARD_END

From 560b8f487cdfe9dae178cf761374120e9260f172 Mon Sep 17 00:00:00 2001
From: gallegonovato <fran-carro@hotmail.es>
Date: Sat, 29 Jul 2023 11:45:37 +0000
Subject: [PATCH 36/53] Qt: Update translation (Spanish)

Translation: mGBA/Qt
Translate-URL: https://hosted.weblate.org/projects/mgba/mgba-qt/es/
---
 src/platform/qt/ts/mgba-es.ts | 30 +++++++++++++++---------------
 1 file changed, 15 insertions(+), 15 deletions(-)

diff --git a/src/platform/qt/ts/mgba-es.ts b/src/platform/qt/ts/mgba-es.ts
index 83c4d5d98..16238357b 100644
--- a/src/platform/qt/ts/mgba-es.ts
+++ b/src/platform/qt/ts/mgba-es.ts
@@ -716,7 +716,7 @@ Tamaño de descarga: %3</translation>
     <message>
         <location filename="../ForwarderView.cpp" line="192"/>
         <source>Image files (*.png *.jpg *.bmp)</source>
-        <translation type="unfinished"></translation>
+        <translation>Archivos de imagen (*.png *.jpg *.bmp)</translation>
     </message>
 </context>
 <context>
@@ -3752,17 +3752,17 @@ Tamaño de descarga: %3</translation>
     <message>
         <location filename="../MultiplayerController.cpp" line="327"/>
         <source>Trying to detach a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>Intentando desvincular a un multijugador que no está conectado</translation>
     </message>
     <message>
         <location filename="../MultiplayerController.cpp" line="391"/>
         <source>Trying to get player ID for a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>Intentando obtener el ID de un multijugador que no está conectado</translation>
     </message>
     <message>
         <location filename="../MultiplayerController.cpp" line="405"/>
         <source>Trying to get save ID for a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>Intentando obtener el ID de guardado de un multijugador que no está conectado</translation>
     </message>
 </context>
 <context>
@@ -4310,7 +4310,7 @@ Tamaño de descarga: %3</translation>
     <message>
         <location filename="../ROMInfo.ui" line="114"/>
         <source>Save file:</source>
-        <translation type="unfinished"></translation>
+        <translation>Guarda el archivo:</translation>
     </message>
 </context>
 <context>
@@ -4477,7 +4477,7 @@ Tamaño de descarga: %3</translation>
     <message>
         <location filename="../SaveConverter.cpp" line="487"/>
         <source> + RTC</source>
-        <translation type="unfinished"></translation>
+        <translation> + RTC</translation>
     </message>
     <message>
         <location filename="../SaveConverter.cpp" line="496"/>
@@ -4759,12 +4759,12 @@ Tamaño de descarga: %3</translation>
     <message>
         <location filename="../SettingsView.cpp" line="452"/>
         <source>Select image</source>
-        <translation type="unfinished">Seleccionar imagen</translation>
+        <translation>Seleccionar una imagen</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="452"/>
         <source>Image file (*.png *.jpg *.jpeg)</source>
-        <translation type="unfinished">Archivo de imagen (*.png *.jpg *.jpeg)</translation>
+        <translation>Archivo de imagen (*.png *.jpg *.jpeg)</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="850"/>
@@ -5089,7 +5089,7 @@ Tamaño de descarga: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="941"/>
         <source>Custom border:</source>
-        <translation type="unfinished"></translation>
+        <translation>Borde personalizado:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="952"/>
@@ -5134,7 +5134,7 @@ Tamaño de descarga: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="1201"/>
         <source>Rewind speed:</source>
-        <translation type="unfinished"></translation>
+        <translation>Velocidad del rebobinado:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="2171"/>
@@ -6388,12 +6388,12 @@ Tamaño de descarga: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1445"/>
         <source>Increase fast forward speed</source>
-        <translation type="unfinished"></translation>
+        <translation>Aumentar la velocidad del avance rápido</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1452"/>
         <source>Decrease fast forward speed</source>
-        <translation type="unfinished"></translation>
+        <translation>Reducir la velocidad del avance rápido</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1459"/>
@@ -6771,17 +6771,17 @@ Tamaño de descarga: %3</translation>
     <message>
         <location filename="../utils.cpp" line="146"/>
         <source>Super (L)</source>
-        <translation type="unfinished">Super (L)</translation>
+        <translation>Súper (L)</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="148"/>
         <source>Super (R)</source>
-        <translation type="unfinished">Super (R)</translation>
+        <translation>Súper (R)</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="150"/>
         <source>Menu</source>
-        <translation type="unfinished">Menú</translation>
+        <translation>Menú</translation>
     </message>
 </context>
 <context>

From cbc43ad15730443a5bd83860e989746a1930475d Mon Sep 17 00:00:00 2001
From: Momo cao <momo.cao@protonmail.com>
Date: Fri, 22 Sep 2023 00:52:19 +0000
Subject: [PATCH 37/53] Qt: Update translation (Spanish)

Translation: mGBA/Qt
Translate-URL: https://hosted.weblate.org/projects/mgba/mgba-qt/es/
---
 src/platform/qt/ts/mgba-es.ts | 34 ++++++++++++++++++----------------
 1 file changed, 18 insertions(+), 16 deletions(-)

diff --git a/src/platform/qt/ts/mgba-es.ts b/src/platform/qt/ts/mgba-es.ts
index 16238357b..7dfe054c7 100644
--- a/src/platform/qt/ts/mgba-es.ts
+++ b/src/platform/qt/ts/mgba-es.ts
@@ -656,7 +656,7 @@ Tamaño de descarga: %3</translation>
     <message>
         <location filename="../ForwarderView.ui" line="215"/>
         <source>Use default image</source>
-        <translation>Utilizar la imagen por defecto</translation>
+        <translation>Utilizar imagen por defecto</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="328"/>
@@ -686,17 +686,17 @@ Tamaño de descarga: %3</translation>
     <message>
         <location filename="../ForwarderView.cpp" line="36"/>
         <source>Build finished</source>
-        <translation>Construcción finalizada</translation>
+        <translation>Compilación finalizada</translation>
     </message>
     <message>
         <location filename="../ForwarderView.cpp" line="37"/>
         <source>Forwarder finished building</source>
-        <translation>Transmisor terminado de construir</translation>
+        <translation>Transmisor terminado de compilar</translation>
     </message>
     <message>
         <location filename="../ForwarderView.cpp" line="44"/>
         <source>Build failed</source>
-        <translation>Falló la construcción</translation>
+        <translation>Falló la compilación</translation>
     </message>
     <message>
         <location filename="../ForwarderView.cpp" line="45"/>
@@ -3762,7 +3762,7 @@ Tamaño de descarga: %3</translation>
     <message>
         <location filename="../MultiplayerController.cpp" line="405"/>
         <source>Trying to get save ID for a multiplayer player that&apos;s not attached</source>
-        <translation>Intentando obtener el ID de guardado de un multijugador que no está conectado</translation>
+        <translation>Intentando obtener ID de guardado para un jugador multijugador que no está conectado</translation>
     </message>
 </context>
 <context>
@@ -3780,7 +3780,7 @@ Tamaño de descarga: %3</translation>
     <message>
         <location filename="../ObjView.ui" line="389"/>
         <source>Export</source>
-        <translation>Esportar</translation>
+        <translation>Exportar</translation>
     </message>
     <message>
         <location filename="../ObjView.ui" line="402"/>
@@ -4228,7 +4228,7 @@ Tamaño de descarga: %3</translation>
     <message>
         <location filename="../PrinterView.ui" line="130"/>
         <source>Hurry up!</source>
-        <translation>¡Apúrate!</translation>
+        <translation>¡Apresúrate!</translation>
     </message>
     <message>
         <location filename="../PrinterView.ui" line="137"/>
@@ -4310,7 +4310,7 @@ Tamaño de descarga: %3</translation>
     <message>
         <location filename="../ROMInfo.ui" line="114"/>
         <source>Save file:</source>
-        <translation>Guarda el archivo:</translation>
+        <translation>Guardar:</translation>
     </message>
 </context>
 <context>
@@ -4759,7 +4759,7 @@ Tamaño de descarga: %3</translation>
     <message>
         <location filename="../SettingsView.cpp" line="452"/>
         <source>Select image</source>
-        <translation>Seleccionar una imagen</translation>
+        <translation>Seleccionar imagen</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="452"/>
@@ -4792,14 +4792,16 @@ Tamaño de descarga: %3</translation>
         <translation>
             <numerusform>Hace %n hora</numerusform>
             <numerusform>Hace %n horas</numerusform>
+            <numerusform>Hace %n horas</numerusform>
         </translation>
     </message>
     <message numerus="yes">
         <location filename="../SettingsView.cpp" line="886"/>
         <source>%n day(s) ago</source>
         <translation>
-            <numerusform>Hace %n dia</numerusform>
-            <numerusform>Hace %n dias</numerusform>
+            <numerusform>Hace %n día</numerusform>
+            <numerusform>Hace %n días</numerusform>
+            <numerusform>Hace %n días</numerusform>
         </translation>
     </message>
     <message>
@@ -5134,7 +5136,7 @@ Tamaño de descarga: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="1201"/>
         <source>Rewind speed:</source>
-        <translation>Velocidad del rebobinado:</translation>
+        <translation>Velocidad de rebobinado:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="2171"/>
@@ -6106,7 +6108,7 @@ Tamaño de descarga: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1267"/>
         <source>Load ROM in archive...</source>
-        <translation>Cargar ROM desde contenedor...</translation>
+        <translation>Cargar ROM desde archivo comprimido...</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1268"/>
@@ -6151,7 +6153,7 @@ Tamaño de descarga: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1321"/>
         <source>Recent</source>
-        <translation>Cargar reciente</translation>
+        <translation>Reciente</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1668"/>
@@ -6388,12 +6390,12 @@ Tamaño de descarga: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1445"/>
         <source>Increase fast forward speed</source>
-        <translation>Aumentar la velocidad del avance rápido</translation>
+        <translation>Aumentar la velocidad de avance rápido</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1452"/>
         <source>Decrease fast forward speed</source>
-        <translation>Reducir la velocidad del avance rápido</translation>
+        <translation>Disminuir velocidad de avance rápido</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1459"/>

From c9cd17d513873c7137c216f2a58ef6bb904bd3a6 Mon Sep 17 00:00:00 2001
From: Hoseok Seo <ddinghoya@gmail.com>
Date: Fri, 4 Aug 2023 02:23:05 +0000
Subject: [PATCH 38/53] Qt: Update translation (Korean)

Translation: mGBA/Qt
Translate-URL: https://hosted.weblate.org/projects/mgba/mgba-qt/ko/
---
 src/platform/qt/ts/mgba-ko.ts | 30 +++++++++++++++---------------
 1 file changed, 15 insertions(+), 15 deletions(-)

diff --git a/src/platform/qt/ts/mgba-ko.ts b/src/platform/qt/ts/mgba-ko.ts
index a0955e500..05a8dc604 100644
--- a/src/platform/qt/ts/mgba-ko.ts
+++ b/src/platform/qt/ts/mgba-ko.ts
@@ -716,7 +716,7 @@ Download size: %3</source>
     <message>
         <location filename="../ForwarderView.cpp" line="192"/>
         <source>Image files (*.png *.jpg *.bmp)</source>
-        <translation type="unfinished"></translation>
+        <translation>이미지 파일 (*.png *.jpg *.bmp)</translation>
     </message>
 </context>
 <context>
@@ -3752,17 +3752,17 @@ Download size: %3</source>
     <message>
         <location filename="../MultiplayerController.cpp" line="327"/>
         <source>Trying to detach a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>연결되지 않은 멀티플레이어 플레이어를 분리하려고 함</translation>
     </message>
     <message>
         <location filename="../MultiplayerController.cpp" line="391"/>
         <source>Trying to get player ID for a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>연결되지 않은 멀티플레이어 플레이어의 플레이어 ID를 가져오려고 함</translation>
     </message>
     <message>
         <location filename="../MultiplayerController.cpp" line="405"/>
         <source>Trying to get save ID for a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>연결되지 않은 멀티플레이어 플레이어의 저장 ID를 얻으려고 함</translation>
     </message>
 </context>
 <context>
@@ -4310,7 +4310,7 @@ Download size: %3</source>
     <message>
         <location filename="../ROMInfo.ui" line="114"/>
         <source>Save file:</source>
-        <translation type="unfinished"></translation>
+        <translation>저장 파일:</translation>
     </message>
 </context>
 <context>
@@ -4477,7 +4477,7 @@ Download size: %3</source>
     <message>
         <location filename="../SaveConverter.cpp" line="487"/>
         <source> + RTC</source>
-        <translation type="unfinished"></translation>
+        <translation> + RTC</translation>
     </message>
     <message>
         <location filename="../SaveConverter.cpp" line="496"/>
@@ -4759,12 +4759,12 @@ Download size: %3</source>
     <message>
         <location filename="../SettingsView.cpp" line="452"/>
         <source>Select image</source>
-        <translation type="unfinished">이미지 선택</translation>
+        <translation>이미지 선택</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="452"/>
         <source>Image file (*.png *.jpg *.jpeg)</source>
-        <translation type="unfinished">이미지 파일 (*.png *.jpg *.jpeg)</translation>
+        <translation>이미지 파일 (*.png *.jpg *.jpeg)</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="850"/>
@@ -5067,7 +5067,7 @@ Download size: %3</source>
     <message>
         <location filename="../SettingsView.ui" line="941"/>
         <source>Custom border:</source>
-        <translation type="unfinished"></translation>
+        <translation>커스텀 테두리:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="952"/>
@@ -5112,7 +5112,7 @@ Download size: %3</source>
     <message>
         <location filename="../SettingsView.ui" line="1201"/>
         <source>Rewind speed:</source>
-        <translation type="unfinished"></translation>
+        <translation>되감기 속도:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="2171"/>
@@ -6325,12 +6325,12 @@ Download size: %3</source>
     <message>
         <location filename="../Window.cpp" line="1445"/>
         <source>Increase fast forward speed</source>
-        <translation type="unfinished"></translation>
+        <translation>빨리 감기 속도 향상</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1452"/>
         <source>Decrease fast forward speed</source>
-        <translation type="unfinished"></translation>
+        <translation>빨리 감기 속도 줄이기</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1459"/>
@@ -6769,17 +6769,17 @@ Download size: %3</source>
     <message>
         <location filename="../utils.cpp" line="146"/>
         <source>Super (L)</source>
-        <translation type="unfinished">슈퍼 (L)</translation>
+        <translation>슈퍼 (L)</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="148"/>
         <source>Super (R)</source>
-        <translation type="unfinished">슈퍼 (R)</translation>
+        <translation>슈퍼 (R)</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="150"/>
         <source>Menu</source>
-        <translation type="unfinished">메뉴</translation>
+        <translation>메뉴</translation>
     </message>
 </context>
 <context>

From 31941d7a25bc35cd5dc4a05b1ce0fc6d89a1cf94 Mon Sep 17 00:00:00 2001
From: Felipe <felipefplzx@gmail.com>
Date: Tue, 1 Aug 2023 13:33:20 +0000
Subject: [PATCH 39/53] Qt: Update translation (Portuguese (Brazil))

Translation: mGBA/Qt
Translate-URL: https://hosted.weblate.org/projects/mgba/mgba-qt/pt_BR/
---
 src/platform/qt/ts/mgba-pt_BR.ts | 32 +++++++++++++++++---------------
 1 file changed, 17 insertions(+), 15 deletions(-)

diff --git a/src/platform/qt/ts/mgba-pt_BR.ts b/src/platform/qt/ts/mgba-pt_BR.ts
index 2cbfde528..77573eb1b 100644
--- a/src/platform/qt/ts/mgba-pt_BR.ts
+++ b/src/platform/qt/ts/mgba-pt_BR.ts
@@ -716,7 +716,7 @@ Tamanho do download: %3</translation>
     <message>
         <location filename="../ForwarderView.cpp" line="192"/>
         <source>Image files (*.png *.jpg *.bmp)</source>
-        <translation type="unfinished"></translation>
+        <translation>Arquivo da imagem (*.png *.jpg *.bmp)</translation>
     </message>
 </context>
 <context>
@@ -3752,17 +3752,17 @@ Tamanho do download: %3</translation>
     <message>
         <location filename="../MultiplayerController.cpp" line="327"/>
         <source>Trying to detach a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>Tentando desconectar um jogador multiplayer que não está conectado</translation>
     </message>
     <message>
         <location filename="../MultiplayerController.cpp" line="391"/>
         <source>Trying to get player ID for a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>Tentando obter a ID do jogador pra um jogador multiplayer que não está conectado</translation>
     </message>
     <message>
         <location filename="../MultiplayerController.cpp" line="405"/>
         <source>Trying to get save ID for a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>Tentando obter a ID salva pra um jogador multiplayer que não está conectado</translation>
     </message>
 </context>
 <context>
@@ -4310,7 +4310,7 @@ Tamanho do download: %3</translation>
     <message>
         <location filename="../ROMInfo.ui" line="114"/>
         <source>Save file:</source>
-        <translation type="unfinished"></translation>
+        <translation>Arquivo do save:</translation>
     </message>
 </context>
 <context>
@@ -4477,7 +4477,7 @@ Tamanho do download: %3</translation>
     <message>
         <location filename="../SaveConverter.cpp" line="487"/>
         <source> + RTC</source>
-        <translation type="unfinished"></translation>
+        <translation> + RTC</translation>
     </message>
     <message>
         <location filename="../SaveConverter.cpp" line="496"/>
@@ -4759,12 +4759,12 @@ Tamanho do download: %3</translation>
     <message>
         <location filename="../SettingsView.cpp" line="452"/>
         <source>Select image</source>
-        <translation type="unfinished">Selecionar imagem</translation>
+        <translation>Selecionar imagem</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="452"/>
         <source>Image file (*.png *.jpg *.jpeg)</source>
-        <translation type="unfinished">Arquivo da imagem (*.png *.jpg *.jpeg)</translation>
+        <translation>Arquivo da imagem (*.png *.jpg *.jpeg)</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="850"/>
@@ -4792,6 +4792,7 @@ Tamanho do download: %3</translation>
         <translation>
             <numerusform>%n hora atrás</numerusform>
             <numerusform>%n horas atrás</numerusform>
+            <numerusform></numerusform>
         </translation>
     </message>
     <message numerus="yes">
@@ -4800,6 +4801,7 @@ Tamanho do download: %3</translation>
         <translation>
             <numerusform>%n dia atrás</numerusform>
             <numerusform>%n dias atrás</numerusform>
+            <numerusform></numerusform>
         </translation>
     </message>
     <message>
@@ -5089,7 +5091,7 @@ Tamanho do download: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="941"/>
         <source>Custom border:</source>
-        <translation type="unfinished"></translation>
+        <translation>Borda personalizada:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="952"/>
@@ -5134,7 +5136,7 @@ Tamanho do download: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="1201"/>
         <source>Rewind speed:</source>
-        <translation type="unfinished"></translation>
+        <translation>Velocidade do retrocesso:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="2171"/>
@@ -6388,12 +6390,12 @@ Tamanho do download: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1445"/>
         <source>Increase fast forward speed</source>
-        <translation type="unfinished"></translation>
+        <translation>Aumentar a velocidade do avanço rápido</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1452"/>
         <source>Decrease fast forward speed</source>
-        <translation type="unfinished"></translation>
+        <translation>Diminuir a velocidade do avanço rápido</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1459"/>
@@ -6771,17 +6773,17 @@ Tamanho do download: %3</translation>
     <message>
         <location filename="../utils.cpp" line="146"/>
         <source>Super (L)</source>
-        <translation type="unfinished">Super (E)</translation>
+        <translation>Super (E)</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="148"/>
         <source>Super (R)</source>
-        <translation type="unfinished">Super (D)</translation>
+        <translation>Super (D)</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="150"/>
         <source>Menu</source>
-        <translation type="unfinished">Menu</translation>
+        <translation>Menu</translation>
     </message>
 </context>
 <context>

From ded5c786e306969b5f3079c956af1d694adf2ad7 Mon Sep 17 00:00:00 2001
From: Eryk Michalak <gnu.ewm@protonmail.com>
Date: Sat, 30 Sep 2023 10:54:29 +0000
Subject: [PATCH 40/53] Qt: Update translation (Polish)

Translation: mGBA/Qt
Translate-URL: https://hosted.weblate.org/projects/mgba/mgba-qt/pl/
---
 src/platform/qt/ts/mgba-pl.ts | 30 +++++++++++++++---------------
 1 file changed, 15 insertions(+), 15 deletions(-)

diff --git a/src/platform/qt/ts/mgba-pl.ts b/src/platform/qt/ts/mgba-pl.ts
index 180b32630..650563e2e 100644
--- a/src/platform/qt/ts/mgba-pl.ts
+++ b/src/platform/qt/ts/mgba-pl.ts
@@ -716,7 +716,7 @@ Rozmiar pobierania: %3</translation>
     <message>
         <location filename="../ForwarderView.cpp" line="192"/>
         <source>Image files (*.png *.jpg *.bmp)</source>
-        <translation type="unfinished"></translation>
+        <translation>Obrazy (*.png *.jpg *.bmp)</translation>
     </message>
 </context>
 <context>
@@ -3752,17 +3752,17 @@ Rozmiar pobierania: %3</translation>
     <message>
         <location filename="../MultiplayerController.cpp" line="327"/>
         <source>Trying to detach a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>Próba odłączenia gracza multiplayer, który nie jest dołączony</translation>
     </message>
     <message>
         <location filename="../MultiplayerController.cpp" line="391"/>
         <source>Trying to get player ID for a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>Próba uzyskania ID gracza w trybie wieloosobowym, który nie jest połączony</translation>
     </message>
     <message>
         <location filename="../MultiplayerController.cpp" line="405"/>
         <source>Trying to get save ID for a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>Próba uzyskania identyfikatora zapisu dla gracza multiplayer, który nie jest połączony</translation>
     </message>
 </context>
 <context>
@@ -4310,7 +4310,7 @@ Rozmiar pobierania: %3</translation>
     <message>
         <location filename="../ROMInfo.ui" line="114"/>
         <source>Save file:</source>
-        <translation type="unfinished"></translation>
+        <translation>Zapisz plik:</translation>
     </message>
 </context>
 <context>
@@ -4477,7 +4477,7 @@ Rozmiar pobierania: %3</translation>
     <message>
         <location filename="../SaveConverter.cpp" line="487"/>
         <source> + RTC</source>
-        <translation type="unfinished"></translation>
+        <translation> + RTC</translation>
     </message>
     <message>
         <location filename="../SaveConverter.cpp" line="496"/>
@@ -4759,12 +4759,12 @@ Rozmiar pobierania: %3</translation>
     <message>
         <location filename="../SettingsView.cpp" line="452"/>
         <source>Select image</source>
-        <translation type="unfinished">Wybierz obraz</translation>
+        <translation>Wybierz obraz</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="452"/>
         <source>Image file (*.png *.jpg *.jpeg)</source>
-        <translation type="unfinished">Plik graficzny (*.png *.jpg *.jpeg)</translation>
+        <translation>Plik graficzny (*.png *.jpg *.jpeg)</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="850"/>
@@ -5251,7 +5251,7 @@ Rozmiar pobierania: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="941"/>
         <source>Custom border:</source>
-        <translation type="unfinished"></translation>
+        <translation>Niestandardowa ramka:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1059"/>
@@ -5287,7 +5287,7 @@ Rozmiar pobierania: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="1201"/>
         <source>Rewind speed:</source>
-        <translation type="unfinished"></translation>
+        <translation>Prędkość przewijania:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1238"/>
@@ -6405,12 +6405,12 @@ Rozmiar pobierania: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1445"/>
         <source>Increase fast forward speed</source>
-        <translation type="unfinished"></translation>
+        <translation>Zwiększenie prędkości przewijania do przodu</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1452"/>
         <source>Decrease fast forward speed</source>
-        <translation type="unfinished"></translation>
+        <translation>Zmiejszenie prędkości przewijania do przodu</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1459"/>
@@ -6773,17 +6773,17 @@ Rozmiar pobierania: %3</translation>
     <message>
         <location filename="../utils.cpp" line="146"/>
         <source>Super (L)</source>
-        <translation type="unfinished">Super (L)</translation>
+        <translation>Super (L)</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="148"/>
         <source>Super (R)</source>
-        <translation type="unfinished">Super (R)</translation>
+        <translation>Super (R)</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="150"/>
         <source>Menu</source>
-        <translation type="unfinished">Menu</translation>
+        <translation>Menu</translation>
     </message>
 </context>
 <context>

From 084edc2215f4b19f1dc17aeab3cc77828fa91448 Mon Sep 17 00:00:00 2001
From: Ensar Melih Bulut <muhammedensarozketen@gmail.com>
Date: Tue, 17 Oct 2023 20:39:46 +0000
Subject: [PATCH 41/53] Qt: Update translation (Turkish)

Translation: mGBA/Qt
Translate-URL: https://hosted.weblate.org/projects/mgba/mgba-qt/tr/
---
 src/platform/qt/ts/mgba-tr.ts | 47 +++++++++++++++++++----------------
 1 file changed, 26 insertions(+), 21 deletions(-)

diff --git a/src/platform/qt/ts/mgba-tr.ts b/src/platform/qt/ts/mgba-tr.ts
index d239b59c2..73ab0b7ca 100644
--- a/src/platform/qt/ts/mgba-tr.ts
+++ b/src/platform/qt/ts/mgba-tr.ts
@@ -6,22 +6,22 @@
     <message>
         <location filename="../utils.cpp" line="89"/>
         <source>Game Boy Advance ROMs (%1)</source>
-        <translation type="unfinished">Game Boy Advance ROMları (%1)</translation>
+        <translation>Game Boy Advance ROM&apos;ları (%1)</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="106"/>
         <source>Game Boy ROMs (%1)</source>
-        <translation type="unfinished">Game Boy ROMları (%1)</translation>
+        <translation>Game Boy ROM&apos;ları (%1)</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="110"/>
         <source>All ROMs (%1)</source>
-        <translation type="unfinished">Bütün ROMlar (%1)</translation>
+        <translation>Bütün ROM&apos;lar (%1)</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="112"/>
         <source>%1 Video Logs (*.mvl)</source>
-        <translation type="unfinished"></translation>
+        <translation>%1 Video Günlükleri (*.mvl)</translation>
     </message>
 </context>
 <context>
@@ -64,47 +64,52 @@ Game Boy Advance, Nintendo Co., Ltd.&apos;nin tescilli ticari markasıdır.</tra
     <message>
         <location filename="../ApplicationUpdatePrompt.ui" line="14"/>
         <source>An update is available</source>
-        <translation type="unfinished"></translation>
+        <translation>Bir güncelleme mevcut</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdatePrompt.cpp" line="26"/>
         <source>An update to %1 is available.
 </source>
-        <translation type="unfinished"></translation>
+        <translation>%1 için bir güncelleme mevcut.
+</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdatePrompt.cpp" line="38"/>
         <source>
 Do you want to download and install it now? You will need to restart the emulator when the download is complete.</source>
-        <translation type="unfinished"></translation>
+        <translation>
+Şimdi indirip yüklemek istiyor musunuz? İndirme işlemi tamamlandığında öykünücüyü yeniden başlatmanız gerekecektir.</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdatePrompt.cpp" line="41"/>
         <source>
 Auto-update is not available on this platform. If you wish to update you will need to do it manually.</source>
-        <translation type="unfinished"></translation>
+        <translation>
+Otomatik güncelleme bu platformda mevcut değildir. Güncellemek istiyorsanız bunu manuel olarak yapmanız gerekecektir.</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdatePrompt.cpp" line="45"/>
         <source>Current version: %1
 New version: %2
 Download size: %3</source>
-        <translation type="unfinished"></translation>
+        <translation>Güncel sürüm: %1
+Yeni sürüm: %2
+İndirme boyutu: %3</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdatePrompt.cpp" line="63"/>
         <source>Downloading update...</source>
-        <translation type="unfinished"></translation>
+        <translation>Güncelleme indiriliyor...</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdatePrompt.cpp" line="79"/>
         <source>Downloading failed. Please update manually.</source>
-        <translation type="unfinished"></translation>
+        <translation>İndirme başarısız oldu. Lütfen manuel olarak güncelleyin.</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdatePrompt.cpp" line="82"/>
         <source>Downloading done. Press OK to restart %1 and install the update.</source>
-        <translation type="unfinished"></translation>
+        <translation>İndirme tamamlandı. %1 yeniden başlatmak ve güncellemeyi yüklemek için Tamam&apos;a basın.</translation>
     </message>
 </context>
 <context>
@@ -112,22 +117,22 @@ Download size: %3</source>
     <message>
         <location filename="../ApplicationUpdater.cpp" line="90"/>
         <source>Stable</source>
-        <translation type="unfinished"></translation>
+        <translation>Kararlı</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdater.cpp" line="93"/>
         <source>Development</source>
-        <translation type="unfinished"></translation>
+        <translation>Geliştirme</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdater.cpp" line="95"/>
         <source>Unknown</source>
-        <translation type="unfinished">Bilinmeyen</translation>
+        <translation>Bilinmeyen</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdater.cpp" line="236"/>
         <source>(None)</source>
-        <translation type="unfinished"></translation>
+        <translation>(Yok)</translation>
     </message>
 </context>
 <context>
@@ -188,17 +193,17 @@ Download size: %3</source>
     <message>
         <location filename="../AudioDevice.cpp" line="26"/>
         <source>Can&apos;t set format of context-less audio device</source>
-        <translation type="unfinished"></translation>
+        <translation>Bağlamdan bağımsız ses cihazının formatı ayarlanamıyor</translation>
     </message>
     <message>
         <location filename="../AudioDevice.cpp" line="44"/>
         <source>Audio device is missing its core</source>
-        <translation type="unfinished"></translation>
+        <translation>Ses cihazının çekirdeği eksik</translation>
     </message>
     <message>
         <location filename="../AudioDevice.cpp" line="62"/>
         <source>Writing data to read-only audio device</source>
-        <translation type="unfinished"></translation>
+        <translation>Salt okunur ses cihazına veri yazma</translation>
     </message>
 </context>
 <context>
@@ -6074,7 +6079,7 @@ Download size: %3</source>
     <message>
         <location filename="../Window.cpp" line="1119"/>
         <source>This will make the emulator load its configuration from the same directory as the executable. Do you want to continue?</source>
-        <translation>Emülatörün yapılandırmasını yürütülebilir dosya ile aynı dizinden yüklemesini sağlar. Devam etmek istiyor musun?</translation>
+        <translation>Öyküncünün yapılandırmasını yürütülebilir dosya ile aynı dizinden yüklemesini sağlar. Devam etmek istiyor musunuz?</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1131"/>
@@ -6084,7 +6089,7 @@ Download size: %3</source>
     <message>
         <location filename="../Window.cpp" line="1132"/>
         <source>Some changes will not take effect until the emulator is restarted.</source>
-        <translation>Bazı değişiklikler emülatör yeniden başlatılıncaya kadar etkili olmaz.</translation>
+        <translation>Bazı değişiklikler öyküncü yeniden başlatılıncaya kadar etkili olmaz.</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1183"/>

From 0f319ea3dd3dfabcd39ed8b071a3131331348f6b Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Enes=20=C3=87etinkal?= <cetinkalenes@gmail.com>
Date: Sat, 27 Jan 2024 19:42:44 +0000
Subject: [PATCH 42/53] Qt: Update translation (Turkish)

Translation: mGBA/Qt
Translate-URL: https://hosted.weblate.org/projects/mgba/mgba-qt/tr/
---
 src/platform/qt/ts/mgba-tr.ts | 26 +++++++++++++-------------
 1 file changed, 13 insertions(+), 13 deletions(-)

diff --git a/src/platform/qt/ts/mgba-tr.ts b/src/platform/qt/ts/mgba-tr.ts
index 73ab0b7ca..a98e0639b 100644
--- a/src/platform/qt/ts/mgba-tr.ts
+++ b/src/platform/qt/ts/mgba-tr.ts
@@ -211,7 +211,7 @@ Yeni sürüm: %2
     <message>
         <location filename="../AudioProcessorQt.cpp" line="43"/>
         <source>Can&apos;t start an audio processor without input</source>
-        <translation type="unfinished"></translation>
+        <translation>Girişsiz ses işlemcisi başlatılamaz</translation>
     </message>
 </context>
 <context>
@@ -219,7 +219,7 @@ Yeni sürüm: %2
     <message>
         <location filename="../AudioProcessorSDL.cpp" line="34"/>
         <source>Can&apos;t start an audio processor without input</source>
-        <translation type="unfinished"></translation>
+        <translation>Girişsiz ses işlemcisi başlatılamaz</translation>
     </message>
 </context>
 <context>
@@ -287,28 +287,28 @@ Yeni sürüm: %2
     <message>
         <location filename="../BattleChipView.cpp" line="117"/>
         <source>BattleChip data missing</source>
-        <translation type="unfinished"></translation>
+        <translation>BattleChip verisi yok</translation>
     </message>
     <message>
         <location filename="../BattleChipView.cpp" line="118"/>
         <source>BattleChip data is missing. BattleChip Gates will still work, but some graphics will be missing. Would you like to download the data now?</source>
-        <translation type="unfinished"></translation>
+        <translation>BattleChip verisi yok. Bazı grafikler olmadan BattleChip Gates hala çalışır. Verileri şimdi indirmek istermisin?</translation>
     </message>
     <message>
         <location filename="../BattleChipView.cpp" line="184"/>
         <location filename="../BattleChipView.cpp" line="203"/>
         <source>Select deck file</source>
-        <translation type="unfinished"></translation>
+        <translation>Deste dosyası seç</translation>
     </message>
     <message>
         <location filename="../BattleChipView.cpp" line="215"/>
         <source>Incompatible deck</source>
-        <translation type="unfinished"></translation>
+        <translation>Uyumsuz deste</translation>
     </message>
     <message>
         <location filename="../BattleChipView.cpp" line="216"/>
         <source>The selected deck is not compatible with this Chip Gate</source>
-        <translation type="unfinished"></translation>
+        <translation>Seçilen deste bu Chip Gate ile uyumlu değildir</translation>
     </message>
 </context>
 <context>
@@ -334,7 +334,7 @@ Yeni sürüm: %2
     <message>
         <location filename="../CheatsView.ui" line="39"/>
         <source>Add New Code</source>
-        <translation type="unfinished"></translation>
+        <translation>Yeni Kod Ekle</translation>
     </message>
     <message>
         <location filename="../CheatsView.ui" line="60"/>
@@ -344,12 +344,12 @@ Yeni sürüm: %2
     <message>
         <location filename="../CheatsView.ui" line="93"/>
         <source>Add Lines</source>
-        <translation type="unfinished"></translation>
+        <translation>Satır ekle</translation>
     </message>
     <message>
         <location filename="../CheatsView.ui" line="100"/>
         <source>Code type</source>
-        <translation type="unfinished"></translation>
+        <translation>Kod tipi</translation>
     </message>
     <message>
         <location filename="../CheatsView.ui" line="53"/>
@@ -370,7 +370,7 @@ Yeni sürüm: %2
         <location filename="../CheatsView.cpp" line="50"/>
         <location filename="../CheatsView.cpp" line="58"/>
         <source>Autodetect (recommended)</source>
-        <translation type="unfinished"></translation>
+        <translation>Otoseç (tavsiye edilir)</translation>
     </message>
     <message>
         <location filename="../CheatsView.cpp" line="88"/>
@@ -381,7 +381,7 @@ Yeni sürüm: %2
     <message>
         <location filename="../CheatsView.cpp" line="187"/>
         <source>Some cheats could not be added. Please ensure they&apos;re formatted correctly and/or try other cheat types.</source>
-        <translation type="unfinished"></translation>
+        <translation>Bazı hileler eklenemedi. Lütfen onların doğru formatlandığından emin ol ve/yada başa hile tiplerini dene.</translation>
     </message>
 </context>
 <context>
@@ -400,7 +400,7 @@ Yeni sürüm: %2
     <message>
         <location filename="../CoreController.cpp" line="596"/>
         <source>Reset the game?</source>
-        <translation type="unfinished"></translation>
+        <translation>Oyun sıfırlansım mı?</translation>
     </message>
     <message>
         <location filename="../CoreController.cpp" line="597"/>

From 62b455c342fd49072920b4cd16fcc4e3d7d450a2 Mon Sep 17 00:00:00 2001
From: Guih48 <guih48@gmail.hu>
Date: Fri, 20 Oct 2023 16:42:39 +0000
Subject: [PATCH 43/53] Qt: Update translation (Hungarian)

Translation: mGBA/Qt
Translate-URL: https://hosted.weblate.org/projects/mgba/mgba-qt/hu/
---
 src/platform/qt/ts/mgba-hu.ts | 72 +++++++++++++++++++----------------
 1 file changed, 39 insertions(+), 33 deletions(-)

diff --git a/src/platform/qt/ts/mgba-hu.ts b/src/platform/qt/ts/mgba-hu.ts
index 4e5f7e1f0..6db9b2da9 100644
--- a/src/platform/qt/ts/mgba-hu.ts
+++ b/src/platform/qt/ts/mgba-hu.ts
@@ -21,7 +21,7 @@
     <message>
         <location filename="../utils.cpp" line="112"/>
         <source>%1 Video Logs (*.mvl)</source>
-        <translation type="unfinished"></translation>
+        <translation>%1 Videonaplók (*.mvl)</translation>
     </message>
 </context>
 <context>
@@ -50,8 +50,9 @@
         <location filename="../AboutScreen.ui" line="86"/>
         <source>© 2013 – {year} Jeffrey Pfau, licensed under the Mozilla Public License, version 2.0
 Game Boy Advance is a registered trademark of Nintendo Co., Ltd.</source>
-        <translation type="unfinished">© 2013 – {year} Jeffrey Pfau, a Mozilla Public License 2.0 alatt licencelve
-A Game Boy Advance a Nintendo Co., Ltd. bejegyzett védjegye</translation>
+        <translation>© 2013 – {year} Jeffrey Pfau, a Mozilla Public License 2.0 alatt licencelve.
+
+A Game Boy Advance a Nintendo Co., Ltd. bejegyzett védjegye.</translation>
     </message>
     <message>
         <location filename="../AboutScreen.ui" line="177"/>
@@ -64,47 +65,52 @@ A Game Boy Advance a Nintendo Co., Ltd. bejegyzett védjegye</translation>
     <message>
         <location filename="../ApplicationUpdatePrompt.ui" line="14"/>
         <source>An update is available</source>
-        <translation type="unfinished"></translation>
+        <translation>Egy frissítés érhető el</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdatePrompt.cpp" line="26"/>
         <source>An update to %1 is available.
 </source>
-        <translation type="unfinished"></translation>
+        <translation>Egy frissítés elérhető %1 verzióra.
+</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdatePrompt.cpp" line="38"/>
         <source>
 Do you want to download and install it now? You will need to restart the emulator when the download is complete.</source>
-        <translation type="unfinished"></translation>
+        <translation>
+Szeretné most letöleni és telepíteni? Az emulátor újraindítására lesz szükség a letöltés befejezésekor.</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdatePrompt.cpp" line="41"/>
         <source>
 Auto-update is not available on this platform. If you wish to update you will need to do it manually.</source>
-        <translation type="unfinished"></translation>
+        <translation>
+Az automatikus frisítés ezen platformon nem elérhető, a frissítéseket manuálisan telepíthetők.</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdatePrompt.cpp" line="45"/>
         <source>Current version: %1
 New version: %2
 Download size: %3</source>
-        <translation type="unfinished"></translation>
+        <translation>Jelenlegi verzió: %1
+Új verzió: %2
+Letöltendő adat: %3</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdatePrompt.cpp" line="63"/>
         <source>Downloading update...</source>
-        <translation type="unfinished"></translation>
+        <translation>Frissítés letöltése...</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdatePrompt.cpp" line="79"/>
         <source>Downloading failed. Please update manually.</source>
-        <translation type="unfinished"></translation>
+        <translation>A letöltés meghiúsult. Próbálja meg manuálisan frissíteni aprogramot.</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdatePrompt.cpp" line="82"/>
         <source>Downloading done. Press OK to restart %1 and install the update.</source>
-        <translation type="unfinished"></translation>
+        <translation>A letöltés kész. Nyomja meg az OK gombot %1 újraindításához és a frissítés telepítéséhez.</translation>
     </message>
 </context>
 <context>
@@ -112,22 +118,22 @@ Download size: %3</source>
     <message>
         <location filename="../ApplicationUpdater.cpp" line="90"/>
         <source>Stable</source>
-        <translation type="unfinished"></translation>
+        <translation>Stabil</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdater.cpp" line="93"/>
         <source>Development</source>
-        <translation type="unfinished"></translation>
+        <translation>Fejlesztési</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdater.cpp" line="95"/>
         <source>Unknown</source>
-        <translation type="unfinished"></translation>
+        <translation>Nem ismert</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdater.cpp" line="236"/>
         <source>(None)</source>
-        <translation type="unfinished"></translation>
+        <translation>(nincs)</translation>
     </message>
 </context>
 <context>
@@ -148,7 +154,7 @@ Download size: %3</source>
     <message>
         <location filename="../AssetTile.ui" line="41"/>
         <source>Tile #</source>
-        <translation type="unfinished"></translation>
+        <translation>Cím #</translation>
     </message>
     <message>
         <location filename="../AssetTile.ui" line="65"/>
@@ -232,7 +238,7 @@ Download size: %3</source>
     <message>
         <location filename="../BattleChipView.ui" line="76"/>
         <source>Insert</source>
-        <translation type="unfinished"></translation>
+        <translation>Beszúrás</translation>
     </message>
     <message>
         <location filename="../BattleChipView.ui" line="87"/>
@@ -329,7 +335,7 @@ Download size: %3</source>
     <message>
         <location filename="../CheatsView.ui" line="39"/>
         <source>Add New Code</source>
-        <translation type="unfinished"></translation>
+        <translation>Új kód hozzáadása</translation>
     </message>
     <message>
         <location filename="../CheatsView.ui" line="60"/>
@@ -339,12 +345,12 @@ Download size: %3</source>
     <message>
         <location filename="../CheatsView.ui" line="93"/>
         <source>Add Lines</source>
-        <translation type="unfinished"></translation>
+        <translation>Sorok hozzáadása</translation>
     </message>
     <message>
         <location filename="../CheatsView.ui" line="100"/>
         <source>Code type</source>
-        <translation type="unfinished"></translation>
+        <translation>Kód típusa</translation>
     </message>
     <message>
         <location filename="../CheatsView.ui" line="53"/>
@@ -365,7 +371,7 @@ Download size: %3</source>
         <location filename="../CheatsView.cpp" line="50"/>
         <location filename="../CheatsView.cpp" line="58"/>
         <source>Autodetect (recommended)</source>
-        <translation type="unfinished"></translation>
+        <translation>Automatikus felisnerés (javasolt)</translation>
     </message>
     <message>
         <location filename="../CheatsView.cpp" line="88"/>
@@ -376,7 +382,7 @@ Download size: %3</source>
     <message>
         <location filename="../CheatsView.cpp" line="187"/>
         <source>Some cheats could not be added. Please ensure they&apos;re formatted correctly and/or try other cheat types.</source>
-        <translation type="unfinished"></translation>
+        <translation>Néhány csalást nem sikerült betölteni. Ellenőrizze, hogy helyesen formázottak-e és/vagy próbáljon ki más csalástípust!</translation>
     </message>
 </context>
 <context>
@@ -390,7 +396,7 @@ Download size: %3</source>
         <location filename="../CoreController.cpp" line="536"/>
         <location filename="../CoreController.cpp" line="553"/>
         <source>Rewinding not currently enabled</source>
-        <translation type="unfinished"></translation>
+        <translation>Visszatekerés jelenleg nem engedélyezett</translation>
     </message>
     <message>
         <location filename="../CoreController.cpp" line="596"/>
@@ -451,7 +457,7 @@ Download size: %3</source>
     <message>
         <location filename="../DebuggerConsole.ui" line="14"/>
         <source>Debugger</source>
-        <translation type="unfinished">Hibakereső</translation>
+        <translation>Hibakereső</translation>
     </message>
     <message>
         <location filename="../DebuggerConsole.ui" line="20"/>
@@ -477,7 +483,7 @@ Download size: %3</source>
     <message>
         <location filename="../DolphinConnector.ui" line="14"/>
         <source>Connect to Dolphin</source>
-        <translation type="unfinished">Csatlakozás Dolphin emulátorhoz</translation>
+        <translation>Csatlakozás Dolphin emulátorhoz</translation>
     </message>
     <message>
         <location filename="../DolphinConnector.ui" line="23"/>
@@ -512,12 +518,12 @@ Download size: %3</source>
     <message>
         <location filename="../DolphinConnector.cpp" line="57"/>
         <source>Couldn&apos;t Connect</source>
-        <translation type="unfinished"></translation>
+        <translation>Nem sikerült csatlakozni</translation>
     </message>
     <message>
         <location filename="../DolphinConnector.cpp" line="58"/>
         <source>Could not connect to Dolphin.</source>
-        <translation type="unfinished"></translation>
+        <translation>Nem sikerült csatlakozni Dolphin emulátorhoz.</translation>
     </message>
 </context>
 <context>
@@ -719,7 +725,7 @@ Download size: %3</source>
     <message>
         <location filename="../FrameView.ui" line="14"/>
         <source>Inspect frame</source>
-        <translation type="unfinished">Képkocka vizsgáló</translation>
+        <translation>Képkocka vizsgálata</translation>
     </message>
     <message>
         <location filename="../FrameView.ui" line="41"/>
@@ -965,22 +971,22 @@ Download size: %3</source>
         <location filename="../GameBoy.cpp" line="60"/>
         <location filename="../GameBoy.cpp" line="79"/>
         <source>Autodetect</source>
-        <translation type="unfinished">Automatikus észlelés</translation>
+        <translation>Automatikus észlelés</translation>
     </message>
     <message>
         <location filename="../GameBoy.cpp" line="61"/>
         <source>Game Boy (DMG)</source>
-        <translation type="unfinished"></translation>
+        <translation>Game Boy (DMG)</translation>
     </message>
     <message>
         <location filename="../GameBoy.cpp" line="62"/>
         <source>Game Boy Pocket (MGB)</source>
-        <translation type="unfinished"></translation>
+        <translation>Game Boy Pocket (MGB)</translation>
     </message>
     <message>
         <location filename="../GameBoy.cpp" line="63"/>
         <source>Super Game Boy (SGB)</source>
-        <translation type="unfinished"></translation>
+        <translation type="unfinished">Super Game Boy (SGB)</translation>
     </message>
     <message>
         <location filename="../GameBoy.cpp" line="64"/>
@@ -1138,7 +1144,7 @@ Download size: %3</source>
     <message>
         <location filename="../IOViewer.ui" line="26"/>
         <source>0x0000</source>
-        <translation type="unfinished"></translation>
+        <translation>0x0000</translation>
     </message>
     <message>
         <location filename="../IOViewer.ui" line="367"/>

From b60086cfd55e75cbd699478e187cc050721a78e5 Mon Sep 17 00:00:00 2001
From: Anatolij Vasilev <function@returnnull.de>
Date: Fri, 3 Nov 2023 10:39:49 +0000
Subject: [PATCH 44/53] Qt: Update translation (German)

Translation: mGBA/Qt
Translate-URL: https://hosted.weblate.org/projects/mgba/mgba-qt/de/
---
 src/platform/qt/ts/mgba-de.ts | 48 +++++++++++++++++------------------
 1 file changed, 24 insertions(+), 24 deletions(-)

diff --git a/src/platform/qt/ts/mgba-de.ts b/src/platform/qt/ts/mgba-de.ts
index a1d1b2e15..ce7f38c30 100644
--- a/src/platform/qt/ts/mgba-de.ts
+++ b/src/platform/qt/ts/mgba-de.ts
@@ -70,7 +70,7 @@ Game Boy Advance ist eine eingetragene Marke von Nintendo Co., Ltd.</translation
         <location filename="../ApplicationUpdatePrompt.cpp" line="26"/>
         <source>An update to %1 is available.
 </source>
-        <translation>Ein Update für %1 ist verfügbar.
+        <translation>Ein Update auf %1 ist verfügbar.
 </translation>
     </message>
     <message>
@@ -132,7 +132,7 @@ Download-Größe: %3</translation>
     <message>
         <location filename="../ApplicationUpdater.cpp" line="236"/>
         <source>(None)</source>
-        <translation>(keiner)</translation>
+        <translation>(Nichts)</translation>
     </message>
 </context>
 <context>
@@ -145,7 +145,7 @@ Download-Größe: %3</translation>
     <message>
         <location filename="../ArchiveInspector.ui" line="20"/>
         <source>Loading...</source>
-        <translation>Laden&#xa0;…</translation>
+        <translation>Lädt&#xa0;…</translation>
     </message>
 </context>
 <context>
@@ -198,7 +198,7 @@ Download-Größe: %3</translation>
     <message>
         <location filename="../AudioDevice.cpp" line="44"/>
         <source>Audio device is missing its core</source>
-        <translation>Dem Audio-Gerät fehlt ein Core</translation>
+        <translation>Dem Audio-Gerät fehlt sein Core</translation>
     </message>
     <message>
         <location filename="../AudioDevice.cpp" line="62"/>
@@ -395,7 +395,7 @@ Download-Größe: %3</translation>
         <location filename="../CoreController.cpp" line="536"/>
         <location filename="../CoreController.cpp" line="553"/>
         <source>Rewinding not currently enabled</source>
-        <translation>Rücklauf ist derzeit nicht aktiviert</translation>
+        <translation>Zurückspulen ist derzeit nicht aktiviert</translation>
     </message>
     <message>
         <location filename="../CoreController.cpp" line="596"/>
@@ -716,7 +716,7 @@ Download-Größe: %3</translation>
     <message>
         <location filename="../ForwarderView.cpp" line="192"/>
         <source>Image files (*.png *.jpg *.bmp)</source>
-        <translation type="unfinished"></translation>
+        <translation>Bilddateien (*.png *.jpg *.bmp)</translation>
     </message>
 </context>
 <context>
@@ -724,7 +724,7 @@ Download-Größe: %3</translation>
     <message>
         <location filename="../FrameView.ui" line="14"/>
         <source>Inspect frame</source>
-        <translation>Bild beobachten</translation>
+        <translation>Frame untersuchen</translation>
     </message>
     <message>
         <location filename="../FrameView.ui" line="41"/>
@@ -734,7 +734,7 @@ Download-Größe: %3</translation>
     <message>
         <location filename="../FrameView.ui" line="50"/>
         <source>Freeze frame</source>
-        <translation>Bild einfrieren</translation>
+        <translation>Frame einfrieren</translation>
     </message>
     <message>
         <location filename="../FrameView.ui" line="84"/>
@@ -3752,17 +3752,17 @@ Download-Größe: %3</translation>
     <message>
         <location filename="../MultiplayerController.cpp" line="327"/>
         <source>Trying to detach a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>Versuch Multiplayer-Spieler zu trennen der nicht verbunden ist</translation>
     </message>
     <message>
         <location filename="../MultiplayerController.cpp" line="391"/>
         <source>Trying to get player ID for a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>Versuch Spieler-ID festzustellen von einem Multiplayer-Spieler der nicht verbunden ist</translation>
     </message>
     <message>
         <location filename="../MultiplayerController.cpp" line="405"/>
         <source>Trying to get save ID for a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>Versuch Speicherstand-ID festzustellen von einem Multiplayer-Spieler der nicht verbunden ist</translation>
     </message>
 </context>
 <context>
@@ -4310,7 +4310,7 @@ Download-Größe: %3</translation>
     <message>
         <location filename="../ROMInfo.ui" line="114"/>
         <source>Save file:</source>
-        <translation type="unfinished"></translation>
+        <translation>Speicherstand:</translation>
     </message>
 </context>
 <context>
@@ -4477,7 +4477,7 @@ Download-Größe: %3</translation>
     <message>
         <location filename="../SaveConverter.cpp" line="487"/>
         <source> + RTC</source>
-        <translation type="unfinished"></translation>
+        <translation> + RTC</translation>
     </message>
     <message>
         <location filename="../SaveConverter.cpp" line="496"/>
@@ -4759,12 +4759,12 @@ Download-Größe: %3</translation>
     <message>
         <location filename="../SettingsView.cpp" line="452"/>
         <source>Select image</source>
-        <translation type="unfinished">Bild auswählen</translation>
+        <translation>Bild auswählen</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="452"/>
         <source>Image file (*.png *.jpg *.jpeg)</source>
-        <translation type="unfinished">Bilddatei (*.png *.jpg *.jpeg)</translation>
+        <translation>Bilddatei (*.png *.jpg *.jpeg)</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="850"/>
@@ -5074,7 +5074,7 @@ Download-Größe: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="941"/>
         <source>Custom border:</source>
-        <translation type="unfinished"></translation>
+        <translation>Benutzerdefinierter Rand:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="952"/>
@@ -5119,7 +5119,7 @@ Download-Größe: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="1201"/>
         <source>Rewind speed:</source>
-        <translation type="unfinished"></translation>
+        <translation>Zurückspulgeschwindigkeit:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="2171"/>
@@ -5457,7 +5457,7 @@ Download-Größe: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="1169"/>
         <source>Enable rewind</source>
-        <translation>Rücklauf aktivieren</translation>
+        <translation>Zurückspulen aktivieren</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="454"/>
@@ -5467,7 +5467,7 @@ Download-Größe: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="1176"/>
         <source>Rewind history:</source>
-        <translation>Rücklauf-Verlauf:</translation>
+        <translation>Zurückspulverlauf:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1238"/>
@@ -6317,12 +6317,12 @@ Download-Größe: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1445"/>
         <source>Increase fast forward speed</source>
-        <translation type="unfinished"></translation>
+        <translation>Vorspulgeschwindigkeit erhöhen</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1452"/>
         <source>Decrease fast forward speed</source>
-        <translation type="unfinished"></translation>
+        <translation>Vorspulgeschwindigkeit senken</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1459"/>
@@ -6771,17 +6771,17 @@ Download-Größe: %3</translation>
     <message>
         <location filename="../utils.cpp" line="146"/>
         <source>Super (L)</source>
-        <translation type="unfinished">Super (L)</translation>
+        <translation>Super (L)</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="148"/>
         <source>Super (R)</source>
-        <translation type="unfinished">Super (R)</translation>
+        <translation>Super (R)</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="150"/>
         <source>Menu</source>
-        <translation type="unfinished">Menü</translation>
+        <translation>Menü</translation>
     </message>
 </context>
 <context>

From 56ef8bdd94122d7bfb510af149f85a01cc964bdd Mon Sep 17 00:00:00 2001
From: ssantos <ssantos@web.de>
Date: Mon, 18 Dec 2023 15:26:35 +0000
Subject: [PATCH 45/53] Qt: Update translation (Portuguese)

Translation: mGBA/Qt
Translate-URL: https://hosted.weblate.org/projects/mgba/mgba-qt/pt/
---
 src/platform/qt/ts/mgba-pt.ts | 32 +++++++++++++++++---------------
 1 file changed, 17 insertions(+), 15 deletions(-)

diff --git a/src/platform/qt/ts/mgba-pt.ts b/src/platform/qt/ts/mgba-pt.ts
index 72af03abe..cddb1dd8c 100644
--- a/src/platform/qt/ts/mgba-pt.ts
+++ b/src/platform/qt/ts/mgba-pt.ts
@@ -716,7 +716,7 @@ Tamanho da descarga: %3</translation>
     <message>
         <location filename="../ForwarderView.cpp" line="192"/>
         <source>Image files (*.png *.jpg *.bmp)</source>
-        <translation type="unfinished"></translation>
+        <translation>Ficheiro da imagem (*.png *.jpg *.bmp)</translation>
     </message>
 </context>
 <context>
@@ -3752,17 +3752,17 @@ Tamanho da descarga: %3</translation>
     <message>
         <location filename="../MultiplayerController.cpp" line="327"/>
         <source>Trying to detach a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>A tentar desconectar um jogador multiplayer que não está conectado</translation>
     </message>
     <message>
         <location filename="../MultiplayerController.cpp" line="391"/>
         <source>Trying to get player ID for a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>A tentar obter a ID do jogador para um jogador multiplayer que não está conectado</translation>
     </message>
     <message>
         <location filename="../MultiplayerController.cpp" line="405"/>
         <source>Trying to get save ID for a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>A tentar obter a ID gravada para um jogador multiplayer que não está conectado</translation>
     </message>
 </context>
 <context>
@@ -4310,7 +4310,7 @@ Tamanho da descarga: %3</translation>
     <message>
         <location filename="../ROMInfo.ui" line="114"/>
         <source>Save file:</source>
-        <translation type="unfinished"></translation>
+        <translation>Ficheiro do save:</translation>
     </message>
 </context>
 <context>
@@ -4477,7 +4477,7 @@ Tamanho da descarga: %3</translation>
     <message>
         <location filename="../SaveConverter.cpp" line="487"/>
         <source> + RTC</source>
-        <translation type="unfinished"></translation>
+        <translation> + RTC</translation>
     </message>
     <message>
         <location filename="../SaveConverter.cpp" line="496"/>
@@ -4759,12 +4759,12 @@ Tamanho da descarga: %3</translation>
     <message>
         <location filename="../SettingsView.cpp" line="452"/>
         <source>Select image</source>
-        <translation type="unfinished">Selecionar imagem</translation>
+        <translation>Selecionar imagem</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="452"/>
         <source>Image file (*.png *.jpg *.jpeg)</source>
-        <translation type="unfinished">Ficheiro da imagem (*.png *.jpg *.jpeg)</translation>
+        <translation>Ficheiro da imagem (*.png *.jpg *.jpeg)</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="850"/>
@@ -4792,6 +4792,7 @@ Tamanho da descarga: %3</translation>
         <translation>
             <numerusform>%n hora atrás</numerusform>
             <numerusform>%n horas atrás</numerusform>
+            <numerusform>%n horas atrás</numerusform>
         </translation>
     </message>
     <message numerus="yes">
@@ -4800,6 +4801,7 @@ Tamanho da descarga: %3</translation>
         <translation>
             <numerusform>%n dia atrás</numerusform>
             <numerusform>%n dias atrás</numerusform>
+            <numerusform>%n dias atrás</numerusform>
         </translation>
     </message>
     <message>
@@ -5249,7 +5251,7 @@ Tamanho da descarga: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="941"/>
         <source>Custom border:</source>
-        <translation type="unfinished"></translation>
+        <translation>Borda personalizada:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1059"/>
@@ -5285,7 +5287,7 @@ Tamanho da descarga: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="1201"/>
         <source>Rewind speed:</source>
-        <translation type="unfinished"></translation>
+        <translation>Velocidade do retrocesso:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1238"/>
@@ -6403,12 +6405,12 @@ Tamanho da descarga: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1445"/>
         <source>Increase fast forward speed</source>
-        <translation type="unfinished"></translation>
+        <translation>Aumentar a velocidade do avanço rápido</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1452"/>
         <source>Decrease fast forward speed</source>
-        <translation type="unfinished"></translation>
+        <translation>Diminuir a velocidade do avanço rápido</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1459"/>
@@ -6771,17 +6773,17 @@ Tamanho da descarga: %3</translation>
     <message>
         <location filename="../utils.cpp" line="146"/>
         <source>Super (L)</source>
-        <translation type="unfinished">Super (E)</translation>
+        <translation>Super (E)</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="148"/>
         <source>Super (R)</source>
-        <translation type="unfinished">Super (D)</translation>
+        <translation>Super (D)</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="150"/>
         <source>Menu</source>
-        <translation type="unfinished">Menu</translation>
+        <translation>Menu</translation>
     </message>
 </context>
 <context>

From dc9c831f62d8aa93e294397bd2f3e1f6638ce5d6 Mon Sep 17 00:00:00 2001
From: Imre Kristoffer Eilertsen <imreeil42@gmail.com>
Date: Thu, 22 Feb 2024 01:36:33 +0000
Subject: [PATCH 46/53] =?UTF-8?q?Qt:=20Update=20translation=20(Norwegian?=
 =?UTF-8?q?=20Bokm=C3=A5l)?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Translation: mGBA/Qt
Translate-URL: https://hosted.weblate.org/projects/mgba/mgba-qt/nb_NO/
---
 src/platform/qt/ts/mgba-nb_NO.ts | 764 +++++++++++++++----------------
 1 file changed, 382 insertions(+), 382 deletions(-)

diff --git a/src/platform/qt/ts/mgba-nb_NO.ts b/src/platform/qt/ts/mgba-nb_NO.ts
index 128bee3ac..4a97f0c60 100644
--- a/src/platform/qt/ts/mgba-nb_NO.ts
+++ b/src/platform/qt/ts/mgba-nb_NO.ts
@@ -16,7 +16,7 @@
     <message>
         <location filename="../utils.cpp" line="110"/>
         <source>All ROMs (%1)</source>
-        <translation type="unfinished"></translation>
+        <translation>Alle ROM-filer (%1)</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="112"/>
@@ -64,7 +64,7 @@ Game Boy Advance er et registrert varemerke tilhørende Nintendo Co., Ltd.</tran
     <message>
         <location filename="../ApplicationUpdatePrompt.ui" line="14"/>
         <source>An update is available</source>
-        <translation type="unfinished"></translation>
+        <translation>En oppdatering er tilgjengelig</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdatePrompt.cpp" line="26"/>
@@ -96,7 +96,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ApplicationUpdatePrompt.cpp" line="63"/>
         <source>Downloading update...</source>
-        <translation type="unfinished">Laster ned ny versjon …</translation>
+        <translation>Laster ned oppdatering …</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdatePrompt.cpp" line="79"/>
@@ -114,22 +114,22 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ApplicationUpdater.cpp" line="90"/>
         <source>Stable</source>
-        <translation type="unfinished"></translation>
+        <translation>Stabil</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdater.cpp" line="93"/>
         <source>Development</source>
-        <translation type="unfinished"></translation>
+        <translation>Utvikling</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdater.cpp" line="95"/>
         <source>Unknown</source>
-        <translation type="unfinished">Ukjent</translation>
+        <translation>Ukjent</translation>
     </message>
     <message>
         <location filename="../ApplicationUpdater.cpp" line="236"/>
         <source>(None)</source>
-        <translation type="unfinished"></translation>
+        <translation>(Ingen)</translation>
     </message>
 </context>
 <context>
@@ -142,7 +142,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ArchiveInspector.ui" line="20"/>
         <source>Loading...</source>
-        <translation type="unfinished">Laster inn …</translation>
+        <translation>Laster inn ...</translation>
     </message>
 </context>
 <context>
@@ -264,7 +264,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../BattleChipView.ui" line="180"/>
         <source>Inserted</source>
-        <translation type="unfinished"></translation>
+        <translation>Satt inn</translation>
     </message>
     <message>
         <location filename="../BattleChipView.ui" line="194"/>
@@ -331,7 +331,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../CheatsView.ui" line="39"/>
         <source>Add New Code</source>
-        <translation type="unfinished"></translation>
+        <translation>Legg til ny kode</translation>
     </message>
     <message>
         <location filename="../CheatsView.ui" line="60"/>
@@ -341,7 +341,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../CheatsView.ui" line="93"/>
         <source>Add Lines</source>
-        <translation type="unfinished"></translation>
+        <translation>Legg til linjer</translation>
     </message>
     <message>
         <location filename="../CheatsView.ui" line="100"/>
@@ -367,7 +367,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../CheatsView.cpp" line="50"/>
         <location filename="../CheatsView.cpp" line="58"/>
         <source>Autodetect (recommended)</source>
-        <translation type="unfinished"></translation>
+        <translation>Auto-oppdag (anbefales)</translation>
     </message>
     <message>
         <location filename="../CheatsView.cpp" line="88"/>
@@ -463,7 +463,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../DebuggerConsole.ui" line="27"/>
         <source>Break</source>
-        <translation type="unfinished"></translation>
+        <translation>Stopp</translation>
     </message>
 </context>
 <context>
@@ -514,12 +514,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../DolphinConnector.cpp" line="57"/>
         <source>Couldn&apos;t Connect</source>
-        <translation type="unfinished"></translation>
+        <translation>Kunne ikke koble til</translation>
     </message>
     <message>
         <location filename="../DolphinConnector.cpp" line="58"/>
         <source>Could not connect to Dolphin.</source>
-        <translation type="unfinished"></translation>
+        <translation>Klarte ikke å koble til Dolphin.</translation>
     </message>
 </context>
 <context>
@@ -527,7 +527,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ForwarderGenerator.cpp" line="83"/>
         <source>3DS</source>
-        <translation type="unfinished"></translation>
+        <translation>3DS</translation>
     </message>
     <message>
         <location filename="../ForwarderGenerator.cpp" line="85"/>
@@ -540,7 +540,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ForwarderGenerator3DS.cpp" line="29"/>
         <source>Icon</source>
-        <translation type="unfinished"></translation>
+        <translation>Ikon</translation>
     </message>
     <message>
         <location filename="../ForwarderGenerator3DS.cpp" line="30"/>
@@ -553,17 +553,17 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ForwarderGeneratorVita.cpp" line="25"/>
         <source>Bubble</source>
-        <translation type="unfinished"></translation>
+        <translation>Boble</translation>
     </message>
     <message>
         <location filename="../ForwarderGeneratorVita.cpp" line="26"/>
         <source>Background</source>
-        <translation type="unfinished">Bakgrunn</translation>
+        <translation>Bakgrunn</translation>
     </message>
     <message>
         <location filename="../ForwarderGeneratorVita.cpp" line="27"/>
         <source>Startup</source>
-        <translation type="unfinished"></translation>
+        <translation>Oppstart</translation>
     </message>
 </context>
 <context>
@@ -576,12 +576,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ForwarderView.ui" line="20"/>
         <source>Files</source>
-        <translation type="unfinished"></translation>
+        <translation>Filer</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="26"/>
         <source>ROM file:</source>
-        <translation type="unfinished"></translation>
+        <translation>ROM-fil:</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="36"/>
@@ -593,7 +593,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ForwarderView.ui" line="43"/>
         <source>Output filename:</source>
-        <translation type="unfinished"></translation>
+        <translation>Utdata-filnavn:</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="60"/>
@@ -603,7 +603,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ForwarderView.ui" line="74"/>
         <source>Latest stable version</source>
-        <translation type="unfinished"></translation>
+        <translation>Nyeste stabile versjon</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="79"/>
@@ -613,42 +613,42 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ForwarderView.ui" line="84"/>
         <source>Specific file</source>
-        <translation type="unfinished"></translation>
+        <translation>Spesifikk fil</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="95"/>
         <source>Base file:</source>
-        <translation type="unfinished"></translation>
+        <translation>Grunnfil:</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="135"/>
         <source>System</source>
-        <translation type="unfinished"></translation>
+        <translation>System</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="141"/>
         <source>3DS</source>
-        <translation type="unfinished"></translation>
+        <translation>3DS</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="151"/>
         <source>Vita</source>
-        <translation type="unfinished"></translation>
+        <translation>Vita</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="174"/>
         <source>Presentation</source>
-        <translation type="unfinished"></translation>
+        <translation>Presentasjon</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="182"/>
         <source>Title:</source>
-        <translation type="unfinished"></translation>
+        <translation>Tittel:</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="195"/>
         <source>Images:</source>
-        <translation type="unfinished"></translation>
+        <translation>Bilder:</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="215"/>
@@ -658,17 +658,17 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ForwarderView.ui" line="328"/>
         <source>Preferred size:</source>
-        <translation type="unfinished"></translation>
+        <translation>Ønsket størrelse:</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="395"/>
         <source>Select image file</source>
-        <translation type="unfinished"></translation>
+        <translation>Velg bildefil</translation>
     </message>
     <message>
         <location filename="../ForwarderView.cpp" line="22"/>
         <source>Select ROM file</source>
-        <translation type="unfinished"></translation>
+        <translation>Velg ROM-fil</translation>
     </message>
     <message>
         <location filename="../ForwarderView.cpp" line="23"/>
@@ -678,7 +678,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ForwarderView.cpp" line="24"/>
         <source>Select base file</source>
-        <translation type="unfinished"></translation>
+        <translation>Velg grunnfil</translation>
     </message>
     <message>
         <location filename="../ForwarderView.cpp" line="36"/>
@@ -708,12 +708,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ForwarderView.cpp" line="192"/>
         <source>Select an image</source>
-        <translation type="unfinished"></translation>
+        <translation>Velg et bilde</translation>
     </message>
     <message>
         <location filename="../ForwarderView.cpp" line="192"/>
         <source>Image files (*.png *.jpg *.bmp)</source>
-        <translation type="unfinished"></translation>
+        <translation>Bildefiler (*.png *.jpg *.bmp)</translation>
     </message>
 </context>
 <context>
@@ -736,7 +736,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../FrameView.ui" line="84"/>
         <source>Backdrop color</source>
-        <translation type="unfinished"></translation>
+        <translation>Bakgrunnsfarge</translation>
     </message>
     <message>
         <location filename="../FrameView.ui" line="132"/>
@@ -791,12 +791,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../FrameView.cpp" line="621"/>
         <source>Backdrop</source>
-        <translation type="unfinished"></translation>
+        <translation>Bakgrunn</translation>
     </message>
     <message>
         <location filename="../FrameView.cpp" line="624"/>
         <source>Frame</source>
-        <translation type="unfinished"></translation>
+        <translation>Ramme</translation>
     </message>
     <message>
         <location filename="../FrameView.cpp" line="630"/>
@@ -850,7 +850,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../GDBWindow.cpp" line="39"/>
         <source>Bind address</source>
-        <translation type="unfinished"></translation>
+        <translation>Bindingsadresse</translation>
     </message>
     <message>
         <location filename="../GDBWindow.cpp" line="52"/>
@@ -875,7 +875,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../GDBWindow.cpp" line="82"/>
         <source>Break</source>
-        <translation type="unfinished"></translation>
+        <translation>Stopp</translation>
     </message>
     <message>
         <location filename="../GDBWindow.cpp" line="124"/>
@@ -967,7 +967,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../GameBoy.cpp" line="60"/>
         <location filename="../GameBoy.cpp" line="79"/>
         <source>Autodetect</source>
-        <translation type="unfinished"></translation>
+        <translation>Auto-oppdag</translation>
     </message>
     <message>
         <location filename="../GameBoy.cpp" line="61"/>
@@ -1037,7 +1037,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../GameBoy.cpp" line="86"/>
         <source>MBC5 + Rumble</source>
-        <translation type="unfinished"></translation>
+        <translation>MBC5 + risting</translation>
     </message>
     <message>
         <location filename="../GameBoy.cpp" line="87"/>
@@ -1047,7 +1047,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../GameBoy.cpp" line="88"/>
         <source>MBC7 (Tilt)</source>
-        <translation type="unfinished"></translation>
+        <translation>MBC7 (Tilt)</translation>
     </message>
     <message>
         <location filename="../GameBoy.cpp" line="89"/>
@@ -1112,12 +1112,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../GameBoy.cpp" line="101"/>
         <source>GGB-81</source>
-        <translation type="unfinished"></translation>
+        <translation>GGB-81</translation>
     </message>
     <message>
         <location filename="../GameBoy.cpp" line="102"/>
         <source>Li Cheng</source>
-        <translation type="unfinished"></translation>
+        <translation>Li Cheng</translation>
     </message>
     <message>
         <location filename="../GameBoy.cpp" line="103"/>
@@ -1135,12 +1135,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../IOViewer.ui" line="14"/>
         <source>I/O Viewer</source>
-        <translation type="unfinished"></translation>
+        <translation>I/O-visning</translation>
     </message>
     <message>
         <location filename="../IOViewer.ui" line="26"/>
         <source>0x0000</source>
-        <translation type="unfinished"></translation>
+        <translation>0x0000</translation>
     </message>
     <message>
         <location filename="../IOViewer.ui" line="367"/>
@@ -1232,7 +1232,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../IOViewer.cpp" line="58"/>
         <source>Enable OBJ</source>
-        <translation type="unfinished"></translation>
+        <translation>Skru på OBJ</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="59"/>
@@ -1252,17 +1252,17 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../IOViewer.cpp" line="69"/>
         <source>Currently in VBlank</source>
-        <translation type="unfinished"></translation>
+        <translation>For øyeblikket i VBlank</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="70"/>
         <source>Currently in HBlank</source>
-        <translation type="unfinished"></translation>
+        <translation>For øyeblikket i HBlank</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="71"/>
         <source>Currently in VCounter</source>
-        <translation type="unfinished"></translation>
+        <translation>For øyeblikket i VCounter</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="72"/>
@@ -1319,7 +1319,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../IOViewer.cpp" line="104"/>
         <location filename="../IOViewer.cpp" line="114"/>
         <source>Enable 256-color</source>
-        <translation type="unfinished"></translation>
+        <translation>Skru på 256-fargemodus</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="87"/>
@@ -1742,7 +1742,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../IOViewer.cpp" line="1135"/>
         <location filename="../IOViewer.cpp" line="1184"/>
         <source>Initial volume</source>
-        <translation type="unfinished"></translation>
+        <translation>Volum ved begynnelse</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="342"/>
@@ -1801,28 +1801,28 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../IOViewer.cpp" line="376"/>
         <location filename="../IOViewer.cpp" line="1158"/>
         <source>0%</source>
-        <translation type="unfinished">0%</translation>
+        <translation>0 %</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="377"/>
         <location filename="../IOViewer.cpp" line="434"/>
         <location filename="../IOViewer.cpp" line="1159"/>
         <source>100%</source>
-        <translation type="unfinished">100%</translation>
+        <translation>100%</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="378"/>
         <location filename="../IOViewer.cpp" line="433"/>
         <location filename="../IOViewer.cpp" line="1160"/>
         <source>50%</source>
-        <translation type="unfinished">50%</translation>
+        <translation>50%</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="379"/>
         <location filename="../IOViewer.cpp" line="432"/>
         <location filename="../IOViewer.cpp" line="1161"/>
         <source>25%</source>
-        <translation type="unfinished">25%</translation>
+        <translation>25%</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="380"/>
@@ -1830,7 +1830,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../IOViewer.cpp" line="382"/>
         <location filename="../IOViewer.cpp" line="383"/>
         <source>75%</source>
-        <translation type="unfinished">75%</translation>
+        <translation>75%</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="405"/>
@@ -1848,13 +1848,13 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../IOViewer.cpp" line="407"/>
         <location filename="../IOViewer.cpp" line="1190"/>
         <source>15</source>
-        <translation type="unfinished">15</translation>
+        <translation>15</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="408"/>
         <location filename="../IOViewer.cpp" line="1191"/>
         <source>7</source>
-        <translation type="unfinished">7</translation>
+        <translation>7</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="410"/>
@@ -1954,7 +1954,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../IOViewer.cpp" line="442"/>
         <location filename="../IOViewer.cpp" line="449"/>
         <source>0</source>
-        <translation type="unfinished">0</translation>
+        <translation>0</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="443"/>
@@ -1967,7 +1967,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../IOViewer.cpp" line="1002"/>
         <location filename="../IOViewer.cpp" line="1012"/>
         <source>1</source>
-        <translation type="unfinished">1</translation>
+        <translation>1</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="445"/>
@@ -2137,22 +2137,22 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../IOViewer.cpp" line="1034"/>
         <source>Right/A</source>
-        <translation type="unfinished"></translation>
+        <translation>Høyre/A</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="1035"/>
         <source>Left/B</source>
-        <translation type="unfinished"></translation>
+        <translation>Venstre/B</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="1036"/>
         <source>Up/Select</source>
-        <translation type="unfinished"></translation>
+        <translation>Opp/Select</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="1037"/>
         <source>Down/Start</source>
-        <translation type="unfinished"></translation>
+        <translation>Ned/Start</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="1038"/>
@@ -2162,7 +2162,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../IOViewer.cpp" line="1039"/>
         <source>Active face buttons</source>
-        <translation type="unfinished"></translation>
+        <translation>Skru på hovedknappene</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="1047"/>
@@ -2182,12 +2182,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../IOViewer.cpp" line="1067"/>
         <source>Divider</source>
-        <translation type="unfinished"></translation>
+        <translation>Skillelinje</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="1069"/>
         <source>1/16</source>
-        <translation type="unfinished">1/16</translation>
+        <translation>1/16</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="1092"/>
@@ -2479,7 +2479,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../IOViewer.cpp" line="1498"/>
         <location filename="../IOViewer.cpp" line="1510"/>
         <source>Red</source>
-        <translation type="unfinished">Rød</translation>
+        <translation>Rød</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="1499"/>
@@ -2618,7 +2618,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../IOViewer.cpp" line="732"/>
         <location filename="../IOViewer.cpp" line="1442"/>
         <source>Immediate</source>
-        <translation type="unfinished"></translation>
+        <translation>Umiddelbart</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="597"/>
@@ -2681,7 +2681,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../IOViewer.cpp" line="726"/>
         <source>Video Capture</source>
-        <translation type="unfinished"></translation>
+        <translation>Videoopptak</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="728"/>
@@ -2715,7 +2715,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../IOViewer.cpp" line="827"/>
         <location filename="../IOViewer.cpp" line="1070"/>
         <source>1/64</source>
-        <translation type="unfinished">1/64</translation>
+        <translation>1/64</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="781"/>
@@ -2724,7 +2724,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../IOViewer.cpp" line="828"/>
         <location filename="../IOViewer.cpp" line="1071"/>
         <source>1/256</source>
-        <translation type="unfinished">1/256</translation>
+        <translation>1/256</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="782"/>
@@ -2733,14 +2733,14 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../IOViewer.cpp" line="829"/>
         <location filename="../IOViewer.cpp" line="1068"/>
         <source>1/1024</source>
-        <translation type="unfinished">1/1024</translation>
+        <translation>1/1024</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="799"/>
         <location filename="../IOViewer.cpp" line="815"/>
         <location filename="../IOViewer.cpp" line="831"/>
         <source>Cascade</source>
-        <translation type="unfinished"></translation>
+        <translation>Cascade</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="869"/>
@@ -2891,7 +2891,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../IOViewer.cpp" line="957"/>
         <location filename="../IOViewer.cpp" line="974"/>
         <source>Gamepak</source>
-        <translation type="unfinished"></translation>
+        <translation>Spillkassett</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="978"/>
@@ -2905,7 +2905,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../IOViewer.cpp" line="1001"/>
         <location filename="../IOViewer.cpp" line="1005"/>
         <source>4</source>
-        <translation type="unfinished">4</translation>
+        <translation>4</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="980"/>
@@ -2913,7 +2913,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../IOViewer.cpp" line="996"/>
         <location filename="../IOViewer.cpp" line="1006"/>
         <source>3</source>
-        <translation type="unfinished">3</translation>
+        <translation>3</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="981"/>
@@ -2922,7 +2922,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../IOViewer.cpp" line="997"/>
         <location filename="../IOViewer.cpp" line="1007"/>
         <source>2</source>
-        <translation type="unfinished">2</translation>
+        <translation>2</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="982"/>
@@ -2931,7 +2931,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../IOViewer.cpp" line="1008"/>
         <location filename="../IOViewer.cpp" line="1011"/>
         <source>8</source>
-        <translation type="unfinished">8</translation>
+        <translation>8</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="984"/>
@@ -2966,7 +2966,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../IOViewer.cpp" line="1014"/>
         <source>PHI terminal</source>
-        <translation type="unfinished"></translation>
+        <translation>PHI-terminal</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="1015"/>
@@ -2977,17 +2977,17 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../IOViewer.cpp" line="1016"/>
         <source>4.19MHz</source>
-        <translation type="unfinished"></translation>
+        <translation>4,19MHz</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="1017"/>
         <source>8.38MHz</source>
-        <translation type="unfinished"></translation>
+        <translation>8,38MHz</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="1018"/>
         <source>16.78MHz</source>
-        <translation type="unfinished"></translation>
+        <translation>16,78MHz</translation>
     </message>
     <message>
         <location filename="../IOViewer.cpp" line="1020"/>
@@ -3006,7 +3006,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../KeyEditor.cpp" line="35"/>
         <location filename="../KeyEditor.cpp" line="213"/>
         <source>---</source>
-        <translation type="unfinished"></translation>
+        <translation>---</translation>
     </message>
 </context>
 <context>
@@ -3019,7 +3019,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../library/LibraryTree.cpp" line="52"/>
         <source>Location</source>
-        <translation type="unfinished"></translation>
+        <translation>Sted</translation>
     </message>
     <message>
         <location filename="../library/LibraryTree.cpp" line="53"/>
@@ -3034,7 +3034,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../library/LibraryTree.cpp" line="55"/>
         <source>CRC32</source>
-        <translation type="unfinished"></translation>
+        <translation>CRC32</translation>
     </message>
 </context>
 <context>
@@ -3111,12 +3111,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../LoadSaveState.cpp" line="75"/>
         <source>Load State</source>
-        <translation type="unfinished"></translation>
+        <translation>Last inn tilstand</translation>
     </message>
     <message>
         <location filename="../LoadSaveState.cpp" line="75"/>
         <source>Save State</source>
-        <translation type="unfinished"></translation>
+        <translation>Lagre tilstand</translation>
     </message>
     <message>
         <location filename="../LoadSaveState.cpp" line="184"/>
@@ -3170,12 +3170,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../LogConfigModel.cpp" line="102"/>
         <source>Stub</source>
-        <translation type="unfinished"></translation>
+        <translation>Stump</translation>
     </message>
     <message>
         <location filename="../LogConfigModel.cpp" line="104"/>
         <source>Game Error</source>
-        <translation type="unfinished">Spillfeil</translation>
+        <translation>Spillfeil</translation>
     </message>
 </context>
 <context>
@@ -3183,7 +3183,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../LogController.cpp" line="72"/>
         <source>[%1] %2: %3</source>
-        <translation type="unfinished"></translation>
+        <translation>[%1] %2: %3</translation>
     </message>
     <message>
         <location filename="../LogController.cpp" line="83"/>
@@ -3208,7 +3208,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../LogController.cpp" line="161"/>
         <source>WARN</source>
-        <translation type="unfinished"></translation>
+        <translation>ADVARSEL</translation>
     </message>
     <message>
         <location filename="../LogController.cpp" line="163"/>
@@ -3246,7 +3246,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../LogView.ui" line="38"/>
         <source>Stub</source>
-        <translation type="unfinished"></translation>
+        <translation>Stump</translation>
     </message>
     <message>
         <location filename="../LogView.ui" line="48"/>
@@ -3304,7 +3304,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../MapView.ui" line="124"/>
         <source>Export</source>
-        <translation type="unfinished">Eksporter</translation>
+        <translation>Eksporter</translation>
     </message>
     <message>
         <location filename="../MapView.ui" line="139"/>
@@ -3352,12 +3352,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../MapView.cpp" line="109"/>
         <source>Mirror</source>
-        <translation type="unfinished"></translation>
+        <translation>Speilvend</translation>
     </message>
     <message>
         <location filename="../MapView.cpp" line="146"/>
         <source>None</source>
-        <translation type="unfinished">Ingen</translation>
+        <translation>Ingen</translation>
     </message>
     <message>
         <location filename="../MapView.cpp" line="148"/>
@@ -3367,12 +3367,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../MapView.cpp" line="150"/>
         <source>Horizontal</source>
-        <translation type="unfinished"></translation>
+        <translation>Horisontal</translation>
     </message>
     <message>
         <location filename="../MapView.cpp" line="152"/>
         <source>Vertical</source>
-        <translation type="unfinished"></translation>
+        <translation>Vertikal</translation>
     </message>
     <message>
         <location filename="../MapView.cpp" line="178"/>
@@ -3389,7 +3389,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../MapView.cpp" line="278"/>
         <source>Portable Network Graphics (*.png)</source>
-        <translation type="unfinished"></translation>
+        <translation>Portable Network Graphics (*.png)</translation>
     </message>
 </context>
 <context>
@@ -3440,7 +3440,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../MemoryModel.cpp" line="54"/>
         <source>Paste</source>
-        <translation type="unfinished">Lim inn</translation>
+        <translation>Lim inn</translation>
     </message>
     <message>
         <location filename="../MemoryModel.cpp" line="59"/>
@@ -3450,7 +3450,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../MemoryModel.cpp" line="113"/>
         <source>All</source>
-        <translation type="unfinished"></translation>
+        <translation>Alle</translation>
     </message>
     <message>
         <location filename="../MemoryModel.cpp" line="158"/>
@@ -3480,12 +3480,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../MemoryModel.cpp" line="347"/>
         <source>TBL</source>
-        <translation type="unfinished"></translation>
+        <translation>TBL</translation>
     </message>
     <message>
         <location filename="../MemoryModel.cpp" line="347"/>
         <source>ISO-8859-1</source>
-        <translation type="unfinished"></translation>
+        <translation>ISO-8859-1</translation>
     </message>
 </context>
 <context>
@@ -3519,7 +3519,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../MemorySearch.ui" line="88"/>
         <source>Numeric</source>
-        <translation type="unfinished"></translation>
+        <translation>Numerisk</translation>
     </message>
     <message>
         <location filename="../MemorySearch.ui" line="101"/>
@@ -3535,7 +3535,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../MemorySearch.ui" line="125"/>
         <location filename="../MemorySearch.ui" line="185"/>
         <source>Guess</source>
-        <translation type="unfinished"></translation>
+        <translation>Gjett</translation>
     </message>
     <message>
         <location filename="../MemorySearch.ui" line="138"/>
@@ -3555,17 +3555,17 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../MemorySearch.ui" line="178"/>
         <source>Number type</source>
-        <translation type="unfinished"></translation>
+        <translation>Nummertype</translation>
     </message>
     <message>
         <location filename="../MemorySearch.ui" line="195"/>
         <source>Decimal</source>
-        <translation type="unfinished"></translation>
+        <translation>Desimal</translation>
     </message>
     <message>
         <location filename="../MemorySearch.ui" line="202"/>
         <source>Hexadecimal</source>
-        <translation type="unfinished"></translation>
+        <translation>Heksadesimal</translation>
     </message>
     <message>
         <location filename="../MemorySearch.ui" line="216"/>
@@ -3640,17 +3640,17 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../MemorySearch.cpp" line="226"/>
         <source> (%0/%1×)</source>
-        <translation type="unfinished"></translation>
+        <translation> (%0/%1×)</translation>
     </message>
     <message>
         <location filename="../MemorySearch.cpp" line="228"/>
         <source> (⅟%0×)</source>
-        <translation type="unfinished"></translation>
+        <translation> (⅟%0×)</translation>
     </message>
     <message>
         <location filename="../MemorySearch.cpp" line="231"/>
         <source> (%0×)</source>
-        <translation type="unfinished"></translation>
+        <translation> (%0×)</translation>
     </message>
     <message>
         <location filename="../MemorySearch.cpp" line="235"/>
@@ -3741,7 +3741,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../MessagePainter.cpp" line="81"/>
         <source>Frame %1</source>
-        <translation type="unfinished"></translation>
+        <translation>Bilde %1</translation>
     </message>
 </context>
 <context>
@@ -3807,17 +3807,17 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ObjView.ui" line="389"/>
         <source>Export</source>
-        <translation type="unfinished">Eksporter</translation>
+        <translation>Eksporter</translation>
     </message>
     <message>
         <location filename="../ObjView.ui" line="402"/>
         <source>Attributes</source>
-        <translation type="unfinished"></translation>
+        <translation>Attributter</translation>
     </message>
     <message>
         <location filename="../ObjView.ui" line="410"/>
         <source>Transform</source>
-        <translation type="unfinished"></translation>
+        <translation>Transformer</translation>
     </message>
     <message>
         <location filename="../ObjView.ui" line="430"/>
@@ -3851,13 +3851,13 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../ObjView.ui" line="545"/>
         <source>H</source>
         <extracomment>Short for horizontal</extracomment>
-        <translation type="unfinished"></translation>
+        <translation>H</translation>
     </message>
     <message>
         <location filename="../ObjView.ui" line="558"/>
         <source>V</source>
         <extracomment>Short for vertical</extracomment>
-        <translation type="unfinished"></translation>
+        <translation>V</translation>
     </message>
     <message>
         <location filename="../ObjView.ui" line="572"/>
@@ -3878,7 +3878,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ObjView.ui" line="643"/>
         <source>Enabled</source>
-        <translation type="unfinished"></translation>
+        <translation>Skrudd på</translation>
     </message>
     <message>
         <location filename="../ObjView.ui" line="677"/>
@@ -3894,7 +3894,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../ObjView.cpp" line="160"/>
         <location filename="../ObjView.cpp" line="249"/>
         <source>0x%0</source>
-        <translation type="unfinished"></translation>
+        <translation>0x%0</translation>
     </message>
     <message>
         <location filename="../ObjView.cpp" line="182"/>
@@ -3906,7 +3906,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../ObjView.cpp" line="259"/>
         <location filename="../ObjView.cpp" line="260"/>
         <source>---</source>
-        <translation type="unfinished"></translation>
+        <translation>---</translation>
     </message>
     <message>
         <location filename="../ObjView.cpp" line="193"/>
@@ -3916,12 +3916,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ObjView.cpp" line="196"/>
         <source>OBJWIN</source>
-        <translation type="unfinished"></translation>
+        <translation>OBJWIN</translation>
     </message>
     <message>
         <location filename="../ObjView.cpp" line="199"/>
         <source>Invalid</source>
-        <translation type="unfinished"></translation>
+        <translation>Ugyldig</translation>
     </message>
     <message>
         <location filename="../ObjView.cpp" line="256"/>
@@ -3945,7 +3945,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../OverrideView.ui" line="20"/>
         <source>Game Overrides</source>
-        <translation type="unfinished"></translation>
+        <translation>Overstyringer for spill</translation>
     </message>
     <message>
         <location filename="../OverrideView.ui" line="30"/>
@@ -3958,7 +3958,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../OverrideView.ui" line="241"/>
         <location filename="../OverrideView.ui" line="257"/>
         <source>Autodetect</source>
-        <translation type="unfinished"></translation>
+        <translation>Auto-oppdag</translation>
     </message>
     <message>
         <location filename="../OverrideView.ui" line="55"/>
@@ -3973,7 +3973,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../OverrideView.ui" line="75"/>
         <source>Tilt</source>
-        <translation type="unfinished"></translation>
+        <translation>Tilt</translation>
     </message>
     <message>
         <location filename="../OverrideView.ui" line="85"/>
@@ -4013,7 +4013,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../OverrideView.ui" line="146"/>
         <source>EEPROM 8kB</source>
-        <translation type="unfinished"></translation>
+        <translation>EEPROM 8kB</translation>
     </message>
     <message>
         <location filename="../OverrideView.ui" line="151"/>
@@ -4033,7 +4033,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../OverrideView.ui" line="190"/>
         <source>Game Boy Player features</source>
-        <translation type="unfinished"></translation>
+        <translation>Game Boy Player-funksjoner</translation>
     </message>
     <message>
         <location filename="../OverrideView.ui" line="197"/>
@@ -4043,12 +4043,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../OverrideView.ui" line="227"/>
         <source>Game Boy</source>
-        <translation type="unfinished"></translation>
+        <translation>Game Boy</translation>
     </message>
     <message>
         <location filename="../OverrideView.ui" line="233"/>
         <source>Game Boy model</source>
-        <translation type="unfinished"></translation>
+        <translation>Game Boy-modell</translation>
     </message>
     <message>
         <location filename="../OverrideView.ui" line="249"/>
@@ -4073,7 +4073,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../OverrideView.ui" line="529"/>
         <source>Palette preset</source>
-        <translation type="unfinished"></translation>
+        <translation>Forhåndsvalgt fargepalett</translation>
     </message>
     <message>
         <location filename="../OverrideView.cpp" line="54"/>
@@ -4096,7 +4096,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../PaletteView.ui" line="14"/>
         <source>Palette</source>
-        <translation type="unfinished">Palett</translation>
+        <translation>Palett</translation>
     </message>
     <message>
         <location filename="../PaletteView.ui" line="44"/>
@@ -4151,17 +4151,17 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../PaletteView.ui" line="360"/>
         <source>Export OBJ</source>
-        <translation type="unfinished"></translation>
+        <translation>Eksporter OBJ</translation>
     </message>
     <message>
         <location filename="../PaletteView.cpp" line="120"/>
         <source>#%0</source>
-        <translation type="unfinished"></translation>
+        <translation>#%0</translation>
     </message>
     <message>
         <location filename="../PaletteView.cpp" line="121"/>
         <source>0x%0</source>
-        <translation type="unfinished"></translation>
+        <translation>0x%0</translation>
     </message>
     <message>
         <location filename="../PaletteView.cpp" line="122"/>
@@ -4169,7 +4169,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../PaletteView.cpp" line="124"/>
         <location filename="../PaletteView.cpp" line="125"/>
         <source>0x%0 (%1)</source>
-        <translation type="unfinished">0x%0 (%1)</translation>
+        <translation>0x%0 (%1)</translation>
     </message>
     <message>
         <location filename="../PaletteView.cpp" line="137"/>
@@ -4197,7 +4197,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../PlacementControl.ui" line="26"/>
         <source>All</source>
-        <translation type="unfinished"></translation>
+        <translation>Alle</translation>
     </message>
     <message>
         <location filename="../PlacementControl.ui" line="65"/>
@@ -4207,12 +4207,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../PlacementControl.ui" line="72"/>
         <source>X</source>
-        <translation type="unfinished"></translation>
+        <translation>X</translation>
     </message>
     <message>
         <location filename="../PlacementControl.ui" line="79"/>
         <source>Y</source>
-        <translation type="unfinished"></translation>
+        <translation>Y</translation>
     </message>
 </context>
 <context>
@@ -4277,32 +4277,32 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ROMInfo.ui" line="14"/>
         <source>ROM Info</source>
-        <translation type="unfinished"></translation>
+        <translation>ROM-info</translation>
     </message>
     <message>
         <location filename="../ROMInfo.ui" line="26"/>
         <source>Game name:</source>
-        <translation type="unfinished"></translation>
+        <translation>Spillets navn:</translation>
     </message>
     <message>
         <location filename="../ROMInfo.ui" line="46"/>
         <source>Internal name:</source>
-        <translation type="unfinished"></translation>
+        <translation>Internt navn:</translation>
     </message>
     <message>
         <location filename="../ROMInfo.ui" line="63"/>
         <source>Game ID:</source>
-        <translation type="unfinished"></translation>
+        <translation>Spill-ID:</translation>
     </message>
     <message>
         <location filename="../ROMInfo.ui" line="80"/>
         <source>File size:</source>
-        <translation type="unfinished"></translation>
+        <translation>Filstørrelse:</translation>
     </message>
     <message>
         <location filename="../ROMInfo.ui" line="97"/>
         <source>CRC32:</source>
-        <translation type="unfinished"></translation>
+        <translation>CRC32:</translation>
     </message>
     <message>
         <location filename="../ROMInfo.ui" line="114"/>
@@ -4340,7 +4340,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ReportView.ui" line="99"/>
         <source>Save</source>
-        <translation type="unfinished">Lagre</translation>
+        <translation>Lagre</translation>
     </message>
     <message>
         <location filename="../ReportView.ui" line="113"/>
@@ -4350,7 +4350,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ReportView.ui" line="134"/>
         <source>Include save file</source>
-        <translation type="unfinished"></translation>
+        <translation>Inkluder lagrefilen</translation>
     </message>
     <message>
         <location filename="../ReportView.ui" line="150"/>
@@ -4378,7 +4378,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SaveConverter.cpp" line="53"/>
         <source>Select save game</source>
-        <translation type="unfinished"></translation>
+        <translation>Velg lagrefil</translation>
     </message>
     <message>
         <location filename="../SaveConverter.cpp" line="74"/>
@@ -4439,7 +4439,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SaveConverter.ui" line="46"/>
         <source>Output file</source>
-        <translation type="unfinished"></translation>
+        <translation>Utdatafil</translation>
     </message>
     <message>
         <location filename="../SaveConverter.cpp" line="455"/>
@@ -4459,7 +4459,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SaveConverter.cpp" line="473"/>
         <source>SRAM</source>
-        <translation type="unfinished">SRAM</translation>
+        <translation>SRAM</translation>
     </message>
     <message>
         <location filename="../SaveConverter.cpp" line="477"/>
@@ -4469,7 +4469,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SaveConverter.cpp" line="481"/>
         <source>%1 EEPROM</source>
-        <translation type="unfinished"></translation>
+        <translation>%1 EEPROM</translation>
     </message>
     <message>
         <location filename="../SaveConverter.cpp" line="487"/>
@@ -4509,17 +4509,17 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SaveConverter.cpp" line="514"/>
         <source>MBC6 SRAM</source>
-        <translation type="unfinished"></translation>
+        <translation>MBC6-SRAM</translation>
     </message>
     <message>
         <location filename="../SaveConverter.cpp" line="518"/>
         <source>TAMA5</source>
-        <translation type="unfinished">TAMA5</translation>
+        <translation>TAMA5</translation>
     </message>
     <message>
         <location filename="../SaveConverter.cpp" line="530"/>
         <source>%1 (%2)</source>
-        <translation type="unfinished"></translation>
+        <translation>%1 (%2)</translation>
     </message>
     <message>
         <location filename="../SaveConverter.cpp" line="534"/>
@@ -4555,12 +4555,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../scripting/ScriptingView.ui" line="45"/>
         <source>Run</source>
-        <translation type="unfinished"></translation>
+        <translation>Kjør</translation>
     </message>
     <message>
         <location filename="../scripting/ScriptingView.ui" line="92"/>
         <source>File</source>
-        <translation type="unfinished"></translation>
+        <translation>Fil</translation>
     </message>
     <message>
         <location filename="../scripting/ScriptingView.ui" line="96"/>
@@ -4570,17 +4570,17 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../scripting/ScriptingView.ui" line="109"/>
         <source>Load script...</source>
-        <translation type="unfinished"></translation>
+        <translation>Last inn skript...</translation>
     </message>
     <message>
         <location filename="../scripting/ScriptingView.ui" line="114"/>
         <source>&amp;Reset</source>
-        <translation type="unfinished"></translation>
+        <translation>&amp;Omstart</translation>
     </message>
     <message>
         <location filename="../scripting/ScriptingView.ui" line="119"/>
         <source>0</source>
-        <translation type="unfinished">0</translation>
+        <translation>0</translation>
     </message>
     <message>
         <location filename="../scripting/ScriptingView.cpp" line="60"/>
@@ -4595,7 +4595,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../scripting/ScriptingView.cpp" line="87"/>
         <source>All files (*.*)</source>
-        <translation type="unfinished"></translation>
+        <translation>Alle filer (*.*)</translation>
     </message>
 </context>
 <context>
@@ -4603,12 +4603,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SensorView.ui" line="20"/>
         <source>Sensors</source>
-        <translation type="unfinished"></translation>
+        <translation>Sensorer</translation>
     </message>
     <message>
         <location filename="../SensorView.ui" line="31"/>
         <source>Realtime clock</source>
-        <translation type="unfinished">Sanntidsklokke</translation>
+        <translation>Sanntidsklokke</translation>
     </message>
     <message>
         <location filename="../SensorView.ui" line="50"/>
@@ -4618,7 +4618,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SensorView.ui" line="37"/>
         <source>System time</source>
-        <translation type="unfinished"></translation>
+        <translation>Systemtid</translation>
     </message>
     <message>
         <location filename="../SensorView.ui" line="96"/>
@@ -4628,7 +4628,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SensorView.ui" line="60"/>
         <source>Now</source>
-        <translation type="unfinished"></translation>
+        <translation>Nå</translation>
     </message>
     <message>
         <location filename="../SensorView.ui" line="67"/>
@@ -4638,27 +4638,27 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SensorView.ui" line="80"/>
         <source> sec</source>
-        <translation type="unfinished"></translation>
+        <translation> sek</translation>
     </message>
     <message>
         <location filename="../SensorView.ui" line="126"/>
         <source>MM/dd/yy hh:mm:ss AP</source>
-        <translation type="unfinished"></translation>
+        <translation>dd/mm/YYYY hh:mm:ss AP</translation>
     </message>
     <message>
         <location filename="../SensorView.ui" line="136"/>
         <source>Light sensor</source>
-        <translation type="unfinished">Lyssensor</translation>
+        <translation>Lyssensor</translation>
     </message>
     <message>
         <location filename="../SensorView.ui" line="142"/>
         <source>Brightness</source>
-        <translation type="unfinished"></translation>
+        <translation>Lysstyrke</translation>
     </message>
     <message>
         <location filename="../SensorView.ui" line="179"/>
         <source>Tilt sensor</source>
-        <translation type="unfinished"></translation>
+        <translation>Tiltsensor</translation>
     </message>
     <message>
         <location filename="../SensorView.ui" line="187"/>
@@ -4675,12 +4675,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SensorView.ui" line="268"/>
         <source>Gyroscope</source>
-        <translation type="unfinished">Gyroskop</translation>
+        <translation>Gyroskop</translation>
     </message>
     <message>
         <location filename="../SensorView.ui" line="296"/>
         <source>Sensitivity</source>
-        <translation type="unfinished"></translation>
+        <translation>Følsomhet</translation>
     </message>
 </context>
 <context>
@@ -4715,12 +4715,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.cpp" line="215"/>
         <source>None</source>
-        <translation type="unfinished">Ingen</translation>
+        <translation>Ingen</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="222"/>
         <source>None (Still Image)</source>
-        <translation type="unfinished"></translation>
+        <translation>Ingen (stillbilde)</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="331"/>
@@ -4756,32 +4756,32 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.cpp" line="452"/>
         <source>Select image</source>
-        <translation type="unfinished">Velg bilde</translation>
+        <translation>Velg bilde</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="452"/>
         <source>Image file (*.png *.jpg *.jpeg)</source>
-        <translation type="unfinished"></translation>
+        <translation>Bildefil (*.png *.jpg *.jpeg)</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="850"/>
         <source>(%1×%2)</source>
-        <translation type="unfinished"></translation>
+        <translation>(%1×%2)</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="868"/>
         <source>Never</source>
-        <translation type="unfinished"></translation>
+        <translation>Aldri</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="873"/>
         <source>Just now</source>
-        <translation type="unfinished"></translation>
+        <translation>Akkurat nå</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="877"/>
         <source>Less than an hour ago</source>
-        <translation type="unfinished"></translation>
+        <translation>Mindre enn én time siden</translation>
     </message>
     <message numerus="yes">
         <location filename="../SettingsView.cpp" line="882"/>
@@ -4802,12 +4802,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="20"/>
         <source>Settings</source>
-        <translation type="unfinished"></translation>
+        <translation>Innstillinger</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="45"/>
         <source>Audio/Video</source>
-        <translation type="unfinished"></translation>
+        <translation>Lyd/Video</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="50"/>
@@ -4817,93 +4817,93 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="55"/>
         <source>Interface</source>
-        <translation type="unfinished"></translation>
+        <translation>Grensesnitt</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="60"/>
         <source>Update</source>
-        <translation type="unfinished"></translation>
+        <translation>Oppdater</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="65"/>
         <source>Emulation</source>
-        <translation type="unfinished"></translation>
+        <translation>Emulering</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="70"/>
         <source>Enhancements</source>
-        <translation type="unfinished"></translation>
+        <translation>Forbedringer</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="75"/>
         <source>BIOS</source>
-        <translation type="unfinished"></translation>
+        <translation>BIOS</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="80"/>
         <source>Paths</source>
-        <translation type="unfinished"></translation>
+        <translation>Filbaner</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="85"/>
         <source>Logging</source>
-        <translation type="unfinished"></translation>
+        <translation>Loggføring</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="90"/>
         <source>Game Boy</source>
-        <translation type="unfinished"></translation>
+        <translation>Game Boy</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="111"/>
         <source>Audio driver:</source>
-        <translation type="unfinished"></translation>
+        <translation>Lyddriver:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="128"/>
         <source>Audio buffer:</source>
-        <translation type="unfinished"></translation>
+        <translation>Lydbuffer:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="140"/>
         <location filename="../SettingsView.ui" line="162"/>
         <source>1536</source>
-        <translation type="unfinished">1536</translation>
+        <translation>1536</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="147"/>
         <source>512</source>
-        <translation type="unfinished">512</translation>
+        <translation>512</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="152"/>
         <source>768</source>
-        <translation type="unfinished">768</translation>
+        <translation>768</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="157"/>
         <source>1024</source>
-        <translation type="unfinished">1024</translation>
+        <translation>1024</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="167"/>
         <source>2048</source>
-        <translation type="unfinished">2048</translation>
+        <translation>2048</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="172"/>
         <source>3072</source>
-        <translation type="unfinished">3072</translation>
+        <translation>3072</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="177"/>
         <source>4096</source>
-        <translation type="unfinished">4096</translation>
+        <translation>4096</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="185"/>
         <source>samples</source>
-        <translation type="unfinished"></translation>
+        <translation>datapunkter</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="194"/>
@@ -4914,32 +4914,32 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../SettingsView.ui" line="206"/>
         <location filename="../SettingsView.ui" line="223"/>
         <source>44100</source>
-        <translation type="unfinished">44100</translation>
+        <translation>44100</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="213"/>
         <source>22050</source>
-        <translation type="unfinished">22050</translation>
+        <translation>22050</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="218"/>
         <source>32000</source>
-        <translation type="unfinished">32000</translation>
+        <translation>32000</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="228"/>
         <source>48000</source>
-        <translation type="unfinished">48000</translation>
+        <translation>48000</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="236"/>
         <source>Hz</source>
-        <translation type="unfinished"></translation>
+        <translation>Hz</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="245"/>
         <source>Volume:</source>
-        <translation type="unfinished"></translation>
+        <translation>Volum:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="276"/>
@@ -4947,7 +4947,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../SettingsView.ui" line="804"/>
         <location filename="../SettingsView.ui" line="829"/>
         <source>Mute</source>
-        <translation type="unfinished"></translation>
+        <translation>Demp lyd</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="285"/>
@@ -4962,7 +4962,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="332"/>
         <source>All windows</source>
-        <translation type="unfinished"></translation>
+        <translation>Alle vinduer</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="345"/>
@@ -4977,7 +4977,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="388"/>
         <source>Display driver:</source>
-        <translation type="unfinished"></translation>
+        <translation>Skjermdriver:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="405"/>
@@ -4987,45 +4987,45 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="414"/>
         <source>Skip every</source>
-        <translation type="unfinished"></translation>
+        <translation>Hopp over hver</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="424"/>
         <location filename="../SettingsView.ui" line="1192"/>
         <source>frames</source>
-        <translation type="unfinished"></translation>
+        <translation>bilder</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="475"/>
         <source>FPS target:</source>
-        <translation type="unfinished"></translation>
+        <translation>Siktemål for bildefrekvens:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="500"/>
         <source>frames per second</source>
-        <translation type="unfinished"></translation>
+        <translation>bilder per sekund</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="516"/>
         <source>Sync:</source>
-        <translation type="unfinished"></translation>
+        <translation>Synkroniser:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="382"/>
         <location filename="../SettingsView.ui" line="525"/>
         <source>Video</source>
-        <translation type="unfinished"></translation>
+        <translation>Video</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="105"/>
         <location filename="../SettingsView.ui" line="532"/>
         <source>Audio</source>
-        <translation type="unfinished"></translation>
+        <translation>Lyd</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="433"/>
         <source>Lock aspect ratio</source>
-        <translation type="unfinished"></translation>
+        <translation>Lås visningsforhold</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="440"/>
@@ -5035,7 +5035,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="454"/>
         <source>Bilinear filtering</source>
-        <translation type="unfinished"></translation>
+        <translation>Bilineær filtrering</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="750"/>
@@ -5046,7 +5046,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../SettingsView.ui" line="797"/>
         <location filename="../SettingsView.ui" line="822"/>
         <source>Pause</source>
-        <translation type="unfinished"></translation>
+        <translation>Pause</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="788"/>
@@ -5056,7 +5056,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="548"/>
         <source>On loading a game:</source>
-        <translation type="unfinished"></translation>
+        <translation>Når det lastes inn et spill:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="555"/>
@@ -5081,32 +5081,32 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="952"/>
         <source>Current channel:</source>
-        <translation type="unfinished"></translation>
+        <translation>Nåværende kanal:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="966"/>
         <source>Current version:</source>
-        <translation type="unfinished"></translation>
+        <translation>Nåværende versjon:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="990"/>
         <source>Update channel:</source>
-        <translation type="unfinished"></translation>
+        <translation>Oppdateringskanal:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1000"/>
         <source>Available version:</source>
-        <translation type="unfinished"></translation>
+        <translation>Tilgjengelig versjon:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1007"/>
         <source>(Unknown)</source>
-        <translation type="unfinished"></translation>
+        <translation>(Ukjent)</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1017"/>
         <source>Last checked:</source>
-        <translation type="unfinished"></translation>
+        <translation>Sist sjekket:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1038"/>
@@ -5116,7 +5116,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="1045"/>
         <source>Check now</source>
-        <translation type="unfinished"></translation>
+        <translation>Sjekk nå</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="2171"/>
@@ -5126,37 +5126,37 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="2164"/>
         <source>SGB color palette if available</source>
-        <translation type="unfinished"></translation>
+        <translation>SGB-fargepalett hvis tilgjengelig</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="2178"/>
         <source>GBC color palette if available</source>
-        <translation type="unfinished"></translation>
+        <translation>GBC-fargepalett hvis tilgjengelig</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="2185"/>
         <source>SGB (preferred) or GBC color palette if available</source>
-        <translation type="unfinished"></translation>
+        <translation>SGB (foretrukket) eller GBC-fargepalett hvis tilgjengelig</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="2197"/>
         <source>Game Boy Camera</source>
-        <translation type="unfinished"></translation>
+        <translation>Game Boy Camera</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="2203"/>
         <source>Driver:</source>
-        <translation type="unfinished"></translation>
+        <translation>Driver:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="2220"/>
         <source>Source:</source>
-        <translation type="unfinished"></translation>
+        <translation>Kilde:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="509"/>
         <source>Native (59.7275)</source>
-        <translation type="unfinished"></translation>
+        <translation>Systemstandard (59.7275)</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="447"/>
@@ -5166,32 +5166,32 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="702"/>
         <source>Language</source>
-        <translation type="unfinished"></translation>
+        <translation>Språk</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="719"/>
         <source>Library:</source>
-        <translation type="unfinished"></translation>
+        <translation>Bibliotek:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="727"/>
         <source>List view</source>
-        <translation type="unfinished"></translation>
+        <translation>Listevisning</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="732"/>
         <source>Tree view</source>
-        <translation type="unfinished"></translation>
+        <translation>Tre-visning</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="740"/>
         <source>Show when no game open</source>
-        <translation type="unfinished"></translation>
+        <translation>Vis når ingen spill er åpne</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="757"/>
         <source>Clear cache</source>
-        <translation type="unfinished"></translation>
+        <translation>Tøm mellomlageret</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="771"/>
@@ -5231,7 +5231,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="855"/>
         <source>Show FPS in title bar</source>
-        <translation type="unfinished"></translation>
+        <translation>Vis bildefrekvensen i tittellinjen</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="897"/>
@@ -5272,7 +5272,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="1169"/>
         <source>Enable rewind</source>
-        <translation type="unfinished"></translation>
+        <translation>Skru på tilbakespoling</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1176"/>
@@ -5292,12 +5292,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="1246"/>
         <source>Run all</source>
-        <translation type="unfinished"></translation>
+        <translation>Kjør alle</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1251"/>
         <source>Remove known</source>
-        <translation type="unfinished"></translation>
+        <translation>Fjern kjente</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1256"/>
@@ -5328,54 +5328,54 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="1812"/>
         <source>Models</source>
-        <translation type="unfinished"></translation>
+        <translation>Modeller</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1818"/>
         <source>GB only:</source>
-        <translation type="unfinished"></translation>
+        <translation>Kun GB:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1828"/>
         <source>SGB compatible:</source>
-        <translation type="unfinished"></translation>
+        <translation>SGB-kompatibel:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1838"/>
         <source>GBC only:</source>
-        <translation type="unfinished"></translation>
+        <translation>Kun GBC:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1848"/>
         <source>GBC compatible:</source>
-        <translation type="unfinished"></translation>
+        <translation>GBC-kompatibel:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1858"/>
         <source>SGB and GBC compatible:</source>
-        <translation type="unfinished"></translation>
+        <translation>SGB- og GBC-kompatible:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1878"/>
         <source>Game Boy palette</source>
-        <translation type="unfinished"></translation>
+        <translation>Game Boy-fargepalett</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1884"/>
         <source>Preset:</source>
-        <translation type="unfinished"></translation>
+        <translation>Forhåndsinnstilling:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="616"/>
         <location filename="../SettingsView.ui" line="660"/>
         <source>Screenshot</source>
-        <translation type="unfinished"></translation>
+        <translation>Skjermbilde</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="636"/>
         <location filename="../SettingsView.ui" line="677"/>
         <source>Cheat codes</source>
-        <translation type="unfinished"></translation>
+        <translation>Juksekoder</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1271"/>
@@ -5395,7 +5395,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="1300"/>
         <source>Software</source>
-        <translation type="unfinished"></translation>
+        <translation>Programvare</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1320"/>
@@ -5410,7 +5410,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="1364"/>
         <source>(240×160)</source>
-        <translation type="unfinished"></translation>
+        <translation>(240×160)</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1313"/>
@@ -5444,22 +5444,22 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="1515"/>
         <source>Skip BIOS intro</source>
-        <translation type="unfinished"></translation>
+        <translation>Hopp over BIOS-introen</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1477"/>
         <source>GBA BIOS file:</source>
-        <translation type="unfinished"></translation>
+        <translation>GBA-BIOS-fil:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1449"/>
         <source>GBC BIOS file:</source>
-        <translation type="unfinished"></translation>
+        <translation>GBC-BIOS-fil:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1421"/>
         <source>SGB BIOS file:</source>
-        <translation type="unfinished"></translation>
+        <translation>SGB-BIOS-fil:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1529"/>
@@ -5488,7 +5488,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="1673"/>
         <source>Patches</source>
-        <translation type="unfinished"></translation>
+        <translation>Patcher</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1721"/>
@@ -5498,7 +5498,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="1778"/>
         <source>Log to file</source>
-        <translation type="unfinished"></translation>
+        <translation>Loggfør til en fil</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1785"/>
@@ -5528,7 +5528,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="1868"/>
         <source>Super Game Boy borders</source>
-        <translation type="unfinished"></translation>
+        <translation>Super Game Boy-kanter</translation>
     </message>
 </context>
 <context>
@@ -5567,7 +5567,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ShaderSelector.ui" line="14"/>
         <source>Shaders</source>
-        <translation type="unfinished">Skyggeleggere</translation>
+        <translation>Skygger</translation>
     </message>
     <message>
         <location filename="../ShaderSelector.ui" line="28"/>
@@ -5577,17 +5577,17 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ShaderSelector.ui" line="35"/>
         <source>Name</source>
-        <translation type="unfinished">Navn</translation>
+        <translation>Navn</translation>
     </message>
     <message>
         <location filename="../ShaderSelector.ui" line="45"/>
         <source>Author</source>
-        <translation type="unfinished"></translation>
+        <translation>Skaper</translation>
     </message>
     <message>
         <location filename="../ShaderSelector.ui" line="62"/>
         <source>Description</source>
-        <translation type="unfinished"></translation>
+        <translation>Beskrivelse</translation>
     </message>
     <message>
         <location filename="../ShaderSelector.ui" line="88"/>
@@ -5615,7 +5615,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ShortcutModel.cpp" line="71"/>
         <source>Gamepad</source>
-        <translation type="unfinished"></translation>
+        <translation>Kontroller</translation>
     </message>
 </context>
 <context>
@@ -5628,17 +5628,17 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../ShortcutView.ui" line="32"/>
         <source>Keyboard</source>
-        <translation type="unfinished">Tastatur</translation>
+        <translation>Tastatur</translation>
     </message>
     <message>
         <location filename="../ShortcutView.ui" line="42"/>
         <source>Gamepad</source>
-        <translation type="unfinished"></translation>
+        <translation>Kontroller</translation>
     </message>
     <message>
         <location filename="../ShortcutView.ui" line="49"/>
         <source>Clear</source>
-        <translation type="unfinished">Tøm</translation>
+        <translation>Tøm</translation>
     </message>
 </context>
 <context>
@@ -5672,17 +5672,17 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../TileView.ui" line="184"/>
         <source>Export All</source>
-        <translation type="unfinished"></translation>
+        <translation>Eksporter alle</translation>
     </message>
     <message>
         <location filename="../TileView.ui" line="40"/>
         <source>256 colors</source>
-        <translation type="unfinished"></translation>
+        <translation>256 farger</translation>
     </message>
     <message>
         <location filename="../TileView.ui" line="33"/>
         <source>Palette</source>
-        <translation type="unfinished">Palett</translation>
+        <translation>Palett</translation>
     </message>
     <message>
         <location filename="../TileView.ui" line="73"/>
@@ -5697,7 +5697,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../TileView.ui" line="103"/>
         <source>Fit to window</source>
-        <translation type="unfinished"></translation>
+        <translation>Tilpass til vinduet</translation>
     </message>
     <message>
         <location filename="../TileView.ui" line="119"/>
@@ -5717,7 +5717,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../TileView.ui" line="145"/>
         <source>Both</source>
-        <translation type="unfinished">Begge</translation>
+        <translation>Begge</translation>
     </message>
     <message>
         <location filename="../TileView.ui" line="163"/>
@@ -5727,7 +5727,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../TileView.ui" line="177"/>
         <source>Copy All</source>
-        <translation type="unfinished"></translation>
+        <translation>Kopier alle</translation>
     </message>
 </context>
 <context>
@@ -5755,44 +5755,44 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../VideoView.ui" line="40"/>
         <source>Start</source>
-        <translation type="unfinished">Start</translation>
+        <translation>Begynn</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="56"/>
         <source>Stop</source>
-        <translation type="unfinished">Stopp</translation>
+        <translation>Stopp</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="69"/>
         <source>Select File</source>
-        <translation type="unfinished">Velg fil</translation>
+        <translation>Velg fil</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="101"/>
         <source>Presets</source>
-        <translation type="unfinished"></translation>
+        <translation>Forhåndsinnstillinger</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="109"/>
         <source>High &amp;Quality</source>
-        <translation type="unfinished"></translation>
+        <translation>Høy &amp;kvalitet</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="119"/>
         <source>&amp;YouTube</source>
-        <translation type="unfinished"></translation>
+        <translation>&amp;YouTube</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="129"/>
         <location filename="../VideoView.ui" line="255"/>
         <source>WebM</source>
-        <translation type="unfinished"></translation>
+        <translation>WebM</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="139"/>
         <location filename="../VideoView.ui" line="265"/>
         <source>MP4</source>
-        <translation type="unfinished"></translation>
+        <translation>MP4</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="146"/>
@@ -5802,22 +5802,22 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../VideoView.ui" line="167"/>
         <source>4K</source>
-        <translation type="unfinished">4K</translation>
+        <translation>4K</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="174"/>
         <source>&amp;1080p</source>
-        <translation type="unfinished"></translation>
+        <translation>&amp;1080p</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="184"/>
         <source>&amp;720p</source>
-        <translation type="unfinished"></translation>
+        <translation>&amp;720p</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="194"/>
         <source>&amp;480p</source>
-        <translation type="unfinished"></translation>
+        <translation>&amp;480p</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="207"/>
@@ -5827,47 +5827,47 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../VideoView.ui" line="240"/>
         <source>Format</source>
-        <translation type="unfinished"></translation>
+        <translation>Format</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="250"/>
         <source>MKV</source>
-        <translation type="unfinished"></translation>
+        <translation>MKV</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="260"/>
         <source>AVI</source>
-        <translation type="unfinished"></translation>
+        <translation>AVI</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="277"/>
         <source>H.264</source>
-        <translation type="unfinished"></translation>
+        <translation>H.264</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="282"/>
         <source>H.264 (NVENC)</source>
-        <translation type="unfinished"></translation>
+        <translation>H.264 (NVENC)</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="287"/>
         <source>HEVC</source>
-        <translation type="unfinished"></translation>
+        <translation>HEVC</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="292"/>
         <source>HEVC (NVENC)</source>
-        <translation type="unfinished"></translation>
+        <translation>HEVC (NVENC)</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="297"/>
         <source>VP8</source>
-        <translation type="unfinished"></translation>
+        <translation>VP8</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="302"/>
         <source>VP9</source>
-        <translation type="unfinished"></translation>
+        <translation>VP9</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="307"/>
@@ -5878,12 +5878,12 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../VideoView.ui" line="312"/>
         <location filename="../VideoView.ui" line="359"/>
         <source>None</source>
-        <translation type="unfinished">Ingen</translation>
+        <translation>Ingen</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="324"/>
         <source>FLAC</source>
-        <translation type="unfinished"></translation>
+        <translation>FLAC</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="329"/>
@@ -5893,27 +5893,27 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../VideoView.ui" line="334"/>
         <source>Opus</source>
-        <translation type="unfinished"></translation>
+        <translation>Opus</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="339"/>
         <source>Vorbis</source>
-        <translation type="unfinished"></translation>
+        <translation>Vorbis</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="344"/>
         <source>MP3</source>
-        <translation type="unfinished"></translation>
+        <translation>MP3</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="349"/>
         <source>AAC</source>
-        <translation type="unfinished"></translation>
+        <translation>AAC</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="354"/>
         <source>Uncompressed</source>
-        <translation type="unfinished"></translation>
+        <translation>Ukomprimert</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="370"/>
@@ -5923,32 +5923,32 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../VideoView.ui" line="415"/>
         <source>ABR</source>
-        <translation type="unfinished"></translation>
+        <translation>ABR</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="460"/>
         <source>VBR</source>
-        <translation type="unfinished"></translation>
+        <translation>VBR</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="473"/>
         <source>CRF</source>
-        <translation type="unfinished"></translation>
+        <translation>CRF</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="489"/>
         <source>Dimensions</source>
-        <translation type="unfinished">Dimensjoner</translation>
+        <translation>Dimensjoner</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="555"/>
         <source>Lock aspect ratio</source>
-        <translation type="unfinished"></translation>
+        <translation>Lås visningsforhold</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="570"/>
         <source>Show advanced</source>
-        <translation type="unfinished">Vis avanserte innstillinger</translation>
+        <translation>Vis avansert</translation>
     </message>
 </context>
 <context>
@@ -5974,7 +5974,7 @@ Nedlastningsstørrelse: %3</translation>
         <location filename="../Window.cpp" line="499"/>
         <location filename="../Window.cpp" line="506"/>
         <source>Select save</source>
-        <translation type="unfinished"></translation>
+        <translation>Velg lagrefil</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="418"/>
@@ -5989,12 +5989,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="429"/>
         <source>Select e-Reader dotcode</source>
-        <translation type="unfinished"></translation>
+        <translation>Velg e-Reader-punktkode</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="429"/>
         <source>e-Reader card (*.raw *.bin *.bmp)</source>
-        <translation type="unfinished"></translation>
+        <translation>e-Reader-kort (*.raw *.bin *.bmp)</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="492"/>
@@ -6019,7 +6019,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="547"/>
         <source>Video logs (*.mvl)</source>
-        <translation type="unfinished"></translation>
+        <translation>Videologgføringer (*.mvl)</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="986"/>
@@ -6036,12 +6036,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="994"/>
         <source>Couldn&apos;t Start</source>
-        <translation type="unfinished"></translation>
+        <translation>Klarte ikke å starte opp</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="995"/>
         <source>Could not start game.</source>
-        <translation type="unfinished"></translation>
+        <translation>Klarte ikke å starte opp spillet.</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1009"/>
@@ -6071,7 +6071,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1131"/>
         <source>Restart needed</source>
-        <translation type="unfinished"></translation>
+        <translation>Gjennomfør omstart</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1132"/>
@@ -6086,12 +6086,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1194"/>
         <source>%1 - %2</source>
-        <translation type="unfinished"></translation>
+        <translation>%1 - %2</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1196"/>
         <source>%1 - %2 - %3</source>
-        <translation type="unfinished"></translation>
+        <translation>%1 - %2 - %3</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1198"/>
@@ -6101,12 +6101,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1262"/>
         <source>&amp;File</source>
-        <translation type="unfinished"></translation>
+        <translation>&amp;Fil</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1264"/>
         <source>Load &amp;ROM...</source>
-        <translation type="unfinished"></translation>
+        <translation>Last inn &amp;ROM...</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1267"/>
@@ -6126,7 +6126,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="380"/>
         <source>Select save game</source>
-        <translation type="unfinished"></translation>
+        <translation>Velg lagrefil</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="388"/>
@@ -6142,12 +6142,12 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="437"/>
         <source>Select e-Reader card images</source>
-        <translation type="unfinished"></translation>
+        <translation>Velg e-Reader-kortavbildninger</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="437"/>
         <source>Image file (*.png *.jpg *.jpeg)</source>
-        <translation type="unfinished"></translation>
+        <translation>Bildefil (*.png *.jpg *.jpeg)</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="438"/>
@@ -6177,17 +6177,17 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1311"/>
         <source>Boot BIOS</source>
-        <translation type="unfinished"></translation>
+        <translation>Oppstarts-BIOS</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1405"/>
         <source>Replace ROM...</source>
-        <translation type="unfinished"></translation>
+        <translation>Bytt ROM....</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1315"/>
         <source>Scan e-Reader dotcodes...</source>
-        <translation type="unfinished"></translation>
+        <translation>Skann e-Reader-punktkoder...</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1710"/>
@@ -6202,7 +6202,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1321"/>
         <source>Recent</source>
-        <translation type="unfinished"></translation>
+        <translation>Nylig</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1668"/>
@@ -6212,7 +6212,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1324"/>
         <source>&amp;Load state</source>
-        <translation type="unfinished"></translation>
+        <translation>&amp;Last inn tilstand</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1329"/>
@@ -6222,7 +6222,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1334"/>
         <source>&amp;Save state</source>
-        <translation type="unfinished"></translation>
+        <translation>&amp;Lagre en tilstand</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1339"/>
@@ -6323,47 +6323,47 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1385"/>
         <source>Connect to Dolphin...</source>
-        <translation type="unfinished"></translation>
+        <translation>Koble til Dolphin...</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1391"/>
         <source>Report bug...</source>
-        <translation type="unfinished"></translation>
+        <translation>Rapporter inn feil...</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1397"/>
         <source>About...</source>
-        <translation type="unfinished"></translation>
+        <translation>Om …</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1398"/>
         <source>E&amp;xit</source>
-        <translation type="unfinished"></translation>
+        <translation>A&amp;vslutt</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1400"/>
         <source>&amp;Emulation</source>
-        <translation type="unfinished"></translation>
+        <translation>&amp;Emulering</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1401"/>
         <source>&amp;Reset</source>
-        <translation type="unfinished"></translation>
+        <translation>&amp;Omstart</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1402"/>
         <source>Sh&amp;utdown</source>
-        <translation type="unfinished"></translation>
+        <translation>Skr&amp;u av</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1406"/>
         <source>Yank game pak</source>
-        <translation type="unfinished"></translation>
+        <translation>Dra ut spillkassetten</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1409"/>
         <source>&amp;Pause</source>
-        <translation type="unfinished"></translation>
+        <translation>&amp;Pause</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1418"/>
@@ -6393,7 +6393,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1441"/>
         <source>%0x</source>
-        <translation type="unfinished">%0x</translation>
+        <translation>%0x</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1445"/>
@@ -6408,7 +6408,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1459"/>
         <source>Rewind (held)</source>
-        <translation type="unfinished"></translation>
+        <translation>Spol tilbake (holdt)</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1466"/>
@@ -6423,37 +6423,37 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1478"/>
         <source>Solar sensor</source>
-        <translation type="unfinished"></translation>
+        <translation>Solsensor</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1479"/>
         <source>Increase solar level</source>
-        <translation type="unfinished"></translation>
+        <translation>Øke solnivået</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1480"/>
         <source>Decrease solar level</source>
-        <translation type="unfinished"></translation>
+        <translation>Reduser solnivået</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1481"/>
         <source>Brightest solar level</source>
-        <translation type="unfinished"></translation>
+        <translation>Lyseste solnivå</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1484"/>
         <source>Darkest solar level</source>
-        <translation type="unfinished"></translation>
+        <translation>Mørkeste solnivå</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1490"/>
         <source>Brightness %1</source>
-        <translation type="unfinished"></translation>
+        <translation>Lysstyrke %1</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1498"/>
         <source>Game Boy Printer...</source>
-        <translation type="unfinished"></translation>
+        <translation>Game Boy Printer...</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1507"/>
@@ -6468,22 +6468,22 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1512"/>
         <source>Frame size</source>
-        <translation type="unfinished"></translation>
+        <translation>Rammestørrelse</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1514"/>
         <source>%1×</source>
-        <translation type="unfinished">%1×</translation>
+        <translation>%1×</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1539"/>
         <source>Toggle fullscreen</source>
-        <translation type="unfinished"></translation>
+        <translation>Skru på/av fullskjerm</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1542"/>
         <source>Lock aspect ratio</source>
-        <translation type="unfinished"></translation>
+        <translation>Lås visningsforhold</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1554"/>
@@ -6498,7 +6498,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1575"/>
         <source>Bilinear filtering</source>
-        <translation type="unfinished"></translation>
+        <translation>Bilineær filtrering</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1583"/>
@@ -6508,7 +6508,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1596"/>
         <source>Mute</source>
-        <translation type="unfinished"></translation>
+        <translation>Demp lyd</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1603"/>
@@ -6518,17 +6518,17 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1611"/>
         <source>Native (59.7275)</source>
-        <translation type="unfinished"></translation>
+        <translation>Systemstandard (59.7275)</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1626"/>
         <source>Take &amp;screenshot</source>
-        <translation type="unfinished"></translation>
+        <translation>Ta &amp;skjermbilde</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1628"/>
         <source>F12</source>
-        <translation type="unfinished"></translation>
+        <translation>F12</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1632"/>
@@ -6548,7 +6548,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1638"/>
         <source>Audio channels</source>
-        <translation type="unfinished"></translation>
+        <translation>Lydkanaler</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1640"/>
@@ -6558,7 +6558,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1642"/>
         <source>&amp;Tools</source>
-        <translation type="unfinished"></translation>
+        <translation>Verk&amp;tøy</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1643"/>
@@ -6573,7 +6573,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1657"/>
         <source>Game Pak sensors...</source>
-        <translation type="unfinished"></translation>
+        <translation>Game Pak-sensorer ...</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1659"/>
@@ -6588,7 +6588,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1667"/>
         <source>Settings...</source>
-        <translation type="unfinished"></translation>
+        <translation>Innstillinger…</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1672"/>
@@ -6613,7 +6613,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1683"/>
         <source>View &amp;palette...</source>
-        <translation type="unfinished"></translation>
+        <translation>Vis &amp;palett ...</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1684"/>
@@ -6628,7 +6628,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1686"/>
         <source>View &amp;map...</source>
-        <translation type="unfinished"></translation>
+        <translation>Vis &amp;kart …</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1688"/>
@@ -6663,7 +6663,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1719"/>
         <source>Exit fullscreen</source>
-        <translation type="unfinished"></translation>
+        <translation>Gå ut av fullskjerm</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1721"/>
@@ -6728,7 +6728,7 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1966"/>
         <source>Clear</source>
-        <translation type="unfinished">Tøm</translation>
+        <translation>Tøm</translation>
     </message>
 </context>
 <context>
@@ -6736,47 +6736,47 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../utils.cpp" line="20"/>
         <source>%1 byte</source>
-        <translation type="unfinished"></translation>
+        <translation>%1 byte</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="23"/>
         <source>%1 kiB</source>
-        <translation type="unfinished"></translation>
+        <translation>%1 kiB</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="27"/>
         <source>%1 MiB</source>
-        <translation type="unfinished"></translation>
+        <translation>%1 MiB</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="36"/>
         <source>GBA</source>
-        <translation type="unfinished"></translation>
+        <translation>GBA</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="40"/>
         <source>GB</source>
-        <translation type="unfinished"></translation>
+        <translation>GB</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="43"/>
         <source>?</source>
-        <translation type="unfinished"></translation>
+        <translation>?</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="146"/>
         <source>Super (L)</source>
-        <translation type="unfinished"></translation>
+        <translation>Super (L)</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="148"/>
         <source>Super (R)</source>
-        <translation type="unfinished"></translation>
+        <translation>Super (R)</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="150"/>
         <source>Menu</source>
-        <translation type="unfinished">Meny</translation>
+        <translation>Meny</translation>
     </message>
 </context>
 <context>
@@ -6784,22 +6784,22 @@ Nedlastningsstørrelse: %3</translation>
     <message>
         <location filename="../utils.cpp" line="137"/>
         <source>Shift</source>
-        <translation type="unfinished"></translation>
+        <translation>Shift</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="139"/>
         <source>Control</source>
-        <translation type="unfinished"></translation>
+        <translation>Kontroll</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="141"/>
         <source>Alt</source>
-        <translation type="unfinished"></translation>
+        <translation>Alt</translation>
     </message>
     <message>
         <location filename="../utils.cpp" line="143"/>
         <source>Meta</source>
-        <translation type="unfinished"></translation>
+        <translation>Meta</translation>
     </message>
 </context>
 </TS>

From 5ba82dd217effccc3ab8fe736040350c633a4cf3 Mon Sep 17 00:00:00 2001
From: Hexaae <hexaae@gmail.com>
Date: Sun, 25 Feb 2024 22:41:33 +0000
Subject: [PATCH 47/53] Qt: Update translation (Italian)

Translation: mGBA/Qt
Translate-URL: https://hosted.weblate.org/projects/mgba/mgba-qt/it/
---
 src/platform/qt/ts/mgba-it.ts | 102 +++++++++++++++++-----------------
 1 file changed, 51 insertions(+), 51 deletions(-)

diff --git a/src/platform/qt/ts/mgba-it.ts b/src/platform/qt/ts/mgba-it.ts
index a0a0deb5e..12a018db7 100644
--- a/src/platform/qt/ts/mgba-it.ts
+++ b/src/platform/qt/ts/mgba-it.ts
@@ -530,12 +530,12 @@ Dimensione del download: %3</translation>
     <message>
         <location filename="../ForwarderGenerator.cpp" line="83"/>
         <source>3DS</source>
-        <translation type="unfinished"></translation>
+        <translation>3DS</translation>
     </message>
     <message>
         <location filename="../ForwarderGenerator.cpp" line="85"/>
         <source>Vita</source>
-        <translation type="unfinished"></translation>
+        <translation>Vita</translation>
     </message>
 </context>
 <context>
@@ -543,12 +543,12 @@ Dimensione del download: %3</translation>
     <message>
         <location filename="../ForwarderGenerator3DS.cpp" line="29"/>
         <source>Icon</source>
-        <translation type="unfinished"></translation>
+        <translation>Icona</translation>
     </message>
     <message>
         <location filename="../ForwarderGenerator3DS.cpp" line="30"/>
         <source>Banner</source>
-        <translation type="unfinished"></translation>
+        <translation>Striscia</translation>
     </message>
 </context>
 <context>
@@ -556,7 +556,7 @@ Dimensione del download: %3</translation>
     <message>
         <location filename="../ForwarderGeneratorVita.cpp" line="25"/>
         <source>Bubble</source>
-        <translation type="unfinished"></translation>
+        <translation>Bolla</translation>
     </message>
     <message>
         <location filename="../ForwarderGeneratorVita.cpp" line="26"/>
@@ -566,7 +566,7 @@ Dimensione del download: %3</translation>
     <message>
         <location filename="../ForwarderGeneratorVita.cpp" line="27"/>
         <source>Startup</source>
-        <translation type="unfinished"></translation>
+        <translation>Avvio</translation>
     </message>
 </context>
 <context>
@@ -574,17 +574,17 @@ Dimensione del download: %3</translation>
     <message>
         <location filename="../ForwarderView.ui" line="14"/>
         <source>Create forwarder</source>
-        <translation type="unfinished"></translation>
+        <translation>Crea Icona di avvio</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="20"/>
         <source>Files</source>
-        <translation type="unfinished"></translation>
+        <translation>File</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="26"/>
         <source>ROM file:</source>
-        <translation type="unfinished"></translation>
+        <translation>File ROM:</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="36"/>
@@ -596,127 +596,127 @@ Dimensione del download: %3</translation>
     <message>
         <location filename="../ForwarderView.ui" line="43"/>
         <source>Output filename:</source>
-        <translation type="unfinished"></translation>
+        <translation>Nome file in uscita:</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="60"/>
         <source>Forwarder base:</source>
-        <translation type="unfinished"></translation>
+        <translation>Base dell&apos;Icona di avvio:</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="74"/>
         <source>Latest stable version</source>
-        <translation type="unfinished"></translation>
+        <translation>Ultima versione stabile</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="79"/>
         <source>Latest development build</source>
-        <translation type="unfinished"></translation>
+        <translation>Ultima development build</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="84"/>
         <source>Specific file</source>
-        <translation type="unfinished"></translation>
+        <translation>File specifico</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="95"/>
         <source>Base file:</source>
-        <translation type="unfinished"></translation>
+        <translation>File base:</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="135"/>
         <source>System</source>
-        <translation type="unfinished"></translation>
+        <translation>Sistema</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="141"/>
         <source>3DS</source>
-        <translation type="unfinished"></translation>
+        <translation>3DS</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="151"/>
         <source>Vita</source>
-        <translation type="unfinished"></translation>
+        <translation>Vita</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="174"/>
         <source>Presentation</source>
-        <translation type="unfinished"></translation>
+        <translation>Presentazione</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="182"/>
         <source>Title:</source>
-        <translation type="unfinished"></translation>
+        <translation>Titolo:</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="195"/>
         <source>Images:</source>
-        <translation type="unfinished"></translation>
+        <translation>Immagini:</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="215"/>
         <source>Use default image</source>
-        <translation type="unfinished"></translation>
+        <translation>Usa immagine predefinita</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="328"/>
         <source>Preferred size:</source>
-        <translation type="unfinished"></translation>
+        <translation>Dimensione preferita:</translation>
     </message>
     <message>
         <location filename="../ForwarderView.ui" line="395"/>
         <source>Select image file</source>
-        <translation type="unfinished"></translation>
+        <translation>Seleziona file immagine</translation>
     </message>
     <message>
         <location filename="../ForwarderView.cpp" line="22"/>
         <source>Select ROM file</source>
-        <translation type="unfinished"></translation>
+        <translation>Seleziona file ROM</translation>
     </message>
     <message>
         <location filename="../ForwarderView.cpp" line="23"/>
         <source>Select output filename</source>
-        <translation type="unfinished"></translation>
+        <translation>Selezione nome file in uscita</translation>
     </message>
     <message>
         <location filename="../ForwarderView.cpp" line="24"/>
         <source>Select base file</source>
-        <translation type="unfinished"></translation>
+        <translation>Selezione file base</translation>
     </message>
     <message>
         <location filename="../ForwarderView.cpp" line="36"/>
         <source>Build finished</source>
-        <translation type="unfinished"></translation>
+        <translation>Build completata</translation>
     </message>
     <message>
         <location filename="../ForwarderView.cpp" line="37"/>
         <source>Forwarder finished building</source>
-        <translation type="unfinished"></translation>
+        <translation>Icona di avvio compilazione completata</translation>
     </message>
     <message>
         <location filename="../ForwarderView.cpp" line="44"/>
         <source>Build failed</source>
-        <translation type="unfinished"></translation>
+        <translation>Build fallita</translation>
     </message>
     <message>
         <location filename="../ForwarderView.cpp" line="45"/>
         <source>Failed to build forwarder</source>
-        <translation type="unfinished"></translation>
+        <translation>Impossibile compilare Icona di avvio</translation>
     </message>
     <message>
         <location filename="../ForwarderView.cpp" line="176"/>
         <source>%1 installable package (*.%2)</source>
-        <translation type="unfinished"></translation>
+        <translation>%1 pacchetto installabile (*.%2)</translation>
     </message>
     <message>
         <location filename="../ForwarderView.cpp" line="192"/>
         <source>Select an image</source>
-        <translation type="unfinished"></translation>
+        <translation>Seleziona una immagine</translation>
     </message>
     <message>
         <location filename="../ForwarderView.cpp" line="192"/>
         <source>Image files (*.png *.jpg *.bmp)</source>
-        <translation type="unfinished"></translation>
+        <translation>File immagine (*.png *.jpg *.bmp)</translation>
     </message>
 </context>
 <context>
@@ -1085,12 +1085,12 @@ Dimensione del download: %3</translation>
     <message>
         <location filename="../GameBoy.cpp" line="95"/>
         <source>NT (old 1)</source>
-        <translation type="unfinished"></translation>
+        <translation>NT (vec. 1)</translation>
     </message>
     <message>
         <location filename="../GameBoy.cpp" line="96"/>
         <source>NT (old 2)</source>
-        <translation type="unfinished"></translation>
+        <translation>NT (vec. 2)</translation>
     </message>
     <message>
         <location filename="../GameBoy.cpp" line="97"/>
@@ -1115,12 +1115,12 @@ Dimensione del download: %3</translation>
     <message>
         <location filename="../GameBoy.cpp" line="101"/>
         <source>GGB-81</source>
-        <translation type="unfinished"></translation>
+        <translation>GGB-81</translation>
     </message>
     <message>
         <location filename="../GameBoy.cpp" line="102"/>
         <source>Li Cheng</source>
-        <translation type="unfinished"></translation>
+        <translation>Li Cheng</translation>
     </message>
     <message>
         <location filename="../GameBoy.cpp" line="103"/>
@@ -3752,17 +3752,17 @@ Dimensione del download: %3</translation>
     <message>
         <location filename="../MultiplayerController.cpp" line="327"/>
         <source>Trying to detach a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>Tentativo di scollegare un giocatore in multi che non è collegato</translation>
     </message>
     <message>
         <location filename="../MultiplayerController.cpp" line="391"/>
         <source>Trying to get player ID for a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>Cerco di ottenere l&apos;ID giocatore per un giocatore in multi non collegato</translation>
     </message>
     <message>
         <location filename="../MultiplayerController.cpp" line="405"/>
         <source>Trying to get save ID for a multiplayer player that&apos;s not attached</source>
-        <translation type="unfinished"></translation>
+        <translation>Cerco di ottenere l&apos;ID di salvataggio per un giocatore in multi non collegato</translation>
     </message>
 </context>
 <context>
@@ -4310,7 +4310,7 @@ Dimensione del download: %3</translation>
     <message>
         <location filename="../ROMInfo.ui" line="114"/>
         <source>Save file:</source>
-        <translation type="unfinished"></translation>
+        <translation>Salva file:</translation>
     </message>
 </context>
 <context>
@@ -4477,7 +4477,7 @@ Dimensione del download: %3</translation>
     <message>
         <location filename="../SaveConverter.cpp" line="487"/>
         <source> + RTC</source>
-        <translation type="unfinished"></translation>
+        <translation> + RTC</translation>
     </message>
     <message>
         <location filename="../SaveConverter.cpp" line="496"/>
@@ -4779,7 +4779,7 @@ Dimensione del download: %3</translation>
     <message>
         <location filename="../SettingsView.cpp" line="873"/>
         <source>Just now</source>
-        <translation>Solo adesso</translation>
+        <translation>Proprio adesso</translation>
     </message>
     <message>
         <location filename="../SettingsView.cpp" line="877"/>
@@ -5079,7 +5079,7 @@ Dimensione del download: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="941"/>
         <source>Custom border:</source>
-        <translation type="unfinished"></translation>
+        <translation>Bordo personalizzato:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="952"/>
@@ -5109,7 +5109,7 @@ Dimensione del download: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="1017"/>
         <source>Last checked:</source>
-        <translation>Vista l&apos;ultima volta:</translation>
+        <translation>Ultimo controllo:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1038"/>
@@ -5124,7 +5124,7 @@ Dimensione del download: %3</translation>
     <message>
         <location filename="../SettingsView.ui" line="1201"/>
         <source>Rewind speed:</source>
-        <translation type="unfinished"></translation>
+        <translation>Velocità riavvolgimento:</translation>
     </message>
     <message>
         <location filename="../SettingsView.ui" line="1812"/>
@@ -5891,7 +5891,7 @@ Dimensione del download: %3</translation>
     <message>
         <location filename="../VideoView.ui" line="329"/>
         <source>WavPack</source>
-        <translation type="unfinished"></translation>
+        <translation>WavPack</translation>
     </message>
     <message>
         <location filename="../VideoView.ui" line="334"/>
@@ -6312,12 +6312,12 @@ Dimensione del download: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1445"/>
         <source>Increase fast forward speed</source>
-        <translation type="unfinished"></translation>
+        <translation>Aumenta la velocità di avvolgimento veloce</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1452"/>
         <source>Decrease fast forward speed</source>
-        <translation type="unfinished"></translation>
+        <translation>Diminuisci la velocità di avvolgimento veloce</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1459"/>
@@ -6447,7 +6447,7 @@ Dimensione del download: %3</translation>
     <message>
         <location filename="../Window.cpp" line="1664"/>
         <source>Create forwarder...</source>
-        <translation type="unfinished"></translation>
+        <translation>Crea Icona di avvio...</translation>
     </message>
     <message>
         <location filename="../Window.cpp" line="1672"/>

From 42d01664d284d8cf7d28b7de738bb5edc7e91c3f Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Wed, 3 Apr 2024 04:57:19 -0700
Subject: [PATCH 48/53] SDL: Fix build on SDL 2.0.12

---
 src/platform/sdl/sdl-events.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/src/platform/sdl/sdl-events.c b/src/platform/sdl/sdl-events.c
index 383775636..cd34a7781 100644
--- a/src/platform/sdl/sdl-events.c
+++ b/src/platform/sdl/sdl-events.c
@@ -920,12 +920,14 @@ static const char* const buttonNamesXboxOne[SDL_CONTROLLER_BUTTON_MAX] = {
 	[SDL_CONTROLLER_BUTTON_RIGHTSTICK] = "RS",
 	[SDL_CONTROLLER_BUTTON_LEFTSHOULDER] = "LB",
 	[SDL_CONTROLLER_BUTTON_RIGHTSHOULDER] = "RB",
+#if SDL_VERSION_ATLEAST(2, 0, 14)
 	[SDL_CONTROLLER_BUTTON_MISC1] = "Share",
 	[SDL_CONTROLLER_BUTTON_PADDLE1] = "P1",
 	[SDL_CONTROLLER_BUTTON_PADDLE2] = "P2",
 	[SDL_CONTROLLER_BUTTON_PADDLE3] = "P3",
 	[SDL_CONTROLLER_BUTTON_PADDLE4] = "P4",
 	[SDL_CONTROLLER_BUTTON_TOUCHPAD] = "Touch",
+#endif
 };
 
 static const char* const buttonNamesPlayStation[SDL_CONTROLLER_BUTTON_MAX] = {
@@ -940,12 +942,14 @@ static const char* const buttonNamesPlayStation[SDL_CONTROLLER_BUTTON_MAX] = {
 	[SDL_CONTROLLER_BUTTON_RIGHTSTICK] = "R3",
 	[SDL_CONTROLLER_BUTTON_LEFTSHOULDER] = "L1",
 	[SDL_CONTROLLER_BUTTON_RIGHTSHOULDER] = "R1",
+#if SDL_VERSION_ATLEAST(2, 0, 14)
 	[SDL_CONTROLLER_BUTTON_MISC1] = "Misc",
 	[SDL_CONTROLLER_BUTTON_PADDLE1] = "P1",
 	[SDL_CONTROLLER_BUTTON_PADDLE2] = "P2",
 	[SDL_CONTROLLER_BUTTON_PADDLE3] = "P3",
 	[SDL_CONTROLLER_BUTTON_PADDLE4] = "P4",
 	[SDL_CONTROLLER_BUTTON_TOUCHPAD] = "Touch",
+#endif
 };
 
 static const char* const buttonNamesNintedo[SDL_CONTROLLER_BUTTON_MAX] = {
@@ -960,12 +964,14 @@ static const char* const buttonNamesNintedo[SDL_CONTROLLER_BUTTON_MAX] = {
 	[SDL_CONTROLLER_BUTTON_RIGHTSTICK] = "RS",
 	[SDL_CONTROLLER_BUTTON_LEFTSHOULDER] = "L",
 	[SDL_CONTROLLER_BUTTON_RIGHTSHOULDER] = "R",
+#if SDL_VERSION_ATLEAST(2, 0, 14)
 	[SDL_CONTROLLER_BUTTON_MISC1] = "Share",
 	[SDL_CONTROLLER_BUTTON_PADDLE1] = "P1",
 	[SDL_CONTROLLER_BUTTON_PADDLE2] = "P2",
 	[SDL_CONTROLLER_BUTTON_PADDLE3] = "P3",
 	[SDL_CONTROLLER_BUTTON_PADDLE4] = "P4",
 	[SDL_CONTROLLER_BUTTON_TOUCHPAD] = "Touch",
+#endif
 };
 
 static const char* const buttonNamesGeneric[SDL_CONTROLLER_BUTTON_MAX] = {

From a27f02ec0f0cff22b73c485d34df7142f1f93d19 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Wed, 3 Apr 2024 04:59:04 -0700
Subject: [PATCH 49/53] SDL: Really fix the build this time

---
 src/platform/sdl/sdl-events.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/src/platform/sdl/sdl-events.c b/src/platform/sdl/sdl-events.c
index cd34a7781..08a369c73 100644
--- a/src/platform/sdl/sdl-events.c
+++ b/src/platform/sdl/sdl-events.c
@@ -899,12 +899,14 @@ static const char* const buttonNamesXbox360[SDL_CONTROLLER_BUTTON_MAX] = {
 	[SDL_CONTROLLER_BUTTON_RIGHTSTICK] = "RS",
 	[SDL_CONTROLLER_BUTTON_LEFTSHOULDER] = "LB",
 	[SDL_CONTROLLER_BUTTON_RIGHTSHOULDER] = "RB",
+#if SDL_VERSION_ATLEAST(2, 0, 14)
 	[SDL_CONTROLLER_BUTTON_MISC1] = "Misc",
 	[SDL_CONTROLLER_BUTTON_PADDLE1] = "P1",
 	[SDL_CONTROLLER_BUTTON_PADDLE2] = "P2",
 	[SDL_CONTROLLER_BUTTON_PADDLE3] = "P3",
 	[SDL_CONTROLLER_BUTTON_PADDLE4] = "P4",
 	[SDL_CONTROLLER_BUTTON_TOUCHPAD] = "Touch",
+#endif
 };
 
 #if SDL_VERSION_ATLEAST(2, 0, 12)
@@ -986,12 +988,14 @@ static const char* const buttonNamesGeneric[SDL_CONTROLLER_BUTTON_MAX] = {
 	[SDL_CONTROLLER_BUTTON_RIGHTSTICK] = "RS",
 	[SDL_CONTROLLER_BUTTON_LEFTSHOULDER] = "LB",
 	[SDL_CONTROLLER_BUTTON_RIGHTSHOULDER] = "RB",
+#if SDL_VERSION_ATLEAST(2, 0, 14)
 	[SDL_CONTROLLER_BUTTON_MISC1] = "Misc",
 	[SDL_CONTROLLER_BUTTON_PADDLE1] = "P1",
 	[SDL_CONTROLLER_BUTTON_PADDLE2] = "P2",
 	[SDL_CONTROLLER_BUTTON_PADDLE3] = "P3",
 	[SDL_CONTROLLER_BUTTON_PADDLE4] = "P4",
 	[SDL_CONTROLLER_BUTTON_TOUCHPAD] = "Touch",
+#endif
 };
 #endif
 

From 9b612fbe7996d8d4408a3aefb8cf01bbdefd9f2e Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Thu, 4 Apr 2024 00:28:58 -0700
Subject: [PATCH 50/53] Core: Fix some mutex ordering

---
 src/core/thread.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/src/core/thread.c b/src/core/thread.c
index 4b470777d..11465e232 100644
--- a/src/core/thread.c
+++ b/src/core/thread.c
@@ -433,13 +433,13 @@ static THREAD_ENTRY _mCoreThreadRun(void* context) {
 				threadContext->run(threadContext);
 			}
 		}
+		MutexLock(&impl->stateMutex);
 	}
 
-	while (impl->state < mTHREAD_SHUTDOWN) {
-		MutexLock(&impl->stateMutex);
+	if (impl->state < mTHREAD_SHUTDOWN) {
 		impl->state = mTHREAD_SHUTDOWN;
-		MutexUnlock(&impl->stateMutex);
 	}
+	MutexUnlock(&impl->stateMutex);
 
 	if (core->opts.rewindEnable) {
 		 mCoreRewindContextDeinit(&impl->rewind);

From e9f318d8cf976c10eee1e0fcf822cd794fc5ec3c Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Thu, 4 Apr 2024 00:31:47 -0700
Subject: [PATCH 51/53] Scripting: Attempt to fix MSVC build

---
 include/mgba/script/macros.h | 4 ++--
 include/mgba/script/types.h  | 1 +
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/include/mgba/script/macros.h b/include/mgba/script/macros.h
index 7d2057d4e..70eed0af5 100644
--- a/include/mgba/script/macros.h
+++ b/include/mgba/script/macros.h
@@ -323,7 +323,7 @@ CXX_GUARD_START
 	} \
 
 #define _mSCRIPT_DECLARE_STRUCT_OVERLOADED_METHOD_BINDING(TYPE, NAME, T) \
-	static const struct mScriptFunctionOverload _mSTStructBindingOverloads_ ## TYPE ## _ ## NAME[]; \
+	static const struct mScriptFunctionOverload _mSTStructBindingOverloads_ ## TYPE ## _ ## NAME[mSCRIPT_OVERLOADS_MAX]; \
 	static bool _mSTStructBinding_ ## TYPE ## _ ## NAME(struct mScriptFrame* frame, void* ctx) { \
 		UNUSED(ctx); \
 		const struct mScriptFunctionOverload* overload = mScriptFunctionFindOverload(_mSTStructBindingOverloads_ ## TYPE ## _ ## NAME, &frame->arguments); \
@@ -468,7 +468,7 @@ CXX_GUARD_START
 #define mSCRIPT_DEFINE_DEFAULTS_END }
 
 #define mSCRIPT_DEFINE_STRUCT_METHOD_OVERLOADS(STRUCT, METHOD) \
-	static const struct mScriptFunctionOverload _mSTStructBindingOverloads_ ## STRUCT ## _ ## METHOD[] = { \
+	static const struct mScriptFunctionOverload _mSTStructBindingOverloads_ ## STRUCT ## _ ## METHOD[mSCRIPT_OVERLOADS_MAX] = { \
 
 #define mSCRIPT_DEFINE_STRUCT_METHOD_OVERLOAD(TYPE, FUNCTION) { \
 	.type = &_mSTStructBindingType_ ## TYPE ## _ ## FUNCTION, \
diff --git a/include/mgba/script/types.h b/include/mgba/script/types.h
index 5770456e6..5b07abe3b 100644
--- a/include/mgba/script/types.h
+++ b/include/mgba/script/types.h
@@ -16,6 +16,7 @@ CXX_GUARD_START
 
 #define mSCRIPT_VALUE_UNREF -1
 #define mSCRIPT_PARAMS_MAX 8
+#define mSCRIPT_OVERLOADS_MAX 8
 
 #define mSCRIPT_VALUE_DOC_FUNCTION(NAME) (&_mScriptDoc_ ## NAME)
 

From b17d05bd74235f51302d91894d2b0de7927efe73 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Thu, 4 Apr 2024 22:49:48 -0700
Subject: [PATCH 52/53] Core: More threading cleanup

---
 include/mgba/core/thread.h |  3 ++-
 src/core/thread.c          | 42 +++++++++++++++++++-------------------
 2 files changed, 23 insertions(+), 22 deletions(-)

diff --git a/include/mgba/core/thread.h b/include/mgba/core/thread.h
index d3d8a9e92..9f2c229be 100644
--- a/include/mgba/core/thread.h
+++ b/include/mgba/core/thread.h
@@ -87,7 +87,8 @@ struct mCoreThreadInternal {
 	int requested;
 
 	Mutex stateMutex;
-	Condition stateCond;
+	Condition stateOnThreadCond;
+	Condition stateOffThreadCond;
 	int interruptDepth;
 	bool frameWasOn;
 
diff --git a/src/core/thread.c b/src/core/thread.c
index 11465e232..e0ace6240 100644
--- a/src/core/thread.c
+++ b/src/core/thread.c
@@ -44,12 +44,12 @@ static void _mCoreLog(struct mLogger* logger, int category, enum mLogLevel level
 
 static void _changeState(struct mCoreThreadInternal* threadContext, enum mCoreThreadState newState) {
 	threadContext->state = newState;
-	ConditionWake(&threadContext->stateCond);
+	ConditionWake(&threadContext->stateOffThreadCond);
 }
 
 static void _waitOnInterrupt(struct mCoreThreadInternal* threadContext) {
 	while (threadContext->state == mTHREAD_INTERRUPTED || threadContext->state == mTHREAD_INTERRUPTING) {
-		ConditionWait(&threadContext->stateCond, &threadContext->stateMutex);
+		ConditionWait(&threadContext->stateOnThreadCond, &threadContext->stateMutex);
 	}
 }
 
@@ -110,7 +110,7 @@ static void _wait(struct mCoreThreadInternal* threadContext) {
 #endif
 
 	MutexLock(&threadContext->stateMutex);
-	ConditionWake(&threadContext->stateCond);
+	ConditionWake(&threadContext->stateOnThreadCond);
 }
 
 static void _waitOnRequest(struct mCoreThreadInternal* threadContext, enum mCoreThreadRequest request) {
@@ -140,7 +140,7 @@ static void _sendRequest(struct mCoreThreadInternal* threadContext, enum mCoreTh
 static void _cancelRequest(struct mCoreThreadInternal* threadContext, enum mCoreThreadRequest request) {
 	threadContext->requested &= ~request;
 	_pokeRequest(threadContext);
-	ConditionWake(&threadContext->stateCond);
+	ConditionWake(&threadContext->stateOffThreadCond);
 }
 
 void _frameStarted(void* context) {
@@ -351,19 +351,18 @@ static THREAD_ENTRY _mCoreThreadRun(void* context) {
 
 		while (impl->state >= mTHREAD_MIN_WAITING && impl->state < mTHREAD_EXITING) {
 			if (impl->state == mTHREAD_INTERRUPTING) {
-				impl->state = mTHREAD_INTERRUPTED;
-				ConditionWake(&impl->stateCond);
+				_changeState(impl, mTHREAD_INTERRUPTED);
 			}
 
 			while (impl->state >= mTHREAD_MIN_WAITING && impl->state <= mTHREAD_MAX_WAITING) {
 #ifdef USE_DEBUGGERS
 				if (debugger && debugger->state != DEBUGGER_SHUTDOWN) {
 					mDebuggerUpdate(debugger);
-					ConditionWaitTimed(&impl->stateCond, &impl->stateMutex, 10);
+					ConditionWaitTimed(&impl->stateOnThreadCond, &impl->stateMutex, 10);
 				} else
 #endif
 				{
-					ConditionWait(&impl->stateCond, &impl->stateMutex);
+					ConditionWait(&impl->stateOnThreadCond, &impl->stateMutex);
 				}
 
 				if (impl->sync.audioWait) {
@@ -392,14 +391,13 @@ static THREAD_ENTRY _mCoreThreadRun(void* context) {
 		if (impl->state == mTHREAD_REQUEST) {
 			if (pendingRequests) {
 				if (pendingRequests & mTHREAD_REQ_PAUSE) {
-					impl->state = mTHREAD_PAUSED;
+					_changeState(impl, mTHREAD_PAUSED);
 				}
 				if (pendingRequests & mTHREAD_REQ_WAIT) {
-					impl->state = mTHREAD_PAUSED;
+					_changeState(impl, mTHREAD_PAUSED);
 				}
 			} else {
-				impl->state = mTHREAD_RUNNING;
-				ConditionWake(&threadContext->impl->stateCond);
+				_changeState(impl, mTHREAD_RUNNING);
 			}
 		}
 		MutexUnlock(&impl->stateMutex);
@@ -439,6 +437,7 @@ static THREAD_ENTRY _mCoreThreadRun(void* context) {
 	if (impl->state < mTHREAD_SHUTDOWN) {
 		impl->state = mTHREAD_SHUTDOWN;
 	}
+	ConditionWake(&threadContext->impl->stateOffThreadCond);
 	MutexUnlock(&impl->stateMutex);
 
 	if (core->opts.rewindEnable) {
@@ -477,7 +476,8 @@ bool mCoreThreadStart(struct mCoreThread* threadContext) {
 	}
 
 	MutexInit(&threadContext->impl->stateMutex);
-	ConditionInit(&threadContext->impl->stateCond);
+	ConditionInit(&threadContext->impl->stateOnThreadCond);
+	ConditionInit(&threadContext->impl->stateOffThreadCond);
 
 	MutexInit(&threadContext->impl->sync.videoFrameMutex);
 	ConditionInit(&threadContext->impl->sync.videoFrameAvailableCond);
@@ -502,7 +502,7 @@ bool mCoreThreadStart(struct mCoreThread* threadContext) {
 	MutexLock(&threadContext->impl->stateMutex);
 	ThreadCreate(&threadContext->impl->thread, _mCoreThreadRun, threadContext);
 	while (threadContext->impl->state < mTHREAD_RUNNING) {
-		ConditionWait(&threadContext->impl->stateCond, &threadContext->impl->stateMutex);
+		ConditionWait(&threadContext->impl->stateOffThreadCond, &threadContext->impl->stateMutex);
 	}
 	MutexUnlock(&threadContext->impl->stateMutex);
 
@@ -544,7 +544,7 @@ bool mCoreThreadHasCrashed(struct mCoreThread* threadContext) {
 
 void mCoreThreadMarkCrashed(struct mCoreThread* threadContext) {
 	MutexLock(&threadContext->impl->stateMutex);
-	threadContext->impl->state = mTHREAD_CRASHED;
+	_changeState(threadContext->impl, mTHREAD_CRASHED);
 	MutexUnlock(&threadContext->impl->stateMutex);
 }
 
@@ -552,7 +552,7 @@ void mCoreThreadClearCrashed(struct mCoreThread* threadContext) {
 	MutexLock(&threadContext->impl->stateMutex);
 	if (threadContext->impl->state == mTHREAD_CRASHED) {
 		threadContext->impl->state = mTHREAD_REQUEST;
-		ConditionWake(&threadContext->impl->stateCond);
+		ConditionWake(&threadContext->impl->stateOnThreadCond);
 	}
 	MutexUnlock(&threadContext->impl->stateMutex);
 }
@@ -561,7 +561,7 @@ void mCoreThreadEnd(struct mCoreThread* threadContext) {
 	MutexLock(&threadContext->impl->stateMutex);
 	_waitOnInterrupt(threadContext->impl);
 	threadContext->impl->state = mTHREAD_EXITING;
-	ConditionWake(&threadContext->impl->stateCond);
+	ConditionWake(&threadContext->impl->stateOnThreadCond);
 	MutexUnlock(&threadContext->impl->stateMutex);
 	MutexLock(&threadContext->impl->sync.audioBufferMutex);
 	threadContext->impl->sync.audioWait = 0;
@@ -590,7 +590,8 @@ void mCoreThreadJoin(struct mCoreThread* threadContext) {
 	ThreadJoin(&threadContext->impl->thread);
 
 	MutexDeinit(&threadContext->impl->stateMutex);
-	ConditionDeinit(&threadContext->impl->stateCond);
+	ConditionDeinit(&threadContext->impl->stateOnThreadCond);
+	ConditionDeinit(&threadContext->impl->stateOffThreadCond);
 
 	MutexDeinit(&threadContext->impl->sync.videoFrameMutex);
 	ConditionWake(&threadContext->impl->sync.videoFrameAvailableCond);
@@ -642,7 +643,6 @@ void mCoreThreadInterruptFromThread(struct mCoreThread* threadContext) {
 		return;
 	}
 	threadContext->impl->state = mTHREAD_INTERRUPTING;
-	ConditionWake(&threadContext->impl->stateCond);
 	MutexUnlock(&threadContext->impl->stateMutex);
 }
 
@@ -658,7 +658,7 @@ void mCoreThreadContinue(struct mCoreThread* threadContext) {
 		} else {
 			threadContext->impl->state = mTHREAD_RUNNING;			
 		}
-		ConditionWake(&threadContext->impl->stateCond);
+		ConditionWake(&threadContext->impl->stateOnThreadCond);
 	}
 	MutexUnlock(&threadContext->impl->stateMutex);
 }
@@ -718,7 +718,7 @@ void mCoreThreadSetRewinding(struct mCoreThread* threadContext, bool rewinding)
 	threadContext->impl->rewinding = rewinding;
 	if (rewinding && threadContext->impl->state == mTHREAD_CRASHED) {
 		threadContext->impl->state = mTHREAD_REQUEST;
-		ConditionWake(&threadContext->impl->stateCond);
+		ConditionWake(&threadContext->impl->stateOnThreadCond);
 	}
 	MutexUnlock(&threadContext->impl->stateMutex);
 }

From 4ea113440085ca620b7e8483838843877bdc11d0 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Fri, 5 Apr 2024 00:10:09 -0700
Subject: [PATCH 53/53] GBA GPIO: Fix gyro read-out start (fixes #3141)

---
 CHANGES                          |  1 +
 src/gba/cart/gpio.c              | 10 ++++++----
 src/platform/3ds/main.c          |  2 +-
 src/platform/libretro/libretro.c |  2 +-
 src/platform/psp2/psp2-context.c |  2 +-
 src/platform/sdl/sdl-events.c    |  4 ++--
 src/platform/switch/main.c       |  2 +-
 src/platform/wii/main.c          |  2 +-
 8 files changed, 14 insertions(+), 11 deletions(-)

diff --git a/CHANGES b/CHANGES
index efb7d494e..5abed6a7e 100644
--- a/CHANGES
+++ b/CHANGES
@@ -12,6 +12,7 @@ Emulation fixes:
  - GB Video: Implement DMG-style sprite ordering
  - GBA: Unhandled bkpt should be treated as an undefined exception
  - GBA GPIO: Fix tilt scale and orientation (fixes mgba.io/i/2703)
+ - GBA GPIO: Fix gyro read-out start (fixes mgba.io/i/3141)
  - GBA I/O: Fix HALTCNT access behavior (fixes mgba.io/i/2309)
  - GBA SIO: Fix MULTI mode SIOCNT bit 7 writes on secondary GBAs (fixes mgba.io/i/3110)
  - GBA Video: Disable BG target 1 blending when OBJ blending (fixes mgba.io/i/2722)
diff --git a/src/gba/cart/gpio.c b/src/gba/cart/gpio.c
index 53c14dafd..811dc1e8a 100644
--- a/src/gba/cart/gpio.c
+++ b/src/gba/cart/gpio.c
@@ -320,18 +320,20 @@ void _gyroReadPins(struct GBACartridgeHardware* hw) {
 		return;
 	}
 
+	// Write bit on falling edge
+	bool doOutput = hw->gyroEdge && !(hw->pinState & 2);
 	if (hw->pinState & 1) {
 		if (gyro->sample) {
 			gyro->sample(gyro);
 		}
 		int32_t sample = gyro->readGyroZ(gyro);
 
-		// Normalize to ~12 bits, focused on 0x6C0
-		hw->gyroSample = (sample >> 21) + 0x6C0; // Crop off an extra bit so that we can't go negative
+		// Normalize to ~12 bits, focused on 0x700
+		hw->gyroSample = (sample >> 21) + 0x700; // Crop off an extra bit so that we can't go negative
+		doOutput = true;
 	}
 
-	if (hw->gyroEdge && !(hw->pinState & 2)) {
-		// Write bit on falling edge
+	if (doOutput) {
 		unsigned bit = hw->gyroSample >> 15;
 		hw->gyroSample <<= 1;
 		_outputPins(hw, bit << 2);
diff --git a/src/platform/3ds/main.c b/src/platform/3ds/main.c
index 0f7bb27b9..36df49a9c 100644
--- a/src/platform/3ds/main.c
+++ b/src/platform/3ds/main.c
@@ -704,7 +704,7 @@ static int32_t _readTiltY(struct mRotationSource* source) {
 
 static int32_t _readGyroZ(struct mRotationSource* source) {
 	struct m3DSRotationSource* rotation = (struct m3DSRotationSource*) source;
-	return rotation->gyro.y << 18L; // Yes, y
+	return rotation->gyro.y << 17L; // Yes, y
 }
 
 static void _startRequestImage(struct mImageSource* source, unsigned w, unsigned h, int colorFormats) {
diff --git a/src/platform/libretro/libretro.c b/src/platform/libretro/libretro.c
index 8ee80ff7d..9e67dec19 100644
--- a/src/platform/libretro/libretro.c
+++ b/src/platform/libretro/libretro.c
@@ -2554,7 +2554,7 @@ static void _updateRotation(struct mRotationSource* source) {
 		tiltY = sensorGetCallback(0, RETRO_SENSOR_ACCELEROMETER_Y) * 2e8f;
 	}
 	if (gyroEnabled) {
-		gyroZ = sensorGetCallback(0, RETRO_SENSOR_GYROSCOPE_Z) * -1.1e9f;
+		gyroZ = sensorGetCallback(0, RETRO_SENSOR_GYROSCOPE_Z) * -5.5e8f;
 	}
 }
 
diff --git a/src/platform/psp2/psp2-context.c b/src/platform/psp2/psp2-context.c
index a7504f7cc..1e48c2f24 100644
--- a/src/platform/psp2/psp2-context.c
+++ b/src/platform/psp2/psp2-context.c
@@ -149,7 +149,7 @@ static int32_t _readTiltY(struct mRotationSource* source) {
 
 static int32_t _readGyroZ(struct mRotationSource* source) {
 	struct mSceRotationSource* rotation = (struct mSceRotationSource*) source;
-	return rotation->state.gyro.z * -0x10000000;
+	return rotation->state.gyro.z * -0x8000000;
 }
 
 static void _setRumble(struct mRumble* source, int enable) {
diff --git a/src/platform/sdl/sdl-events.c b/src/platform/sdl/sdl-events.c
index 08a369c73..46807cae1 100644
--- a/src/platform/sdl/sdl-events.c
+++ b/src/platform/sdl/sdl-events.c
@@ -823,14 +823,14 @@ static void _mSDLRotationSample(struct mRotationSource* source) {
 			float theta[3];
 			int count = SDL_GameControllerGetSensorData(controller, SDL_SENSOR_GYRO, theta, 3);
 			if (count >= 0) {
-				rotation->zDelta = theta[1] / -10.f;
+				rotation->zDelta = theta[1] / -20.f;
 			}
 			return;
 		}
 	}
 #endif
 	if (rotation->gyroZ >= 0) {
-		rotation->zDelta = SDL_JoystickGetAxis(rotation->p->joystick->joystick, rotation->gyroZ) / 1.e5f;
+		rotation->zDelta = SDL_JoystickGetAxis(rotation->p->joystick->joystick, rotation->gyroZ) / 2.e5f;
 		return;
 	}
 
diff --git a/src/platform/switch/main.c b/src/platform/switch/main.c
index ef3e12164..15196aaec 100644
--- a/src/platform/switch/main.c
+++ b/src/platform/switch/main.c
@@ -644,7 +644,7 @@ void _sampleRotation(struct mRotationSource* source) {
 	}
 	tiltX = sixaxis.acceleration.x * 3e8f;
 	tiltY = sixaxis.acceleration.y * -3e8f;
-	gyroZ = sixaxis.angular_velocity.z * -1.1e9f;
+	gyroZ = sixaxis.angular_velocity.z * -5.5e8f;
 }
 
 int32_t _readTiltX(struct mRotationSource* source) {
diff --git a/src/platform/wii/main.c b/src/platform/wii/main.c
index db3ed7242..60d4e95ae 100644
--- a/src/platform/wii/main.c
+++ b/src/platform/wii/main.c
@@ -1731,7 +1731,7 @@ void _sampleRotation(struct mRotationSource* source) {
 		return;
 	}
 	gyroZ = exp.mp.rz - 0x1FA0;
-	gyroZ <<= 18;
+	gyroZ <<= 17;
 }
 
 int32_t _readTiltX(struct mRotationSource* source) {
